{"version":3,"file":"dependencies.spec.js","sourceRoot":"","sources":["../../src/lib/dependencies.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import test = require('blue-tape')\nimport { join } from 'path'\nimport { EventEmitter } from 'events'\nimport { resolveAllDependencies } from './dependencies'\nimport { DependencyTree, DependencyBranch } from '../interfaces'\n\nconst RESOLVE_FIXTURE_DIR = join(__dirname, '__test__/fixtures/resolve')\nconst emitter = new EventEmitter()\n\ntest('dependencies', t => {\n  t.test('resolve fixture', t => {\n    t.test('resolve a dependency tree', t => {\n      const expected: DependencyTree = {\n        raw: undefined,\n        global: false,\n        postmessage: undefined,\n        name: 'foobar',\n        src: join(RESOLVE_FIXTURE_DIR, 'typings.json'),\n        main: 'foo.d.ts',\n        files: undefined,\n        version: undefined,\n        browser: undefined,\n        typings: undefined,\n        browserTypings: undefined,\n        dependencies: {},\n        devDependencies: {},\n        peerDependencies: {},\n        globalDependencies: {},\n        globalDevDependencies: {}\n      }\n\n      const bowerDep: DependencyTree = {\n        raw: 'bower:bower-dep',\n        global: false,\n        postmessage: undefined,\n        src: join(RESOLVE_FIXTURE_DIR, 'bower_components/bower-dep/bower.json'),\n        typings: 'bower-dep.d.ts',\n        browserTypings: undefined,\n        dependencies: {},\n        devDependencies: {},\n        peerDependencies: {},\n        globalDependencies: {},\n        globalDevDependencies: {},\n        name: 'bower-dep',\n        files: undefined,\n        version: undefined,\n        main: 'index.js',\n        browser: undefined\n      }\n\n      const exampleDep: DependencyTree = {\n        raw: 'bower:example',\n        global: false,\n        postmessage: undefined,\n        src: join(RESOLVE_FIXTURE_DIR, 'bower_components/example/bower.json'),\n        main: undefined,\n        browser: undefined,\n        files: undefined,\n        version: undefined,\n        typings: undefined,\n        browserTypings: undefined,\n        name: 'example',\n        dependencies: {},\n        devDependencies: {},\n        peerDependencies: {},\n        globalDependencies: {},\n        globalDevDependencies: {}\n      }\n\n      const typedDep: DependencyTree = {\n        raw: 'file:typings/dep.d.ts',\n        global: undefined,\n        postmessage: undefined,\n        src: join(RESOLVE_FIXTURE_DIR, 'typings/dep.d.ts'),\n        typings: join(RESOLVE_FIXTURE_DIR, 'typings/dep.d.ts'),\n        main: undefined,\n        browser: undefined,\n        files: undefined,\n        version: undefined,\n        browserTypings: undefined,\n        dependencies: {},\n        devDependencies: {},\n        peerDependencies: {},\n        globalDependencies: {},\n        globalDevDependencies: {}\n      }\n\n      const npmDep: DependencyTree = {\n        raw: 'npm:npm-dep',\n        global: false,\n        postmessage: undefined,\n        src: join(RESOLVE_FIXTURE_DIR, 'node_modules/npm-dep/package.json'),\n        main: './index.js',\n        browser: undefined,\n        files: undefined,\n        version: undefined,\n        typings: undefined,\n        browserTypings: undefined,\n        name: 'npm-dep',\n        dependencies: {},\n        devDependencies: {},\n        peerDependencies: {},\n        globalDependencies: {},\n        globalDevDependencies: {}\n      }\n\n      const typedDevDep: DependencyTree = {\n        globalDependencies: {},\n        globalDevDependencies: {},\n        browser: undefined,\n        browserTypings: undefined,\n        dependencies: {},\n        devDependencies: {},\n        peerDependencies: {},\n        main: undefined,\n        name: 'dep',\n        raw: 'bower:dep',\n        global: false,\n        postmessage: undefined,\n        src: join(RESOLVE_FIXTURE_DIR, 'bower_components/dep/bower.json'),\n        typings: undefined,\n        files: undefined,\n        version: undefined\n      }\n\n      ;(expected as any).dependencies['bower-dep'] = bowerDep\n      ;(expected as any).dependencies.dep = typedDep\n      ;(expected as any).dependencies['npm-dep'] = npmDep\n      ;(expected as any).devDependencies['dev-dep'] = typedDevDep\n\n      ;(bowerDep as any).dependencies.example = exampleDep\n\n      return resolveAllDependencies({\n        cwd: RESOLVE_FIXTURE_DIR,\n        dev: true,\n        emitter\n      })\n        .then((result) => {\n          function removeParentReferenceFromDependencies (dependencies: DependencyBranch) {\n            Object.keys(dependencies).forEach(function (key) {\n              removeParentReference(dependencies[key])\n            })\n          }\n\n          function removeParentReference (tree: DependencyTree) {\n            delete tree.parent\n\n            removeParentReferenceFromDependencies(tree.dependencies)\n            removeParentReferenceFromDependencies(tree.devDependencies)\n            removeParentReferenceFromDependencies(tree.peerDependencies)\n            removeParentReferenceFromDependencies(tree.globalDependencies)\n            removeParentReferenceFromDependencies(tree.globalDevDependencies)\n\n            return tree\n          }\n\n          t.equal(result.parent, undefined)\n          t.ok((result.dependencies as any).dep.parent != null)\n          t.ok((result.dependencies as any)['npm-dep'].parent != null)\n\n          removeParentReference(result)\n\n          t.deepEqual(result, expected)\n        })\n    })\n  })\n})\n"]}