{"version":3,"sources":["vs/base/common/worker/fake","vs/base/common/worker/workerServer.js","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/arrays.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/assert.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/collections.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/events.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/map.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/platform.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/paths.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/stopwatch.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/strings.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/filters.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/glob.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/types.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/graph.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/lifecycle.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/mime.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/objects.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/uri.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/marshalling.ts","vs/base/common/worker/vs/base/common/winjs.base.raw.js","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/worker/workerProtocol.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/core/arrays.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/core/modeTransition.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/core/position.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/core/range.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/core/viewLineToken.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/editorCommon.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/indentationGuesser.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/lineToken.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/tokenIterator.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/wordHelper.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/abstractState.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/languageSelector.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/lineStream.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/monarch/monarchCommon.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/monarch/monarchCompile.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/nullMode.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports/characterPair.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports/richEditBrackets.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports/electricCharacter.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports/tokenizationSupport.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/monarch/monarchLexer.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/viewModel/prefixSumComputer.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/errors.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/callbackList.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/event.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/cancellation.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/eventEmitter.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/timer.ts","vs/base/common/worker/vs/base/common/winjs.base.js","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/async.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/network.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/worker/workerServer.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/tokensBinaryEncoding.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/modelLine.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/languageFeatureRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports/onEnter.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/languageConfigurationRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/textModelWithTokensHelpers.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/base/common/severity.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/config/defaultConfig.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/textModel.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/textModelWithTokens.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/model/mirrorModel.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/instantiation/common/descriptors.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/instantiation/common/instantiation.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/compatWorkerService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/editorWorkerService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/modeService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/modelService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/resourceService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/resourceServiceImpl.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/configuration/common/configuration.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/event/common/event.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/event/common/eventService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/extensions/common/extensions.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/instantiation/common/serviceCollection.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/instantiation/common/instantiationService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/platform.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/modesRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/compatWorkerServiceWorker.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/languagesRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/jsonschemas/common/jsonContributionRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/extensions/common/extensionsRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/configuration/common/configurationRegistry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/supports/suggestSupport.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/modes/abstractMode.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/services/modeServiceImpl.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/extensions/common/abstractExtensionService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/request/common/request.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/telemetry/common/telemetry.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/request/common/baseRequestService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/workspace/common/workspace.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/languages.common.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/platform/workspace/common/baseWorkspaceContextService.ts","vs/base/common/worker/file:/home/aeschli/workspaces/vscode/src/vs/editor/common/worker/editorWorkerServer.ts"],"names":["__m","__M","deps","result","i","len","length","define","require","exports","tail","array","n","forEach","callback","splice","equals","one","other","itemEquals","a","b","binarySearch","key","comparator","low","high","mid","comp","findFirst","p","Math","floor","merge","arrays","hashFn","Array","map","j","element","hash","hasOwnProperty","push","apply","coalesce","filter","e","contains","item","indexOf","swap","pos1","pos2","element1","element2","move","from","to","isFalsyOrEmpty","obj","isArray","distinct","keyFn","position","seen","Object","create","elem","uniqueFilter","firstIndex","fn","first","notFoundValue","index","commonPrefixLength","min","flatten","arr","reduce","r","v","concat","range","fill","num","valueFn","indexer","t","ok","value","message","Error","createStringDictionary","createNumberDictionary","lookup","what","alternate","String","lookupOrInsert","stringOrNumber","insert","into","data","call","values","remove","groupBy","groupFn","prototype","__extends","this","d","__","constructor","Event","originalEvent","time","Date","getTime","source","PropertyChangeEvent","_super","oldValue","newValue","ViewerEvent","EventType","PROPERTY_CHANGED","SELECTION","FOCUS","BLUR","HIGHLIGHT","EXPAND","COLLAPSE","TOGGLE","CONTENTS_CHANGED","BEFORE_RUN","RUN","EDIT","SAVE","CANCEL","CHANGE","DISPOSE","SimpleMap","_size","defineProperty","get","enumerable","configurable","k","peek","keys","entries","set","pop","has","clear","entry","toString","LinkedMap","limit","ratio","Number","MAX_VALUE","trim","next","prev","head","current","LRUCache","hasWebWorkerSupport","_globals","Worker","_isWindows","_isMacintosh","_isLinux","_isRootUser","_isNative","_isWeb","_isQunit","_locale","undefined","_language","LANGUAGE_DEFAULT","process","platform","getuid","vscode_nls_config","env","nlsConfig","JSON","parse","resolved","availableLanguages","locale","navigator","userAgent","language","self","QUnit","Platform","_platform","Web","Mac","Windows","Linux","isWindows","isMacintosh","isLinux","isRootUser","isNative","isWeb","isQunit","global","globals","setTimeout","bind","clearTimeout","setInterval","clearInterval","platform_1","relative","normalize","fromParts","split","sep","toParts","shift","unshift","join","dirname","path","idx","lastIndexOf","substring","basename","substr","extname","_isNormal","win","_winBadPath","test","_posixBadPath","toOSPath","wantsBackslash","root","getRoot","start","skip","res","end","charCodeAt","_slash","_backslash","streql","prev_start","prev_part","slice","part","code","pos_1","replace","_A","_Z","_a","_z","_colon","pos","isUNC","isNaN","isPosixAbsolute","makePosixAbsolute","isEqualOrParent","candidate","candidateLen","lastCandidateChar","toLowerCase","char","isValidBasename","name","INVALID_FILE_CHARS","lastIndex","WINDOWS_FORBIDDEN_NAMES","isAbsolute","isAbsoluteRegex","nativeSep","arguments","last","hasPerformanceNow","performance","now","StopWatch","highResolution","_highResolution","_startTime","_now","_stopTime","stop","elapsed","map_1","pad","l","str","reverse","format","args","_i","_formatRegexp","match","group","parseInt","escape","html","escapeRegExpCharacters","haystack","needle","trimmed","ltrim","rtrim","needleLen","offset","haystackLen","convertSimple2RegExpPattern","pattern","stripWildcards","startsWith","endsWith","diff","createRegExp","searchString","isRegex","matchCase","wholeWord","charAt","modifiers","RegExp","createSafeRegExp","regex","err","regExpLeadsToEndlessLoop","regexp","exec","normalizeNFC","canNormalize","cached","normalizedCache","nonAsciiCharactersPattern","firstNonWhitespaceIndex","getLeadingWhitespace","lastNonWhitespaceIndex","startIndex","localeCompare","strA","strB","isAsciiChar","equalsIgnoreCase","len1","len2","codeA","codeB","abs","fromCharCode","toLocaleLowerCase","commonSuffixLength","aLastIndex","bLastIndex","isFullWidthCharacter","charCode","difference","second","maxLenDelta","lengthDifference","LCS","zeroArray","max","sqrt","computeLineStarts","text","ret","lcut","segments","count","empty","removeAnsiEscapeCodes","EL","LF","COLOR_START","COLOR_END","startsWithUTF8BOM","__utf8_bom","appendWithLimit","maxLength","newLength","safeBtoa","btoa","encodeURIComponent","repeat","s","UTF8_BOM_CHARACTER","strings","or","word","wordToMatchAgainst","and","_matchesPrefix","ignoreCase","matchesContiguousSubString","matchesSubString","_matchesSubString","isLower","isUpper","isNumber","isWhitespace","isAlphanumeric","nextAnchor","camelCaseWord","c","_matchesCamelCase","nextUpperIndex","isCamelCaseWord","upper","lower","alpha","numeric","upperPercent","lowerPercent","alphaPercent","numericPercent","isCamelCasePattern","whitespace","matchesCamelCase","matchesWords","target","_matchesWords","nextWord","nextWordIndex","matchesFuzzy","enableSeparateSubstringMatching","fuzzyRegExpCache","fuzzySeparateFilter","fuzzyContiguousFilter","matchesStrictPrefix","matchesPrefix","SubstringMatching","paths","starsToRegExp","starCount","NO_PATH_REGEX","PATH_REGEX","splitGlobAware","splitChar","inBraces","inBrackets","curVal","parseRegExp","regEx","every","previousSegmentWasGlobStar_1","segment","braceVal","bracketVal","choices","braceRegExp","parsePattern","parsedPattern","CACHE","T1","trivia","Trivia","T2","T3","toRegExp","error","arg1","siblings","base","some","matchExpression","expression","patterns","getOwnPropertyNames","_loop_1","when","clause","clausePattern_1","sibling","state_1","_typeof","number","isString","string","isStringArray","isObject","object","isBoolean","isUndefined","isUndefinedOrNull","isEmptyObject","isFunction","areFunctions","objects","validateConstraints","constraints","validateConstraint","arg","constraint","ctor","function","types_1","collections_1","newNode","incoming","outgoing","Graph","_hashFn","_nodes","roots","traverse","inwards","startNode","_traverse","node","_this","nodes","insertEdge","fromNode","lookupOrInsertNode","toNode","removeNode","dispose","disposables","combinedDisposable","toDisposable","fns","freeze","Disposable","_toDispose","_register","Disposables","add","arg_1","types","glob_1","registerTextMime","association","registeredAssociations","userConfigured","mime","extension","console","warn","filename","filepattern","firstline","clearTextMimes","onlyUserConfigured","guessMimeTypes","firstLine","MIME_UNKNOWN","configuredMime","guessMimeTypeByPath","MIME_TEXT","registeredMime","firstlineMime","guessMimeTypeByFirstline","associations","filenameMatch","patternMatch","extensionMatch","matches","isBinaryMime","mimes","mimeVals","MIME_BINARY","isUnspecific","suggestFilename","theMime","prefix","Types","clone","deepClone","cloneAndChange","changer","_cloneAndChange","encounteredObjects","changed","r1","i1","r2","i2","mixin","destination","overwrite","assign","sources","toObject","keyMap","valueMap","x","o","oneKeys","sort","otherKeys","ensureProperty","property","defaultValue","arrayToHash","createKeywordMatcher","caseInsensitive","derive","baseClass","derivedClass","prop","basePrototype","derivedPrototype","getOwnPropertyDescriptor","writable","safeStringify","stringify","getOrDefault","_encode","ch","toUpperCase","encodeURIComponent2","encodeNoop","URI","_scheme","_empty","_authority","_path","_query","_fragment","_formatted","_fsPath","scheme","_driveLetterPath","change","authority","query","fragment","_validate","_parseComponents","decodeURIComponent","file","_regexp","components","skipEncoding","_asFormatted","uri","encoder","parts","m","_upperCaseDrive","lastIdx","toJSON","fsPath","external","$mid","revive","uri_1","replacer","reviver","flags","multiline","marshallingConst","_modules","_winjs","moduleId","factory","exportsPassedIn","depsValues","dep","globalObject","window","_Global","markSupportedForProcessing","func","supportedForProcessing","hasWinRT","_setImmediate","setImmediate","handler","msWriteProfilerMark","_WinJS","_BaseCoreUtils","_WriteProfilerMark","initializeProperties","members","properties","member","setName","defineProperties","createNamespace","parentNamespace","currentNamespace","namespaceFragments","namespaceName","defineWithParent","lazy","f","state","LazyStates","uninitialized","initialized","working","moduleDefine","publicNS","_rootNamespace","Namespace","_lazy","_moduleDefine","instanceMembers","staticMembers","mix","Class","_Base","ErrorFromName","createEventProperty","eventPropStateName","userHandler","wrapper","evt","addEventListener","removeEventListener","createEventProperties","props","EventMixinEvent","type","detail","timeStamp","bubbles","cancelable","currentTarget","defaultPrevented","_preventDefaultCalled","trusted","eventPhase","preventDefault","stopImmediatePropagation","_stopImmediatePropagationCalled","stopPropagation","eventMixin","_listeners","listener","useCapture","eventListeners","dispatchEvent","details","listeners","eventValue","_createEventProperty","nop","_traceAsyncOperationStarting","Debug","msTraceAsyncOperationStarting","_traceAsyncOperationCompleted","msTraceAsyncOperationCompleted","_traceAsyncCallbackStarting","msTraceAsyncCallbackStarting","_traceAsyncCallbackCompleted","msTraceAsyncCallbackCompleted","_ErrorFromName","_Events","_Trace","_","completed","promise","targetState","then","state_waiting","state_success_notify","_value","_setState","createErrorDetails","exception","id","parent","detailsForHandledError","errorValue","context","_isException","errorId","_errorId","detailsForChainedError","setErrorInfo","detailsForError","error_number","detailsForException","exceptionValue","done","onComplete","onError","onProgress","asyncOpID","pushListener","onerrorDetails","callonerror","state_error_notify","notifySuccess","queue","MS_ASYNC_OP_STATUS_SUCCESS","_setCompleteValue","ex","_setExceptionValue","_state","CompletePromise","notifyError","errorID","canceledName","MS_ASYNC_OP_STATUS_CANCELED","MS_ASYNC_OP_STATUS_ERROR","asyncCallbackStarted","handlesOnError","_setChainedErrorValue","ErrorPromise","onerrorDetailsGenerator","promiseEventListeners","errorET","progress","_progress","isException","setErrorValue","state_error","setCompleteValue","state_success","ThenPromise","timeout","timeoutMS","Promise","timeoutWithPromise","cancelPromise","cancel","cancelTimeout","setNonUserCodeExceptions","ListenerType","tagWithStack","tag","thenPromise","errorPromise","exceptionPromise","completePromise","all","state_created","state_working","state_waiting_canceled","state_canceled","state_canceling","enter","_completed","_error","_notify","_setErrorValue","waitedUpon","_chainedError","_cancelAction","_cleanupAction","staticCanceledPromise","PromiseStateMachine","_nextState","_run","creator","_stack","_getStack","_creator","unused","_doneHandler","ExceptionPromise","init","oncancel","_oncancel","complete","stack","eventType","capture","any","canceled","as","is","errors","results","undefineds","pending","argDone","errorCount","canceledCount","Key","Done","thenEach","wrap","wrapError","_veryExpensiveTagWithStack","_veryExpensiveTagWithStack_tag","debuggerEnabled","_cancelBlocker","input","output","_StateMachine","exported","amd","module","nextTick","MessageType","INITIALIZE","REPLY","PRINT","ReplyType","COMPLETE","ERROR","PROGRESS","PrintType","LOG","DEBUG","INFO","WARN","Arrays","findIndexInSegmentsArray","desiredIndex","ceil","arrays_1","ModeTransition","mode","modeId","getId","modeTransitions","modeTransition","Position","lineNumber","column","isBefore","isBeforeOrEqual","lift","isIPosition","position_1","Range","startLineNumber","startColumn","endLineNumber","endColumn","isEmpty","containsPosition","containsRange","otherRange","plusRange","intersectRanges","resultStartLineNumber","resultStartColumn","resultEndLineNumber","resultEndColumn","otherStartLineNumber","otherStartColumn","otherEndLineNumber","otherEndColumn","equalsRange","getEndPosition","getStartPosition","cloneRange","setEndPosition","setStartPosition","collapseToStart","isIRange","areIntersectingOrTouching","compareRangesUsingStarts","aStartLineNumber","bStartLineNumber","aStartColumn","bStartColumn","aEndLineNumber","bEndLineNumber","aEndColumn","bEndColumn","compareRangesUsingEnds","spansMultipleLines","ViewLineToken","equalsArray","aLen","bLen","ViewLineTokens","lineTokens","fauxIndentLength","textLength","_lineTokens","_fauxIndentLength","_textLength","getTokens","getFauxIndentLength","getTextLength","findIndexOfOffset","cursorStyleToString","cursorStyle","TextEditorCursorStyle","Line","Block","Underline","WrappingIndent","InternalEditorScrollbarOptions","arrowSize","vertical","horizontal","useShadows","Boolean","verticalHasArrows","horizontalHasArrows","handleMouseWheel","horizontalScrollbarSize","horizontalSliderSize","verticalScrollbarSize","verticalSliderSize","mouseWheelScrollSensitivity","EditorWrappingInfo","isViewportWrapping","wrappingColumn","wrappingIndent","wordWrapBreakBeforeCharacters","wordWrapBreakAfterCharacters","wordWrapBreakObtrusiveCharacters","InternalEditorViewOptions","theme","canUseTranslate3d","experimentalScreenReader","rulers","_toSortedIntegerArray","ariaLabel","lineNumbers","selectOnLineNumbers","glyphMargin","revealHorizontalRightPadding","roundedSelection","overviewRulerLanes","cursorBlinking","hideCursorInOverviewRuler","scrollBeyondLastLine","editorClassName","stopRenderingLineAfter","renderWhitespace","indentGuides","scrollbar","arrSource","el","_numberArraysEqual","createChangeEvent","newOpts","EditorContribOptions","selectionClipboard","hover","contextmenu","quickSuggestions","quickSuggestionsDelay","parameterHints","iconsInSuggestions","formatOnType","suggestOnTriggerCharacters","acceptSuggestionOnEnter","selectionHighlight","outlineMarkers","referenceInfos","folding","InternalEditorOptions","lineHeight","readOnly","wordSeparators","autoClosingBrackets","useTabStops","tabFocusMode","layoutInfo","fontInfo","viewInfo","wrappingInfo","contribInfo","OverviewRulerLane","EndOfLinePreference","DefaultEndOfLine","EndOfLineSequence","TrackedRangeStickiness","CursorChangeReason","VerticalRevealType","OverviewRulerPosition","width","height","top","right","EditorLayoutInfo","glyphMarginLeft","glyphMarginWidth","glyphMarginHeight","lineNumbersLeft","lineNumbersWidth","lineNumbersHeight","decorationsLeft","decorationsWidth","decorationsHeight","contentLeft","contentWidth","contentHeight","verticalScrollbarWidth","horizontalScrollbarHeight","overviewRuler","MouseTargetType","KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS","KEYBINDING_CONTEXT_EDITOR_FOCUS","KEYBINDING_CONTEXT_EDITOR_TAB_MOVES_FOCUS","KEYBINDING_CONTEXT_EDITOR_HAS_MULTIPLE_SELECTIONS","KEYBINDING_CONTEXT_EDITOR_HAS_NON_EMPTY_SELECTION","KEYBINDING_CONTEXT_EDITOR_LANGUAGE_ID","SHOW_ACCESSIBILITY_HELP_ACTION_ID","BareFontInfo","opts","fontFamily","fontSize","FontInfo","typicalHalfwidthCharacterWidth","typicalFullwidthCharacterWidth","spaceWidth","maxDigitWidth","ViewEventNames","ModelFlushedEvent","LinesDeletedEvent","LinesInsertedEvent","LineChangedEvent","TokensChangedEvent","DecorationsChangedEvent","CursorPositionChangedEvent","CursorSelectionChangedEvent","RevealRangeEvent","LineMappingChangedEvent","ScrollRequestEvent","Viewport","left","CodeEditorStateFlag","EditorType","ICodeEditor","IDiffEditor","ClassName","EditorWarningDecoration","EditorErrorDecoration","Disposed","ConfigurationChanged","ModelDispose","ModelChanged","ModelTokensChanged","ModelModeChanged","ModelModeSupportChanged","ModelOptionsChanged","ModelRawContentChanged","ModelContentChanged2","ModelRawContentChangedFlush","ModelRawContentChangedLinesDeleted","ModelRawContentChangedLinesInserted","ModelRawContentChangedLineChanged","EditorTextBlur","EditorTextFocus","EditorFocus","EditorBlur","ModelDecorationsChanged","CursorPositionChanged","CursorSelectionChanged","CursorRevealRange","CursorScrollRequest","ViewFocusGained","ViewFocusLost","ViewFocusChanged","ViewScrollChanged","ViewZonesChanged","ViewLayoutChanged","ContextMenu","MouseDown","MouseUp","MouseMove","MouseLeave","KeyDown","KeyUp","EditorLayout","DiffUpdated","Handler","ExecuteCommand","ExecuteCommands","CursorLeft","CursorLeftSelect","CursorWordLeft","CursorWordStartLeft","CursorWordEndLeft","CursorWordLeftSelect","CursorWordStartLeftSelect","CursorWordEndLeftSelect","CursorRight","CursorRightSelect","CursorWordRight","CursorWordStartRight","CursorWordEndRight","CursorWordRightSelect","CursorWordStartRightSelect","CursorWordEndRightSelect","CursorUp","CursorUpSelect","CursorDown","CursorDownSelect","CursorPageUp","CursorPageUpSelect","CursorPageDown","CursorPageDownSelect","CursorHome","CursorHomeSelect","CursorEnd","CursorEndSelect","ExpandLineSelection","CursorTop","CursorTopSelect","CursorBottom","CursorBottomSelect","CursorColumnSelectLeft","CursorColumnSelectRight","CursorColumnSelectUp","CursorColumnSelectPageUp","CursorColumnSelectDown","CursorColumnSelectPageDown","AddCursorDown","AddCursorUp","CursorUndo","MoveTo","MoveToSelect","ColumnSelect","CreateCursor","LastCursorMoveToSelect","JumpToBracket","Type","ReplacePreviousChar","Paste","Tab","Indent","Outdent","DeleteLeft","DeleteRight","DeleteWordLeft","DeleteWordStartLeft","DeleteWordEndLeft","DeleteWordRight","DeleteWordStartRight","DeleteWordEndRight","DeleteAllLeft","DeleteAllRight","RemoveSecondaryCursors","CancelSelection","Cut","Undo","Redo","WordSelect","WordSelectDrag","LastCursorWordSelect","LineSelect","LineSelectDrag","LastCursorLineSelect","LastCursorLineSelectDrag","LineInsertBefore","LineInsertAfter","LineBreakInsert","SelectAll","ScrollLineUp","ScrollLineDown","ScrollPageUp","ScrollPageDown","ColorZone","colorId","OverviewRulerZone","forceHeight","color","darkColor","_color","_darkColor","_colorZones","getColor","useDarkColor","compareTo","setColorZones","colorZones","getColorZones","spacesDiff","aLength","bLength","aCharCode","bCharCode","aSpacesCnt","aTabsCount","__space","bSpacesCnt","bTabsCount","tabsDiff","guessIndentation","lines","defaultTabSize","defaultInsertSpaces","linesIndentedWithTabsCount","linesIndentedWithSpacesCount","previousLineText","previousLineIndentation","ALLOWED_TAB_SIZE_GUESSES","MAX_ALLOWED_TAB_SIZE_GUESS","spacesDiffCount","currentLineText","currentLineHasContent","currentLineIndentation","currentLineSpacesCount","currentLineTabsCount","lenJ","__tab","currentSpacesDiff","deltaSpacesCount","insertSpaces","tabSize","tabSizeScore","possibleTabSize","possibleTabSizeScore","LineToken","TokenIterator","model","_model","_currentLineNumber","_currentTokenIndex","_readLineTokens","_next","_prev","columnIndex","tokenEndIndex","_currentLineTokens","getTokenCount","tokenStartIndex","getTokenStartIndex","_current","getLineTokens","_advanceNext","getLineCount","_advancePrev","getTokenType","endIndex","getTokenEndIndex","getLineContent","token","hasNext","hasPrev","_invalidate","errorFn","createWordRegExp","allowInWords","usualSeparators","USUAL_WORD_SEPARATORS","ensureValidWordDefinition","wordDefinition","DEFAULT_WORD_REGEXP","getWordAtText","textOffset","startWord","endWord","words","AbstractState","stateData","getMode","makeClone","initializeFrom","getStateData","setStateData","safeEquals","tokenize","stream","safeClone","selection","score","selector","LineStream","_source","sourceLength","_pos","whitespaceArr","stringToArray","separators","separatorsArr","tokenStart","tokenEnd","STRING_TO_ARRAY_CACHE","actualStringToArray","maxCharCode","eos","next2","advance","oldPos","_advance2","advanceToEOS","resetPeekedToken","goBack","createPeeker","condition","_advanceIfStringCaseInsensitive","advanceIfStringCaseInsensitive","advanceIfStringCaseInsensitive2","_advanceIfString","advanceIfString","advanceIfString2","_advanceIfCharCode","advanceIfCharCode","advanceIfCharCode2","_advanceIfRegExp","lastMatch","advanceIfRegExp","advanceIfRegExp2","advanceLoop","isWhile","including","peeker","advanceWhile","advanceUntil","_advanceUntilString","advanceUntilString","advanceUntilString2","setTokenRules","peekToken","nextToken","peekWhitespace","_skipWhitespace","skipWhitespace","skipWhitespace2","fixCase","lexer","sanitize","log","msg","languageId","throwError","substituteMatches","re","stateMatches","full","sub","dollar","attr","ofs","total","findRules","rules","tokenizer","stateExists","exist","stateNames","MonarchBracket","monarchCommon","isArrayOf","elemType","bool","def","onerr","compileRegExp","selectScrutinee","createGuard","ruleName","tkey","val","scrut","oppat","op","pat","tester","inWords","patx","patexp","scrutinee","compileAction","action","newAction","tokenSubst","bracket","Open","Close","switchTo","nextEmbedded","usesEmbedded","cases","defaultToken","didmatch","compile","json","addRules","newrules","rule","include","newrule","Rule","setRegex","lexerMin","setAction","rule1","matchOnlyAtStart","matchOnlyAtLineStart","noThrow","maxStack","tokenPostfix","brackets","open","close","bracketIdx","desc","sregex","act","nullTokenize","buffer","deltaOffset","stopAtOffset","tokens","actualStopOffset","endState","NullState","stateDataClone","otherStateData","NullMode","ID","toSimplifiedMode","modeTransition_1","handleEvent","runner","modeIndex","nestedMode","modeStartIndex","firstTokenInModeIndex","nextCharacterAfterModeIndex","nextTokenAfterMode","firstTokenCharacterOffset","newCtx","FilteredLineContext","ignoreBracketsInToken","tokenType","IGNORE_IN_TOKENS","Token","LineTokens","retokenize","actual","_actual","_firstTokenInModeIndex","_nextTokenAfterMode","_firstTokenCharacterOffset","_nextCharacterAfterModeIndex","actualLineContent","tokenIndex","getTokenText","SnippetsRegistry","registerDefaultSnippets","snippets","_defaultSnippets","registerSnippets","snippetsByMode","_snippets","getNonWhitespacePrefix","line","getSnippets","getWordAtPosition","currentWord","currentFullWord","incomplete","suggestions","getModeId","snipppetsByMode","defaultSnippets","label","overwriteBefore","supports_1","CharacterPairSupport","registry","config","_registry","_modeId","_autoClosingPairs","autoClosingPairs","_surroundingPairs","surroundingPairs","getAutoClosingPairs","shouldAutoClosePair","character","nestedModeId","notIn","notInIndex","characterPairSupport","getCharacterPairSupport","getSurroundingPairs","range_1","once","computeFn","cache","createOrRegex","pieces","regexStr","toReversedString","reversedStr","RichEditBrackets","forwardRegex","getRegexForBracketPair","reversedRegex","getReversedRegexForBracketPair","getRegexForBrackets","getReversedRegexForBrackets","textIsBracket","textIsOpenBracket","maxBracketLength","BracketsUtils","_findPrevBracketInText","reversedBracketRegex","reversedText","matchOffset","matchLength","absoluteMatchOffset","findPrevBracketInToken","lineText","currentTokenStart","currentTokenEnd","currentTokenReversedText","findNextBracketInText","bracketRegex","findNextBracketInToken","currentTokenText","richEditBrackets_1","BracketElectricCharacterSupport","contribution","Brackets","docComment","getElectricCharacters","embeddedElectricCharacters","onElectricCharacter","electricCharacterSupport","getElectricCharacterSupport","richEditBrackets","_richEditBrackets","_docComment","bracketPair","lastChar","_onElectricCharacterDocComment","_onElectricCharacterStandardBrackets","containsTokenTypes","fullTokenSpec","tokensToLookFor","isOpen","matchOpenBracket","lastTokenIndex","scope","appendText","lineStream_1","nullMode_1","something","TokenizationSupport","customization","supportsNestedModes","_mode","_embeddedModesListeners","setTokenizationSupport","defaults","enterNestedMode","getNestedMode","getNestedModeInitialState","getLeavingNestedModeData","onReturningFromNestedMode","getInitialState","_nestedTokenize","_myTokenize","nestedModeState","prependTokens","prependModeTransitions","myStateBeforeNestedMode","leavingNestedModeData","stepOnceNestedState","tokenizationSupport","nestedModeBuffer","nestedModeLineTokens","bufferAfterNestedMode","myStateAfterNestedMode","stateAfterNestedMode","myState","tokenResult","beforeTokenizeStreamPos","lineStream","previousType","maxPos","nextState","dontMergeWithPrev","currentEmbeddedLevels","_getEmbeddedLevel","MAX_EMBEDDED_LEVELS","embeddedMode","addSupportChangedListener","emitting","restOfBuffer","missingModePromise","_validatedNestedMode","lastNestedModeState","abstractState_1","tokenizationSupport_1","findBracket","matched","bracketType","createTokenizationSupport","modeService","MonarchLexer","embeddedEntered","rawState","isRegisteredMode","getOrCreateMode","mstate","groupActions","groupMatches","groupMatched","groupRule","otherm","noConsumeIsOk","stackLen0","groupLen0","callres","getModeIdForLanguageName","transform","totalLen","rest","None","PrefixSumIndexOfResult","remainder","PrefixSumComputer","prefixSum","prefixSumValidIndex","getCount","insertValue","insertIndex","insertValues","_zeroArray","changeValue","removeValues","cnt","getTotalValue","getAccumulatedValue","getIndexOf","accumulatedValue","midStop","midStart","nls","setUnexpectedErrorHandler","newUnexpectedErrorHandler","errorHandler","onUnexpectedError","isPromiseCanceledError","onUnexpectedPromiseError","transformErrorForSerialization","name_1","stacktrace","$isError","xhrToErrorMessage","xhr","verbose","ce","ConnectionError","verboseMessage","exceptionToErrorMessage","localize","detectSystemErrorMessage","errno","syscall","toErrorMessage","status","notImplemented","illegalArgument","illegalState","readonly","loaderError","options","severity","actions","ErrorHandler","unexpectedErrorHandler","addListener","_removeListener","emit","getUnexpectedErrorHandler","statusText","responseText","errorMessage","errorCode","errorObject","errorObj","connectionErrorToMessage","connectionErrorDetailsToMessage","errors_1","CallbackList","bucket","_callbacks","_contexts","foundCallbackWithDifferentContext","invoke","callbacks","contexts","callbackList_1","fromEventEmitter","emitter","thisArgs","addListener2","mapEvent","event","filterEvent","debounceEvent","merger","delay","subscription","handle","Emitter","onFirstListenerAdd","cur","fire","onLastListenerRemove","_disposable","_options","_event","_noop","_disposed","EventDelayerState","EventBufferer","buffers","wrapEvent","bufferEvents","flush","event_1","CancellationToken","isCancellationRequested","onCancellationRequested","Cancelled","shortcutEvent","MutableToken","_isCancelled","_emitter","CancellationTokenSource","_token","Errors","safeInvokeNoArg","safeInvoke1Arg","EmitterEvent","_type","_data","getType","getData","EventEmitter","allowedEventTypes","_bulkListeners","_collectedEvents","_deferredCnt","_allowedEventTypes","bound","addOneTimeDisposableListener","disposable","addBulkListener","_removeBulkListener","addBulkListener2","addEmitter","eventEmitter","events","newEvents","_emitEvents","addEmitter2","_emitToSpecificTypeListeners","_emitToBulkListeners","bulkListeners","emitterEvent","deferredEmit","_emitCollected","EmitQueueElement","OrderGuaranteeEventEmitter","_emitQueue","queueElement","precision","topic","description","timeKeeper","getTimeKeeper","ENABLE_TIMER","Topic","NullTimerEvent","timeTaken","TimerEvent","startTime","stopTime","sw","profilerName","_onEventStopped","TimeKeeper","cleaningIntervalId","collectedEvents","isEnabled","nullEvent","strTopic","EDITOR","LANGUAGES","WORKER","WORKBENCH","STARTUP","initAutoCleaning","addEvent","EVENT_ID","_EVENT_CACHE_LIMIT","_MAX_TIMER_LENGTH","_CLEAN_UP_INTERVAL","getCollectedEvents","clearCollectedEvents","emitEvents","setInitialCollectedEvents","PARSE_TIME","winjs","__Errors__","promiseErrorHandler","outstandingPromiseErrors","TPromise","PPromise","winjs_base_1","cancellation_1","lifecycle_1","isThenable","toThenable","asWinJsPromise","resolve","reject","wireCancellationToken","always","e1","sequence","promiseFactory","thenHandler","didCall","nfcall","ninvoke","thisArg","Throttler","activePromise","queuedPromise","queuedPromiseFactory","onComplete_1","SimpleThrottler","promiseTask","Delayer","defaultDelay","completionPromise","onSuccess","task","trigger","isTriggered","ThrottledDelayer","throttler","PeriodThrottledDelayer","minimumPeriod","periodThrottler","PromiseSource","_completeCallback","_errorCallback","ShallowCancelThenPromise","outer","completeCallback","errorCallback","progressCallback","Limiter","maxDegreeOfParalellism","outstandingPromises","runningPromises","consume","iLimitedTask","consumed","TimeoutTimer","cancelAndSet","setIfNotSet","IntervalTimer","interval","RunOnceScheduler","timeoutToken","timeoutHandler","onTimeout","isScheduled","setRunner","schedule","req","XMLHttpRequest","onreadystatechange","readyState","url","user","password","responseType","headers","setRequestHeader","customRequestInitializer","send","abort","Schemas","inMemory","vscode","internal","http","https","marshalling_1","workerProtocol","postMessage","WorkerServer","postSerializedMessage","_postSerializedMessage","_workerId","_requestHandler","_bindConsole","_sendPrintMessage","debug","info","level","transformedObjects","monacoWorker","payload","_postMessage","_sendReply","msgId","loadModule","errorback","onmessage","_onmessage","loaderConfig","loaderConfiguration","baseUrl","vs","nlsConfig_1","pseudo","nlsPlugin","setPseudoTranslation","catchError","handlerModule","_handleMessage","handlerMethod","handlerError","viewLineToken_1","START_INDEX_MASK","TYPE_MASK","START_INDEX_OFFSET","TYPE_OFFSET","pow","DEFAULT_VIEW_TOKEN","INFLATED_TOKENS_EMPTY_TEXT","DEFLATED_TOKENS_EMPTY_TEXT","INFLATED_TOKENS_NON_EMPTY_TEXT","DEFLATED_TOKENS_NON_EMPTY_TEXT","TokensInflatorMap","_inflate","_deflate","","TokensBinaryEncoding","deflateArr","deflatedToken","deflated","inflateMap","deflateMap","prevStartIndex","getStartIndex","binaryEncodedToken","deflatedType","inflateArr","binaryEncodedTokens","sliceAndInflate","startOffset","endOffset","deltaStartIndex","originalToken","newStartIndex","originalStartIndex","tokensBinaryEncoding_1","toLineTokensFromInflated","toLineTokensFromDeflated","toModeTransitions","topLevelMode","MarkerMoveSemantics","NO_OP_TOKENS_ADJUSTER","adjust","finish","NO_OP_MARKERS_ADJUSTER","adjustDelta","adjustSet","ModelLine","_lineNumber","_text","_isInvalid","_modeTransitions","_markers","setState","getState","getModeTransitions","setTokens","_setLineTokensFromDeflated","EmptyLineTokens","INSTANCE","DefaultLineTokens","_createTokensAdjuster","getBinaryEncodedTokens","tokensLength","tokensIndex","currentTokenStartIndex","toColumn","delta","minimumAllowedColumn","minimumAllowedIndex","newToken","prevTokenStartIndex","lineTextLength","_setText","getBinaryEncodedTokensMap","lastTokenStartIndex","_createMarkersAdjuster","changedMarkers","_compareMarkers","markers","markersLength","markersIndex","marker","adjustMarkerBeforeColumn","moveSemantics","ForceMove","ForceStay","stickToPreviousCharacter","newColumn","oldLineNumber","oldColumn","MarkerDefined","applyEdits","edits","deltaColumn","resultText","tokensAdjuster","markersAdjuster","edit","deletingCnt","insertingCnt","forceMoveMarkers","commonLength","splitColumn","myText","otherText","otherMarkers","myMarkers","otherLine","addMarkers","append","thisTextLength","otherLineTokens","otherTokens","deflatedStartIndex","myLineTokens","addMarker","removeMarker","_indexOfMarkerId","removeMarkers","deleteMarkers","getMarkers","updateLineNumber","newLineNumber","deleteLine","setMarkersColumn","setMarkersOldLineNumber","markerId","_tokens","inflate","languageSelector_1","LanguageFeatureRegistry","_clock","_entries","_onDidChange","register","provider","isBuiltin","_score","_time","_lastCandidate","isTooLargeForHavingAMode","_updateScores","ordered","_orderedForEach","orderedGroups","lastBucket","lastBucketScore","_compareByScoreAndTime","languageFeatureRegistry_1","DocumentHighlightKind","SymbolKind","kind","Method","Function","Constructor","Variable","Interface","Package","Module","Property","Enum","File","Null","IndentAction","ReferenceProviderRegistry","RenameProviderRegistry","SuggestRegistry","SignatureHelpProviderRegistry","HoverProviderRegistry","DocumentSymbolProviderRegistry","DocumentHighlightProviderRegistry","DefinitionProviderRegistry","CodeLensProviderRegistry","CodeActionProviderRegistry","DocumentFormattingEditProviderRegistry","DocumentRangeFormattingEditProviderRegistry","OnTypeFormattingEditProviderRegistry","LinkProviderRegistry","modes_1","OnEnterSupport","_brackets","openRegExp","_createOpenBracketRegExp","closeRegExp","_createCloseBracketRegExp","_regExpRules","regExpRules","_indentationRules","indentationRules","onEnter","getLineContext","_onEnter","onEnterSupport","getOnEnterSupport","beforeEnterText","afterEnterText","oneLineAboveText","_actualOnEnter","beforeText","afterText","_INDENT_OUTDENT","increaseIndentPattern","_INDENT","indentNextLinePattern","decreaseIndentPattern","_OUTDENT","_safeRegExp","indentAction","IndentOutdent","characterPair_1","electricCharacter_1","onEnter_1","wordHelper_1","RichEditSupport","previous","rawConf","_conf","_mergeConf","_handleOnEnter","_handleComments","characterPair","LanguageConfigurationRegistry","__electricCharacterSupport","electricCharacter","wordPattern","comments","onEnterRules","conf","commentRule","lineComment","lineCommentToken","blockComment","blockStart","blockEnd","blockCommentStartToken","blockCommentEndToken","LanguageConfigurationRegistryImpl","onDidChange","configuration","_getRichEditSupport","getComments","getWordDefinition","getRawEnterActionAtPosition","getEnterActionAtPosition","indentation","enterAction","removeText","getBracketsSupport","languageConfigurationRegistry_1","WordHelper","_safeGetWordDefinition","massageWordDefinitionOf","_getWordAtColumn","txt","modeEndIndex","textSource","_lineIsTokenized","_getLineModeTransitions","Severity","fromValue","_warning","_warn","Warning","_info","Info","Ignore","_displayStrings","compare","DEFAULT_INDENTATION","detectIndentation","DEFAULT_TRIM_AUTO_WHITESPACE","DEFAULT_WINDOWS_FONT_FAMILY","DEFAULT_MAC_FONT_FAMILY","DEFAULT_LINUX_FONT_FAMILY","GOLDEN_LINE_HEIGHT_RATIO","ConfigClass","editor","lineNumbersMinChars","lineDecorationsWidth","fontLigatures","disableTranslate3d","automaticLayout","DefaultConfig","eventEmitter_1","editorCommon","modelLine_1","indentationGuesser_1","defaultConfig_1","prefixSumComputer_1","LIMIT_FIND_COUNT","LONG_LINE_BOUNDARY","TextModel","rawText","_shouldSimplifyMode","MODEL_SYNC_LIMIT","_shouldDenyMode","MODEL_TOKENIZATION_LIMIT","_constructLines","_setVersionId","_isDisposed","_isDisposing","isTooLargeForHavingARichMode","getOptions","updateOptions","somethingChanged","trimAutoWhitespace","_lines","guessedIndentation","_normalizeIndentationFromWhitespace","spacesCnt","tabsCnt","normalizeIndentation","getOneIndent","getVersionId","_versionId","getAlternativeVersionId","_alternativeVersionId","_ensureLineStarts","_lineStarts","lineStartValues","eolLength","_EOL","getOffsetAt","rawPosition","validatePosition","getPositionAt","out","lineLength","_increaseVersionId","newVersionId","_overwriteAlternativeVersionId","newAlternativeVersionId","isDisposed","_BOM","_createContentChangedFlushEvent","changeType","versionId","isUndoing","isRedoing","_emitContentChanged2","rangeLength","eol","_resetValue","toRawText","BOM","EOL","getLinesContent","getValueLength","setValue","defaultEOL","setValueFromRawText","oldFullModelRange","getFullModelRange","oldModelValueLength","getValueLengthInRange","getLineMaxColumn","_emitModelContentChangedFlushEvent","getValue","preserveBOM","fullModelRange","fullModelValue","getValueInRange","getEmptiedValueInRange","rawRange","fillCharacter","TextDefined","validateRange","_repeatCharacter","lineEnding","_getEndOfLine","startLineIndex","endLineIndex","resultLines","isDominatedByLongLines","smallLineCharCount","longLineCharCount","getEOL","setEOL","newEOL","CRLF","getLineMinColumn","getLineFirstNonWhitespaceColumn","getLineLastNonWhitespaceColumn","validateLineNumber","maxColumn","modifyPosition","lineCount","carriageReturnCnt","lastCarriageReturnIndex","lineFeedCnt","resolvedOpts","rawLines","modelLines","findMatches","rawSearchScope","limitResultCount","searchRange","_doFindMatches","findNextMatch","rawSearchStart","searchStart","_findMatchInLine","lineIndex","findPreviousMatch","_findLastMatchInLine","searchRegex","counter","_findMatchesInLine","bestResult","DEFAULT_CREATION_OPTIONS","RawText","fromString","fromStringWithModelOptions","async_1","stopwatch_1","timer","textModel_1","textModelWithTokensHelpers_1","tokenIterator_1","lineToken_1","ModeToModelBinder","modePromise","_modePromise","_externalModePromise","_externalModePromise_c","_externalModePromise_e","setMode","_warmUpTokens","getModePromise","FullModelRetokenizer","retokenizePromise","_retokenizePromise","isFulfilled","onRetokenizerFulfilled","getRange","LineContext","TextModelWithTokens","shouldAutoTokenize","modeOrPromise","_shouldAutoTokenize","_modeListener","_modeToModelBinder","_tokensInflatorMap","_invalidLineStartIndex","_lastState","_revalidateTokensTimeout","_scheduleRetokenizeNow","_retokenizers","promiseValue","_massageMode","_resetModeListener","_retokenizeNow","_resetTokenizationState","_clearTimers","whenModeIsReady","fulfilled","hasFullModel","isInvalid","minLineNumber","_beginBackgroundTokenization","_createRetokenizer","_resetMode","newMode","emitModelTokensChangedEvent","_onModeSupportChanged","_emitModelModeSupportChangedEvent","_initializeTokenizationState","initialState","friendlyMessage","MODE_TOKENIZATION_FAILED_MSG","inaccurateTokensAcceptable","_updateTokensUntilLine","_getInternalTokens","newModeOrPromise","actualNewMode","e2","oldMode","_emitModelModeChangedEvent","getModeIdAtPosition","_column","validPosition","getStateBeforeLine","getStateAfterLine","modeTransitionIndex","_invalidateLine","_toLineTokens","_toModeTransitions","_updateLineTokens","_revalidateTokensNow","maxLineNumber","toLineNumber","t1","elapsedTime","MAX_ALLOWED_TIME","fromLineNumber","tokenizedChars","currentCharsToTokenize","currentEstimatedTimeToTokenize","linesLength","stopLineTokenizationAfter","endStateIndex","nextInvalidLineIndex","_getWordDefinition","getWordUntilPosition","wordAtPosition","tokenIterator","iter","findMatchingBracketUp","_position","currentModeIndex","currentMode","currentModeBrackets","_findMatchingBracketUp","matchBracket","_matchBracket","currentTokenIndex","prevTokenIndex","prevTokenType","prevTokenStart","prevMode","prevModeBrackets","foundBracket","foundBracketText","_matchFoundBracket","_findMatchingBracketDown","currentModeStart","currentModeId","currentTokenType","hitText","nextModeStart","startTokenIndex","findPrevBracket","_toFoundBracket","findNextBracket","textModelWithTokens_1","createTestMirrorModelFromString","associatedResource","MirrorModel","AbstractMirrorModel","_associatedResource","destroy","getRangeFromOffsetAndLength","startPosition","endPosition","getOffsetAndLengthFromRange","getPositionFromOffset","getOffsetFromPosition","getLineStart","getAllWordsWithRange","toTextRange","wordenize","getAllWords","getAllUniqueWords","skipWordOnce","foundSkipWord","uniqueWords","content","wordsRegexp","onEvents","contentChanged","contentChangedEvent","_onLinesFlushed","_onLinesDeleted","_onLinesInserted","_onLineChanged","fromLineIndex","toLineIndex","firstLineState","splitLines","newLengths","AbstractDescriptor","_staticArguments","appendStaticArguments","more","staticArguments","nth","SyncDescriptor","_ctor","moreStaticArguments","allArgs","createSyncDescriptor","AsyncDescriptor","_moduleName","_ctorName","moduleName","ctorName","_createAsyncDescriptor","createAsyncDescriptor0","createAsyncDescriptor1","createAsyncDescriptor2","createAsyncDescriptor3","createAsyncDescriptor4","createAsyncDescriptor5","createAsyncDescriptor6","createAsyncDescriptor7","storeServiceDependency","optional","_util","DI_TARGET","DI_DEPENDENCIES","createDecorator","serviceId","serviceIdentifier","getServiceDependencies","IInstantiationService","instantiation_1","findMember","proto","CompatWorkerAttr","methodName","param","compatWorkerService","CompatWorker","ICompatWorkerService","ID_EDITOR_WORKER_SERVICE","IEditorWorkerService","IModeService","IModelService","ResourceEvents","ADDED","REMOVED","CHANGED","IResourceService","resourceService_1","ResourceService","unbinds","addListener2_","_anonymousModelId","originalEvents","addedElement","removedElement","getConfigurationValue","settingPath","accessSetting","IConfigurationService","IEventService","EventService","IExtensionService","ServiceCollection","_c","entries_1","instanceOrDescriptor","_entryCompare","old","_searchEntry","_dummy","_b","assert","graph_1","descriptors_1","serviceCollection_1","InstantiationService","services","strict","_services","_strict","createChild","thing","_createAndCacheServiceInstance","invokeFunction","signature","accessor","isOptional","_getOrCreateServiceInstance","createInstance","_createInstanceAsync","_createInstance","descriptor","canceledError","_module","staticArgs","serviceDependencies","serviceArgs","dependency","service","firstServiceArgPos","argArray","instance","throwCycleError","graph","dependencies","dependencies_1","instanceOrDesc","roots_1","Assert","RegistryImpl","knows","Registry","BaseRegistry","toBeInstantiated","instances","setInstantiationService","instantiationService","instantiate","_getInstances","_setInstances","Extensions","ModesRegistry","EditorModesRegistry","_onDidAddCompatModes","onDidAddCompatModes","_onDidAddLanguages","onDidAddLanguages","_compatModes","_languages","registerCompatModes","registerCompatMode","getCompatModes","registerLanguage","registerLanguages","getLanguages","extensions","aliases","mimetypes","__decorate","decorators","Reflect","decorate","__param","paramIndex","decorator","compatWorkerService_1","modeService_1","mirrorModel_1","modesRegistry_1","CompatWorkerServiceWorker","resourceService","modesRegistryData","isInMainThread","compatModes","languages","compatMode","handleMainRequest","rpcId","_acceptNewModel","_acceptDidDisposeModel","_acceptModelEvents","_acceptCompatModes","_acceptLanguages","_instantiateCompatMode","mirrorModel","modes","LanguagesRegistry","useModesRegistry","_onDidAddModes","onDidAddModes","knownModeIds","mime2LanguageId","name2LanguageId","id2Name","id2Extensions","lowerName2Id","id2ConfigurationFiles","_registerCompatModes","_registerLanguages","defs","addedModes","_registerLanguage","filenames","_setLanguageName","languageName","force","prevName","lang","primaryMime","filenamePatterns","_d","_e","filenamePattern","firstLineRegexStr","firstLineRegex","containsAliases","bestName","mimetypeOrModeId","getRegisteredModes","getRegisteredLanguageNames","getLanguageName","getModeIdForLanguageNameLowercase","languageNameLower","getConfigurationFiles","getMimeForMode","theModeId","_mime","extractModeIds","commaSeparatedMimetypesOrCommaSeparatedIdsOrName","mimeTypeOrIdOrName","getModeIdsFromLanguageName","getModeIdsFromFilenameOrFirstLine","mimeTypes","getCompatMode","getExtensions","normalizeId","JSONContribution","JSONContributionRegistry","schemasById","addRegistryChangedListener","registerSchema","unresolvedSchemaContent","getSchemaContributions","schemas","jsonContributionRegistry","title","$schema","definitions","schemaArray","minItems","items","$ref","positiveInteger","minimum","positiveIntegerDefault0","allOf","default","simpleTypes","enum","stringArray","uniqueItems","multipleOf","exclusiveMinimum","maximum","exclusiveMaximum","minLength","additionalItems","anyOf","maxItems","maxProperties","minProperties","required","additionalProperties","patternProperties","oneOf","not","severity_1","jsonContributionRegistry_1","isValidExtensionDescription","extensionFolderPath","extensionDescription","notices","publisher","version","engines","extensionDependencies","_isStringArray","activationEvents","main","normalizedAbsolutePath","ExtensionMessageCollector","messageHandler","_messageHandler","_msg","schemaRegistry","ExtensionPoint","_handler","setHandler","_handle","registerPointListener","descriptions","users","contributes","collector","schemaId","schema","author","displayName","categories","galleryBanner","scripts","vscode:prepublish","ExtensionsRegistryImpl","_extensionsMap","_extensionsArr","_activationMap","_pointListeners","_extensionPoints","_oneTimeActivationEventListeners","point","extensionPoint","_triggerPointListener","_filterWithExtPoint","getAllExtensionDescriptions","registerExtensionPoint","jsonSchema","handleExtensionPoints","extensionPointName","registerExtensions","extensionDescriptions","activationEvent","listenerEntry","getExtensionDescriptionsForActivationEvent","getExtensionDescription","extensionId","registerOneTimeActivationEventListener","triggerActivationEventListeners","PRExtensions","ExtensionsRegistry","extensionsRegistry_1","Configuration","contributionRegistry","ConfigurationRegistry","configurationContributors","configurationSchema","_onDidRegisterConfiguration","registerConfiguration","registerJSONConfiguration","getConfigurations","configurationRegistry","configurationExtPoint","body","clonedConfiguration","filters_1","configurationRegistry_1","nls_1","filterSuggestions","accept","TextualSuggestSupport","editorWorkerService","configurationService","_editorWorkerService","_configurationService","provideCompletionItems","getConfiguration","wordBasedSuggestions","textualSuggest","order","editor.wordBasedSuggestions","configuration_1","suggestSupport_1","editorWorkerService_1","wordHelper","_createModeSupportChangedEvent","ModeWorkerManager","workerModuleId","workerClassName","superWorkerModuleId","_descriptor","_workerDescriptor","_superWorkerModuleId","_instantiationService","_workerPiecePromise","worker","_getOrCreateWorker","superWorkerCodePromise","_loadModule","AbstractMode","_eventEmitter","_simplifiedMode","SimplifiedMode","supportImpl","CompatMode","sourceMode","_sourceMode","_id","_assignSupports","isDigit","_0","_1","_2","_3","_4","_5","_6","_7","_8","_9","_f","_B","_C","_D","_E","_F","FrankensteinMode","extensions_1","abstractMode_1","languagesRegistry_1","isUndefinedOrStringArray","isValidLanguageExtensionPoint","languagesExtPoint","ModeServiceImpl","extensionService","_onDidCreateMode","onDidCreateMode","_extensionService","_activationPromises","_instantiatedModes","_config","getConfigurationForMode","configureMode","mimetype","configureModeById","previousOptions","newOptions","configSupport","configure","configureAllModes","modeIdentifier","isCompatMode","compatModeData","alias","commaSeparatedMimetypesOrCommaSeparatedIds","modeIds","isInstantiated","isPlainText","getModeIdByLanguageName","getModeIdByFilenameOrFirstLine","onReady","_getOrCreateMode","getOrCreateModeByLanguageName","getOrCreateModeByFilenameOrFirstLine","cc","ee","pp","_createMode","activateByEvent","modeDescriptor","_createModeDescriptor","resolvedDeps","compatModeAsyncDescriptor","_registerTokenizationSupport","registerModeSupport","registerTokenizationSupport","registerTokenizationSupport2","support","TokenizationSupport2Adapter","TokenizationState2Adapter","_stateData","offsetDelta","actualResult","tokens_1","scopes","MainThreadModeServiceImpl","allValidLanguages","ext","onDidUpdateConfiguration","onConfigurationChange","_onReadyPromise","configuration_2","files","ActivatedExtension","activationFailed","AbstractExtensionService","isReadyByDefault","_onReady","_onReadyC","_activatingExtensions","_activatedExtensions","_triggerOnReady","getExtensionsStatus","isActivated","activateExtensions","_activateExtensions","activateById","_handleActivateRequest","currentExtension","greenExtensions","redExtensions","depIds","currentExtensionGetsGreenLight","depId","depDesc","_showMessage","_createFailedExtension","recursionLevel","greenMap","red","green","_activateExtension","_actualActivateExtension","IRequestService","timer_1","combinedAppender","appenders","anonymize","ITelemetryService","NullTelemetryService","timedPublicLog","publicLog","eventName","isOptedIn","getTelemetryInfo","instanceId","sessionId","machineId","NullAppender","network_1","Timer","Async","request_1","telemetry_1","BaseRequestService","contextService","telemetryService","workspaceUri","workspace","getWorkspace","_serviceMap","_telemetryService","resource","computeOrigin","_origin","urlPath","makeCrossOriginRequest","makeRequest","isXhrRequestCORS","coPromise","xhrOptions","xhrOptionsPromise","additionalHeaders","xhrRequest","IWorkspaceContextService","workspace_1","BaseWorkspaceContextService","isInsideWorkspace","toWorkspaceRelativePath","toResource","workspaceRelativePath","eventService_1","abstractExtensionService_1","instantiationService_1","baseRequestService_1","baseWorkspaceContextService_1","modeServiceImpl_1","resourceServiceImpl_1","compatWorkerServiceWorker_1","WorkerExtensionService","EditorWorkerServer","initialize","mainThread","initData","requestService","request"],"mappings":"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","file":"vs/base/common/worker/workerServer.js","sourcesContent":["}).call(this);","/*!-----------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Version: 0.5.3(793ede49d53dba79d39e52205f16321278f5183c)\n * Released under the MIT license\n * https://github.com/Microsoft/vscode/blob/master/LICENSE.txt\n *-----------------------------------------------------------*/\n\n(function() {\nvar __m = [\"exports\",\"require\",\"vs/base/common/errors\",\"vs/base/common/strings\",\"vs/platform/instantiation/common/instantiation\",\"vs/base/common/winjs.base\",\"vs/nls!vs/base/common/worker/workerServer\",\"vs/nls\",\"vs/base/common/event\",\"vs/base/common/types\",\"vs/base/common/platform\",\"vs/platform/platform\",\"vs/base/common/objects\",\"vs/base/common/paths\",\"vs/editor/common/modes/supports\",\"vs/base/common/eventEmitter\",\"vs/base/common/lifecycle\",\"vs/editor/common/model/wordHelper\",\"vs/editor/common/core/modeTransition\",\"vs/editor/common/editorCommon\",\"vs/base/common/uri\",\"vs/editor/common/modes\",\"vs/editor/common/core/position\",\"vs/editor/common/services/modeService\",\"vs/base/common/async\",\"vs/editor/common/modes/monarch/monarchCommon\",\"vs/base/common/timer\",\"vs/platform/workspace/common/workspace\",\"vs/editor/common/modes/supports/richEditBrackets\",\"vs/editor/common/core/range\",\"vs/editor/common/core/arrays\",\"vs/editor/common/modes/languageConfigurationRegistry\",\"vs/base/common/severity\",\"vs/platform/instantiation/common/descriptors\",\"vs/base/common/assert\",\"vs/editor/common/services/compatWorkerService\",\"vs/base/common/map\",\"vs/editor/common/services/resourceService\",\"vs/platform/extensions/common/extensions\",\"vs/editor/common/modes/abstractState\",\"vs/editor/common/modes/modesRegistry\",\"vs/platform/jsonschemas/common/jsonContributionRegistry\",\"vs/platform/extensions/common/extensionsRegistry\",\"vs/platform/request/common/request\",\"vs/platform/telemetry/common/telemetry\",\"vs/editor/common/model/textModel\",\"vs/base/common/mime\",\"vs/base/common/cancellation\",\"vs/editor/common/modes/nullMode\",\"vs/base/common/collections\",\"vs/editor/common/core/viewLineToken\",\"vs/platform/configuration/common/configuration\",\"vs/platform/event/common/event\",\"vs/editor/common/modes/supports/tokenizationSupport\",\"vs/platform/instantiation/common/serviceCollection\",\"vs/base/common/glob\",\"vs/editor/common/model/tokensBinaryEncoding\",\"vs/editor/common/model/modelLine\",\"vs/base/common/arrays\",\"vs/editor/common/modes/supports/suggestSupport\",\"vs/editor/common/modes/abstractMode\",\"vs/base/common/stopwatch\",\"vs/editor/common/modes/lineStream\",\"vs/base/common/callbackList\",\"vs/editor/common/model/textModelWithTokensHelpers\",\"vs/nls!vs/base/common/severity\",\"vs/nls!vs/base/common/errors\",\"vs/nls!vs/editor/common/config/defaultConfig\",\"vs/editor/common/config/defaultConfig\",\"vs/editor/common/model/tokenIterator\",\"vs/nls!vs/editor/common/model/textModelWithTokens\",\"vs/editor/common/model/textModelWithTokens\",\"vs/editor/common/model/mirrorModel\",\"vs/nls!vs/editor/common/modes/modesRegistry\",\"vs/nls!vs/editor/common/modes/supports/suggestSupport\",\"vs/nls!vs/editor/common/services/modeServiceImpl\",\"vs/nls!vs/platform/configuration/common/configurationRegistry\",\"vs/nls!vs/platform/extensions/common/abstractExtensionService\",\"vs/nls!vs/platform/extensions/common/extensionsRegistry\",\"vs/nls!vs/platform/jsonschemas/common/jsonContributionRegistry\",\"vs/base/common/filters\",\"vs/base/common/events\",\"vs/editor/common/modes/languageSelector\",\"vs/editor/common/services/editorWorkerService\",\"vs/base/common/network\",\"vs/editor/common/services/modelService\",\"vs/base/common/graph\",\"vs/editor/common/services/resourceServiceImpl\",\"vs/editor/common/modes/monarch/monarchCompile\",\"vs/base/common/marshalling\",\"vs/platform/event/common/eventService\",\"vs/base/common/worker/workerProtocol\",\"vs/platform/workspace/common/baseWorkspaceContextService\",\"vs/platform/instantiation/common/instantiationService\",\"vs/editor/common/modes/supports/characterPair\",\"vs/editor/common/model/indentationGuesser\",\"vs/editor/common/services/compatWorkerServiceWorker\",\"vs/editor/common/services/languagesRegistry\",\"vs/editor/common/languages.common\",\"vs/editor/common/modes/supports/electricCharacter\",\"vs/platform/configuration/common/configurationRegistry\",\"vs/editor/common/model/lineToken\",\"vs/editor/common/modes/languageFeatureRegistry\",\"vs/editor/common/services/modeServiceImpl\",\"vs/platform/extensions/common/abstractExtensionService\",\"vs/editor/common/modes/monarch/monarchLexer\",\"vs/editor/common/modes/supports/onEnter\",\"vs/platform/request/common/baseRequestService\",\"vs/editor/common/viewModel/prefixSumComputer\",\"vs/base/common/worker/workerServer\",\"vs/base/common/winjs.base.raw\",\"vs/editor/common/worker/editorWorkerServer\"];\nvar __M = function(deps) {\n  var result = [];\n  for (var i = 0, len = deps.length; i < len; i++) {\n    result[i] = __m[deps[i]];\n  }\n  return result;\n};\ndefine(__m[58], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * Returns the last element of an array.\n     * @param array The array.\n     * @param n Which element from the end (default ist zero).\n     */\n    function tail(array, n) {\n        if (n === void 0) { n = 0; }\n        return array[array.length - (1 + n)];\n    }\n    exports.tail = tail;\n    /**\n     * Iterates the provided array and allows to remove\n     * elements while iterating.\n     */\n    function forEach(array, callback) {\n        for (var i = 0, len = array.length; i < len; i++) {\n            callback(array[i], function () {\n                array.splice(i, 1);\n                i--;\n                len--;\n            });\n        }\n    }\n    exports.forEach = forEach;\n    function equals(one, other, itemEquals) {\n        if (itemEquals === void 0) { itemEquals = function (a, b) { return a === b; }; }\n        if (one.length !== other.length) {\n            return false;\n        }\n        for (var i = 0, len = one.length; i < len; i++) {\n            if (!itemEquals(one[i], other[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n    exports.equals = equals;\n    function binarySearch(array, key, comparator) {\n        var low = 0, high = array.length - 1;\n        while (low <= high) {\n            var mid = ((low + high) / 2) | 0;\n            var comp = comparator(array[mid], key);\n            if (comp < 0) {\n                low = mid + 1;\n            }\n            else if (comp > 0) {\n                high = mid - 1;\n            }\n            else {\n                return mid;\n            }\n        }\n        return -(low + 1);\n    }\n    exports.binarySearch = binarySearch;\n    /**\n     * Takes a sorted array and a function p. The array is sorted in such a way that all elements where p(x) is false\n     * are located before all elements where p(x) is true.\n     * @returns the least x for which p(x) is true or array.length if no element fullfills the given function.\n     */\n    function findFirst(array, p) {\n        var low = 0, high = array.length;\n        if (high === 0) {\n            return 0; // no children\n        }\n        while (low < high) {\n            var mid = Math.floor((low + high) / 2);\n            if (p(array[mid])) {\n                high = mid;\n            }\n            else {\n                low = mid + 1;\n            }\n        }\n        return low;\n    }\n    exports.findFirst = findFirst;\n    function merge(arrays, hashFn) {\n        var result = new Array();\n        if (!hashFn) {\n            for (var i = 0, len = arrays.length; i < len; i++) {\n                result.push.apply(result, arrays[i]);\n            }\n        }\n        else {\n            var map = {};\n            for (var i = 0; i < arrays.length; i++) {\n                for (var j = 0; j < arrays[i].length; j++) {\n                    var element = arrays[i][j], hash = hashFn(element);\n                    if (!map.hasOwnProperty(hash)) {\n                        map[hash] = true;\n                        result.push(element);\n                    }\n                }\n            }\n        }\n        return result;\n    }\n    exports.merge = merge;\n    /**\n     * @returns a new array with all undefined or null values removed. The original array is not modified at all.\n     */\n    function coalesce(array) {\n        if (!array) {\n            return array;\n        }\n        return array.filter(function (e) { return !!e; });\n    }\n    exports.coalesce = coalesce;\n    /**\n     * @returns true if the given item is contained in the array.\n     */\n    function contains(array, item) {\n        return array.indexOf(item) >= 0;\n    }\n    exports.contains = contains;\n    /**\n     * Swaps the elements in the array for the provided positions.\n     */\n    function swap(array, pos1, pos2) {\n        var element1 = array[pos1];\n        var element2 = array[pos2];\n        array[pos1] = element2;\n        array[pos2] = element1;\n    }\n    exports.swap = swap;\n    /**\n     * Moves the element in the array for the provided positions.\n     */\n    function move(array, from, to) {\n        array.splice(to, 0, array.splice(from, 1)[0]);\n    }\n    exports.move = move;\n    /**\n     * @returns {{false}} if the provided object is an array\n     * \tand not empty.\n     */\n    function isFalsyOrEmpty(obj) {\n        return !Array.isArray(obj) || obj.length === 0;\n    }\n    exports.isFalsyOrEmpty = isFalsyOrEmpty;\n    /**\n     * Removes duplicates from the given array. The optional keyFn allows to specify\n     * how elements are checked for equalness by returning a unique string for each.\n     */\n    function distinct(array, keyFn) {\n        if (!keyFn) {\n            return array.filter(function (element, position) {\n                return array.indexOf(element) === position;\n            });\n        }\n        var seen = Object.create(null);\n        return array.filter(function (elem) {\n            var key = keyFn(elem);\n            if (seen[key]) {\n                return false;\n            }\n            seen[key] = true;\n            return true;\n        });\n    }\n    exports.distinct = distinct;\n    function uniqueFilter(keyFn) {\n        var seen = Object.create(null);\n        return function (element) {\n            var key = keyFn(element);\n            if (seen[key]) {\n                return false;\n            }\n            seen[key] = true;\n            return true;\n        };\n    }\n    exports.uniqueFilter = uniqueFilter;\n    function firstIndex(array, fn) {\n        for (var i = 0; i < array.length; i++) {\n            var element = array[i];\n            if (fn(element)) {\n                return i;\n            }\n        }\n        return -1;\n    }\n    exports.firstIndex = firstIndex;\n    function first(array, fn, notFoundValue) {\n        if (notFoundValue === void 0) { notFoundValue = null; }\n        var index = firstIndex(array, fn);\n        return index < 0 ? notFoundValue : array[index];\n    }\n    exports.first = first;\n    function commonPrefixLength(one, other, equals) {\n        if (equals === void 0) { equals = function (a, b) { return a === b; }; }\n        var result = 0;\n        for (var i = 0, len = Math.min(one.length, other.length); i < len && equals(one[i], other[i]); i++) {\n            result++;\n        }\n        return result;\n    }\n    exports.commonPrefixLength = commonPrefixLength;\n    function flatten(arr) {\n        return arr.reduce(function (r, v) { return r.concat(v); }, []);\n    }\n    exports.flatten = flatten;\n    function range(to, from) {\n        if (from === void 0) { from = 0; }\n        var result = [];\n        for (var i = from; i < to; i++) {\n            result.push(i);\n        }\n        return result;\n    }\n    exports.range = range;\n    function fill(num, valueFn, arr) {\n        if (arr === void 0) { arr = []; }\n        for (var i = 0; i < num; i++) {\n            arr[i] = valueFn();\n        }\n        return arr;\n    }\n    exports.fill = fill;\n    function index(array, indexer) {\n        var result = Object.create(null);\n        array.forEach(function (t) { return result[indexer(t)] = t; });\n        return result;\n    }\n    exports.index = index;\n});\n\ndefine(__m[34], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * Throws an error with the provided message if the provided value does not evaluate to a true Javascript value.\n     */\n    function ok(value, message) {\n        if (!value || value === null) {\n            throw new Error(message ? 'Assertion failed (' + message + ')' : 'Assertion Failed');\n        }\n    }\n    exports.ok = ok;\n});\n\ndefine(__m[49], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function createStringDictionary() {\n        return Object.create(null);\n    }\n    exports.createStringDictionary = createStringDictionary;\n    function createNumberDictionary() {\n        return Object.create(null);\n    }\n    exports.createNumberDictionary = createNumberDictionary;\n    function lookup(from, what, alternate) {\n        if (alternate === void 0) { alternate = null; }\n        var key = String(what);\n        if (contains(from, key)) {\n            return from[key];\n        }\n        return alternate;\n    }\n    exports.lookup = lookup;\n    function lookupOrInsert(from, stringOrNumber, alternate) {\n        var key = String(stringOrNumber);\n        if (contains(from, key)) {\n            return from[key];\n        }\n        else {\n            if (typeof alternate === 'function') {\n                alternate = alternate();\n            }\n            from[key] = alternate;\n            return alternate;\n        }\n    }\n    exports.lookupOrInsert = lookupOrInsert;\n    function insert(into, data, hashFn) {\n        into[hashFn(data)] = data;\n    }\n    exports.insert = insert;\n    var hasOwnProperty = Object.prototype.hasOwnProperty;\n    function contains(from, what) {\n        return hasOwnProperty.call(from, what);\n    }\n    exports.contains = contains;\n    function values(from) {\n        var result = [];\n        for (var key in from) {\n            if (hasOwnProperty.call(from, key)) {\n                result.push(from[key]);\n            }\n        }\n        return result;\n    }\n    exports.values = values;\n    function forEach(from, callback) {\n        for (var key in from) {\n            if (hasOwnProperty.call(from, key)) {\n                var result = callback({ key: key, value: from[key] }, function () {\n                    delete from[key];\n                });\n                if (result === false) {\n                    return;\n                }\n            }\n        }\n    }\n    exports.forEach = forEach;\n    function remove(from, key) {\n        if (!hasOwnProperty.call(from, key)) {\n            return false;\n        }\n        delete from[key];\n        return true;\n    }\n    exports.remove = remove;\n    /**\n     * Groups the collection into a dictionary based on the provided\n     * group function.\n     */\n    function groupBy(data, groupFn) {\n        var result = createStringDictionary();\n        data.forEach(function (element) { return lookupOrInsert(result, groupFn(element), []).push(element); });\n        return result;\n    }\n    exports.groupBy = groupBy;\n});\n\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\ndefine(__m[81], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var Event = (function () {\n        function Event(originalEvent) {\n            this.time = (new Date()).getTime();\n            this.originalEvent = originalEvent;\n            this.source = null;\n        }\n        return Event;\n    }());\n    exports.Event = Event;\n    var PropertyChangeEvent = (function (_super) {\n        __extends(PropertyChangeEvent, _super);\n        function PropertyChangeEvent(key, oldValue, newValue, originalEvent) {\n            _super.call(this, originalEvent);\n            this.key = key;\n            this.oldValue = oldValue;\n            this.newValue = newValue;\n        }\n        return PropertyChangeEvent;\n    }(Event));\n    exports.PropertyChangeEvent = PropertyChangeEvent;\n    var ViewerEvent = (function (_super) {\n        __extends(ViewerEvent, _super);\n        function ViewerEvent(element, originalEvent) {\n            _super.call(this, originalEvent);\n            this.element = element;\n        }\n        return ViewerEvent;\n    }(Event));\n    exports.ViewerEvent = ViewerEvent;\n    exports.EventType = {\n        PROPERTY_CHANGED: 'propertyChanged',\n        SELECTION: 'selection',\n        FOCUS: 'focus',\n        BLUR: 'blur',\n        HIGHLIGHT: 'highlight',\n        EXPAND: 'expand',\n        COLLAPSE: 'collapse',\n        TOGGLE: 'toggle',\n        CONTENTS_CHANGED: 'contentsChanged',\n        BEFORE_RUN: 'beforeRun',\n        RUN: 'run',\n        EDIT: 'edit',\n        SAVE: 'save',\n        CANCEL: 'cancel',\n        CHANGE: 'change',\n        DISPOSE: 'dispose',\n    };\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\n\n\n\ndefine(__m[36], __M([1,0]), function (require, exports) {\n    'use strict';\n    /**\n     * A simple map to store value by a key object. Key can be any object that has toString() function to get\n     * string value of the key.\n     */\n    var SimpleMap = (function () {\n        function SimpleMap() {\n            this.map = Object.create(null);\n            this._size = 0;\n        }\n        Object.defineProperty(SimpleMap.prototype, \"size\", {\n            get: function () {\n                return this._size;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        SimpleMap.prototype.get = function (k) {\n            var value = this.peek(k);\n            return value ? value : null;\n        };\n        SimpleMap.prototype.keys = function () {\n            var keys = [];\n            for (var key in this.map) {\n                keys.push(this.map[key].key);\n            }\n            return keys;\n        };\n        SimpleMap.prototype.entries = function () {\n            var entries = [];\n            for (var key in this.map) {\n                entries.push(this.map[key]);\n            }\n            return entries;\n        };\n        SimpleMap.prototype.set = function (k, t) {\n            if (this.get(k)) {\n                return false; // already present!\n            }\n            this.push(k, t);\n            return true;\n        };\n        SimpleMap.prototype.delete = function (k) {\n            var value = this.get(k);\n            if (value) {\n                this.pop(k);\n                return value;\n            }\n            return null;\n        };\n        SimpleMap.prototype.has = function (k) {\n            return !!this.get(k);\n        };\n        SimpleMap.prototype.clear = function () {\n            this.map = Object.create(null);\n            this._size = 0;\n        };\n        SimpleMap.prototype.push = function (key, value) {\n            var entry = { key: key, value: value };\n            this.map[key.toString()] = entry;\n            this._size++;\n        };\n        SimpleMap.prototype.pop = function (k) {\n            delete this.map[k.toString()];\n            this._size--;\n        };\n        SimpleMap.prototype.peek = function (k) {\n            var entry = this.map[k.toString()];\n            return entry ? entry.value : null;\n        };\n        return SimpleMap;\n    }());\n    exports.SimpleMap = SimpleMap;\n    /**\n     * A simple Map<T> that optionally allows to set a limit of entries to store. Once the limit is hit,\n     * the cache will remove the entry that was last recently added. Or, if a ratio is provided below 1,\n     * all elements will be removed until the ratio is full filled (e.g. 0.75 to remove 25% of old elements).\n     */\n    var LinkedMap = (function () {\n        function LinkedMap(limit, ratio) {\n            if (limit === void 0) { limit = Number.MAX_VALUE; }\n            if (ratio === void 0) { ratio = 1; }\n            this.limit = limit;\n            this.map = Object.create(null);\n            this._size = 0;\n            this.ratio = limit * ratio;\n        }\n        Object.defineProperty(LinkedMap.prototype, \"size\", {\n            get: function () {\n                return this._size;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        LinkedMap.prototype.set = function (key, value) {\n            if (this.map[key]) {\n                return false; // already present!\n            }\n            var entry = { key: key, value: value };\n            this.push(entry);\n            if (this._size > this.limit) {\n                this.trim();\n            }\n            return true;\n        };\n        LinkedMap.prototype.get = function (key) {\n            var entry = this.map[key];\n            return entry ? entry.value : null;\n        };\n        LinkedMap.prototype.delete = function (key) {\n            var entry = this.map[key];\n            if (entry) {\n                this.map[key] = void 0;\n                this._size--;\n                if (entry.next) {\n                    entry.next.prev = entry.prev; // [A]<-[x]<-[C] = [A]<-[C]\n                }\n                else {\n                    this.head = entry.prev; // [A]-[x] = [A]\n                }\n                if (entry.prev) {\n                    entry.prev.next = entry.next; // [A]->[x]->[C] = [A]->[C]\n                }\n                else {\n                    this.tail = entry.next; // [x]-[A] = [A]\n                }\n                return entry.value;\n            }\n            return null;\n        };\n        LinkedMap.prototype.has = function (key) {\n            return !!this.map[key];\n        };\n        LinkedMap.prototype.clear = function () {\n            this.map = Object.create(null);\n            this._size = 0;\n            this.head = null;\n            this.tail = null;\n        };\n        LinkedMap.prototype.push = function (entry) {\n            if (this.head) {\n                // [A]-[B] = [A]-[B]->[X]\n                entry.prev = this.head;\n                this.head.next = entry;\n            }\n            if (!this.tail) {\n                this.tail = entry;\n            }\n            this.head = entry;\n            this.map[entry.key] = entry;\n            this._size++;\n        };\n        LinkedMap.prototype.trim = function () {\n            if (this.tail) {\n                // Remove all elements until ratio is reached\n                if (this.ratio < this.limit) {\n                    var index = 0;\n                    var current = this.tail;\n                    while (current.next) {\n                        // Remove the entry\n                        this.map[current.key] = void 0;\n                        this._size--;\n                        // if we reached the element that overflows our ratio condition\n                        // make its next element the new tail of the Map and adjust the size\n                        if (index === this.ratio) {\n                            this.tail = current.next;\n                            this.tail.prev = null;\n                            break;\n                        }\n                        // Move on\n                        current = current.next;\n                        index++;\n                    }\n                }\n                else {\n                    this.map[this.tail.key] = void 0;\n                    this._size--;\n                    // [x]-[B] = [B]\n                    this.tail = this.tail.next;\n                    this.tail.prev = null;\n                }\n            }\n        };\n        return LinkedMap;\n    }());\n    exports.LinkedMap = LinkedMap;\n    /**\n     * A subclass of Map<T> that makes an entry the MRU entry as soon\n     * as it is being accessed. In combination with the limit for the\n     * maximum number of elements in the cache, it helps to remove those\n     * entries from the cache that are LRU.\n     */\n    var LRUCache = (function (_super) {\n        __extends(LRUCache, _super);\n        function LRUCache(limit) {\n            _super.call(this, limit);\n        }\n        LRUCache.prototype.get = function (key) {\n            // Upon access of an entry, make it the head of\n            // the linked map so that it is the MRU element\n            var entry = this.map[key];\n            if (entry) {\n                this.delete(key);\n                this.push(entry);\n                return entry.value;\n            }\n            return null;\n        };\n        return LRUCache;\n    }(LinkedMap));\n    exports.LRUCache = LRUCache;\n});\n\ndefine(__m[10], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // --- THIS FILE IS TEMPORARY UNTIL ENV.TS IS CLEANED UP. IT CAN SAFELY BE USED IN ALL TARGET EXECUTION ENVIRONMENTS (node & dom) ---\n    var _isWindows = false;\n    var _isMacintosh = false;\n    var _isLinux = false;\n    var _isRootUser = false;\n    var _isNative = false;\n    var _isWeb = false;\n    var _isQunit = false;\n    var _locale = undefined;\n    var _language = undefined;\n    exports.LANGUAGE_DEFAULT = 'en';\n    // OS detection\n    if (typeof process === 'object') {\n        _isWindows = (process.platform === 'win32');\n        _isMacintosh = (process.platform === 'darwin');\n        _isLinux = (process.platform === 'linux');\n        _isRootUser = !_isWindows && (process.getuid() === 0);\n        var vscode_nls_config = process.env['VSCODE_NLS_CONFIG'];\n        if (vscode_nls_config) {\n            try {\n                var nlsConfig = JSON.parse(vscode_nls_config);\n                var resolved = nlsConfig.availableLanguages['*'];\n                _locale = nlsConfig.locale;\n                // VSCode's default language is 'en'\n                _language = resolved ? resolved : exports.LANGUAGE_DEFAULT;\n            }\n            catch (e) {\n            }\n        }\n        _isNative = true;\n    }\n    else if (typeof navigator === 'object') {\n        var userAgent = navigator.userAgent;\n        _isWindows = userAgent.indexOf('Windows') >= 0;\n        _isMacintosh = userAgent.indexOf('Macintosh') >= 0;\n        _isLinux = userAgent.indexOf('Linux') >= 0;\n        _isWeb = true;\n        _locale = navigator.language;\n        _language = _locale;\n        _isQunit = !!self.QUnit;\n    }\n    (function (Platform) {\n        Platform[Platform[\"Web\"] = 0] = \"Web\";\n        Platform[Platform[\"Mac\"] = 1] = \"Mac\";\n        Platform[Platform[\"Linux\"] = 2] = \"Linux\";\n        Platform[Platform[\"Windows\"] = 3] = \"Windows\";\n    })(exports.Platform || (exports.Platform = {}));\n    var Platform = exports.Platform;\n    exports._platform = Platform.Web;\n    if (_isNative) {\n        if (_isMacintosh) {\n            exports._platform = Platform.Mac;\n        }\n        else if (_isWindows) {\n            exports._platform = Platform.Windows;\n        }\n        else if (_isLinux) {\n            exports._platform = Platform.Linux;\n        }\n    }\n    exports.isWindows = _isWindows;\n    exports.isMacintosh = _isMacintosh;\n    exports.isLinux = _isLinux;\n    exports.isRootUser = _isRootUser;\n    exports.isNative = _isNative;\n    exports.isWeb = _isWeb;\n    exports.isQunit = _isQunit;\n    exports.platform = exports._platform;\n    /**\n     * The language used for the user interface. The format of\n     * the string is all lower case (e.g. zh-tw for Traditional\n     * Chinese)\n     */\n    exports.language = _language;\n    /**\n     * The OS locale or the locale specified by --locale. The format of\n     * the string is all lower case (e.g. zh-tw for Traditional\n     * Chinese). The UI is not necessarily shown in the provided locale.\n     */\n    exports.locale = _locale;\n    var _globals = (typeof self === 'object' ? self : global);\n    exports.globals = _globals;\n    function hasWebWorkerSupport() {\n        return typeof _globals.Worker !== 'undefined';\n    }\n    exports.hasWebWorkerSupport = hasWebWorkerSupport;\n    exports.setTimeout = _globals.setTimeout.bind(_globals);\n    exports.clearTimeout = _globals.clearTimeout.bind(_globals);\n    exports.setInterval = _globals.setInterval.bind(_globals);\n    exports.clearInterval = _globals.clearInterval.bind(_globals);\n});\n\ndefine(__m[13], __M([1,0,10]), function (require, exports, platform_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * The forward slash path separator.\n     */\n    exports.sep = '/';\n    /**\n     * The native path separator depending on the OS.\n     */\n    exports.nativeSep = platform_1.isWindows ? '\\\\' : '/';\n    function relative(from, to) {\n        from = normalize(from);\n        to = normalize(to);\n        var fromParts = from.split(exports.sep), toParts = to.split(exports.sep);\n        while (fromParts.length > 0 && toParts.length > 0) {\n            if (fromParts[0] === toParts[0]) {\n                fromParts.shift();\n                toParts.shift();\n            }\n            else {\n                break;\n            }\n        }\n        for (var i = 0, len = fromParts.length; i < len; i++) {\n            toParts.unshift('..');\n        }\n        return toParts.join(exports.sep);\n    }\n    exports.relative = relative;\n    /**\n     * @returns the directory name of a path.\n     */\n    function dirname(path) {\n        var idx = ~path.lastIndexOf('/') || ~path.lastIndexOf('\\\\');\n        if (idx === 0) {\n            return '.';\n        }\n        else if (~idx === 0) {\n            return path[0];\n        }\n        else {\n            return path.substring(0, ~idx);\n        }\n    }\n    exports.dirname = dirname;\n    /**\n     * @returns the base name of a path.\n     */\n    function basename(path) {\n        var idx = ~path.lastIndexOf('/') || ~path.lastIndexOf('\\\\');\n        if (idx === 0) {\n            return path;\n        }\n        else if (~idx === path.length - 1) {\n            return basename(path.substring(0, path.length - 1));\n        }\n        else {\n            return path.substr(~idx + 1);\n        }\n    }\n    exports.basename = basename;\n    /**\n     * @returns {{.far}} from boo.far or the empty string.\n     */\n    function extname(path) {\n        path = basename(path);\n        var idx = ~path.lastIndexOf('.');\n        return idx ? path.substring(~idx) : '';\n    }\n    exports.extname = extname;\n    var _posixBadPath = /(\\/\\.\\.?\\/)|(\\/\\.\\.?)$|^(\\.\\.?\\/)|(\\/\\/+)|(\\\\)/;\n    var _winBadPath = /(\\\\\\.\\.?\\\\)|(\\\\\\.\\.?)$|^(\\.\\.?\\\\)|(\\\\\\\\+)|(\\/)/;\n    function _isNormal(path, win) {\n        return win\n            ? !_winBadPath.test(path)\n            : !_posixBadPath.test(path);\n    }\n    function normalize(path, toOSPath) {\n        if (path === null || path === void 0) {\n            return path;\n        }\n        var len = path.length;\n        if (len === 0) {\n            return '.';\n        }\n        var wantsBackslash = platform_1.isWindows && toOSPath;\n        if (_isNormal(path, wantsBackslash)) {\n            return path;\n        }\n        var sep = wantsBackslash ? '\\\\' : '/';\n        var root = getRoot(path, sep);\n        // skip the root-portion of the path\n        var start = root.length;\n        var skip = false;\n        var res = '';\n        for (var end = root.length; end <= len; end++) {\n            // either at the end or at a path-separator character\n            if (end === len || path.charCodeAt(end) === _slash || path.charCodeAt(end) === _backslash) {\n                if (streql(path, start, end, '..')) {\n                    // skip current and remove parent (if there is already something)\n                    var prev_start = res.lastIndexOf(sep);\n                    var prev_part = res.slice(prev_start + 1);\n                    if ((root || prev_part.length > 0) && prev_part !== '..') {\n                        res = prev_start === -1 ? '' : res.slice(0, prev_start);\n                        skip = true;\n                    }\n                }\n                else if (streql(path, start, end, '.') && (root || res || end < len - 1)) {\n                    // skip current (if there is already something or if there is more to come)\n                    skip = true;\n                }\n                if (!skip) {\n                    var part = path.slice(start, end);\n                    if (res !== '' && res[res.length - 1] !== sep) {\n                        res += sep;\n                    }\n                    res += part;\n                }\n                start = end + 1;\n                skip = false;\n            }\n        }\n        return root + res;\n    }\n    exports.normalize = normalize;\n    function streql(value, start, end, other) {\n        return start + other.length === end && value.indexOf(other, start) === start;\n    }\n    /**\n     * Computes the _root_ this path, like `getRoot('c:\\files') === c:\\`,\n     * `getRoot('files:///files/path') === files:///`,\n     * or `getRoot('\\\\server\\shares\\path') === \\\\server\\shares\\`\n     */\n    function getRoot(path, sep) {\n        if (sep === void 0) { sep = '/'; }\n        if (!path) {\n            return '';\n        }\n        var len = path.length;\n        var code = path.charCodeAt(0);\n        if (code === _slash || code === _backslash) {\n            code = path.charCodeAt(1);\n            if (code === _slash || code === _backslash) {\n                // UNC candidate \\\\localhost\\shares\\ddd\n                //               ^^^^^^^^^^^^^^^^^^^\n                code = path.charCodeAt(2);\n                if (code !== _slash && code !== _backslash) {\n                    var pos_1 = 3;\n                    var start = pos_1;\n                    for (; pos_1 < len; pos_1++) {\n                        code = path.charCodeAt(pos_1);\n                        if (code === _slash || code === _backslash) {\n                            break;\n                        }\n                    }\n                    code = path.charCodeAt(pos_1 + 1);\n                    if (start !== pos_1 && code !== _slash && code !== _backslash) {\n                        pos_1 += 1;\n                        for (; pos_1 < len; pos_1++) {\n                            code = path.charCodeAt(pos_1);\n                            if (code === _slash || code === _backslash) {\n                                return path.slice(0, pos_1 + 1) // consume this separator\n                                    .replace(/[\\\\/]/g, sep);\n                            }\n                        }\n                    }\n                }\n            }\n            // /user/far\n            // ^\n            return sep;\n        }\n        else if ((code >= _A && code <= _Z) || (code >= _a && code <= _z)) {\n            // check for windows drive letter c:\\ or c:\n            if (path.charCodeAt(1) === _colon) {\n                code = path.charCodeAt(2);\n                if (code === _slash || code === _backslash) {\n                    // C:\\fff\n                    // ^^^\n                    return path.slice(0, 2) + sep;\n                }\n                else {\n                    // C:\n                    // ^^\n                    return path.slice(0, 2);\n                }\n            }\n        }\n        // check for URI\n        // scheme://authority/path\n        // ^^^^^^^^^^^^^^^^^^^\n        var pos = path.indexOf('://');\n        if (pos !== -1) {\n            pos += 3; // 3 -> \"://\".length\n            for (; pos < len; pos++) {\n                code = path.charCodeAt(pos);\n                if (code === _slash || code === _backslash) {\n                    return path.slice(0, pos + 1); // consume this separator\n                }\n            }\n        }\n        return '';\n    }\n    exports.getRoot = getRoot;\n    exports.join = function () {\n        var value = '';\n        for (var i = 0; i < arguments.length; i++) {\n            var part = arguments[i];\n            if (i > 0) {\n                // add the separater between two parts unless\n                // there already is one\n                var last = value.charCodeAt(value.length - 1);\n                if (last !== _slash && last !== _backslash) {\n                    var next = part.charCodeAt(0);\n                    if (next !== _slash && next !== _backslash) {\n                        value += exports.sep;\n                    }\n                }\n            }\n            value += part;\n        }\n        return normalize(value);\n    };\n    /**\n     * Check if the path follows this pattern: `\\\\hostname\\sharename`.\n     *\n     * @see https://msdn.microsoft.com/en-us/library/gg465305.aspx\n     * @return A boolean indication if the path is a UNC path, on none-windows\n     * always false.\n     */\n    function isUNC(path) {\n        if (!platform_1.isWindows) {\n            // UNC is a windows concept\n            return false;\n        }\n        if (!path || path.length < 5) {\n            // at least \\\\a\\b\n            return false;\n        }\n        var code = path.charCodeAt(0);\n        if (code !== _backslash) {\n            return false;\n        }\n        code = path.charCodeAt(1);\n        if (code !== _backslash) {\n            return false;\n        }\n        var pos = 2;\n        var start = pos;\n        for (; pos < path.length; pos++) {\n            code = path.charCodeAt(pos);\n            if (code === _backslash) {\n                break;\n            }\n        }\n        if (start === pos) {\n            return false;\n        }\n        code = path.charCodeAt(pos + 1);\n        if (isNaN(code) || code === _backslash) {\n            return false;\n        }\n        return true;\n    }\n    exports.isUNC = isUNC;\n    function isPosixAbsolute(path) {\n        return path && path[0] === '/';\n    }\n    function makePosixAbsolute(path) {\n        return isPosixAbsolute(normalize(path)) ? path : exports.sep + path;\n    }\n    exports.makePosixAbsolute = makePosixAbsolute;\n    var _slash = '/'.charCodeAt(0);\n    var _backslash = '\\\\'.charCodeAt(0);\n    var _colon = ':'.charCodeAt(0);\n    var _a = 'a'.charCodeAt(0);\n    var _A = 'A'.charCodeAt(0);\n    var _z = 'z'.charCodeAt(0);\n    var _Z = 'Z'.charCodeAt(0);\n    function isEqualOrParent(path, candidate) {\n        if (path === candidate) {\n            return true;\n        }\n        path = normalize(path);\n        candidate = normalize(candidate);\n        var candidateLen = candidate.length;\n        var lastCandidateChar = candidate.charCodeAt(candidateLen - 1);\n        if (lastCandidateChar === _slash) {\n            candidate = candidate.substring(0, candidateLen - 1);\n            candidateLen -= 1;\n        }\n        if (path === candidate) {\n            return true;\n        }\n        if (!platform_1.isLinux) {\n            // case insensitive\n            path = path.toLowerCase();\n            candidate = candidate.toLowerCase();\n        }\n        if (path === candidate) {\n            return true;\n        }\n        if (path.indexOf(candidate) !== 0) {\n            return false;\n        }\n        var char = path.charCodeAt(candidateLen);\n        return char === _slash;\n    }\n    exports.isEqualOrParent = isEqualOrParent;\n    // Reference: https://en.wikipedia.org/wiki/Filename\n    var INVALID_FILE_CHARS = platform_1.isWindows ? /[\\\\/:\\*\\?\"<>\\|]/g : /[\\\\/]/g;\n    var WINDOWS_FORBIDDEN_NAMES = /^(con|prn|aux|clock\\$|nul|lpt[0-9]|com[0-9])$/i;\n    function isValidBasename(name) {\n        if (!name || name.length === 0 || /^\\s+$/.test(name)) {\n            return false; // require a name that is not just whitespace\n        }\n        INVALID_FILE_CHARS.lastIndex = 0; // the holy grail of software development\n        if (INVALID_FILE_CHARS.test(name)) {\n            return false; // check for certain invalid file characters\n        }\n        if (platform_1.isWindows && WINDOWS_FORBIDDEN_NAMES.test(name)) {\n            return false; // check for certain invalid file names\n        }\n        if (name === '.' || name === '..') {\n            return false; // check for reserved values\n        }\n        if (platform_1.isWindows && name[name.length - 1] === '.') {\n            return false; // Windows: file cannot end with a \".\"\n        }\n        if (platform_1.isWindows && name.length !== name.trim().length) {\n            return false; // Windows: file cannot end with a whitespace\n        }\n        return true;\n    }\n    exports.isValidBasename = isValidBasename;\n    exports.isAbsoluteRegex = /^((\\/|[a-zA-Z]:\\\\)[^\\(\\)<>\\\\'\\\"\\[\\]]+)/;\n    /**\n     * If you have access to node, it is recommended to use node's path.isAbsolute().\n     * This is a simple regex based approach.\n     */\n    function isAbsolute(path) {\n        return exports.isAbsoluteRegex.test(path);\n    }\n    exports.isAbsolute = isAbsolute;\n});\n\ndefine(__m[61], __M([1,0,10]), function (require, exports, platform_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var hasPerformanceNow = (platform_1.globals.performance && typeof platform_1.globals.performance.now === 'function');\n    var StopWatch = (function () {\n        function StopWatch(highResolution) {\n            this._highResolution = hasPerformanceNow && highResolution;\n            this._startTime = this._now();\n            this._stopTime = -1;\n        }\n        StopWatch.create = function (highResolution) {\n            if (highResolution === void 0) { highResolution = true; }\n            return new StopWatch(highResolution);\n        };\n        StopWatch.prototype.stop = function () {\n            this._stopTime = this._now();\n        };\n        StopWatch.prototype.elapsed = function () {\n            if (this._stopTime !== -1) {\n                return this._stopTime - this._startTime;\n            }\n            return this._now() - this._startTime;\n        };\n        StopWatch.prototype._now = function () {\n            return this._highResolution ? platform_1.globals.performance.now() : new Date().getTime();\n        };\n        return StopWatch;\n    }());\n    exports.StopWatch = StopWatch;\n});\n\ndefine(__m[3], __M([1,0,36]), function (require, exports, map_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * The empty string.\n     */\n    exports.empty = '';\n    /**\n     * @returns the provided number with the given number of preceding zeros.\n     */\n    function pad(n, l, char) {\n        if (char === void 0) { char = '0'; }\n        var str = '' + n;\n        var r = [str];\n        for (var i = str.length; i < l; i++) {\n            r.push(char);\n        }\n        return r.reverse().join('');\n    }\n    exports.pad = pad;\n    var _formatRegexp = /{(\\d+)}/g;\n    /**\n     * Helper to produce a string with a variable number of arguments. Insert variable segments\n     * into the string using the {n} notation where N is the index of the argument following the string.\n     * @param value string to which formatting is applied\n     * @param args replacements for {n}-entries\n     */\n    function format(value) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        if (args.length === 0) {\n            return value;\n        }\n        return value.replace(_formatRegexp, function (match, group) {\n            var idx = parseInt(group, 10);\n            return isNaN(idx) || idx < 0 || idx >= args.length ?\n                match :\n                args[idx];\n        });\n    }\n    exports.format = format;\n    /**\n     * Converts HTML characters inside the string to use entities instead. Makes the string safe from\n     * being used e.g. in HTMLElement.innerHTML.\n     */\n    function escape(html) {\n        return html.replace(/[<|>|&]/g, function (match) {\n            switch (match) {\n                case '<': return '&lt;';\n                case '>': return '&gt;';\n                case '&': return '&amp;';\n                default: return match;\n            }\n        });\n    }\n    exports.escape = escape;\n    /**\n     * Escapes regular expression characters in a given string\n     */\n    function escapeRegExpCharacters(value) {\n        return value.replace(/[\\-\\\\\\{\\}\\*\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&');\n    }\n    exports.escapeRegExpCharacters = escapeRegExpCharacters;\n    /**\n     * Removes all occurrences of needle from the beginning and end of haystack.\n     * @param haystack string to trim\n     * @param needle the thing to trim (default is a blank)\n     */\n    function trim(haystack, needle) {\n        if (needle === void 0) { needle = ' '; }\n        var trimmed = ltrim(haystack, needle);\n        return rtrim(trimmed, needle);\n    }\n    exports.trim = trim;\n    /**\n     * Removes all occurrences of needle from the beginning of haystack.\n     * @param haystack string to trim\n     * @param needle the thing to trim\n     */\n    function ltrim(haystack, needle) {\n        if (!haystack || !needle) {\n            return haystack;\n        }\n        var needleLen = needle.length;\n        if (needleLen === 0 || haystack.length === 0) {\n            return haystack;\n        }\n        var offset = 0, idx = -1;\n        while ((idx = haystack.indexOf(needle, offset)) === offset) {\n            offset = offset + needleLen;\n        }\n        return haystack.substring(offset);\n    }\n    exports.ltrim = ltrim;\n    /**\n     * Removes all occurrences of needle from the end of haystack.\n     * @param haystack string to trim\n     * @param needle the thing to trim\n     */\n    function rtrim(haystack, needle) {\n        if (!haystack || !needle) {\n            return haystack;\n        }\n        var needleLen = needle.length, haystackLen = haystack.length;\n        if (needleLen === 0 || haystackLen === 0) {\n            return haystack;\n        }\n        var offset = haystackLen, idx = -1;\n        while (true) {\n            idx = haystack.lastIndexOf(needle, offset - 1);\n            if (idx === -1 || idx + needleLen !== offset) {\n                break;\n            }\n            if (idx === 0) {\n                return '';\n            }\n            offset = idx;\n        }\n        return haystack.substring(0, offset);\n    }\n    exports.rtrim = rtrim;\n    function convertSimple2RegExpPattern(pattern) {\n        return pattern.replace(/[\\-\\\\\\{\\}\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&').replace(/[\\*]/g, '.*');\n    }\n    exports.convertSimple2RegExpPattern = convertSimple2RegExpPattern;\n    function stripWildcards(pattern) {\n        return pattern.replace(/\\*/g, '');\n    }\n    exports.stripWildcards = stripWildcards;\n    /**\n     * Determines if haystack starts with needle.\n     */\n    function startsWith(haystack, needle) {\n        if (haystack.length < needle.length) {\n            return false;\n        }\n        for (var i = 0; i < needle.length; i++) {\n            if (haystack[i] !== needle[i]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    exports.startsWith = startsWith;\n    /**\n     * Determines if haystack ends with needle.\n     */\n    function endsWith(haystack, needle) {\n        var diff = haystack.length - needle.length;\n        if (diff > 0) {\n            return haystack.lastIndexOf(needle) === diff;\n        }\n        else if (diff === 0) {\n            return haystack === needle;\n        }\n        else {\n            return false;\n        }\n    }\n    exports.endsWith = endsWith;\n    function createRegExp(searchString, isRegex, matchCase, wholeWord, global) {\n        if (searchString === '') {\n            throw new Error('Cannot create regex from empty string');\n        }\n        if (!isRegex) {\n            searchString = searchString.replace(/[\\-\\\\\\{\\}\\*\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&');\n        }\n        if (wholeWord) {\n            if (!/\\B/.test(searchString.charAt(0))) {\n                searchString = '\\\\b' + searchString;\n            }\n            if (!/\\B/.test(searchString.charAt(searchString.length - 1))) {\n                searchString = searchString + '\\\\b';\n            }\n        }\n        var modifiers = '';\n        if (global) {\n            modifiers += 'g';\n        }\n        if (!matchCase) {\n            modifiers += 'i';\n        }\n        return new RegExp(searchString, modifiers);\n    }\n    exports.createRegExp = createRegExp;\n    /**\n     * Create a regular expression only if it is valid and it doesn't lead to endless loop.\n     */\n    function createSafeRegExp(searchString, isRegex, matchCase, wholeWord) {\n        if (searchString === '') {\n            return null;\n        }\n        // Try to create a RegExp out of the params\n        var regex = null;\n        try {\n            regex = createRegExp(searchString, isRegex, matchCase, wholeWord, true);\n        }\n        catch (err) {\n            return null;\n        }\n        // Guard against endless loop RegExps & wrap around try-catch as very long regexes produce an exception when executed the first time\n        try {\n            if (regExpLeadsToEndlessLoop(regex)) {\n                return null;\n            }\n        }\n        catch (err) {\n            return null;\n        }\n        return regex;\n    }\n    exports.createSafeRegExp = createSafeRegExp;\n    function regExpLeadsToEndlessLoop(regexp) {\n        // Exit early if it's one of these special cases which are meant to match\n        // against an empty string\n        if (regexp.source === '^' || regexp.source === '^$' || regexp.source === '$') {\n            return false;\n        }\n        // We check against an empty string. If the regular expression doesn't advance\n        // (e.g. ends in an endless loop) it will match an empty string.\n        var match = regexp.exec('');\n        return (match && regexp.lastIndex === 0);\n    }\n    exports.regExpLeadsToEndlessLoop = regExpLeadsToEndlessLoop;\n    /**\n     * The normalize() method returns the Unicode Normalization Form of a given string. The form will be\n     * the Normalization Form Canonical Composition.\n     *\n     * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize}\n     */\n    exports.canNormalize = typeof (''.normalize) === 'function';\n    var nonAsciiCharactersPattern = /[^\\u0000-\\u0080]/;\n    var normalizedCache = new map_1.LinkedMap(10000); // bounded to 10000 elements\n    function normalizeNFC(str) {\n        if (!exports.canNormalize || !str) {\n            return str;\n        }\n        var cached = normalizedCache.get(str);\n        if (cached) {\n            return cached;\n        }\n        var res;\n        if (nonAsciiCharactersPattern.test(str)) {\n            res = str.normalize('NFC');\n        }\n        else {\n            res = str;\n        }\n        // Use the cache for fast lookup\n        normalizedCache.set(str, res);\n        return res;\n    }\n    exports.normalizeNFC = normalizeNFC;\n    /**\n     * Returns first index of the string that is not whitespace.\n     * If string is empty or contains only whitespaces, returns -1\n     */\n    function firstNonWhitespaceIndex(str) {\n        for (var i = 0, len = str.length; i < len; i++) {\n            if (str.charAt(i) !== ' ' && str.charAt(i) !== '\\t') {\n                return i;\n            }\n        }\n        return -1;\n    }\n    exports.firstNonWhitespaceIndex = firstNonWhitespaceIndex;\n    /**\n     * Returns the leading whitespace of the string.\n     * If the string contains only whitespaces, returns entire string\n     */\n    function getLeadingWhitespace(str) {\n        for (var i = 0, len = str.length; i < len; i++) {\n            if (str.charAt(i) !== ' ' && str.charAt(i) !== '\\t') {\n                return str.substring(0, i);\n            }\n        }\n        return str;\n    }\n    exports.getLeadingWhitespace = getLeadingWhitespace;\n    /**\n     * Returns last index of the string that is not whitespace.\n     * If string is empty or contains only whitespaces, returns -1\n     */\n    function lastNonWhitespaceIndex(str, startIndex) {\n        if (startIndex === void 0) { startIndex = str.length - 1; }\n        for (var i = startIndex; i >= 0; i--) {\n            if (str.charAt(i) !== ' ' && str.charAt(i) !== '\\t') {\n                return i;\n            }\n        }\n        return -1;\n    }\n    exports.lastNonWhitespaceIndex = lastNonWhitespaceIndex;\n    function localeCompare(strA, strB) {\n        return strA.localeCompare(strB);\n    }\n    exports.localeCompare = localeCompare;\n    function isAsciiChar(code) {\n        return (code >= 97 && code <= 122) || (code >= 65 && code <= 90);\n    }\n    function equalsIgnoreCase(a, b) {\n        var len1 = a.length, len2 = b.length;\n        if (len1 !== len2) {\n            return false;\n        }\n        for (var i = 0; i < len1; i++) {\n            var codeA = a.charCodeAt(i), codeB = b.charCodeAt(i);\n            if (codeA === codeB) {\n                continue;\n            }\n            else if (isAsciiChar(codeA) && isAsciiChar(codeB)) {\n                var diff = Math.abs(codeA - codeB);\n                if (diff !== 0 && diff !== 32) {\n                    return false;\n                }\n            }\n            else {\n                if (String.fromCharCode(codeA).toLocaleLowerCase() !== String.fromCharCode(codeB).toLocaleLowerCase()) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    exports.equalsIgnoreCase = equalsIgnoreCase;\n    /**\n     * @returns the length of the common prefix of the two strings.\n     */\n    function commonPrefixLength(a, b) {\n        var i, len = Math.min(a.length, b.length);\n        for (i = 0; i < len; i++) {\n            if (a.charCodeAt(i) !== b.charCodeAt(i)) {\n                return i;\n            }\n        }\n        return len;\n    }\n    exports.commonPrefixLength = commonPrefixLength;\n    /**\n     * @returns the length of the common suffix of the two strings.\n     */\n    function commonSuffixLength(a, b) {\n        var i, len = Math.min(a.length, b.length);\n        var aLastIndex = a.length - 1;\n        var bLastIndex = b.length - 1;\n        for (i = 0; i < len; i++) {\n            if (a.charCodeAt(aLastIndex - i) !== b.charCodeAt(bLastIndex - i)) {\n                return i;\n            }\n        }\n        return len;\n    }\n    exports.commonSuffixLength = commonSuffixLength;\n    // --- unicode\n    // http://en.wikipedia.org/wiki/Surrogate_pair\n    // Returns the code point starting at a specified index in a string\n    // Code points U+0000 to U+D7FF and U+E000 to U+FFFF are represented on a single character\n    // Code points U+10000 to U+10FFFF are represented on two consecutive characters\n    //export function getUnicodePoint(str:string, index:number, len:number):number {\n    //\tlet chrCode = str.charCodeAt(index);\n    //\tif (0xD800 <= chrCode && chrCode <= 0xDBFF && index + 1 < len) {\n    //\t\tlet nextChrCode = str.charCodeAt(index + 1);\n    //\t\tif (0xDC00 <= nextChrCode && nextChrCode <= 0xDFFF) {\n    //\t\t\treturn (chrCode - 0xD800) << 10 + (nextChrCode - 0xDC00) + 0x10000;\n    //\t\t}\n    //\t}\n    //\treturn chrCode;\n    //}\n    //export function isLeadSurrogate(chr:string) {\n    //\tlet chrCode = chr.charCodeAt(0);\n    //\treturn ;\n    //}\n    //\n    //export function isTrailSurrogate(chr:string) {\n    //\tlet chrCode = chr.charCodeAt(0);\n    //\treturn 0xDC00 <= chrCode && chrCode <= 0xDFFF;\n    //}\n    function isFullWidthCharacter(charCode) {\n        // Do a cheap trick to better support wrapping of wide characters, treat them as 2 columns\n        // http://jrgraphix.net/research/unicode_blocks.php\n        //          2E80  2EFF   CJK Radicals Supplement\n        //          2F00  2FDF   Kangxi Radicals\n        //          2FF0  2FFF   Ideographic Description Characters\n        //          3000  303F   CJK Symbols and Punctuation\n        //          3040  309F   Hiragana\n        //          30A0  30FF   Katakana\n        //          3100  312F   Bopomofo\n        //          3130  318F   Hangul Compatibility Jamo\n        //          3190  319F   Kanbun\n        //          31A0  31BF   Bopomofo Extended\n        //          31F0  31FF   Katakana Phonetic Extensions\n        //          3200  32FF   Enclosed CJK Letters and Months\n        //          3300  33FF   CJK Compatibility\n        //          3400  4DBF   CJK Unified Ideographs Extension A\n        //          4DC0  4DFF   Yijing Hexagram Symbols\n        //          4E00  9FFF   CJK Unified Ideographs\n        //          A000  A48F   Yi Syllables\n        //          A490  A4CF   Yi Radicals\n        //          AC00  D7AF   Hangul Syllables\n        // [IGNORE] D800  DB7F   High Surrogates\n        // [IGNORE] DB80  DBFF   High Private Use Surrogates\n        // [IGNORE] DC00  DFFF   Low Surrogates\n        // [IGNORE] E000  F8FF   Private Use Area\n        //          F900  FAFF   CJK Compatibility Ideographs\n        // [IGNORE] FB00  FB4F   Alphabetic Presentation Forms\n        // [IGNORE] FB50  FDFF   Arabic Presentation Forms-A\n        // [IGNORE] FE00  FE0F   Variation Selectors\n        // [IGNORE] FE20  FE2F   Combining Half Marks\n        // [IGNORE] FE30  FE4F   CJK Compatibility Forms\n        // [IGNORE] FE50  FE6F   Small Form Variants\n        // [IGNORE] FE70  FEFF   Arabic Presentation Forms-B\n        //          FF00  FFEF   Halfwidth and Fullwidth Forms\n        //               [https://en.wikipedia.org/wiki/Halfwidth_and_fullwidth_forms]\n        //               of which FF01 - FF5E fullwidth ASCII of 21 to 7E\n        // [IGNORE]    and FF65 - FFDC halfwidth of Katakana and Hangul\n        // [IGNORE] FFF0  FFFF   Specials\n        charCode = +charCode; // @perf\n        return ((charCode >= 0x2E80 && charCode <= 0xD7AF)\n            || (charCode >= 0xF900 && charCode <= 0xFAFF)\n            || (charCode >= 0xFF01 && charCode <= 0xFF5E));\n    }\n    exports.isFullWidthCharacter = isFullWidthCharacter;\n    /**\n     * Computes the difference score for two strings. More similar strings have a higher score.\n     * We use largest common subsequence dynamic programming approach but penalize in the end for length differences.\n     * Strings that have a large length difference will get a bad default score 0.\n     * Complexity - both time and space O(first.length * second.length)\n     * Dynamic programming LCS computation http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n     *\n     * @param first a string\n     * @param second a string\n     */\n    function difference(first, second, maxLenDelta) {\n        if (maxLenDelta === void 0) { maxLenDelta = 4; }\n        var lengthDifference = Math.abs(first.length - second.length);\n        // We only compute score if length of the currentWord and length of entry.name are similar.\n        if (lengthDifference > maxLenDelta) {\n            return 0;\n        }\n        // Initialize LCS (largest common subsequence) matrix.\n        var LCS = [];\n        var zeroArray = [];\n        var i, j;\n        for (i = 0; i < second.length + 1; ++i) {\n            zeroArray.push(0);\n        }\n        for (i = 0; i < first.length + 1; ++i) {\n            LCS.push(zeroArray);\n        }\n        for (i = 1; i < first.length + 1; ++i) {\n            for (j = 1; j < second.length + 1; ++j) {\n                if (first[i - 1] === second[j - 1]) {\n                    LCS[i][j] = LCS[i - 1][j - 1] + 1;\n                }\n                else {\n                    LCS[i][j] = Math.max(LCS[i - 1][j], LCS[i][j - 1]);\n                }\n            }\n        }\n        return LCS[first.length][second.length] - Math.sqrt(lengthDifference);\n    }\n    exports.difference = difference;\n    /**\n     * Returns an array in which every entry is the offset of a\n     * line. There is always one entry which is zero.\n     */\n    function computeLineStarts(text) {\n        var regexp = /\\r\\n|\\r|\\n/g, ret = [0], match;\n        while ((match = regexp.exec(text))) {\n            ret.push(regexp.lastIndex);\n        }\n        return ret;\n    }\n    exports.computeLineStarts = computeLineStarts;\n    /**\n     * Given a string and a max length returns a shorted version. Shorting\n     * happens at favorable positions - such as whitespace or punctuation characters.\n     */\n    function lcut(text, n) {\n        if (text.length < n) {\n            return text;\n        }\n        var segments = text.split(/\\b/), count = 0;\n        for (var i = segments.length - 1; i >= 0; i--) {\n            count += segments[i].length;\n            if (count > n) {\n                segments.splice(0, i);\n                break;\n            }\n        }\n        return segments.join(exports.empty).replace(/^\\s/, exports.empty);\n    }\n    exports.lcut = lcut;\n    // Escape codes\n    // http://en.wikipedia.org/wiki/ANSI_escape_code\n    var EL = /\\x1B\\x5B[12]?K/g; // Erase in line\n    var LF = /\\xA/g; // line feed\n    var COLOR_START = /\\x1b\\[\\d+m/g; // Color\n    var COLOR_END = /\\x1b\\[0?m/g; // Color\n    function removeAnsiEscapeCodes(str) {\n        if (str) {\n            str = str.replace(EL, '');\n            str = str.replace(LF, '\\n');\n            str = str.replace(COLOR_START, '');\n            str = str.replace(COLOR_END, '');\n        }\n        return str;\n    }\n    exports.removeAnsiEscapeCodes = removeAnsiEscapeCodes;\n    // -- UTF-8 BOM\n    var __utf8_bom = 65279;\n    exports.UTF8_BOM_CHARACTER = String.fromCharCode(__utf8_bom);\n    function startsWithUTF8BOM(str) {\n        return (str && str.length > 0 && str.charCodeAt(0) === __utf8_bom);\n    }\n    exports.startsWithUTF8BOM = startsWithUTF8BOM;\n    /**\n     * Appends two strings. If the appended result is longer than maxLength,\n     * trims the start of the result and replaces it with '...'.\n     */\n    function appendWithLimit(first, second, maxLength) {\n        var newLength = first.length + second.length;\n        if (newLength > maxLength) {\n            first = '...' + first.substr(newLength - maxLength);\n        }\n        if (second.length > maxLength) {\n            first += second.substr(second.length - maxLength);\n        }\n        else {\n            first += second;\n        }\n        return first;\n    }\n    exports.appendWithLimit = appendWithLimit;\n    function safeBtoa(str) {\n        return btoa(encodeURIComponent(str)); // we use encodeURIComponent because btoa fails for non Latin 1 values\n    }\n    exports.safeBtoa = safeBtoa;\n    function repeat(s, count) {\n        var result = '';\n        for (var i = 0; i < count; i++) {\n            result += s;\n        }\n        return result;\n    }\n    exports.repeat = repeat;\n});\n\ndefine(__m[80], __M([1,0,3,36]), function (require, exports, strings, map_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // Combined filters\n    /**\n     * @returns A filter which combines the provided set\n     * of filters with an or. The *first* filters that\n     * matches defined the return value of the returned\n     * filter.\n     */\n    function or() {\n        var filter = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            filter[_i - 0] = arguments[_i];\n        }\n        return function (word, wordToMatchAgainst) {\n            for (var i = 0, len = filter.length; i < len; i++) {\n                var match = filter[i](word, wordToMatchAgainst);\n                if (match) {\n                    return match;\n                }\n            }\n            return null;\n        };\n    }\n    exports.or = or;\n    /**\n     * @returns A filter which combines the provided set\n     * of filters with an and. The combines matches are\n     * returned if *all* filters match.\n     */\n    function and() {\n        var filter = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            filter[_i - 0] = arguments[_i];\n        }\n        return function (word, wordToMatchAgainst) {\n            var result = [];\n            for (var i = 0, len = filter.length; i < len; i++) {\n                var match = filter[i](word, wordToMatchAgainst);\n                if (!match) {\n                    return null;\n                }\n                result = result.concat(match);\n            }\n            return result;\n        };\n    }\n    exports.and = and;\n    // Prefix\n    exports.matchesStrictPrefix = function (word, wordToMatchAgainst) { return _matchesPrefix(false, word, wordToMatchAgainst); };\n    exports.matchesPrefix = function (word, wordToMatchAgainst) { return _matchesPrefix(true, word, wordToMatchAgainst); };\n    function _matchesPrefix(ignoreCase, word, wordToMatchAgainst) {\n        if (!wordToMatchAgainst || wordToMatchAgainst.length === 0 || wordToMatchAgainst.length < word.length) {\n            return null;\n        }\n        if (ignoreCase) {\n            word = word.toLowerCase();\n            wordToMatchAgainst = wordToMatchAgainst.toLowerCase();\n        }\n        for (var i = 0; i < word.length; i++) {\n            if (word[i] !== wordToMatchAgainst[i]) {\n                return null;\n            }\n        }\n        return word.length > 0 ? [{ start: 0, end: word.length }] : [];\n    }\n    // Contiguous Substring\n    function matchesContiguousSubString(word, wordToMatchAgainst) {\n        var index = wordToMatchAgainst.toLowerCase().indexOf(word.toLowerCase());\n        if (index === -1) {\n            return null;\n        }\n        return [{ start: index, end: index + word.length }];\n    }\n    exports.matchesContiguousSubString = matchesContiguousSubString;\n    // Substring\n    function matchesSubString(word, wordToMatchAgainst) {\n        return _matchesSubString(word.toLowerCase(), wordToMatchAgainst.toLowerCase(), 0, 0);\n    }\n    exports.matchesSubString = matchesSubString;\n    function _matchesSubString(word, wordToMatchAgainst, i, j) {\n        if (i === word.length) {\n            return [];\n        }\n        else if (j === wordToMatchAgainst.length) {\n            return null;\n        }\n        else {\n            if (word[i] === wordToMatchAgainst[j]) {\n                var result = null;\n                if (result = _matchesSubString(word, wordToMatchAgainst, i + 1, j + 1)) {\n                    return join({ start: j, end: j + 1 }, result);\n                }\n            }\n            return _matchesSubString(word, wordToMatchAgainst, i, j + 1);\n        }\n    }\n    // CamelCase\n    function isLower(code) {\n        return 97 <= code && code <= 122;\n    }\n    function isUpper(code) {\n        return 65 <= code && code <= 90;\n    }\n    function isNumber(code) {\n        return 48 <= code && code <= 57;\n    }\n    function isWhitespace(code) {\n        return [32, 9, 10, 13].indexOf(code) > -1;\n    }\n    function isAlphanumeric(code) {\n        return isLower(code) || isUpper(code) || isNumber(code);\n    }\n    function join(head, tail) {\n        if (tail.length === 0) {\n            tail = [head];\n        }\n        else if (head.end === tail[0].start) {\n            tail[0].start = head.start;\n        }\n        else {\n            tail.unshift(head);\n        }\n        return tail;\n    }\n    function nextAnchor(camelCaseWord, start) {\n        for (var i = start; i < camelCaseWord.length; i++) {\n            var c = camelCaseWord.charCodeAt(i);\n            if (isUpper(c) || isNumber(c) || (i > 0 && !isAlphanumeric(camelCaseWord.charCodeAt(i - 1)))) {\n                return i;\n            }\n        }\n        return camelCaseWord.length;\n    }\n    function _matchesCamelCase(word, camelCaseWord, i, j) {\n        if (i === word.length) {\n            return [];\n        }\n        else if (j === camelCaseWord.length) {\n            return null;\n        }\n        else if (word[i] !== camelCaseWord[j].toLowerCase()) {\n            return null;\n        }\n        else {\n            var result = null;\n            var nextUpperIndex = j + 1;\n            result = _matchesCamelCase(word, camelCaseWord, i + 1, j + 1);\n            while (!result && (nextUpperIndex = nextAnchor(camelCaseWord, nextUpperIndex)) < camelCaseWord.length) {\n                result = _matchesCamelCase(word, camelCaseWord, i + 1, nextUpperIndex);\n                nextUpperIndex++;\n            }\n            return result === null ? null : join({ start: j, end: j + 1 }, result);\n        }\n    }\n    // Heuristic to avoid computing camel case matcher for words that don't\n    // look like camelCaseWords.\n    function isCamelCaseWord(word) {\n        if (word.length > 60) {\n            return false;\n        }\n        var upper = 0, lower = 0, alpha = 0, numeric = 0, code = 0;\n        for (var i = 0; i < word.length; i++) {\n            code = word.charCodeAt(i);\n            if (isUpper(code)) {\n                upper++;\n            }\n            if (isLower(code)) {\n                lower++;\n            }\n            if (isAlphanumeric(code)) {\n                alpha++;\n            }\n            if (isNumber(code)) {\n                numeric++;\n            }\n        }\n        var upperPercent = upper / word.length;\n        var lowerPercent = lower / word.length;\n        var alphaPercent = alpha / word.length;\n        var numericPercent = numeric / word.length;\n        return lowerPercent > 0.2 && upperPercent < 0.8 && alphaPercent > 0.6 && numericPercent < 0.2;\n    }\n    // Heuristic to avoid computing camel case matcher for words that don't\n    // look like camel case patterns.\n    function isCamelCasePattern(word) {\n        var upper = 0, lower = 0, code = 0, whitespace = 0;\n        for (var i = 0; i < word.length; i++) {\n            code = word.charCodeAt(i);\n            if (isUpper(code)) {\n                upper++;\n            }\n            if (isLower(code)) {\n                lower++;\n            }\n            if (isWhitespace(code)) {\n                whitespace++;\n            }\n        }\n        if ((upper === 0 || lower === 0) && whitespace === 0) {\n            return word.length <= 30;\n        }\n        else {\n            return upper <= 5;\n        }\n    }\n    function matchesCamelCase(word, camelCaseWord) {\n        if (!camelCaseWord || camelCaseWord.length === 0) {\n            return null;\n        }\n        if (!isCamelCasePattern(word)) {\n            return null;\n        }\n        if (!isCamelCaseWord(camelCaseWord)) {\n            return null;\n        }\n        var result = null;\n        var i = 0;\n        while (i < camelCaseWord.length && (result = _matchesCamelCase(word.toLowerCase(), camelCaseWord, 0, i)) === null) {\n            i = nextAnchor(camelCaseWord, i + 1);\n        }\n        return result;\n    }\n    exports.matchesCamelCase = matchesCamelCase;\n    // Matches beginning of words supporting non-ASCII languages\n    // E.g. \"gp\" or \"g p\" will match \"Git: Pull\"\n    // Useful in cases where the target is words (e.g. command labels)\n    function matchesWords(word, target) {\n        if (!target || target.length === 0) {\n            return null;\n        }\n        var result = null;\n        var i = 0;\n        while (i < target.length && (result = _matchesWords(word.toLowerCase(), target, 0, i)) === null) {\n            i = nextWord(target, i + 1);\n        }\n        return result;\n    }\n    exports.matchesWords = matchesWords;\n    function _matchesWords(word, target, i, j) {\n        if (i === word.length) {\n            return [];\n        }\n        else if (j === target.length) {\n            return null;\n        }\n        else if (word[i] !== target[j].toLowerCase()) {\n            return null;\n        }\n        else {\n            var result = null;\n            var nextWordIndex = j + 1;\n            result = _matchesWords(word, target, i + 1, j + 1);\n            while (!result && (nextWordIndex = nextWord(target, nextWordIndex)) < target.length) {\n                result = _matchesWords(word, target, i + 1, nextWordIndex);\n                nextWordIndex++;\n            }\n            return result === null ? null : join({ start: j, end: j + 1 }, result);\n        }\n    }\n    function nextWord(word, start) {\n        for (var i = start; i < word.length; i++) {\n            var c = word.charCodeAt(i);\n            if (isWhitespace(c) || (i > 0 && isWhitespace(word.charCodeAt(i - 1)))) {\n                return i;\n            }\n        }\n        return word.length;\n    }\n    // Fuzzy\n    (function (SubstringMatching) {\n        SubstringMatching[SubstringMatching[\"Contiguous\"] = 0] = \"Contiguous\";\n        SubstringMatching[SubstringMatching[\"Separate\"] = 1] = \"Separate\";\n    })(exports.SubstringMatching || (exports.SubstringMatching = {}));\n    var SubstringMatching = exports.SubstringMatching;\n    exports.fuzzyContiguousFilter = or(exports.matchesPrefix, matchesCamelCase, matchesContiguousSubString);\n    var fuzzySeparateFilter = or(exports.matchesPrefix, matchesCamelCase, matchesSubString);\n    var fuzzyRegExpCache = new map_1.LinkedMap(10000); // bounded to 10000 elements\n    function matchesFuzzy(word, wordToMatchAgainst, enableSeparateSubstringMatching) {\n        if (enableSeparateSubstringMatching === void 0) { enableSeparateSubstringMatching = false; }\n        if (typeof word !== 'string' || typeof wordToMatchAgainst !== 'string') {\n            return null; // return early for invalid input\n        }\n        // Form RegExp for wildcard matches\n        var regexp = fuzzyRegExpCache.get(word);\n        if (!regexp) {\n            regexp = new RegExp(strings.convertSimple2RegExpPattern(word), 'i');\n            fuzzyRegExpCache.set(word, regexp);\n        }\n        // RegExp Filter\n        var match = regexp.exec(wordToMatchAgainst);\n        if (match) {\n            return [{ start: match.index, end: match.index + match[0].length }];\n        }\n        // Default Filter\n        return enableSeparateSubstringMatching ? fuzzySeparateFilter(word, wordToMatchAgainst) : exports.fuzzyContiguousFilter(word, wordToMatchAgainst);\n    }\n    exports.matchesFuzzy = matchesFuzzy;\n});\n\ndefine(__m[55], __M([1,0,3,13,36]), function (require, exports, strings, paths, map_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var PATH_REGEX = '[/\\\\\\\\]'; // any slash or backslash\n    var NO_PATH_REGEX = '[^/\\\\\\\\]'; // any non-slash and non-backslash\n    function starsToRegExp(starCount) {\n        switch (starCount) {\n            case 0:\n                return '';\n            case 1:\n                return NO_PATH_REGEX + \"*?\"; // 1 star matches any number of characters except path separator (/ and \\) - non greedy (?)\n            default:\n                // Matches:  (Path Sep OR Path Val followed by Path Sep OR Path Sep followed by Path Val) 0-many times\n                // Group is non capturing because we don't need to capture at all (?:...)\n                // Overall we use non-greedy matching because it could be that we match too much\n                return \"(?:\" + PATH_REGEX + \"|\" + NO_PATH_REGEX + \"+\" + PATH_REGEX + \"|\" + PATH_REGEX + NO_PATH_REGEX + \"+)*?\";\n        }\n    }\n    function splitGlobAware(pattern, splitChar) {\n        if (!pattern) {\n            return [];\n        }\n        var segments = [];\n        var inBraces = false;\n        var inBrackets = false;\n        var char;\n        var curVal = '';\n        for (var i = 0; i < pattern.length; i++) {\n            char = pattern[i];\n            switch (char) {\n                case splitChar:\n                    if (!inBraces && !inBrackets) {\n                        segments.push(curVal);\n                        curVal = '';\n                        continue;\n                    }\n                    break;\n                case '{':\n                    inBraces = true;\n                    break;\n                case '}':\n                    inBraces = false;\n                    break;\n                case '[':\n                    inBrackets = true;\n                    break;\n                case ']':\n                    inBrackets = false;\n                    break;\n            }\n            curVal += char;\n        }\n        // Tail\n        if (curVal) {\n            segments.push(curVal);\n        }\n        return segments;\n    }\n    exports.splitGlobAware = splitGlobAware;\n    function parseRegExp(pattern) {\n        if (!pattern) {\n            return '';\n        }\n        var regEx = '';\n        // Split up into segments for each slash found\n        var segments = splitGlobAware(pattern, '/');\n        // Special case where we only have globstars\n        if (segments.every(function (s) { return s === '**'; })) {\n            regEx = '.*';\n        }\n        else {\n            var previousSegmentWasGlobStar_1 = false;\n            segments.forEach(function (segment, index) {\n                // Globstar is special\n                if (segment === '**') {\n                    // if we have more than one globstar after another, just ignore it\n                    if (!previousSegmentWasGlobStar_1) {\n                        regEx += starsToRegExp(2);\n                        previousSegmentWasGlobStar_1 = true;\n                    }\n                    return;\n                }\n                // States\n                var inBraces = false;\n                var braceVal = '';\n                var inBrackets = false;\n                var bracketVal = '';\n                var char;\n                for (var i = 0; i < segment.length; i++) {\n                    char = segment[i];\n                    // Support brace expansion\n                    if (char !== '}' && inBraces) {\n                        braceVal += char;\n                        continue;\n                    }\n                    // Support brackets\n                    if (char !== ']' && inBrackets) {\n                        var res = void 0;\n                        switch (char) {\n                            case '-':\n                                res = char;\n                                break;\n                            case '^':\n                                res = char;\n                                break;\n                            default:\n                                res = strings.escapeRegExpCharacters(char);\n                        }\n                        bracketVal += res;\n                        continue;\n                    }\n                    switch (char) {\n                        case '{':\n                            inBraces = true;\n                            continue;\n                        case '[':\n                            inBrackets = true;\n                            continue;\n                        case '}':\n                            var choices = splitGlobAware(braceVal, ',');\n                            // Converts {foo,bar} => [foo|bar]\n                            var braceRegExp = \"(?:\" + choices.map(function (c) { return parseRegExp(c); }).join('|') + \")\";\n                            regEx += braceRegExp;\n                            inBraces = false;\n                            braceVal = '';\n                            break;\n                        case ']':\n                            regEx += ('[' + bracketVal + ']');\n                            inBrackets = false;\n                            bracketVal = '';\n                            break;\n                        case '?':\n                            regEx += NO_PATH_REGEX; // 1 ? matches any single character except path separator (/ and \\)\n                            continue;\n                        case '*':\n                            regEx += starsToRegExp(1);\n                            continue;\n                        default:\n                            regEx += strings.escapeRegExpCharacters(char);\n                    }\n                }\n                // Tail: Add the slash we had split on if there is more to come and the next one is not a globstar\n                if (index < segments.length - 1 && segments[index + 1] !== '**') {\n                    regEx += PATH_REGEX;\n                }\n                // reset state\n                previousSegmentWasGlobStar_1 = false;\n            });\n        }\n        return regEx;\n    }\n    // regexes to check for trival glob patterns that just check for String#endsWith\n    var T1 = /^\\*\\*\\/\\*\\.[\\w\\.-]+$/; // **/*.something\n    var T2 = /^\\*\\*\\/[\\w\\.-]+$/; // **/something\n    var T3 = /^{\\*\\*\\/\\*\\.[\\w\\.-]+(,\\*\\*\\/\\*\\.[\\w\\.-]+)*}$/; // {**/*.something,**/*.else}\n    var Trivia;\n    (function (Trivia) {\n        Trivia[Trivia[\"T1\"] = 0] = \"T1\";\n        Trivia[Trivia[\"T2\"] = 1] = \"T2\";\n        Trivia[Trivia[\"T3\"] = 2] = \"T3\"; // {**/*.something,**/*.else}\n    })(Trivia || (Trivia = {}));\n    var CACHE = new map_1.LinkedMap(10000); // bounded to 10000 elements\n    function parsePattern(pattern) {\n        if (!pattern) {\n            return null;\n        }\n        // Whitespace trimming\n        pattern = pattern.trim();\n        // Check cache\n        var parsedPattern = CACHE.get(pattern);\n        if (parsedPattern) {\n            if (parsedPattern.regexp) {\n                parsedPattern.regexp.lastIndex = 0; // reset RegExp to its initial state to reuse it!\n            }\n            return parsedPattern;\n        }\n        parsedPattern = Object.create(null);\n        // Check for Trivias\n        if (T1.test(pattern)) {\n            parsedPattern.trivia = Trivia.T1;\n        }\n        else if (T2.test(pattern)) {\n            parsedPattern.trivia = Trivia.T2;\n        }\n        else if (T3.test(pattern)) {\n            parsedPattern.trivia = Trivia.T3;\n        }\n        else {\n            parsedPattern.regexp = toRegExp(\"^\" + parseRegExp(pattern) + \"$\");\n        }\n        // Cache\n        CACHE.set(pattern, parsedPattern);\n        return parsedPattern;\n    }\n    function toRegExp(regEx) {\n        try {\n            return new RegExp(regEx);\n        }\n        catch (error) {\n            return /.^/; // create a regex that matches nothing if we cannot parse the pattern\n        }\n    }\n    function match(arg1, path, siblings) {\n        if (!arg1 || !path) {\n            return false;\n        }\n        // Glob with String\n        if (typeof arg1 === 'string') {\n            var parsedPattern = parsePattern(arg1);\n            if (!parsedPattern) {\n                return false;\n            }\n            // common pattern: **/*.txt just need endsWith check\n            if (parsedPattern.trivia === Trivia.T1) {\n                return strings.endsWith(path, arg1.substr(4)); // '**/*'.length === 4\n            }\n            // common pattern: **/some.txt just need basename check\n            if (parsedPattern.trivia === Trivia.T2) {\n                var base = arg1.substr(3); // '**/'.length === 3\n                return path === base || strings.endsWith(path, \"/\" + base) || strings.endsWith(path, \"\\\\\" + base);\n            }\n            // repetition of common patterns (see above) {**/*.txt,**/*.png}\n            if (parsedPattern.trivia === Trivia.T3) {\n                return arg1.slice(1, -1).split(',').some(function (pattern) { return match(pattern, path); });\n            }\n            return parsedPattern.regexp.test(path);\n        }\n        // Glob with Expression\n        return matchExpression(arg1, path, siblings);\n    }\n    exports.match = match;\n    function matchExpression(expression, path, siblings) {\n        var patterns = Object.getOwnPropertyNames(expression);\n        var basename;\n        var _loop_1 = function(i) {\n            var pattern = patterns[i];\n            var value = expression[pattern];\n            if (value === false) {\n                return \"continue\"; // pattern is disabled\n            }\n            // Pattern matches path\n            if (match(pattern, path)) {\n                // Expression Pattern is <boolean>\n                if (typeof value === 'boolean') {\n                    return { value: pattern };\n                }\n                // Expression Pattern is <SiblingClause>\n                if (value && typeof value.when === 'string') {\n                    if (!siblings || !siblings.length) {\n                        return \"continue\"; // pattern is malformed or we don't have siblings\n                    }\n                    if (!basename) {\n                        basename = strings.rtrim(paths.basename(path), paths.extname(path));\n                    }\n                    var clause = value;\n                    var clausePattern_1 = clause.when.replace('$(basename)', basename);\n                    if (siblings.some(function (sibling) { return sibling === clausePattern_1; })) {\n                        return { value: pattern };\n                    }\n                    else {\n                        return \"continue\"; // pattern does not match in the end because the when clause is not satisfied\n                    }\n                }\n                // Expression is Anything\n                return { value: pattern };\n            }\n        };\n        for (var i = 0; i < patterns.length; i++) {\n            var state_1 = _loop_1(i);\n            if (typeof state_1 === \"object\") return state_1.value;\n            if (state_1 === \"continue\") continue;\n        }\n        return null;\n    }\n});\n\ndefine(__m[9], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var _typeof = {\n        number: 'number',\n        string: 'string',\n        undefined: 'undefined',\n        object: 'object',\n        function: 'function'\n    };\n    /**\n     * @returns whether the provided parameter is a JavaScript Array or not.\n     */\n    function isArray(array) {\n        if (Array.isArray) {\n            return Array.isArray(array);\n        }\n        if (array && typeof (array.length) === _typeof.number && array.constructor === Array) {\n            return true;\n        }\n        return false;\n    }\n    exports.isArray = isArray;\n    /**\n     * @returns whether the provided parameter is a JavaScript String or not.\n     */\n    function isString(str) {\n        if (typeof (str) === _typeof.string || str instanceof String) {\n            return true;\n        }\n        return false;\n    }\n    exports.isString = isString;\n    /**\n     * @returns whether the provided parameter is a JavaScript Array and each element in the array is a string.\n     */\n    function isStringArray(value) {\n        return isArray(value) && value.every(function (elem) { return isString(elem); });\n    }\n    exports.isStringArray = isStringArray;\n    /**\n     *\n     * @returns whether the provided parameter is of type `object` but **not**\n     *\t`null`, an `array`, a `regexp`, nor a `date`.\n     */\n    function isObject(obj) {\n        return typeof obj === _typeof.object\n            && obj !== null\n            && !Array.isArray(obj)\n            && !(obj instanceof RegExp)\n            && !(obj instanceof Date);\n    }\n    exports.isObject = isObject;\n    /**\n     * In **contrast** to just checking `typeof` this will return `false` for `NaN`.\n     * @returns whether the provided parameter is a JavaScript Number or not.\n     */\n    function isNumber(obj) {\n        if ((typeof (obj) === _typeof.number || obj instanceof Number) && !isNaN(obj)) {\n            return true;\n        }\n        return false;\n    }\n    exports.isNumber = isNumber;\n    /**\n     * @returns whether the provided parameter is a JavaScript Boolean or not.\n     */\n    function isBoolean(obj) {\n        return obj === true || obj === false;\n    }\n    exports.isBoolean = isBoolean;\n    /**\n     * @returns whether the provided parameter is undefined.\n     */\n    function isUndefined(obj) {\n        return typeof (obj) === _typeof.undefined;\n    }\n    exports.isUndefined = isUndefined;\n    /**\n     * @returns whether the provided parameter is undefined or null.\n     */\n    function isUndefinedOrNull(obj) {\n        return isUndefined(obj) || obj === null;\n    }\n    exports.isUndefinedOrNull = isUndefinedOrNull;\n    var hasOwnProperty = Object.prototype.hasOwnProperty;\n    /**\n     * @returns whether the provided parameter is an empty JavaScript Object or not.\n     */\n    function isEmptyObject(obj) {\n        if (!isObject(obj)) {\n            return false;\n        }\n        for (var key in obj) {\n            if (hasOwnProperty.call(obj, key)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    exports.isEmptyObject = isEmptyObject;\n    /**\n     * @returns whether the provided parameter is a JavaScript Function or not.\n     */\n    function isFunction(obj) {\n        return typeof obj === _typeof.function;\n    }\n    exports.isFunction = isFunction;\n    /**\n     * @returns whether the provided parameters is are JavaScript Function or not.\n     */\n    function areFunctions() {\n        var objects = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            objects[_i - 0] = arguments[_i];\n        }\n        return objects && objects.length > 0 && objects.every(isFunction);\n    }\n    exports.areFunctions = areFunctions;\n    function validateConstraints(args, constraints) {\n        var len = Math.min(args.length, constraints.length);\n        for (var i = 0; i < len; i++) {\n            validateConstraint(args[i], constraints[i]);\n        }\n    }\n    exports.validateConstraints = validateConstraints;\n    function validateConstraint(arg, constraint) {\n        if (isString(constraint)) {\n            if (typeof arg !== constraint) {\n                throw new Error(\"argument does not match constraint: typeof \" + constraint);\n            }\n        }\n        else if (isFunction(constraint)) {\n            if (arg instanceof constraint) {\n                return;\n            }\n            if (arg && arg.constructor === constraint) {\n                return;\n            }\n            if (constraint.length === 1 && constraint.call(undefined, arg) === true) {\n                return;\n            }\n            throw new Error(\"argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true\");\n        }\n    }\n    exports.validateConstraint = validateConstraint;\n    /**\n     * Creates a new object of the provided class and will call the constructor with\n     * any additional argument supplied.\n     */\n    function create(ctor) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var obj = Object.create(ctor.prototype);\n        ctor.apply(obj, args);\n        return obj;\n    }\n    exports.create = create;\n});\n\ndefine(__m[86], __M([1,0,9,49]), function (require, exports, types_1, collections_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function newNode(data) {\n        return {\n            data: data,\n            incoming: Object.create(null),\n            outgoing: Object.create(null)\n        };\n    }\n    var Graph = (function () {\n        function Graph(_hashFn) {\n            this._hashFn = _hashFn;\n            this._nodes = Object.create(null);\n            // empty\n        }\n        Graph.prototype.roots = function () {\n            var ret = [];\n            collections_1.forEach(this._nodes, function (entry) {\n                if (types_1.isEmptyObject(entry.value.outgoing)) {\n                    ret.push(entry.value);\n                }\n            });\n            return ret;\n        };\n        Graph.prototype.traverse = function (start, inwards, callback) {\n            var startNode = this.lookup(start);\n            if (!startNode) {\n                return;\n            }\n            this._traverse(startNode, inwards, Object.create(null), callback);\n        };\n        Graph.prototype._traverse = function (node, inwards, seen, callback) {\n            var _this = this;\n            var key = this._hashFn(node.data);\n            if (collections_1.contains(seen, key)) {\n                return;\n            }\n            seen[key] = true;\n            callback(node.data);\n            var nodes = inwards ? node.outgoing : node.incoming;\n            collections_1.forEach(nodes, function (entry) { return _this._traverse(entry.value, inwards, seen, callback); });\n        };\n        Graph.prototype.insertEdge = function (from, to) {\n            var fromNode = this.lookupOrInsertNode(from), toNode = this.lookupOrInsertNode(to);\n            fromNode.outgoing[this._hashFn(to)] = toNode;\n            toNode.incoming[this._hashFn(from)] = fromNode;\n        };\n        Graph.prototype.removeNode = function (data) {\n            var key = this._hashFn(data);\n            delete this._nodes[key];\n            collections_1.forEach(this._nodes, function (entry) {\n                delete entry.value.outgoing[key];\n                delete entry.value.incoming[key];\n            });\n        };\n        Graph.prototype.lookupOrInsertNode = function (data) {\n            var key = this._hashFn(data), node = collections_1.lookup(this._nodes, key);\n            if (!node) {\n                node = newNode(data);\n                this._nodes[key] = node;\n            }\n            return node;\n        };\n        Graph.prototype.lookup = function (data) {\n            return collections_1.lookup(this._nodes, this._hashFn(data));\n        };\n        Object.defineProperty(Graph.prototype, \"length\", {\n            get: function () {\n                return Object.keys(this._nodes).length;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Graph.prototype.toString = function () {\n            var data = [];\n            collections_1.forEach(this._nodes, function (entry) {\n                data.push(entry.key + \", (incoming)[\" + Object.keys(entry.value.incoming).join(', ') + \"], (outgoing)[\" + Object.keys(entry.value.outgoing).join(',') + \"]\");\n            });\n            return data.join('\\n');\n        };\n        return Graph;\n    }());\n    exports.Graph = Graph;\n});\n\n\n\n\n\n\ndefine(__m[16], __M([1,0,9]), function (require, exports, types_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.empty = Object.freeze({\n        dispose: function () { }\n    });\n    function dispose() {\n        var disposables = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            disposables[_i - 0] = arguments[_i];\n        }\n        var first = disposables[0];\n        if (types_1.isArray(first)) {\n            disposables = first;\n        }\n        disposables.forEach(function (d) { return d && d.dispose(); });\n        return [];\n    }\n    exports.dispose = dispose;\n    function combinedDisposable(disposables) {\n        return { dispose: function () { return dispose(disposables); } };\n    }\n    exports.combinedDisposable = combinedDisposable;\n    function toDisposable() {\n        var fns = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            fns[_i - 0] = arguments[_i];\n        }\n        return combinedDisposable(fns.map(function (fn) { return ({ dispose: fn }); }));\n    }\n    exports.toDisposable = toDisposable;\n    var Disposable = (function () {\n        function Disposable() {\n            this._toDispose = [];\n        }\n        Disposable.prototype.dispose = function () {\n            this._toDispose = dispose(this._toDispose);\n        };\n        Disposable.prototype._register = function (t) {\n            this._toDispose.push(t);\n            return t;\n        };\n        return Disposable;\n    }());\n    exports.Disposable = Disposable;\n    var Disposables = (function (_super) {\n        __extends(Disposables, _super);\n        function Disposables() {\n            _super.apply(this, arguments);\n        }\n        Disposables.prototype.add = function (arg) {\n            if (!Array.isArray(arg)) {\n                return this._register(arg);\n            }\n            else {\n                for (var _i = 0, arg_1 = arg; _i < arg_1.length; _i++) {\n                    var element = arg_1[_i];\n                    return this._register(element);\n                }\n            }\n        };\n        return Disposables;\n    }(Disposable));\n    exports.Disposables = Disposables;\n});\n\ndefine(__m[46], __M([1,0,13,9,3,55]), function (require, exports, paths, types, strings, glob_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.MIME_TEXT = 'text/plain';\n    exports.MIME_BINARY = 'application/octet-stream';\n    exports.MIME_UNKNOWN = 'application/unknown';\n    var registeredAssociations = [];\n    /**\n     * Associate a text mime to the registry.\n     */\n    function registerTextMime(association) {\n        // Register\n        registeredAssociations.push(association);\n        // Check for conflicts unless this is a user configured association\n        if (!association.userConfigured) {\n            registeredAssociations.forEach(function (a) {\n                if (a.mime === association.mime || a.userConfigured) {\n                    return; // same mime or userConfigured is ok\n                }\n                if (association.extension && a.extension === association.extension) {\n                    console.warn(\"Overwriting extension <<\" + association.extension + \">> to now point to mime <<\" + association.mime + \">>\");\n                }\n                if (association.filename && a.filename === association.filename) {\n                    console.warn(\"Overwriting filename <<\" + association.filename + \">> to now point to mime <<\" + association.mime + \">>\");\n                }\n                if (association.filepattern && a.filepattern === association.filepattern) {\n                    console.warn(\"Overwriting filepattern <<\" + association.filepattern + \">> to now point to mime <<\" + association.mime + \">>\");\n                }\n                if (association.firstline && a.firstline === association.firstline) {\n                    console.warn(\"Overwriting firstline <<\" + association.firstline + \">> to now point to mime <<\" + association.mime + \">>\");\n                }\n            });\n        }\n    }\n    exports.registerTextMime = registerTextMime;\n    /**\n     * Clear text mimes from the registry.\n     */\n    function clearTextMimes(onlyUserConfigured) {\n        if (!onlyUserConfigured) {\n            registeredAssociations = [];\n        }\n        else {\n            registeredAssociations = registeredAssociations.filter(function (a) { return !a.userConfigured; });\n        }\n    }\n    exports.clearTextMimes = clearTextMimes;\n    /**\n     * Given a file, return the best matching mime type for it\n     */\n    function guessMimeTypes(path, firstLine) {\n        if (!path) {\n            return [exports.MIME_UNKNOWN];\n        }\n        path = path.toLowerCase();\n        // 1.) User configured mappings have highest priority\n        var configuredMime = guessMimeTypeByPath(path, registeredAssociations.filter(function (a) { return a.userConfigured; }));\n        if (configuredMime) {\n            return [configuredMime, exports.MIME_TEXT];\n        }\n        // 2.) Registered mappings have middle priority\n        var registeredMime = guessMimeTypeByPath(path, registeredAssociations.filter(function (a) { return !a.userConfigured; }));\n        if (registeredMime) {\n            return [registeredMime, exports.MIME_TEXT];\n        }\n        // 3.) Firstline has lowest priority\n        if (firstLine) {\n            var firstlineMime = guessMimeTypeByFirstline(firstLine);\n            if (firstlineMime) {\n                return [firstlineMime, exports.MIME_TEXT];\n            }\n        }\n        return [exports.MIME_UNKNOWN];\n    }\n    exports.guessMimeTypes = guessMimeTypes;\n    function guessMimeTypeByPath(path, associations) {\n        var filename = paths.basename(path);\n        var filenameMatch;\n        var patternMatch;\n        var extensionMatch;\n        for (var i = 0; i < associations.length; i++) {\n            var association = associations[i];\n            // First exact name match\n            if (association.filename && filename === association.filename.toLowerCase()) {\n                filenameMatch = association;\n                break; // take it!\n            }\n            // Longest pattern match\n            if (association.filepattern) {\n                var target = association.filepattern.indexOf(paths.sep) >= 0 ? path : filename; // match on full path if pattern contains path separator\n                if (glob_1.match(association.filepattern.toLowerCase(), target)) {\n                    if (!patternMatch || association.filepattern.length > patternMatch.filepattern.length) {\n                        patternMatch = association;\n                    }\n                }\n            }\n            // Longest extension match\n            if (association.extension) {\n                if (strings.endsWith(filename, association.extension.toLowerCase())) {\n                    if (!extensionMatch || association.extension.length > extensionMatch.extension.length) {\n                        extensionMatch = association;\n                    }\n                }\n            }\n        }\n        // 1.) Exact name match has second highest prio\n        if (filenameMatch) {\n            return filenameMatch.mime;\n        }\n        // 2.) Match on pattern\n        if (patternMatch) {\n            return patternMatch.mime;\n        }\n        // 3.) Match on extension comes next\n        if (extensionMatch) {\n            return extensionMatch.mime;\n        }\n        return null;\n    }\n    function guessMimeTypeByFirstline(firstLine) {\n        if (strings.startsWithUTF8BOM(firstLine)) {\n            firstLine = firstLine.substr(1);\n        }\n        if (firstLine.length > 0) {\n            for (var i = 0; i < registeredAssociations.length; ++i) {\n                var association = registeredAssociations[i];\n                if (!association.firstline) {\n                    continue;\n                }\n                // Make sure the entire line matches, not just a subpart.\n                var matches = firstLine.match(association.firstline);\n                if (matches && matches.length > 0 && matches[0].length === firstLine.length) {\n                    return association.mime;\n                }\n            }\n        }\n        return null;\n    }\n    function isBinaryMime(mimes) {\n        if (!mimes) {\n            return false;\n        }\n        var mimeVals;\n        if (types.isArray(mimes)) {\n            mimeVals = mimes;\n        }\n        else {\n            mimeVals = mimes.split(',').map(function (mime) { return mime.trim(); });\n        }\n        return mimeVals.indexOf(exports.MIME_BINARY) >= 0;\n    }\n    exports.isBinaryMime = isBinaryMime;\n    function isUnspecific(mime) {\n        if (!mime) {\n            return true;\n        }\n        if (typeof mime === 'string') {\n            return mime === exports.MIME_BINARY || mime === exports.MIME_TEXT || mime === exports.MIME_UNKNOWN;\n        }\n        return mime.length === 1 && isUnspecific(mime[0]);\n    }\n    exports.isUnspecific = isUnspecific;\n    function suggestFilename(theMime, prefix) {\n        for (var i = 0; i < registeredAssociations.length; i++) {\n            var association = registeredAssociations[i];\n            if (association.userConfigured) {\n                continue; // only support registered ones\n            }\n            if (association.mime === theMime && association.extension) {\n                return prefix + association.extension;\n            }\n        }\n        return null;\n    }\n    exports.suggestFilename = suggestFilename;\n});\n\ndefine(__m[12], __M([1,0,9]), function (require, exports, Types) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function clone(obj) {\n        if (!obj || typeof obj !== 'object') {\n            return obj;\n        }\n        if (obj instanceof RegExp) {\n            return obj;\n        }\n        var result = (Array.isArray(obj)) ? [] : {};\n        Object.keys(obj).forEach(function (key) {\n            if (obj[key] && typeof obj[key] === 'object') {\n                result[key] = clone(obj[key]);\n            }\n            else {\n                result[key] = obj[key];\n            }\n        });\n        return result;\n    }\n    exports.clone = clone;\n    function deepClone(obj) {\n        if (!obj || typeof obj !== 'object') {\n            return obj;\n        }\n        var result = (Array.isArray(obj)) ? [] : {};\n        Object.getOwnPropertyNames(obj).forEach(function (key) {\n            if (obj[key] && typeof obj[key] === 'object') {\n                result[key] = deepClone(obj[key]);\n            }\n            else {\n                result[key] = obj[key];\n            }\n        });\n        return result;\n    }\n    exports.deepClone = deepClone;\n    var hasOwnProperty = Object.prototype.hasOwnProperty;\n    function cloneAndChange(obj, changer) {\n        return _cloneAndChange(obj, changer, []);\n    }\n    exports.cloneAndChange = cloneAndChange;\n    function _cloneAndChange(obj, changer, encounteredObjects) {\n        if (Types.isUndefinedOrNull(obj)) {\n            return obj;\n        }\n        var changed = changer(obj);\n        if (typeof changed !== 'undefined') {\n            return changed;\n        }\n        if (Types.isArray(obj)) {\n            var r1 = [];\n            for (var i1 = 0; i1 < obj.length; i1++) {\n                r1.push(_cloneAndChange(obj[i1], changer, encounteredObjects));\n            }\n            return r1;\n        }\n        if (Types.isObject(obj)) {\n            if (encounteredObjects.indexOf(obj) >= 0) {\n                throw new Error('Cannot clone recursive data-structure');\n            }\n            encounteredObjects.push(obj);\n            var r2 = {};\n            for (var i2 in obj) {\n                if (hasOwnProperty.call(obj, i2)) {\n                    r2[i2] = _cloneAndChange(obj[i2], changer, encounteredObjects);\n                }\n            }\n            encounteredObjects.pop();\n            return r2;\n        }\n        return obj;\n    }\n    // DON'T USE THESE FUNCTION UNLESS YOU KNOW HOW CHROME\n    // WORKS... WE HAVE SEEN VERY WEIRD BEHAVIOUR WITH CHROME >= 37\n    ///**\n    // * Recursively call Object.freeze on object and any properties that are objects.\n    // */\n    //export function deepFreeze(obj:any):void {\n    //\tObject.freeze(obj);\n    //\tObject.keys(obj).forEach((key) => {\n    //\t\tif(!(typeof obj[key] === 'object') || Object.isFrozen(obj[key])) {\n    //\t\t\treturn;\n    //\t\t}\n    //\n    //\t\tdeepFreeze(obj[key]);\n    //\t});\n    //\tif(!Object.isFrozen(obj)) {\n    //\t\tconsole.log('too warm');\n    //\t}\n    //}\n    //\n    //export function deepSeal(obj:any):void {\n    //\tObject.seal(obj);\n    //\tObject.keys(obj).forEach((key) => {\n    //\t\tif(!(typeof obj[key] === 'object') || Object.isSealed(obj[key])) {\n    //\t\t\treturn;\n    //\t\t}\n    //\n    //\t\tdeepSeal(obj[key]);\n    //\t});\n    //\tif(!Object.isSealed(obj)) {\n    //\t\tconsole.log('NOT sealed');\n    //\t}\n    //}\n    /**\n     * Copies all properties of source into destination. The optional parameter \"overwrite\" allows to control\n     * if existing properties on the destination should be overwritten or not. Defaults to true (overwrite).\n     */\n    function mixin(destination, source, overwrite) {\n        if (overwrite === void 0) { overwrite = true; }\n        if (!Types.isObject(destination)) {\n            return source;\n        }\n        if (Types.isObject(source)) {\n            Object.keys(source).forEach(function (key) {\n                if (key in destination) {\n                    if (overwrite) {\n                        if (Types.isObject(destination[key]) && Types.isObject(source[key])) {\n                            mixin(destination[key], source[key], overwrite);\n                        }\n                        else {\n                            destination[key] = source[key];\n                        }\n                    }\n                }\n                else {\n                    destination[key] = source[key];\n                }\n            });\n        }\n        return destination;\n    }\n    exports.mixin = mixin;\n    function assign(destination) {\n        var sources = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            sources[_i - 1] = arguments[_i];\n        }\n        sources.forEach(function (source) { return Object.keys(source).forEach(function (key) { return destination[key] = source[key]; }); });\n        return destination;\n    }\n    exports.assign = assign;\n    function toObject(arr, keyMap, valueMap) {\n        if (valueMap === void 0) { valueMap = function (x) { return x; }; }\n        return arr.reduce(function (o, d) { return assign(o, (_a = {}, _a[keyMap(d)] = valueMap(d), _a)); var _a; }, Object.create(null));\n    }\n    exports.toObject = toObject;\n    function equals(one, other) {\n        if (one === other) {\n            return true;\n        }\n        if (one === null || one === undefined || other === null || other === undefined) {\n            return false;\n        }\n        if (typeof one !== typeof other) {\n            return false;\n        }\n        if (typeof one !== 'object') {\n            return false;\n        }\n        if ((Array.isArray(one)) !== (Array.isArray(other))) {\n            return false;\n        }\n        var i, key;\n        if (Array.isArray(one)) {\n            if (one.length !== other.length) {\n                return false;\n            }\n            for (i = 0; i < one.length; i++) {\n                if (!equals(one[i], other[i])) {\n                    return false;\n                }\n            }\n        }\n        else {\n            var oneKeys = [];\n            for (key in one) {\n                oneKeys.push(key);\n            }\n            oneKeys.sort();\n            var otherKeys = [];\n            for (key in other) {\n                otherKeys.push(key);\n            }\n            otherKeys.sort();\n            if (!equals(oneKeys, otherKeys)) {\n                return false;\n            }\n            for (i = 0; i < oneKeys.length; i++) {\n                if (!equals(one[oneKeys[i]], other[oneKeys[i]])) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    exports.equals = equals;\n    function ensureProperty(obj, property, defaultValue) {\n        if (typeof obj[property] === 'undefined') {\n            obj[property] = defaultValue;\n        }\n    }\n    exports.ensureProperty = ensureProperty;\n    function arrayToHash(array) {\n        var result = {};\n        for (var i = 0; i < array.length; ++i) {\n            result[array[i]] = true;\n        }\n        return result;\n    }\n    exports.arrayToHash = arrayToHash;\n    /**\n     * Given an array of strings, returns a function which, given a string\n     * returns true or false whether the string is in that array.\n     */\n    function createKeywordMatcher(arr, caseInsensitive) {\n        if (caseInsensitive === void 0) { caseInsensitive = false; }\n        if (caseInsensitive) {\n            arr = arr.map(function (x) { return x.toLowerCase(); });\n        }\n        var hash = arrayToHash(arr);\n        if (caseInsensitive) {\n            return function (word) {\n                return hash[word.toLowerCase()] !== undefined && hash.hasOwnProperty(word.toLowerCase());\n            };\n        }\n        else {\n            return function (word) {\n                return hash[word] !== undefined && hash.hasOwnProperty(word);\n            };\n        }\n    }\n    exports.createKeywordMatcher = createKeywordMatcher;\n    /**\n     * Started from TypeScript's __extends function to make a type a subclass of a specific class.\n     * Modified to work with properties already defined on the derivedClass, since we can't get TS\n     * to call this method before the constructor definition.\n     */\n    function derive(baseClass, derivedClass) {\n        for (var prop in baseClass) {\n            if (baseClass.hasOwnProperty(prop)) {\n                derivedClass[prop] = baseClass[prop];\n            }\n        }\n        derivedClass = derivedClass || function () { };\n        var basePrototype = baseClass.prototype;\n        var derivedPrototype = derivedClass.prototype;\n        derivedClass.prototype = Object.create(basePrototype);\n        for (var prop in derivedPrototype) {\n            if (derivedPrototype.hasOwnProperty(prop)) {\n                // handle getters and setters properly\n                Object.defineProperty(derivedClass.prototype, prop, Object.getOwnPropertyDescriptor(derivedPrototype, prop));\n            }\n        }\n        // Cast to any due to Bug 16188:PropertyDescriptor set and get function should be optional.\n        Object.defineProperty(derivedClass.prototype, 'constructor', { value: derivedClass, writable: true, configurable: true, enumerable: true });\n    }\n    exports.derive = derive;\n    /**\n     * Calls JSON.Stringify with a replacer to break apart any circular references.\n     * This prevents JSON.stringify from throwing the exception\n     *  \"Uncaught TypeError: Converting circular structure to JSON\"\n     */\n    function safeStringify(obj) {\n        var seen = [];\n        return JSON.stringify(obj, function (key, value) {\n            if (Types.isObject(value) || Array.isArray(value)) {\n                if (seen.indexOf(value) !== -1) {\n                    return '[Circular]';\n                }\n                else {\n                    seen.push(value);\n                }\n            }\n            return value;\n        });\n    }\n    exports.safeStringify = safeStringify;\n    function getOrDefault(obj, fn, defaultValue) {\n        if (defaultValue === void 0) { defaultValue = null; }\n        var result = fn(obj);\n        return typeof result === 'undefined' ? defaultValue : result;\n    }\n    exports.getOrDefault = getOrDefault;\n});\n\ndefine(__m[20], __M([1,0,10]), function (require, exports, platform) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function _encode(ch) {\n        return '%' + ch.charCodeAt(0).toString(16).toUpperCase();\n    }\n    // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\n    function encodeURIComponent2(str) {\n        return encodeURIComponent(str).replace(/[!'()*]/g, _encode);\n    }\n    function encodeNoop(str) {\n        return str;\n    }\n    /**\n     * Uniform Resource Identifier (URI) http://tools.ietf.org/html/rfc3986.\n     * This class is a simple parser which creates the basic component paths\n     * (http://tools.ietf.org/html/rfc3986#section-3) with minimal validation\n     * and encoding.\n     *\n     *       foo://example.com:8042/over/there?name=ferret#nose\n     *       \\_/   \\______________/\\_________/ \\_________/ \\__/\n     *        |           |            |            |        |\n     *     scheme     authority       path        query   fragment\n     *        |   _____________________|__\n     *       / \\ /                        \\\n     *       urn:example:animal:ferret:nose\n     *\n     *\n     */\n    var URI = (function () {\n        function URI() {\n            this._scheme = URI._empty;\n            this._authority = URI._empty;\n            this._path = URI._empty;\n            this._query = URI._empty;\n            this._fragment = URI._empty;\n            this._formatted = null;\n            this._fsPath = null;\n        }\n        Object.defineProperty(URI.prototype, \"scheme\", {\n            /**\n             * scheme is the 'http' part of 'http://www.msft.com/some/path?query#fragment'.\n             * The part before the first colon.\n             */\n            get: function () {\n                return this._scheme;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(URI.prototype, \"authority\", {\n            /**\n             * authority is the 'www.msft.com' part of 'http://www.msft.com/some/path?query#fragment'.\n             * The part between the first double slashes and the next slash.\n             */\n            get: function () {\n                return this._authority;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(URI.prototype, \"path\", {\n            /**\n             * path is the '/some/path' part of 'http://www.msft.com/some/path?query#fragment'.\n             */\n            get: function () {\n                return this._path;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(URI.prototype, \"query\", {\n            /**\n             * query is the 'query' part of 'http://www.msft.com/some/path?query#fragment'.\n             */\n            get: function () {\n                return this._query;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(URI.prototype, \"fragment\", {\n            /**\n             * fragment is the 'fragment' part of 'http://www.msft.com/some/path?query#fragment'.\n             */\n            get: function () {\n                return this._fragment;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(URI.prototype, \"fsPath\", {\n            // ---- filesystem path -----------------------\n            /**\n             * Returns a string representing the corresponding file system path of this URI.\n             * Will handle UNC paths and normalize windows drive letters to lower-case. Also\n             * uses the platform specific path separator. Will *not* validate the path for\n             * invalid characters and semantics. Will *not* look at the scheme of this URI.\n             */\n            get: function () {\n                if (!this._fsPath) {\n                    var value;\n                    if (this._authority && this.scheme === 'file') {\n                        // unc path: file://shares/c$/far/boo\n                        value = \"//\" + this._authority + this._path;\n                    }\n                    else if (URI._driveLetterPath.test(this._path)) {\n                        // windows drive letter: file:///c:/far/boo\n                        value = this._path[1].toLowerCase() + this._path.substr(2);\n                    }\n                    else {\n                        // other path\n                        value = this._path;\n                    }\n                    if (platform.isWindows) {\n                        value = value.replace(/\\//g, '\\\\');\n                    }\n                    this._fsPath = value;\n                }\n                return this._fsPath;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        // ---- modify to new -------------------------\n        URI.prototype.with = function (change) {\n            if (!change) {\n                return this;\n            }\n            var scheme = change.scheme || this.scheme;\n            var authority = change.authority || this.authority;\n            var path = change.path || this.path;\n            var query = change.query || this.query;\n            var fragment = change.fragment || this.fragment;\n            if (scheme === this.scheme\n                && authority === this.authority\n                && path === this.path\n                && query === this.query\n                && fragment === this.fragment) {\n                return this;\n            }\n            var ret = new URI();\n            ret._scheme = scheme;\n            ret._authority = authority;\n            ret._path = path;\n            ret._query = query;\n            ret._fragment = fragment;\n            URI._validate(ret);\n            return ret;\n        };\n        // ---- parse & validate ------------------------\n        URI.parse = function (value) {\n            var ret = new URI();\n            var data = URI._parseComponents(value);\n            ret._scheme = data.scheme;\n            ret._authority = decodeURIComponent(data.authority);\n            ret._path = decodeURIComponent(data.path);\n            ret._query = decodeURIComponent(data.query);\n            ret._fragment = decodeURIComponent(data.fragment);\n            URI._validate(ret);\n            return ret;\n        };\n        URI.file = function (path) {\n            var ret = new URI();\n            ret._scheme = 'file';\n            // normalize to fwd-slashes\n            path = path.replace(/\\\\/g, URI._slash);\n            // check for authority as used in UNC shares\n            // or use the path as given\n            if (path[0] === URI._slash && path[0] === path[1]) {\n                var idx = path.indexOf(URI._slash, 2);\n                if (idx === -1) {\n                    ret._authority = path.substring(2);\n                }\n                else {\n                    ret._authority = path.substring(2, idx);\n                    ret._path = path.substring(idx);\n                }\n            }\n            else {\n                ret._path = path;\n            }\n            // Ensure that path starts with a slash\n            // or that it is at least a slash\n            if (ret._path[0] !== URI._slash) {\n                ret._path = URI._slash + ret._path;\n            }\n            URI._validate(ret);\n            return ret;\n        };\n        URI._parseComponents = function (value) {\n            var ret = {\n                scheme: URI._empty,\n                authority: URI._empty,\n                path: URI._empty,\n                query: URI._empty,\n                fragment: URI._empty,\n            };\n            var match = URI._regexp.exec(value);\n            if (match) {\n                ret.scheme = match[2] || ret.scheme;\n                ret.authority = match[4] || ret.authority;\n                ret.path = match[5] || ret.path;\n                ret.query = match[7] || ret.query;\n                ret.fragment = match[9] || ret.fragment;\n            }\n            return ret;\n        };\n        URI.from = function (components) {\n            return new URI().with(components);\n        };\n        URI._validate = function (ret) {\n            // validation\n            // path, http://tools.ietf.org/html/rfc3986#section-3.3\n            // If a URI contains an authority component, then the path component\n            // must either be empty or begin with a slash (\"/\") character.  If a URI\n            // does not contain an authority component, then the path cannot begin\n            // with two slash characters (\"//\").\n            if (ret.authority && ret.path && ret.path[0] !== '/') {\n                throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash (\"/\") character');\n            }\n            if (!ret.authority && ret.path.indexOf('//') === 0) {\n                throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters (\"//\")');\n            }\n        };\n        // ---- printing/externalize ---------------------------\n        /**\n         *\n         * @param skipEncoding Do not encode the result, default is `false`\n         */\n        URI.prototype.toString = function (skipEncoding) {\n            if (skipEncoding === void 0) { skipEncoding = false; }\n            if (!skipEncoding) {\n                if (!this._formatted) {\n                    this._formatted = URI._asFormatted(this, false);\n                }\n                return this._formatted;\n            }\n            else {\n                // we don't cache that\n                return URI._asFormatted(this, true);\n            }\n        };\n        URI._asFormatted = function (uri, skipEncoding) {\n            var encoder = !skipEncoding\n                ? encodeURIComponent2\n                : encodeNoop;\n            var parts = [];\n            var scheme = uri.scheme, authority = uri.authority, path = uri.path, query = uri.query, fragment = uri.fragment;\n            if (scheme) {\n                parts.push(scheme, ':');\n            }\n            if (authority || scheme === 'file') {\n                parts.push('//');\n            }\n            if (authority) {\n                authority = authority.toLowerCase();\n                var idx = authority.indexOf(':');\n                if (idx === -1) {\n                    parts.push(encoder(authority));\n                }\n                else {\n                    parts.push(encoder(authority.substr(0, idx)), authority.substr(idx));\n                }\n            }\n            if (path) {\n                // lower-case windown drive letters in /C:/fff\n                var m = URI._upperCaseDrive.exec(path);\n                if (m) {\n                    path = m[1] + m[2].toLowerCase() + path.substr(m[1].length + m[2].length);\n                }\n                // encode every segement but not slashes\n                // make sure that # and ? are always encoded\n                // when occurring in paths - otherwise the result\n                // cannot be parsed back again\n                var lastIdx = 0;\n                while (true) {\n                    var idx = path.indexOf(URI._slash, lastIdx);\n                    if (idx === -1) {\n                        parts.push(encoder(path.substring(lastIdx)).replace(/[#?]/, _encode));\n                        break;\n                    }\n                    parts.push(encoder(path.substring(lastIdx, idx)).replace(/[#?]/, _encode), URI._slash);\n                    lastIdx = idx + 1;\n                }\n                ;\n            }\n            if (query) {\n                parts.push('?', encoder(query));\n            }\n            if (fragment) {\n                parts.push('#', encoder(fragment));\n            }\n            return parts.join(URI._empty);\n        };\n        URI.prototype.toJSON = function () {\n            return {\n                scheme: this.scheme,\n                authority: this.authority,\n                path: this.path,\n                fsPath: this.fsPath,\n                query: this.query,\n                fragment: this.fragment,\n                external: this.toString(),\n                $mid: 1\n            };\n        };\n        URI.revive = function (data) {\n            var result = new URI();\n            result._scheme = data.scheme;\n            result._authority = data.authority;\n            result._path = data.path;\n            result._query = data.query;\n            result._fragment = data.fragment;\n            result._fsPath = data.fsPath;\n            result._formatted = data.external;\n            URI._validate(result);\n            return result;\n        };\n        URI._empty = '';\n        URI._slash = '/';\n        URI._regexp = /^(([^:/?#]+?):)?(\\/\\/([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?/;\n        URI._driveLetterPath = /^\\/[a-zA-z]:/;\n        URI._upperCaseDrive = /^(\\/)?([A-Z]:)/;\n        return URI;\n    }());\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = URI;\n});\n\ndefine(__m[89], __M([1,0,20]), function (require, exports, uri_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function stringify(obj) {\n        return JSON.stringify(obj, replacer);\n    }\n    exports.stringify = stringify;\n    function parse(text) {\n        return JSON.parse(text, reviver);\n    }\n    exports.parse = parse;\n    function replacer(key, value) {\n        // URI is done via toJSON-member\n        if (value instanceof RegExp) {\n            return {\n                $mid: 2,\n                source: value.source,\n                flags: (value.global ? 'g' : '') + (value.ignoreCase ? 'i' : '') + (value.multiline ? 'm' : ''),\n            };\n        }\n        return value;\n    }\n    function reviver(key, value) {\n        var marshallingConst;\n        if (value !== void 0 && value !== null) {\n            marshallingConst = value.$mid;\n        }\n        if (marshallingConst === 1) {\n            return uri_1.default.revive(value);\n        }\n        else if (marshallingConst === 2) {\n            return new RegExp(value.source, value.flags);\n        }\n        else {\n            return value;\n        }\n    }\n});\n\n/**\n * Extracted from https://github.com/winjs/winjs\n * Version: 4.4.0(ec3258a9f3a36805a187848984e3bb938044178d)\n * Copyright (c) Microsoft Corporation.\n * All Rights Reserved.\n * Licensed under the MIT License.\n */\n(function() {\n\nvar _modules = {};\n_modules[\"WinJS/Core/_WinJS\"] = {};\n\nvar _winjs = function(moduleId, deps, factory) {\n    var exports = {};\n    var exportsPassedIn = false;\n\n    var depsValues = deps.map(function(dep) {\n        if (dep === 'exports') {\n            exportsPassedIn = true;\n            return exports;\n        }\n        return _modules[dep];\n    });\n\n    var result = factory.apply({}, depsValues);\n\n    _modules[moduleId] = exportsPassedIn ? exports : result;\n};\n\n\n_winjs(\"WinJS/Core/_Global\", [], function () {\n    \"use strict\";\n\n    // Appease jshint\n    /* global window, self, global */\n\n    var globalObject =\n        typeof window !== 'undefined' ? window :\n        typeof self !== 'undefined' ? self :\n        typeof global !== 'undefined' ? global :\n        {};\n    return globalObject;\n});\n\n_winjs(\"WinJS/Core/_BaseCoreUtils\", [\"WinJS/Core/_Global\"], function baseCoreUtilsInit(_Global) {\n    \"use strict\";\n\n    var hasWinRT = !!_Global.Windows;\n\n    function markSupportedForProcessing(func) {\n        /// <signature helpKeyword=\"WinJS.Utilities.markSupportedForProcessing\">\n        /// <summary locid=\"WinJS.Utilities.markSupportedForProcessing\">\n        /// Marks a function as being compatible with declarative processing, such as WinJS.UI.processAll\n        /// or WinJS.Binding.processAll.\n        /// </summary>\n        /// <param name=\"func\" type=\"Function\" locid=\"WinJS.Utilities.markSupportedForProcessing_p:func\">\n        /// The function to be marked as compatible with declarative processing.\n        /// </param>\n        /// <returns type=\"Function\" locid=\"WinJS.Utilities.markSupportedForProcessing_returnValue\">\n        /// The input function.\n        /// </returns>\n        /// </signature>\n        func.supportedForProcessing = true;\n        return func;\n    }\n\n    return {\n        hasWinRT: hasWinRT,\n        markSupportedForProcessing: markSupportedForProcessing,\n        _setImmediate: _Global.setImmediate ? _Global.setImmediate.bind(_Global) : function (handler) {\n            _Global.setTimeout(handler, 0);\n        }\n    };\n});\n_winjs(\"WinJS/Core/_WriteProfilerMark\", [\"WinJS/Core/_Global\"], function profilerInit(_Global) {\n    \"use strict\";\n\n    return _Global.msWriteProfilerMark || function () { };\n});\n_winjs(\"WinJS/Core/_Base\", [\"WinJS/Core/_WinJS\",\"WinJS/Core/_Global\",\"WinJS/Core/_BaseCoreUtils\",\"WinJS/Core/_WriteProfilerMark\"], function baseInit(_WinJS, _Global, _BaseCoreUtils, _WriteProfilerMark) {\n    \"use strict\";\n\n    function initializeProperties(target, members, prefix) {\n        var keys = Object.keys(members);\n        var isArray = Array.isArray(target);\n        var properties;\n        var i, len;\n        for (i = 0, len = keys.length; i < len; i++) {\n            var key = keys[i];\n            var enumerable = key.charCodeAt(0) !== /*_*/95;\n            var member = members[key];\n            if (member && typeof member === 'object') {\n                if (member.value !== undefined || typeof member.get === 'function' || typeof member.set === 'function') {\n                    if (member.enumerable === undefined) {\n                        member.enumerable = enumerable;\n                    }\n                    if (prefix && member.setName && typeof member.setName === 'function') {\n                        member.setName(prefix + \".\" + key);\n                    }\n                    properties = properties || {};\n                    properties[key] = member;\n                    continue;\n                }\n            }\n            if (!enumerable) {\n                properties = properties || {};\n                properties[key] = { value: member, enumerable: enumerable, configurable: true, writable: true };\n                continue;\n            }\n            if (isArray) {\n                target.forEach(function (target) {\n                    target[key] = member;\n                });\n            } else {\n                target[key] = member;\n            }\n        }\n        if (properties) {\n            if (isArray) {\n                target.forEach(function (target) {\n                    Object.defineProperties(target, properties);\n                });\n            } else {\n                Object.defineProperties(target, properties);\n            }\n        }\n    }\n\n    (function () {\n\n        var _rootNamespace = _WinJS;\n        if (!_rootNamespace.Namespace) {\n            _rootNamespace.Namespace = Object.create(Object.prototype);\n        }\n\n        function createNamespace(parentNamespace, name) {\n            var currentNamespace = parentNamespace || {};\n            if (name) {\n                var namespaceFragments = name.split(\".\");\n                if (currentNamespace === _Global && namespaceFragments[0] === \"WinJS\") {\n                    currentNamespace = _WinJS;\n                    namespaceFragments.splice(0, 1);\n                }\n                for (var i = 0, len = namespaceFragments.length; i < len; i++) {\n                    var namespaceName = namespaceFragments[i];\n                    if (!currentNamespace[namespaceName]) {\n                        Object.defineProperty(currentNamespace, namespaceName,\n                            { value: {}, writable: false, enumerable: true, configurable: true }\n                        );\n                    }\n                    currentNamespace = currentNamespace[namespaceName];\n                }\n            }\n            return currentNamespace;\n        }\n\n        function defineWithParent(parentNamespace, name, members) {\n            /// <signature helpKeyword=\"WinJS.Namespace.defineWithParent\">\n            /// <summary locid=\"WinJS.Namespace.defineWithParent\">\n            /// Defines a new namespace with the specified name under the specified parent namespace.\n            /// </summary>\n            /// <param name=\"parentNamespace\" type=\"Object\" locid=\"WinJS.Namespace.defineWithParent_p:parentNamespace\">\n            /// The parent namespace.\n            /// </param>\n            /// <param name=\"name\" type=\"String\" locid=\"WinJS.Namespace.defineWithParent_p:name\">\n            /// The name of the new namespace.\n            /// </param>\n            /// <param name=\"members\" type=\"Object\" locid=\"WinJS.Namespace.defineWithParent_p:members\">\n            /// The members of the new namespace.\n            /// </param>\n            /// <returns type=\"Object\" locid=\"WinJS.Namespace.defineWithParent_returnValue\">\n            /// The newly-defined namespace.\n            /// </returns>\n            /// </signature>\n            var currentNamespace = createNamespace(parentNamespace, name);\n\n            if (members) {\n                initializeProperties(currentNamespace, members, name || \"<ANONYMOUS>\");\n            }\n\n            return currentNamespace;\n        }\n\n        function define(name, members) {\n            /// <signature helpKeyword=\"WinJS.Namespace.define\">\n            /// <summary locid=\"WinJS.Namespace.define\">\n            /// Defines a new namespace with the specified name.\n            /// </summary>\n            /// <param name=\"name\" type=\"String\" locid=\"WinJS.Namespace.define_p:name\">\n            /// The name of the namespace. This could be a dot-separated name for nested namespaces.\n            /// </param>\n            /// <param name=\"members\" type=\"Object\" locid=\"WinJS.Namespace.define_p:members\">\n            /// The members of the new namespace.\n            /// </param>\n            /// <returns type=\"Object\" locid=\"WinJS.Namespace.define_returnValue\">\n            /// The newly-defined namespace.\n            /// </returns>\n            /// </signature>\n            return defineWithParent(_Global, name, members);\n        }\n\n        var LazyStates = {\n            uninitialized: 1,\n            working: 2,\n            initialized: 3,\n        };\n\n        function lazy(f) {\n            var name;\n            var state = LazyStates.uninitialized;\n            var result;\n            return {\n                setName: function (value) {\n                    name = value;\n                },\n                get: function () {\n                    switch (state) {\n                        case LazyStates.initialized:\n                            return result;\n\n                        case LazyStates.uninitialized:\n                            state = LazyStates.working;\n                            try {\n                                _WriteProfilerMark(\"WinJS.Namespace._lazy:\" + name + \",StartTM\");\n                                result = f();\n                            } finally {\n                                _WriteProfilerMark(\"WinJS.Namespace._lazy:\" + name + \",StopTM\");\n                                state = LazyStates.uninitialized;\n                            }\n                            f = null;\n                            state = LazyStates.initialized;\n                            return result;\n\n                        case LazyStates.working:\n                            throw \"Illegal: reentrancy on initialization\";\n\n                        default:\n                            throw \"Illegal\";\n                    }\n                },\n                set: function (value) {\n                    switch (state) {\n                        case LazyStates.working:\n                            throw \"Illegal: reentrancy on initialization\";\n\n                        default:\n                            state = LazyStates.initialized;\n                            result = value;\n                            break;\n                    }\n                },\n                enumerable: true,\n                configurable: true,\n            };\n        }\n\n        // helper for defining AMD module members\n        function moduleDefine(exports, name, members) {\n            var target = [exports];\n            var publicNS = null;\n            if (name) {\n                publicNS = createNamespace(_Global, name);\n                target.push(publicNS);\n            }\n            initializeProperties(target, members, name || \"<ANONYMOUS>\");\n            return publicNS;\n        }\n\n        // Establish members of the \"WinJS.Namespace\" namespace\n        Object.defineProperties(_rootNamespace.Namespace, {\n\n            defineWithParent: { value: defineWithParent, writable: true, enumerable: true, configurable: true },\n\n            define: { value: define, writable: true, enumerable: true, configurable: true },\n\n            _lazy: { value: lazy, writable: true, enumerable: true, configurable: true },\n\n            _moduleDefine: { value: moduleDefine, writable: true, enumerable: true, configurable: true }\n\n        });\n\n    })();\n\n    (function () {\n\n        function define(constructor, instanceMembers, staticMembers) {\n            /// <signature helpKeyword=\"WinJS.Class.define\">\n            /// <summary locid=\"WinJS.Class.define\">\n            /// Defines a class using the given constructor and the specified instance members.\n            /// </summary>\n            /// <param name=\"constructor\" type=\"Function\" locid=\"WinJS.Class.define_p:constructor\">\n            /// A constructor function that is used to instantiate this class.\n            /// </param>\n            /// <param name=\"instanceMembers\" type=\"Object\" locid=\"WinJS.Class.define_p:instanceMembers\">\n            /// The set of instance fields, properties, and methods made available on the class.\n            /// </param>\n            /// <param name=\"staticMembers\" type=\"Object\" locid=\"WinJS.Class.define_p:staticMembers\">\n            /// The set of static fields, properties, and methods made available on the class.\n            /// </param>\n            /// <returns type=\"Function\" locid=\"WinJS.Class.define_returnValue\">\n            /// The newly-defined class.\n            /// </returns>\n            /// </signature>\n            constructor = constructor || function () { };\n            _BaseCoreUtils.markSupportedForProcessing(constructor);\n            if (instanceMembers) {\n                initializeProperties(constructor.prototype, instanceMembers);\n            }\n            if (staticMembers) {\n                initializeProperties(constructor, staticMembers);\n            }\n            return constructor;\n        }\n\n        function derive(baseClass, constructor, instanceMembers, staticMembers) {\n            /// <signature helpKeyword=\"WinJS.Class.derive\">\n            /// <summary locid=\"WinJS.Class.derive\">\n            /// Creates a sub-class based on the supplied baseClass parameter, using prototypal inheritance.\n            /// </summary>\n            /// <param name=\"baseClass\" type=\"Function\" locid=\"WinJS.Class.derive_p:baseClass\">\n            /// The class to inherit from.\n            /// </param>\n            /// <param name=\"constructor\" type=\"Function\" locid=\"WinJS.Class.derive_p:constructor\">\n            /// A constructor function that is used to instantiate this class.\n            /// </param>\n            /// <param name=\"instanceMembers\" type=\"Object\" locid=\"WinJS.Class.derive_p:instanceMembers\">\n            /// The set of instance fields, properties, and methods to be made available on the class.\n            /// </param>\n            /// <param name=\"staticMembers\" type=\"Object\" locid=\"WinJS.Class.derive_p:staticMembers\">\n            /// The set of static fields, properties, and methods to be made available on the class.\n            /// </param>\n            /// <returns type=\"Function\" locid=\"WinJS.Class.derive_returnValue\">\n            /// The newly-defined class.\n            /// </returns>\n            /// </signature>\n            if (baseClass) {\n                constructor = constructor || function () { };\n                var basePrototype = baseClass.prototype;\n                constructor.prototype = Object.create(basePrototype);\n                _BaseCoreUtils.markSupportedForProcessing(constructor);\n                Object.defineProperty(constructor.prototype, \"constructor\", { value: constructor, writable: true, configurable: true, enumerable: true });\n                if (instanceMembers) {\n                    initializeProperties(constructor.prototype, instanceMembers);\n                }\n                if (staticMembers) {\n                    initializeProperties(constructor, staticMembers);\n                }\n                return constructor;\n            } else {\n                return define(constructor, instanceMembers, staticMembers);\n            }\n        }\n\n        function mix(constructor) {\n            /// <signature helpKeyword=\"WinJS.Class.mix\">\n            /// <summary locid=\"WinJS.Class.mix\">\n            /// Defines a class using the given constructor and the union of the set of instance members\n            /// specified by all the mixin objects. The mixin parameter list is of variable length.\n            /// </summary>\n            /// <param name=\"constructor\" locid=\"WinJS.Class.mix_p:constructor\">\n            /// A constructor function that is used to instantiate this class.\n            /// </param>\n            /// <returns type=\"Function\" locid=\"WinJS.Class.mix_returnValue\">\n            /// The newly-defined class.\n            /// </returns>\n            /// </signature>\n            constructor = constructor || function () { };\n            var i, len;\n            for (i = 1, len = arguments.length; i < len; i++) {\n                initializeProperties(constructor.prototype, arguments[i]);\n            }\n            return constructor;\n        }\n\n        // Establish members of \"WinJS.Class\" namespace\n        _WinJS.Namespace.define(\"WinJS.Class\", {\n            define: define,\n            derive: derive,\n            mix: mix\n        });\n\n    })();\n\n    return {\n        Namespace: _WinJS.Namespace,\n        Class: _WinJS.Class\n    };\n\n});\n_winjs(\"WinJS/Core/_ErrorFromName\", [\"WinJS/Core/_Base\"], function errorsInit(_Base) {\n    \"use strict\";\n\n    var ErrorFromName = _Base.Class.derive(Error, function (name, message) {\n        /// <signature helpKeyword=\"WinJS.ErrorFromName\">\n        /// <summary locid=\"WinJS.ErrorFromName\">\n        /// Creates an Error object with the specified name and message properties.\n        /// </summary>\n        /// <param name=\"name\" type=\"String\" locid=\"WinJS.ErrorFromName_p:name\">The name of this error. The name is meant to be consumed programmatically and should not be localized.</param>\n        /// <param name=\"message\" type=\"String\" optional=\"true\" locid=\"WinJS.ErrorFromName_p:message\">The message for this error. The message is meant to be consumed by humans and should be localized.</param>\n        /// <returns type=\"Error\" locid=\"WinJS.ErrorFromName_returnValue\">Error instance with .name and .message properties populated</returns>\n        /// </signature>\n        this.name = name;\n        this.message = message || name;\n    }, {\n        /* empty */\n    }, {\n        supportedForProcessing: false,\n    });\n\n    _Base.Namespace.define(\"WinJS\", {\n        // ErrorFromName establishes a simple pattern for returning error codes.\n        //\n        ErrorFromName: ErrorFromName\n    });\n\n    return ErrorFromName;\n\n});\n\n\n_winjs(\"WinJS/Core/_Events\", [\"exports\",\"WinJS/Core/_Base\"], function eventsInit(exports, _Base) {\n    \"use strict\";\n\n\n    function createEventProperty(name) {\n        var eventPropStateName = \"_on\" + name + \"state\";\n\n        return {\n            get: function () {\n                var state = this[eventPropStateName];\n                return state && state.userHandler;\n            },\n            set: function (handler) {\n                var state = this[eventPropStateName];\n                if (handler) {\n                    if (!state) {\n                        state = { wrapper: function (evt) { return state.userHandler(evt); }, userHandler: handler };\n                        Object.defineProperty(this, eventPropStateName, { value: state, enumerable: false, writable:true, configurable: true });\n                        this.addEventListener(name, state.wrapper, false);\n                    }\n                    state.userHandler = handler;\n                } else if (state) {\n                    this.removeEventListener(name, state.wrapper, false);\n                    this[eventPropStateName] = null;\n                }\n            },\n            enumerable: true\n        };\n    }\n\n    function createEventProperties() {\n        /// <signature helpKeyword=\"WinJS.Utilities.createEventProperties\">\n        /// <summary locid=\"WinJS.Utilities.createEventProperties\">\n        /// Creates an object that has one property for each name passed to the function.\n        /// </summary>\n        /// <param name=\"events\" locid=\"WinJS.Utilities.createEventProperties_p:events\">\n        /// A variable list of property names.\n        /// </param>\n        /// <returns type=\"Object\" locid=\"WinJS.Utilities.createEventProperties_returnValue\">\n        /// The object with the specified properties. The names of the properties are prefixed with 'on'.\n        /// </returns>\n        /// </signature>\n        var props = {};\n        for (var i = 0, len = arguments.length; i < len; i++) {\n            var name = arguments[i];\n            props[\"on\" + name] = createEventProperty(name);\n        }\n        return props;\n    }\n\n    var EventMixinEvent = _Base.Class.define(\n        function EventMixinEvent_ctor(type, detail, target) {\n            this.detail = detail;\n            this.target = target;\n            this.timeStamp = Date.now();\n            this.type = type;\n        },\n        {\n            bubbles: { value: false, writable: false },\n            cancelable: { value: false, writable: false },\n            currentTarget: {\n                get: function () { return this.target; }\n            },\n            defaultPrevented: {\n                get: function () { return this._preventDefaultCalled; }\n            },\n            trusted: { value: false, writable: false },\n            eventPhase: { value: 0, writable: false },\n            target: null,\n            timeStamp: null,\n            type: null,\n\n            preventDefault: function () {\n                this._preventDefaultCalled = true;\n            },\n            stopImmediatePropagation: function () {\n                this._stopImmediatePropagationCalled = true;\n            },\n            stopPropagation: function () {\n            }\n        }, {\n            supportedForProcessing: false,\n        }\n    );\n\n    var eventMixin = {\n        _listeners: null,\n\n        addEventListener: function (type, listener, useCapture) {\n            /// <signature helpKeyword=\"WinJS.Utilities.eventMixin.addEventListener\">\n            /// <summary locid=\"WinJS.Utilities.eventMixin.addEventListener\">\n            /// Adds an event listener to the control.\n            /// </summary>\n            /// <param name=\"type\" locid=\"WinJS.Utilities.eventMixin.addEventListener_p:type\">\n            /// The type (name) of the event.\n            /// </param>\n            /// <param name=\"listener\" locid=\"WinJS.Utilities.eventMixin.addEventListener_p:listener\">\n            /// The listener to invoke when the event is raised.\n            /// </param>\n            /// <param name=\"useCapture\" locid=\"WinJS.Utilities.eventMixin.addEventListener_p:useCapture\">\n            /// if true initiates capture, otherwise false.\n            /// </param>\n            /// </signature>\n            useCapture = useCapture || false;\n            this._listeners = this._listeners || {};\n            var eventListeners = (this._listeners[type] = this._listeners[type] || []);\n            for (var i = 0, len = eventListeners.length; i < len; i++) {\n                var l = eventListeners[i];\n                if (l.useCapture === useCapture && l.listener === listener) {\n                    return;\n                }\n            }\n            eventListeners.push({ listener: listener, useCapture: useCapture });\n        },\n        dispatchEvent: function (type, details) {\n            /// <signature helpKeyword=\"WinJS.Utilities.eventMixin.dispatchEvent\">\n            /// <summary locid=\"WinJS.Utilities.eventMixin.dispatchEvent\">\n            /// Raises an event of the specified type and with the specified additional properties.\n            /// </summary>\n            /// <param name=\"type\" locid=\"WinJS.Utilities.eventMixin.dispatchEvent_p:type\">\n            /// The type (name) of the event.\n            /// </param>\n            /// <param name=\"details\" locid=\"WinJS.Utilities.eventMixin.dispatchEvent_p:details\">\n            /// The set of additional properties to be attached to the event object when the event is raised.\n            /// </param>\n            /// <returns type=\"Boolean\" locid=\"WinJS.Utilities.eventMixin.dispatchEvent_returnValue\">\n            /// true if preventDefault was called on the event.\n            /// </returns>\n            /// </signature>\n            var listeners = this._listeners && this._listeners[type];\n            if (listeners) {\n                var eventValue = new EventMixinEvent(type, details, this);\n                // Need to copy the array to protect against people unregistering while we are dispatching\n                listeners = listeners.slice(0, listeners.length);\n                for (var i = 0, len = listeners.length; i < len && !eventValue._stopImmediatePropagationCalled; i++) {\n                    listeners[i].listener(eventValue);\n                }\n                return eventValue.defaultPrevented || false;\n            }\n            return false;\n        },\n        removeEventListener: function (type, listener, useCapture) {\n            /// <signature helpKeyword=\"WinJS.Utilities.eventMixin.removeEventListener\">\n            /// <summary locid=\"WinJS.Utilities.eventMixin.removeEventListener\">\n            /// Removes an event listener from the control.\n            /// </summary>\n            /// <param name=\"type\" locid=\"WinJS.Utilities.eventMixin.removeEventListener_p:type\">\n            /// The type (name) of the event.\n            /// </param>\n            /// <param name=\"listener\" locid=\"WinJS.Utilities.eventMixin.removeEventListener_p:listener\">\n            /// The listener to remove.\n            /// </param>\n            /// <param name=\"useCapture\" locid=\"WinJS.Utilities.eventMixin.removeEventListener_p:useCapture\">\n            /// Specifies whether to initiate capture.\n            /// </param>\n            /// </signature>\n            useCapture = useCapture || false;\n            var listeners = this._listeners && this._listeners[type];\n            if (listeners) {\n                for (var i = 0, len = listeners.length; i < len; i++) {\n                    var l = listeners[i];\n                    if (l.listener === listener && l.useCapture === useCapture) {\n                        listeners.splice(i, 1);\n                        if (listeners.length === 0) {\n                            delete this._listeners[type];\n                        }\n                        // Only want to remove one element for each call to removeEventListener\n                        break;\n                    }\n                }\n            }\n        }\n    };\n\n    _Base.Namespace._moduleDefine(exports, \"WinJS.Utilities\", {\n        _createEventProperty: createEventProperty,\n        createEventProperties: createEventProperties,\n        eventMixin: eventMixin\n    });\n\n});\n\n\n_winjs(\"WinJS/Core/_Trace\", [\"WinJS/Core/_Global\"], function traceInit(_Global) {\n    \"use strict\";\n\n    function nop(v) {\n        return v;\n    }\n\n    return {\n        _traceAsyncOperationStarting: (_Global.Debug && _Global.Debug.msTraceAsyncOperationStarting && _Global.Debug.msTraceAsyncOperationStarting.bind(_Global.Debug)) || nop,\n        _traceAsyncOperationCompleted: (_Global.Debug && _Global.Debug.msTraceAsyncOperationCompleted && _Global.Debug.msTraceAsyncOperationCompleted.bind(_Global.Debug)) || nop,\n        _traceAsyncCallbackStarting: (_Global.Debug && _Global.Debug.msTraceAsyncCallbackStarting && _Global.Debug.msTraceAsyncCallbackStarting.bind(_Global.Debug)) || nop,\n        _traceAsyncCallbackCompleted: (_Global.Debug && _Global.Debug.msTraceAsyncCallbackCompleted && _Global.Debug.msTraceAsyncCallbackCompleted.bind(_Global.Debug)) || nop\n    };\n});\n_winjs(\"WinJS/Promise/_StateMachine\", [\"WinJS/Core/_Global\",\"WinJS/Core/_BaseCoreUtils\",\"WinJS/Core/_Base\",\"WinJS/Core/_ErrorFromName\",\"WinJS/Core/_Events\",\"WinJS/Core/_Trace\"], function promiseStateMachineInit(_Global, _BaseCoreUtils, _Base, _ErrorFromName, _Events, _Trace) {\n    \"use strict\";\n\n    _Global.Debug && (_Global.Debug.setNonUserCodeExceptions = true);\n\n    var ListenerType = _Base.Class.mix(_Base.Class.define(null, { /*empty*/ }, { supportedForProcessing: false }), _Events.eventMixin);\n    var promiseEventListeners = new ListenerType();\n    // make sure there is a listeners collection so that we can do a more trivial check below\n    promiseEventListeners._listeners = {};\n    var errorET = \"error\";\n    var canceledName = \"Canceled\";\n    var tagWithStack = false;\n    var tag = {\n        promise: 0x01,\n        thenPromise: 0x02,\n        errorPromise: 0x04,\n        exceptionPromise: 0x08,\n        completePromise: 0x10,\n    };\n    tag.all = tag.promise | tag.thenPromise | tag.errorPromise | tag.exceptionPromise | tag.completePromise;\n\n    //\n    // Global error counter, for each error which enters the system we increment this once and then\n    // the error number travels with the error as it traverses the tree of potential handlers.\n    //\n    // When someone has registered to be told about errors (WinJS.Promise.callonerror) promises\n    // which are in error will get tagged with a ._errorId field. This tagged field is the\n    // contract by which nested promises with errors will be identified as chaining for the\n    // purposes of the callonerror semantics. If a nested promise in error is encountered without\n    // a ._errorId it will be assumed to be foreign and treated as an interop boundary and\n    // a new error id will be minted.\n    //\n    var error_number = 1;\n\n    //\n    // The state machine has a interesting hiccup in it with regards to notification, in order\n    // to flatten out notification and avoid recursion for synchronous completion we have an\n    // explicit set of *_notify states which are responsible for notifying their entire tree\n    // of children. They can do this because they know that immediate children are always\n    // ThenPromise instances and we can therefore reach into their state to access the\n    // _listeners collection.\n    //\n    // So, what happens is that a Promise will be fulfilled through the _completed or _error\n    // messages at which point it will enter a *_notify state and be responsible for to move\n    // its children into an (as appropriate) success or error state and also notify that child's\n    // listeners of the state transition, until leaf notes are reached.\n    //\n\n    var state_created,              // -> working\n        state_working,              // -> error | error_notify | success | success_notify | canceled | waiting\n        state_waiting,              // -> error | error_notify | success | success_notify | waiting_canceled\n        state_waiting_canceled,     // -> error | error_notify | success | success_notify | canceling\n        state_canceled,             // -> error | error_notify | success | success_notify | canceling\n        state_canceling,            // -> error_notify\n        state_success_notify,       // -> success\n        state_success,              // -> .\n        state_error_notify,         // -> error\n        state_error;                // -> .\n\n    // Noop function, used in the various states to indicate that they don't support a given\n    // message. Named with the somewhat cute name '_' because it reads really well in the states.\n\n    function _() { }\n\n    // Initial state\n    //\n    state_created = {\n        name: \"created\",\n        enter: function (promise) {\n            promise._setState(state_working);\n        },\n        cancel: _,\n        done: _,\n        then: _,\n        _completed: _,\n        _error: _,\n        _notify: _,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Ready state, waiting for a message (completed/error/progress), able to be canceled\n    //\n    state_working = {\n        name: \"working\",\n        enter: _,\n        cancel: function (promise) {\n            promise._setState(state_canceled);\n        },\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Waiting state, if a promise is completed with a value which is itself a promise\n    // (has a then() method) it signs up to be informed when that child promise is\n    // fulfilled at which point it will be fulfilled with that value.\n    //\n    state_waiting = {\n        name: \"waiting\",\n        enter: function (promise) {\n            var waitedUpon = promise._value;\n            // We can special case our own intermediate promises which are not in a\n            //  terminal state by just pushing this promise as a listener without\n            //  having to create new indirection functions\n            if (waitedUpon instanceof ThenPromise &&\n                waitedUpon._state !== state_error &&\n                waitedUpon._state !== state_success) {\n                pushListener(waitedUpon, { promise: promise });\n            } else {\n                var error = function (value) {\n                    if (waitedUpon._errorId) {\n                        promise._chainedError(value, waitedUpon);\n                    } else {\n                        // Because this is an interop boundary we want to indicate that this\n                        //  error has been handled by the promise infrastructure before we\n                        //  begin a new handling chain.\n                        //\n                        callonerror(promise, value, detailsForHandledError, waitedUpon, error);\n                        promise._error(value);\n                    }\n                };\n                error.handlesOnError = true;\n                waitedUpon.then(\n                    promise._completed.bind(promise),\n                    error,\n                    promise._progress.bind(promise)\n                );\n            }\n        },\n        cancel: function (promise) {\n            promise._setState(state_waiting_canceled);\n        },\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Waiting canceled state, when a promise has been in a waiting state and receives a\n    // request to cancel its pending work it will forward that request to the child promise\n    // and then waits to be informed of the result. This promise moves itself into the\n    // canceling state but understands that the child promise may instead push it to a\n    // different state.\n    //\n    state_waiting_canceled = {\n        name: \"waiting_canceled\",\n        enter: function (promise) {\n            // Initiate a transition to canceling. Triggering a cancel on the promise\n            // that we are waiting upon may result in a different state transition\n            // before the state machine pump runs again.\n            promise._setState(state_canceling);\n            var waitedUpon = promise._value;\n            if (waitedUpon.cancel) {\n                waitedUpon.cancel();\n            }\n        },\n        cancel: _,\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Canceled state, moves to the canceling state and then tells the promise to do\n    // whatever it might need to do on cancelation.\n    //\n    state_canceled = {\n        name: \"canceled\",\n        enter: function (promise) {\n            // Initiate a transition to canceling. The _cancelAction may change the state\n            // before the state machine pump runs again.\n            promise._setState(state_canceling);\n            promise._cancelAction();\n        },\n        cancel: _,\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Canceling state, commits to the promise moving to an error state with an error\n    // object whose 'name' and 'message' properties contain the string \"Canceled\"\n    //\n    state_canceling = {\n        name: \"canceling\",\n        enter: function (promise) {\n            var error = new Error(canceledName);\n            error.name = error.message;\n            promise._value = error;\n            promise._setState(state_error_notify);\n        },\n        cancel: _,\n        done: _,\n        then: _,\n        _completed: _,\n        _error: _,\n        _notify: _,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Success notify state, moves a promise to the success state and notifies all children\n    //\n    state_success_notify = {\n        name: \"complete_notify\",\n        enter: function (promise) {\n            promise.done = CompletePromise.prototype.done;\n            promise.then = CompletePromise.prototype.then;\n            if (promise._listeners) {\n                var queue = [promise];\n                var p;\n                while (queue.length) {\n                    p = queue.shift();\n                    p._state._notify(p, queue);\n                }\n            }\n            promise._setState(state_success);\n        },\n        cancel: _,\n        done: null, /*error to get here */\n        then: null, /*error to get here */\n        _completed: _,\n        _error: _,\n        _notify: notifySuccess,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Success state, moves a promise to the success state and does NOT notify any children.\n    // Some upstream promise is owning the notification pass.\n    //\n    state_success = {\n        name: \"success\",\n        enter: function (promise) {\n            promise.done = CompletePromise.prototype.done;\n            promise.then = CompletePromise.prototype.then;\n            promise._cleanupAction();\n        },\n        cancel: _,\n        done: null, /*error to get here */\n        then: null, /*error to get here */\n        _completed: _,\n        _error: _,\n        _notify: notifySuccess,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Error notify state, moves a promise to the error state and notifies all children\n    //\n    state_error_notify = {\n        name: \"error_notify\",\n        enter: function (promise) {\n            promise.done = ErrorPromise.prototype.done;\n            promise.then = ErrorPromise.prototype.then;\n            if (promise._listeners) {\n                var queue = [promise];\n                var p;\n                while (queue.length) {\n                    p = queue.shift();\n                    p._state._notify(p, queue);\n                }\n            }\n            promise._setState(state_error);\n        },\n        cancel: _,\n        done: null, /*error to get here*/\n        then: null, /*error to get here*/\n        _completed: _,\n        _error: _,\n        _notify: notifyError,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Error state, moves a promise to the error state and does NOT notify any children.\n    // Some upstream promise is owning the notification pass.\n    //\n    state_error = {\n        name: \"error\",\n        enter: function (promise) {\n            promise.done = ErrorPromise.prototype.done;\n            promise.then = ErrorPromise.prototype.then;\n            promise._cleanupAction();\n        },\n        cancel: _,\n        done: null, /*error to get here*/\n        then: null, /*error to get here*/\n        _completed: _,\n        _error: _,\n        _notify: notifyError,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    //\n    // The statemachine implementation follows a very particular pattern, the states are specified\n    // as static stateless bags of functions which are then indirected through the state machine\n    // instance (a Promise). As such all of the functions on each state have the promise instance\n    // passed to them explicitly as a parameter and the Promise instance members do a little\n    // dance where they indirect through the state and insert themselves in the argument list.\n    //\n    // We could instead call directly through the promise states however then every caller\n    // would have to remember to do things like pumping the state machine to catch state transitions.\n    //\n\n    var PromiseStateMachine = _Base.Class.define(null, {\n        _listeners: null,\n        _nextState: null,\n        _state: null,\n        _value: null,\n\n        cancel: function () {\n            /// <signature helpKeyword=\"WinJS.PromiseStateMachine.cancel\">\n            /// <summary locid=\"WinJS.PromiseStateMachine.cancel\">\n            /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't\n            /// already been fulfilled and cancellation is supported, the promise enters\n            /// the error state with a value of Error(\"Canceled\").\n            /// </summary>\n            /// </signature>\n            this._state.cancel(this);\n            this._run();\n        },\n        done: function Promise_done(onComplete, onError, onProgress) {\n            /// <signature helpKeyword=\"WinJS.PromiseStateMachine.done\">\n            /// <summary locid=\"WinJS.PromiseStateMachine.done\">\n            /// Allows you to specify the work to be done on the fulfillment of the promised value,\n            /// the error handling to be performed if the promise fails to fulfill\n            /// a value, and the handling of progress notifications along the way.\n            ///\n            /// After the handlers have finished executing, this function throws any error that would have been returned\n            /// from then() as a promise in the error state.\n            /// </summary>\n            /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.done_p:onComplete\">\n            /// The function to be called if the promise is fulfilled successfully with a value.\n            /// The fulfilled value is passed as the single argument. If the value is null,\n            /// the fulfilled value is returned. The value returned\n            /// from the function becomes the fulfilled value of the promise returned by\n            /// then(). If an exception is thrown while executing the function, the promise returned\n            /// by then() moves into the error state.\n            /// </param>\n            /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onError\">\n            /// The function to be called if the promise is fulfilled with an error. The error\n            /// is passed as the single argument. If it is null, the error is forwarded.\n            /// The value returned from the function is the fulfilled value of the promise returned by then().\n            /// </param>\n            /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onProgress\">\n            /// the function to be called if the promise reports progress. Data about the progress\n            /// is passed as the single argument. Promises are not required to support\n            /// progress.\n            /// </param>\n            /// </signature>\n            this._state.done(this, onComplete, onError, onProgress);\n        },\n        then: function Promise_then(onComplete, onError, onProgress) {\n            /// <signature helpKeyword=\"WinJS.PromiseStateMachine.then\">\n            /// <summary locid=\"WinJS.PromiseStateMachine.then\">\n            /// Allows you to specify the work to be done on the fulfillment of the promised value,\n            /// the error handling to be performed if the promise fails to fulfill\n            /// a value, and the handling of progress notifications along the way.\n            /// </summary>\n            /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.then_p:onComplete\">\n            /// The function to be called if the promise is fulfilled successfully with a value.\n            /// The value is passed as the single argument. If the value is null, the value is returned.\n            /// The value returned from the function becomes the fulfilled value of the promise returned by\n            /// then(). If an exception is thrown while this function is being executed, the promise returned\n            /// by then() moves into the error state.\n            /// </param>\n            /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onError\">\n            /// The function to be called if the promise is fulfilled with an error. The error\n            /// is passed as the single argument. If it is null, the error is forwarded.\n            /// The value returned from the function becomes the fulfilled value of the promise returned by then().\n            /// </param>\n            /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onProgress\">\n            /// The function to be called if the promise reports progress. Data about the progress\n            /// is passed as the single argument. Promises are not required to support\n            /// progress.\n            /// </param>\n            /// <returns type=\"WinJS.Promise\" locid=\"WinJS.PromiseStateMachine.then_returnValue\">\n            /// The promise whose value is the result of executing the complete or\n            /// error function.\n            /// </returns>\n            /// </signature>\n            return this._state.then(this, onComplete, onError, onProgress);\n        },\n\n        _chainedError: function (value, context) {\n            var result = this._state._error(this, value, detailsForChainedError, context);\n            this._run();\n            return result;\n        },\n        _completed: function (value) {\n            var result = this._state._completed(this, value);\n            this._run();\n            return result;\n        },\n        _error: function (value) {\n            var result = this._state._error(this, value, detailsForError);\n            this._run();\n            return result;\n        },\n        _progress: function (value) {\n            this._state._progress(this, value);\n        },\n        _setState: function (state) {\n            this._nextState = state;\n        },\n        _setCompleteValue: function (value) {\n            this._state._setCompleteValue(this, value);\n            this._run();\n        },\n        _setChainedErrorValue: function (value, context) {\n            var result = this._state._setErrorValue(this, value, detailsForChainedError, context);\n            this._run();\n            return result;\n        },\n        _setExceptionValue: function (value) {\n            var result = this._state._setErrorValue(this, value, detailsForException);\n            this._run();\n            return result;\n        },\n        _run: function () {\n            while (this._nextState) {\n                this._state = this._nextState;\n                this._nextState = null;\n                this._state.enter(this);\n            }\n        }\n    }, {\n        supportedForProcessing: false\n    });\n\n    //\n    // Implementations of shared state machine code.\n    //\n\n    function completed(promise, value) {\n        var targetState;\n        if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n            targetState = state_waiting;\n        } else {\n            targetState = state_success_notify;\n        }\n        promise._value = value;\n        promise._setState(targetState);\n    }\n    function createErrorDetails(exception, error, promise, id, parent, handler) {\n        return {\n            exception: exception,\n            error: error,\n            promise: promise,\n            handler: handler,\n            id: id,\n            parent: parent\n        };\n    }\n    function detailsForHandledError(promise, errorValue, context, handler) {\n        var exception = context._isException;\n        var errorId = context._errorId;\n        return createErrorDetails(\n            exception ? errorValue : null,\n            exception ? null : errorValue,\n            promise,\n            errorId,\n            context,\n            handler\n        );\n    }\n    function detailsForChainedError(promise, errorValue, context) {\n        var exception = context._isException;\n        var errorId = context._errorId;\n        setErrorInfo(promise, errorId, exception);\n        return createErrorDetails(\n            exception ? errorValue : null,\n            exception ? null : errorValue,\n            promise,\n            errorId,\n            context\n        );\n    }\n    function detailsForError(promise, errorValue) {\n        var errorId = ++error_number;\n        setErrorInfo(promise, errorId);\n        return createErrorDetails(\n            null,\n            errorValue,\n            promise,\n            errorId\n        );\n    }\n    function detailsForException(promise, exceptionValue) {\n        var errorId = ++error_number;\n        setErrorInfo(promise, errorId, true);\n        return createErrorDetails(\n            exceptionValue,\n            null,\n            promise,\n            errorId\n        );\n    }\n    function done(promise, onComplete, onError, onProgress) {\n        var asyncOpID = _Trace._traceAsyncOperationStarting(\"WinJS.Promise.done\");\n        pushListener(promise, { c: onComplete, e: onError, p: onProgress, asyncOpID: asyncOpID });\n    }\n    function error(promise, value, onerrorDetails, context) {\n        promise._value = value;\n        callonerror(promise, value, onerrorDetails, context);\n        promise._setState(state_error_notify);\n    }\n    function notifySuccess(promise, queue) {\n        var value = promise._value;\n        var listeners = promise._listeners;\n        if (!listeners) {\n            return;\n        }\n        promise._listeners = null;\n        var i, len;\n        for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {\n            var listener = len === 1 ? listeners : listeners[i];\n            var onComplete = listener.c;\n            var target = listener.promise;\n\n            _Trace._traceAsyncOperationCompleted(listener.asyncOpID, _Global.Debug && _Global.Debug.MS_ASYNC_OP_STATUS_SUCCESS);\n\n            if (target) {\n                _Trace._traceAsyncCallbackStarting(listener.asyncOpID);\n                try {\n                    target._setCompleteValue(onComplete ? onComplete(value) : value);\n                } catch (ex) {\n                    target._setExceptionValue(ex);\n                } finally {\n                    _Trace._traceAsyncCallbackCompleted();\n                }\n                if (target._state !== state_waiting && target._listeners) {\n                    queue.push(target);\n                }\n            } else {\n                CompletePromise.prototype.done.call(promise, onComplete);\n            }\n        }\n    }\n    function notifyError(promise, queue) {\n        var value = promise._value;\n        var listeners = promise._listeners;\n        if (!listeners) {\n            return;\n        }\n        promise._listeners = null;\n        var i, len;\n        for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {\n            var listener = len === 1 ? listeners : listeners[i];\n            var onError = listener.e;\n            var target = listener.promise;\n\n            var errorID = _Global.Debug && (value && value.name === canceledName ? _Global.Debug.MS_ASYNC_OP_STATUS_CANCELED : _Global.Debug.MS_ASYNC_OP_STATUS_ERROR);\n            _Trace._traceAsyncOperationCompleted(listener.asyncOpID, errorID);\n\n            if (target) {\n                var asyncCallbackStarted = false;\n                try {\n                    if (onError) {\n                        _Trace._traceAsyncCallbackStarting(listener.asyncOpID);\n                        asyncCallbackStarted = true;\n                        if (!onError.handlesOnError) {\n                            callonerror(target, value, detailsForHandledError, promise, onError);\n                        }\n                        target._setCompleteValue(onError(value));\n                    } else {\n                        target._setChainedErrorValue(value, promise);\n                    }\n                } catch (ex) {\n                    target._setExceptionValue(ex);\n                } finally {\n                    if (asyncCallbackStarted) {\n                        _Trace._traceAsyncCallbackCompleted();\n                    }\n                }\n                if (target._state !== state_waiting && target._listeners) {\n                    queue.push(target);\n                }\n            } else {\n                ErrorPromise.prototype.done.call(promise, null, onError);\n            }\n        }\n    }\n    function callonerror(promise, value, onerrorDetailsGenerator, context, handler) {\n        if (promiseEventListeners._listeners[errorET]) {\n            if (value instanceof Error && value.message === canceledName) {\n                return;\n            }\n            promiseEventListeners.dispatchEvent(errorET, onerrorDetailsGenerator(promise, value, context, handler));\n        }\n    }\n    function progress(promise, value) {\n        var listeners = promise._listeners;\n        if (listeners) {\n            var i, len;\n            for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {\n                var listener = len === 1 ? listeners : listeners[i];\n                var onProgress = listener.p;\n                if (onProgress) {\n                    try { onProgress(value); } catch (ex) { }\n                }\n                if (!(listener.c || listener.e) && listener.promise) {\n                    listener.promise._progress(value);\n                }\n            }\n        }\n    }\n    function pushListener(promise, listener) {\n        var listeners = promise._listeners;\n        if (listeners) {\n            // We may have either a single listener (which will never be wrapped in an array)\n            // or 2+ listeners (which will be wrapped). Since we are now adding one more listener\n            // we may have to wrap the single listener before adding the second.\n            listeners = Array.isArray(listeners) ? listeners : [listeners];\n            listeners.push(listener);\n        } else {\n            listeners = listener;\n        }\n        promise._listeners = listeners;\n    }\n    // The difference beween setCompleteValue()/setErrorValue() and complete()/error() is that setXXXValue() moves\n    // a promise directly to the success/error state without starting another notification pass (because one\n    // is already ongoing).\n    function setErrorInfo(promise, errorId, isException) {\n        promise._isException = isException || false;\n        promise._errorId = errorId;\n    }\n    function setErrorValue(promise, value, onerrorDetails, context) {\n        promise._value = value;\n        callonerror(promise, value, onerrorDetails, context);\n        promise._setState(state_error);\n    }\n    function setCompleteValue(promise, value) {\n        var targetState;\n        if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n            targetState = state_waiting;\n        } else {\n            targetState = state_success;\n        }\n        promise._value = value;\n        promise._setState(targetState);\n    }\n    function then(promise, onComplete, onError, onProgress) {\n        var result = new ThenPromise(promise);\n        var asyncOpID = _Trace._traceAsyncOperationStarting(\"WinJS.Promise.then\");\n        pushListener(promise, { promise: result, c: onComplete, e: onError, p: onProgress, asyncOpID: asyncOpID });\n        return result;\n    }\n\n    //\n    // Internal implementation detail promise, ThenPromise is created when a promise needs\n    // to be returned from a then() method.\n    //\n    var ThenPromise = _Base.Class.derive(PromiseStateMachine,\n        function (creator) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.thenPromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._creator = creator;\n            this._setState(state_created);\n            this._run();\n        }, {\n            _creator: null,\n\n            _cancelAction: function () { if (this._creator) { this._creator.cancel(); } },\n            _cleanupAction: function () { this._creator = null; }\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    //\n    // Slim promise implementations for already completed promises, these are created\n    // under the hood on synchronous completion paths as well as by WinJS.Promise.wrap\n    // and WinJS.Promise.wrapError.\n    //\n\n    var ErrorPromise = _Base.Class.define(\n        function ErrorPromise_ctor(value) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.errorPromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._value = value;\n            callonerror(this, value, detailsForError);\n        }, {\n            cancel: function () {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.cancel\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.cancel\">\n                /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't\n                /// already been fulfilled and cancellation is supported, the promise enters\n                /// the error state with a value of Error(\"Canceled\").\n                /// </summary>\n                /// </signature>\n            },\n            done: function ErrorPromise_done(unused, onError) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.done\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.done\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                ///\n                /// After the handlers have finished executing, this function throws any error that would have been returned\n                /// from then() as a promise in the error state.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.done_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The fulfilled value is passed as the single argument. If the value is null,\n                /// the fulfilled value is returned. The value returned\n                /// from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while executing the function, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function is the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onProgress\">\n                /// the function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// </signature>\n                var value = this._value;\n                if (onError) {\n                    try {\n                        if (!onError.handlesOnError) {\n                            callonerror(null, value, detailsForHandledError, this, onError);\n                        }\n                        var result = onError(value);\n                        if (result && typeof result === \"object\" && typeof result.done === \"function\") {\n                            // If a promise is returned we need to wait on it.\n                            result.done();\n                        }\n                        return;\n                    } catch (ex) {\n                        value = ex;\n                    }\n                }\n                if (value instanceof Error && value.message === canceledName) {\n                    // suppress cancel\n                    return;\n                }\n                // force the exception to be thrown asyncronously to avoid any try/catch blocks\n                //\n                Promise._doneHandler(value);\n            },\n            then: function ErrorPromise_then(unused, onError) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.then\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.then\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.then_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The value is passed as the single argument. If the value is null, the value is returned.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while this function is being executed, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onProgress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.PromiseStateMachine.then_returnValue\">\n                /// The promise whose value is the result of executing the complete or\n                /// error function.\n                /// </returns>\n                /// </signature>\n\n                // If the promise is already in a error state and no error handler is provided\n                // we optimize by simply returning the promise instead of creating a new one.\n                //\n                if (!onError) { return this; }\n                var result;\n                var value = this._value;\n                try {\n                    if (!onError.handlesOnError) {\n                        callonerror(null, value, detailsForHandledError, this, onError);\n                    }\n                    result = new CompletePromise(onError(value));\n                } catch (ex) {\n                    // If the value throw from the error handler is the same as the value\n                    // provided to the error handler then there is no need for a new promise.\n                    //\n                    if (ex === value) {\n                        result = this;\n                    } else {\n                        result = new ExceptionPromise(ex);\n                    }\n                }\n                return result;\n            }\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    var ExceptionPromise = _Base.Class.derive(ErrorPromise,\n        function ExceptionPromise_ctor(value) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.exceptionPromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._value = value;\n            callonerror(this, value, detailsForException);\n        }, {\n            /* empty */\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    var CompletePromise = _Base.Class.define(\n        function CompletePromise_ctor(value) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.completePromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n                var result = new ThenPromise(null);\n                result._setCompleteValue(value);\n                return result;\n            }\n            this._value = value;\n        }, {\n            cancel: function () {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.cancel\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.cancel\">\n                /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't\n                /// already been fulfilled and cancellation is supported, the promise enters\n                /// the error state with a value of Error(\"Canceled\").\n                /// </summary>\n                /// </signature>\n            },\n            done: function CompletePromise_done(onComplete) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.done\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.done\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                ///\n                /// After the handlers have finished executing, this function throws any error that would have been returned\n                /// from then() as a promise in the error state.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.done_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The fulfilled value is passed as the single argument. If the value is null,\n                /// the fulfilled value is returned. The value returned\n                /// from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while executing the function, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function is the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onProgress\">\n                /// the function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// </signature>\n                if (!onComplete) { return; }\n                try {\n                    var result = onComplete(this._value);\n                    if (result && typeof result === \"object\" && typeof result.done === \"function\") {\n                        result.done();\n                    }\n                } catch (ex) {\n                    // force the exception to be thrown asynchronously to avoid any try/catch blocks\n                    Promise._doneHandler(ex);\n                }\n            },\n            then: function CompletePromise_then(onComplete) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.then\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.then\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.then_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The value is passed as the single argument. If the value is null, the value is returned.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while this function is being executed, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onProgress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.PromiseStateMachine.then_returnValue\">\n                /// The promise whose value is the result of executing the complete or\n                /// error function.\n                /// </returns>\n                /// </signature>\n                try {\n                    // If the value returned from the completion handler is the same as the value\n                    // provided to the completion handler then there is no need for a new promise.\n                    //\n                    var newValue = onComplete ? onComplete(this._value) : this._value;\n                    return newValue === this._value ? this : new CompletePromise(newValue);\n                } catch (ex) {\n                    return new ExceptionPromise(ex);\n                }\n            }\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    //\n    // Promise is the user-creatable WinJS.Promise object.\n    //\n\n    function timeout(timeoutMS) {\n        var id;\n        return new Promise(\n            function (c) {\n                if (timeoutMS) {\n                    id = _Global.setTimeout(c, timeoutMS);\n                } else {\n                    _BaseCoreUtils._setImmediate(c);\n                }\n            },\n            function () {\n                if (id) {\n                    _Global.clearTimeout(id);\n                }\n            }\n        );\n    }\n\n    function timeoutWithPromise(timeout, promise) {\n        var cancelPromise = function () { promise.cancel(); };\n        var cancelTimeout = function () { timeout.cancel(); };\n        timeout.then(cancelPromise);\n        promise.then(cancelTimeout, cancelTimeout);\n        return promise;\n    }\n\n    var staticCanceledPromise;\n\n    var Promise = _Base.Class.derive(PromiseStateMachine,\n        function Promise_ctor(init, oncancel) {\n            /// <signature helpKeyword=\"WinJS.Promise\">\n            /// <summary locid=\"WinJS.Promise\">\n            /// A promise provides a mechanism to schedule work to be done on a value that\n            /// has not yet been computed. It is a convenient abstraction for managing\n            /// interactions with asynchronous APIs.\n            /// </summary>\n            /// <param name=\"init\" type=\"Function\" locid=\"WinJS.Promise_p:init\">\n            /// The function that is called during construction of the  promise. The function\n            /// is given three arguments (complete, error, progress). Inside this function\n            /// you should add event listeners for the notifications supported by this value.\n            /// </param>\n            /// <param name=\"oncancel\" optional=\"true\" locid=\"WinJS.Promise_p:oncancel\">\n            /// The function to call if a consumer of this promise wants\n            /// to cancel its undone work. Promises are not required to\n            /// support cancellation.\n            /// </param>\n            /// </signature>\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.promise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._oncancel = oncancel;\n            this._setState(state_created);\n            this._run();\n\n            try {\n                var complete = this._completed.bind(this);\n                var error = this._error.bind(this);\n                var progress = this._progress.bind(this);\n                init(complete, error, progress);\n            } catch (ex) {\n                this._setExceptionValue(ex);\n            }\n        }, {\n            _oncancel: null,\n\n            _cancelAction: function () {\n                // BEGIN monaco change\n                try {\n                    if (this._oncancel) {\n                        this._oncancel();\n                    } else {\n                        throw new Error('Promise did not implement oncancel');\n                    }\n                } catch (ex) {\n                    // Access fields to get them created\n                    var msg = ex.message;\n                    var stack = ex.stack;\n                    promiseEventListeners.dispatchEvent('error', ex);\n                }\n                // END monaco change\n            },\n            _cleanupAction: function () { this._oncancel = null; }\n        }, {\n\n            addEventListener: function Promise_addEventListener(eventType, listener, capture) {\n                /// <signature helpKeyword=\"WinJS.Promise.addEventListener\">\n                /// <summary locid=\"WinJS.Promise.addEventListener\">\n                /// Adds an event listener to the control.\n                /// </summary>\n                /// <param name=\"eventType\" locid=\"WinJS.Promise.addEventListener_p:eventType\">\n                /// The type (name) of the event.\n                /// </param>\n                /// <param name=\"listener\" locid=\"WinJS.Promise.addEventListener_p:listener\">\n                /// The listener to invoke when the event is raised.\n                /// </param>\n                /// <param name=\"capture\" locid=\"WinJS.Promise.addEventListener_p:capture\">\n                /// Specifies whether or not to initiate capture.\n                /// </param>\n                /// </signature>\n                promiseEventListeners.addEventListener(eventType, listener, capture);\n            },\n            any: function Promise_any(values) {\n                /// <signature helpKeyword=\"WinJS.Promise.any\">\n                /// <summary locid=\"WinJS.Promise.any\">\n                /// Returns a promise that is fulfilled when one of the input promises\n                /// has been fulfilled.\n                /// </summary>\n                /// <param name=\"values\" type=\"Array\" locid=\"WinJS.Promise.any_p:values\">\n                /// An array that contains promise objects or objects whose property\n                /// values include promise objects.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.any_returnValue\">\n                /// A promise that on fulfillment yields the value of the input (complete or error).\n                /// </returns>\n                /// </signature>\n                return new Promise(\n                    function (complete, error) {\n                        var keys = Object.keys(values);\n                        if (keys.length === 0) {\n                            complete();\n                        }\n                        var canceled = 0;\n                        keys.forEach(function (key) {\n                            Promise.as(values[key]).then(\n                                function () { complete({ key: key, value: values[key] }); },\n                                function (e) {\n                                    if (e instanceof Error && e.name === canceledName) {\n                                        if ((++canceled) === keys.length) {\n                                            complete(Promise.cancel);\n                                        }\n                                        return;\n                                    }\n                                    error({ key: key, value: values[key] });\n                                }\n                            );\n                        });\n                    },\n                    function () {\n                        var keys = Object.keys(values);\n                        keys.forEach(function (key) {\n                            var promise = Promise.as(values[key]);\n                            if (typeof promise.cancel === \"function\") {\n                                promise.cancel();\n                            }\n                        });\n                    }\n                );\n            },\n            as: function Promise_as(value) {\n                /// <signature helpKeyword=\"WinJS.Promise.as\">\n                /// <summary locid=\"WinJS.Promise.as\">\n                /// Returns a promise. If the object is already a promise it is returned;\n                /// otherwise the object is wrapped in a promise.\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.as_p:value\">\n                /// The value to be treated as a promise.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.as_returnValue\">\n                /// A promise.\n                /// </returns>\n                /// </signature>\n                if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n                    return value;\n                }\n                return new CompletePromise(value);\n            },\n            /// <field type=\"WinJS.Promise\" helpKeyword=\"WinJS.Promise.cancel\" locid=\"WinJS.Promise.cancel\">\n            /// Canceled promise value, can be returned from a promise completion handler\n            /// to indicate cancelation of the promise chain.\n            /// </field>\n            cancel: {\n                get: function () {\n                    return (staticCanceledPromise = staticCanceledPromise || new ErrorPromise(new _ErrorFromName(canceledName)));\n                }\n            },\n            dispatchEvent: function Promise_dispatchEvent(eventType, details) {\n                /// <signature helpKeyword=\"WinJS.Promise.dispatchEvent\">\n                /// <summary locid=\"WinJS.Promise.dispatchEvent\">\n                /// Raises an event of the specified type and properties.\n                /// </summary>\n                /// <param name=\"eventType\" locid=\"WinJS.Promise.dispatchEvent_p:eventType\">\n                /// The type (name) of the event.\n                /// </param>\n                /// <param name=\"details\" locid=\"WinJS.Promise.dispatchEvent_p:details\">\n                /// The set of additional properties to be attached to the event object.\n                /// </param>\n                /// <returns type=\"Boolean\" locid=\"WinJS.Promise.dispatchEvent_returnValue\">\n                /// Specifies whether preventDefault was called on the event.\n                /// </returns>\n                /// </signature>\n                return promiseEventListeners.dispatchEvent(eventType, details);\n            },\n            is: function Promise_is(value) {\n                /// <signature helpKeyword=\"WinJS.Promise.is\">\n                /// <summary locid=\"WinJS.Promise.is\">\n                /// Determines whether a value fulfills the promise contract.\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.is_p:value\">\n                /// A value that may be a promise.\n                /// </param>\n                /// <returns type=\"Boolean\" locid=\"WinJS.Promise.is_returnValue\">\n                /// true if the specified value is a promise, otherwise false.\n                /// </returns>\n                /// </signature>\n                return value && typeof value === \"object\" && typeof value.then === \"function\";\n            },\n            join: function Promise_join(values) {\n                /// <signature helpKeyword=\"WinJS.Promise.join\">\n                /// <summary locid=\"WinJS.Promise.join\">\n                /// Creates a promise that is fulfilled when all the values are fulfilled.\n                /// </summary>\n                /// <param name=\"values\" type=\"Object\" locid=\"WinJS.Promise.join_p:values\">\n                /// An object whose fields contain values, some of which may be promises.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.join_returnValue\">\n                /// A promise whose value is an object with the same field names as those of the object in the values parameter, where\n                /// each field value is the fulfilled value of a promise.\n                /// </returns>\n                /// </signature>\n                return new Promise(\n                    function (complete, error, progress) {\n                        var keys = Object.keys(values);\n                        var errors = Array.isArray(values) ? [] : {};\n                        var results = Array.isArray(values) ? [] : {};\n                        var undefineds = 0;\n                        var pending = keys.length;\n                        var argDone = function (key) {\n                            if ((--pending) === 0) {\n                                var errorCount = Object.keys(errors).length;\n                                if (errorCount === 0) {\n                                    complete(results);\n                                } else {\n                                    var canceledCount = 0;\n                                    keys.forEach(function (key) {\n                                        var e = errors[key];\n                                        if (e instanceof Error && e.name === canceledName) {\n                                            canceledCount++;\n                                        }\n                                    });\n                                    if (canceledCount === errorCount) {\n                                        complete(Promise.cancel);\n                                    } else {\n                                        error(errors);\n                                    }\n                                }\n                            } else {\n                                progress({ Key: key, Done: true });\n                            }\n                        };\n                        keys.forEach(function (key) {\n                            var value = values[key];\n                            if (value === undefined) {\n                                undefineds++;\n                            } else {\n                                Promise.then(value,\n                                    function (value) { results[key] = value; argDone(key); },\n                                    function (value) { errors[key] = value; argDone(key); }\n                                );\n                            }\n                        });\n                        pending -= undefineds;\n                        if (pending === 0) {\n                            complete(results);\n                            return;\n                        }\n                    },\n                    function () {\n                        Object.keys(values).forEach(function (key) {\n                            var promise = Promise.as(values[key]);\n                            if (typeof promise.cancel === \"function\") {\n                                promise.cancel();\n                            }\n                        });\n                    }\n                );\n            },\n            removeEventListener: function Promise_removeEventListener(eventType, listener, capture) {\n                /// <signature helpKeyword=\"WinJS.Promise.removeEventListener\">\n                /// <summary locid=\"WinJS.Promise.removeEventListener\">\n                /// Removes an event listener from the control.\n                /// </summary>\n                /// <param name='eventType' locid=\"WinJS.Promise.removeEventListener_eventType\">\n                /// The type (name) of the event.\n                /// </param>\n                /// <param name='listener' locid=\"WinJS.Promise.removeEventListener_listener\">\n                /// The listener to remove.\n                /// </param>\n                /// <param name='capture' locid=\"WinJS.Promise.removeEventListener_capture\">\n                /// Specifies whether or not to initiate capture.\n                /// </param>\n                /// </signature>\n                promiseEventListeners.removeEventListener(eventType, listener, capture);\n            },\n            supportedForProcessing: false,\n            then: function Promise_then(value, onComplete, onError, onProgress) {\n                /// <signature helpKeyword=\"WinJS.Promise.then\">\n                /// <summary locid=\"WinJS.Promise.then\">\n                /// A static version of the promise instance method then().\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.then_p:value\">\n                /// the value to be treated as a promise.\n                /// </param>\n                /// <param name=\"onComplete\" type=\"Function\" locid=\"WinJS.Promise.then_p:complete\">\n                /// The function to be called if the promise is fulfilled with a value.\n                /// If it is null, the promise simply\n                /// returns the value. The value is passed as the single argument.\n                /// </param>\n                /// <param name=\"onError\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.then_p:error\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument.\n                /// </param>\n                /// <param name=\"onProgress\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.then_p:progress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.then_returnValue\">\n                /// A promise whose value is the result of executing the provided complete function.\n                /// </returns>\n                /// </signature>\n                return Promise.as(value).then(onComplete, onError, onProgress);\n            },\n            thenEach: function Promise_thenEach(values, onComplete, onError, onProgress) {\n                /// <signature helpKeyword=\"WinJS.Promise.thenEach\">\n                /// <summary locid=\"WinJS.Promise.thenEach\">\n                /// Performs an operation on all the input promises and returns a promise\n                /// that has the shape of the input and contains the result of the operation\n                /// that has been performed on each input.\n                /// </summary>\n                /// <param name=\"values\" locid=\"WinJS.Promise.thenEach_p:values\">\n                /// A set of values (which could be either an array or an object) of which some or all are promises.\n                /// </param>\n                /// <param name=\"onComplete\" type=\"Function\" locid=\"WinJS.Promise.thenEach_p:complete\">\n                /// The function to be called if the promise is fulfilled with a value.\n                /// If the value is null, the promise returns the value.\n                /// The value is passed as the single argument.\n                /// </param>\n                /// <param name=\"onError\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.thenEach_p:error\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument.\n                /// </param>\n                /// <param name=\"onProgress\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.thenEach_p:progress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.thenEach_returnValue\">\n                /// A promise that is the result of calling Promise.join on the values parameter.\n                /// </returns>\n                /// </signature>\n                var result = Array.isArray(values) ? [] : {};\n                Object.keys(values).forEach(function (key) {\n                    result[key] = Promise.as(values[key]).then(onComplete, onError, onProgress);\n                });\n                return Promise.join(result);\n            },\n            timeout: function Promise_timeout(time, promise) {\n                /// <signature helpKeyword=\"WinJS.Promise.timeout\">\n                /// <summary locid=\"WinJS.Promise.timeout\">\n                /// Creates a promise that is fulfilled after a timeout.\n                /// </summary>\n                /// <param name=\"timeout\" type=\"Number\" optional=\"true\" locid=\"WinJS.Promise.timeout_p:timeout\">\n                /// The timeout period in milliseconds. If this value is zero or not specified\n                /// setImmediate is called, otherwise setTimeout is called.\n                /// </param>\n                /// <param name=\"promise\" type=\"Promise\" optional=\"true\" locid=\"WinJS.Promise.timeout_p:promise\">\n                /// A promise that will be canceled if it doesn't complete before the\n                /// timeout has expired.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.timeout_returnValue\">\n                /// A promise that is completed asynchronously after the specified timeout.\n                /// </returns>\n                /// </signature>\n                var to = timeout(time);\n                return promise ? timeoutWithPromise(to, promise) : to;\n            },\n            wrap: function Promise_wrap(value) {\n                /// <signature helpKeyword=\"WinJS.Promise.wrap\">\n                /// <summary locid=\"WinJS.Promise.wrap\">\n                /// Wraps a non-promise value in a promise. You can use this function if you need\n                /// to pass a value to a function that requires a promise.\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.wrap_p:value\">\n                /// Some non-promise value to be wrapped in a promise.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.wrap_returnValue\">\n                /// A promise that is successfully fulfilled with the specified value\n                /// </returns>\n                /// </signature>\n                return new CompletePromise(value);\n            },\n            wrapError: function Promise_wrapError(error) {\n                /// <signature helpKeyword=\"WinJS.Promise.wrapError\">\n                /// <summary locid=\"WinJS.Promise.wrapError\">\n                /// Wraps a non-promise error value in a promise. You can use this function if you need\n                /// to pass an error to a function that requires a promise.\n                /// </summary>\n                /// <param name=\"error\" locid=\"WinJS.Promise.wrapError_p:error\">\n                /// A non-promise error value to be wrapped in a promise.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.wrapError_returnValue\">\n                /// A promise that is in an error state with the specified value.\n                /// </returns>\n                /// </signature>\n                return new ErrorPromise(error);\n            },\n\n            _veryExpensiveTagWithStack: {\n                get: function () { return tagWithStack; },\n                set: function (value) { tagWithStack = value; }\n            },\n            _veryExpensiveTagWithStack_tag: tag,\n            _getStack: function () {\n                if (_Global.Debug && _Global.Debug.debuggerEnabled) {\n                    try { throw new Error(); } catch (e) { return e.stack; }\n                }\n            },\n\n            _cancelBlocker: function Promise__cancelBlocker(input, oncancel) {\n                //\n                // Returns a promise which on cancelation will still result in downstream cancelation while\n                //  protecting the promise 'input' from being  canceled which has the effect of allowing\n                //  'input' to be shared amoung various consumers.\n                //\n                if (!Promise.is(input)) {\n                    return Promise.wrap(input);\n                }\n                var complete;\n                var error;\n                var output = new Promise(\n                    function (c, e) {\n                        complete = c;\n                        error = e;\n                    },\n                    function () {\n                        complete = null;\n                        error = null;\n                        oncancel && oncancel();\n                    }\n                );\n                input.then(\n                    function (v) { complete && complete(v); },\n                    function (e) { error && error(e); }\n                );\n                return output;\n            },\n\n        }\n    );\n    Object.defineProperties(Promise, _Events.createEventProperties(errorET));\n\n    Promise._doneHandler = function (value) {\n        _BaseCoreUtils._setImmediate(function Promise_done_rethrow() {\n            throw value;\n        });\n    };\n\n    return {\n        PromiseStateMachine: PromiseStateMachine,\n        Promise: Promise,\n        state_created: state_created\n    };\n});\n\n_winjs(\"WinJS/Promise\", [\"WinJS/Core/_Base\",\"WinJS/Promise/_StateMachine\"], function promiseInit( _Base, _StateMachine) {\n    \"use strict\";\n\n    _Base.Namespace.define(\"WinJS\", {\n        Promise: _StateMachine.Promise\n    });\n\n    return _StateMachine.Promise;\n});\n\nvar exported = _modules[\"WinJS/Core/_WinJS\"];\n\nif (typeof exports === 'undefined' && typeof define === 'function' && define.amd) {\n    define(\"vs/base/common/winjs.base.raw\", exported);\n} else {\n    module.exports = exported;\n}\n\nif (typeof process !== 'undefined' && typeof process.nextTick === 'function') {\n    _modules[\"WinJS/Core/_BaseCoreUtils\"]._setImmediate = function(handler) {\n        return process.nextTick(handler);\n    };\n}\n\n})();\ndefine(__m[91], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.MessageType = {\n        INITIALIZE: '$initialize',\n        REPLY: '$reply',\n        PRINT: '$print'\n    };\n    exports.ReplyType = {\n        COMPLETE: 'complete',\n        ERROR: 'error',\n        PROGRESS: 'progress'\n    };\n    exports.PrintType = {\n        LOG: 'log',\n        DEBUG: 'debug',\n        INFO: 'info',\n        WARN: 'warn',\n        ERROR: 'error'\n    };\n});\n\ndefine(__m[30], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var Arrays;\n    (function (Arrays) {\n        /**\n         * Given a sorted array of natural number segments, find the segment containing a natural number.\n         *    For example, the segments [0, 5), [5, 9), [9, infinity) will be represented in the following manner:\n         *       [{ startIndex: 0 }, { startIndex: 5 }, { startIndex: 9 }]\n         *    Searching for 0, 1, 2, 3 or 4 will return 0.\n         *    Searching for 5, 6, 7 or 8 will return 1.\n         *    Searching for 9, 10, 11, ... will return 2.\n         * @param arr A sorted array representing natural number segments\n         * @param desiredIndex The search\n         * @return The index of the containing segment in the array.\n         */\n        function findIndexInSegmentsArray(arr, desiredIndex) {\n            var low = 0;\n            var high = arr.length - 1;\n            if (high <= 0) {\n                return 0;\n            }\n            while (low < high) {\n                var mid = low + Math.ceil((high - low) / 2);\n                if (arr[mid].startIndex > desiredIndex) {\n                    high = mid - 1;\n                }\n                else {\n                    low = mid;\n                }\n            }\n            return low;\n        }\n        Arrays.findIndexInSegmentsArray = findIndexInSegmentsArray;\n    })(Arrays = exports.Arrays || (exports.Arrays = {}));\n});\n\ndefine(__m[18], __M([1,0,30]), function (require, exports, arrays_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var ModeTransition = (function () {\n        function ModeTransition(startIndex, mode) {\n            this.startIndex = startIndex | 0;\n            this.mode = mode;\n            this.modeId = mode.getId();\n        }\n        ModeTransition.findIndexInSegmentsArray = function (arr, desiredIndex) {\n            return arrays_1.Arrays.findIndexInSegmentsArray(arr, desiredIndex);\n        };\n        ModeTransition.create = function (modeTransitions) {\n            var result = [];\n            for (var i = 0, len = modeTransitions.length; i < len; i++) {\n                var modeTransition = modeTransitions[i];\n                result.push(new ModeTransition(modeTransition.startIndex, modeTransition.mode));\n            }\n            return result;\n        };\n        return ModeTransition;\n    }());\n    exports.ModeTransition = ModeTransition;\n});\n\ndefine(__m[22], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * A position in the editor.\n     */\n    var Position = (function () {\n        function Position(lineNumber, column) {\n            this.lineNumber = lineNumber;\n            this.column = column;\n        }\n        /**\n         * Test if this position equals other position\n         */\n        Position.prototype.equals = function (other) {\n            return Position.equals(this, other);\n        };\n        /**\n         * Test if position `a` equals position `b`\n         */\n        Position.equals = function (a, b) {\n            if (!a && !b) {\n                return true;\n            }\n            return (!!a &&\n                !!b &&\n                a.lineNumber === b.lineNumber &&\n                a.column === b.column);\n        };\n        /**\n         * Test if this position is before other position.\n         * If the two positions are equal, the result will be false.\n         */\n        Position.prototype.isBefore = function (other) {\n            return Position.isBefore(this, other);\n        };\n        /**\n         * Test if position `a` is before position `b`.\n         * If the two positions are equal, the result will be false.\n         */\n        Position.isBefore = function (a, b) {\n            if (a.lineNumber < b.lineNumber) {\n                return true;\n            }\n            if (b.lineNumber < a.lineNumber) {\n                return false;\n            }\n            return a.column < b.column;\n        };\n        /**\n         * Test if this position is before other position.\n         * If the two positions are equal, the result will be true.\n         */\n        Position.prototype.isBeforeOrEqual = function (other) {\n            return Position.isBeforeOrEqual(this, other);\n        };\n        /**\n         * Test if position `a` is before position `b`.\n         * If the two positions are equal, the result will be true.\n         */\n        Position.isBeforeOrEqual = function (a, b) {\n            if (a.lineNumber < b.lineNumber) {\n                return true;\n            }\n            if (b.lineNumber < a.lineNumber) {\n                return false;\n            }\n            return a.column <= b.column;\n        };\n        /**\n         * Clone this position.\n         */\n        Position.prototype.clone = function () {\n            return new Position(this.lineNumber, this.column);\n        };\n        /**\n         * Convert to a human-readable representation.\n         */\n        Position.prototype.toString = function () {\n            return '(' + this.lineNumber + ',' + this.column + ')';\n        };\n        // ---\n        /**\n         * Create a `Position` from an `IPosition`.\n         */\n        Position.lift = function (pos) {\n            return new Position(pos.lineNumber, pos.column);\n        };\n        /**\n         * Test if `obj` is an `IPosition`.\n         */\n        Position.isIPosition = function (obj) {\n            return (obj\n                && (typeof obj.lineNumber === 'number')\n                && (typeof obj.column === 'number'));\n        };\n        return Position;\n    }());\n    exports.Position = Position;\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[29], __M([1,0,22]), function (require, exports, position_1) {\n    'use strict';\n    /**\n     * A range in the editor. (startLineNumber,startColumn) is <= (endLineNumber,endColumn)\n     */\n    var Range = (function () {\n        function Range(startLineNumber, startColumn, endLineNumber, endColumn) {\n            if ((startLineNumber > endLineNumber) || (startLineNumber === endLineNumber && startColumn > endColumn)) {\n                this.startLineNumber = endLineNumber;\n                this.startColumn = endColumn;\n                this.endLineNumber = startLineNumber;\n                this.endColumn = startColumn;\n            }\n            else {\n                this.startLineNumber = startLineNumber;\n                this.startColumn = startColumn;\n                this.endLineNumber = endLineNumber;\n                this.endColumn = endColumn;\n            }\n        }\n        /**\n         * Test if this range is empty.\n         */\n        Range.prototype.isEmpty = function () {\n            return Range.isEmpty(this);\n        };\n        /**\n         * Test if `range` is empty.\n         */\n        Range.isEmpty = function (range) {\n            return (range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn);\n        };\n        /**\n         * Test if position is in this range. If the position is at the edges, will return true.\n         */\n        Range.prototype.containsPosition = function (position) {\n            return Range.containsPosition(this, position);\n        };\n        /**\n         * Test if `position` is in `range`. If the position is at the edges, will return true.\n         */\n        Range.containsPosition = function (range, position) {\n            if (position.lineNumber < range.startLineNumber || position.lineNumber > range.endLineNumber) {\n                return false;\n            }\n            if (position.lineNumber === range.startLineNumber && position.column < range.startColumn) {\n                return false;\n            }\n            if (position.lineNumber === range.endLineNumber && position.column > range.endColumn) {\n                return false;\n            }\n            return true;\n        };\n        /**\n         * Test if range is in this range. If the range is equal to this range, will return true.\n         */\n        Range.prototype.containsRange = function (range) {\n            return Range.containsRange(this, range);\n        };\n        /**\n         * Test if `otherRange` is in `range`. If the ranges are equal, will return true.\n         */\n        Range.containsRange = function (range, otherRange) {\n            if (otherRange.startLineNumber < range.startLineNumber || otherRange.endLineNumber < range.startLineNumber) {\n                return false;\n            }\n            if (otherRange.startLineNumber > range.endLineNumber || otherRange.endLineNumber > range.endLineNumber) {\n                return false;\n            }\n            if (otherRange.startLineNumber === range.startLineNumber && otherRange.startColumn < range.startColumn) {\n                return false;\n            }\n            if (otherRange.endLineNumber === range.endLineNumber && otherRange.endColumn > range.endColumn) {\n                return false;\n            }\n            return true;\n        };\n        /**\n         * A reunion of the two ranges.\n         * The smallest position will be used as the start point, and the largest one as the end point.\n         */\n        Range.prototype.plusRange = function (range) {\n            return Range.plusRange(this, range);\n        };\n        /**\n         * A reunion of the two ranges.\n         * The smallest position will be used as the start point, and the largest one as the end point.\n         */\n        Range.plusRange = function (a, b) {\n            var startLineNumber, startColumn, endLineNumber, endColumn;\n            if (b.startLineNumber < a.startLineNumber) {\n                startLineNumber = b.startLineNumber;\n                startColumn = b.startColumn;\n            }\n            else if (b.startLineNumber === a.startLineNumber) {\n                startLineNumber = b.startLineNumber;\n                startColumn = Math.min(b.startColumn, a.startColumn);\n            }\n            else {\n                startLineNumber = a.startLineNumber;\n                startColumn = a.startColumn;\n            }\n            if (b.endLineNumber > a.endLineNumber) {\n                endLineNumber = b.endLineNumber;\n                endColumn = b.endColumn;\n            }\n            else if (b.endLineNumber === a.endLineNumber) {\n                endLineNumber = b.endLineNumber;\n                endColumn = Math.max(b.endColumn, a.endColumn);\n            }\n            else {\n                endLineNumber = a.endLineNumber;\n                endColumn = a.endColumn;\n            }\n            return new Range(startLineNumber, startColumn, endLineNumber, endColumn);\n        };\n        /**\n         * A intersection of the two ranges.\n         */\n        Range.prototype.intersectRanges = function (range) {\n            return Range.intersectRanges(this, range);\n        };\n        /**\n         * A intersection of the two ranges.\n         */\n        Range.intersectRanges = function (a, b) {\n            var resultStartLineNumber = a.startLineNumber, resultStartColumn = a.startColumn, resultEndLineNumber = a.endLineNumber, resultEndColumn = a.endColumn, otherStartLineNumber = b.startLineNumber, otherStartColumn = b.startColumn, otherEndLineNumber = b.endLineNumber, otherEndColumn = b.endColumn;\n            if (resultStartLineNumber < otherStartLineNumber) {\n                resultStartLineNumber = otherStartLineNumber;\n                resultStartColumn = otherStartColumn;\n            }\n            else if (resultStartLineNumber === otherStartLineNumber) {\n                resultStartColumn = Math.max(resultStartColumn, otherStartColumn);\n            }\n            if (resultEndLineNumber > otherEndLineNumber) {\n                resultEndLineNumber = otherEndLineNumber;\n                resultEndColumn = otherEndColumn;\n            }\n            else if (resultEndLineNumber === otherEndLineNumber) {\n                resultEndColumn = Math.min(resultEndColumn, otherEndColumn);\n            }\n            // Check if selection is now empty\n            if (resultStartLineNumber > resultEndLineNumber) {\n                return null;\n            }\n            if (resultStartLineNumber === resultEndLineNumber && resultStartColumn > resultEndColumn) {\n                return null;\n            }\n            return new Range(resultStartLineNumber, resultStartColumn, resultEndLineNumber, resultEndColumn);\n        };\n        /**\n         * Test if this range equals other.\n         */\n        Range.prototype.equalsRange = function (other) {\n            return Range.equalsRange(this, other);\n        };\n        /**\n         * Test if range `a` equals `b`.\n         */\n        Range.equalsRange = function (a, b) {\n            return (!!a &&\n                !!b &&\n                a.startLineNumber === b.startLineNumber &&\n                a.startColumn === b.startColumn &&\n                a.endLineNumber === b.endLineNumber &&\n                a.endColumn === b.endColumn);\n        };\n        /**\n         * Return the end position (which will be after or equal to the start position)\n         */\n        Range.prototype.getEndPosition = function () {\n            return new position_1.Position(this.endLineNumber, this.endColumn);\n        };\n        /**\n         * Return the start position (which will be before or equal to the end position)\n         */\n        Range.prototype.getStartPosition = function () {\n            return new position_1.Position(this.startLineNumber, this.startColumn);\n        };\n        /**\n         * Clone this range.\n         */\n        Range.prototype.cloneRange = function () {\n            return new Range(this.startLineNumber, this.startColumn, this.endLineNumber, this.endColumn);\n        };\n        /**\n         * Transform to a user presentable string representation.\n         */\n        Range.prototype.toString = function () {\n            return '[' + this.startLineNumber + ',' + this.startColumn + ' -> ' + this.endLineNumber + ',' + this.endColumn + ']';\n        };\n        /**\n         * Create a new range using this range's start position, and using endLineNumber and endColumn as the end position.\n         */\n        Range.prototype.setEndPosition = function (endLineNumber, endColumn) {\n            return new Range(this.startLineNumber, this.startColumn, endLineNumber, endColumn);\n        };\n        /**\n         * Create a new range using this range's end position, and using startLineNumber and startColumn as the start position.\n         */\n        Range.prototype.setStartPosition = function (startLineNumber, startColumn) {\n            return new Range(startLineNumber, startColumn, this.endLineNumber, this.endColumn);\n        };\n        /**\n         * Create a new empty range using this range's start position.\n         */\n        Range.prototype.collapseToStart = function () {\n            return Range.collapseToStart(this);\n        };\n        /**\n         * Create a new empty range using this range's start position.\n         */\n        Range.collapseToStart = function (range) {\n            return new Range(range.startLineNumber, range.startColumn, range.startLineNumber, range.startColumn);\n        };\n        // ---\n        /**\n         * Create a `Range` from an `IRange`.\n         */\n        Range.lift = function (range) {\n            if (!range) {\n                return null;\n            }\n            return new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n        };\n        /**\n         * Test if `obj` is an `IRange`.\n         */\n        Range.isIRange = function (obj) {\n            return (obj\n                && (typeof obj.startLineNumber === 'number')\n                && (typeof obj.startColumn === 'number')\n                && (typeof obj.endLineNumber === 'number')\n                && (typeof obj.endColumn === 'number'));\n        };\n        /**\n         * Test if the two ranges are touching in any way.\n         */\n        Range.areIntersectingOrTouching = function (a, b) {\n            // Check if `a` is before `b`\n            if (a.endLineNumber < b.startLineNumber || (a.endLineNumber === b.startLineNumber && a.endColumn < b.startColumn)) {\n                return false;\n            }\n            // Check if `b` is before `a`\n            if (b.endLineNumber < a.startLineNumber || (b.endLineNumber === a.startLineNumber && b.endColumn < a.startColumn)) {\n                return false;\n            }\n            // These ranges must intersect\n            return true;\n        };\n        /**\n         * A function that compares ranges, useful for sorting ranges\n         * It will first compare ranges on the startPosition and then on the endPosition\n         */\n        Range.compareRangesUsingStarts = function (a, b) {\n            var aStartLineNumber = a.startLineNumber | 0;\n            var bStartLineNumber = b.startLineNumber | 0;\n            var aStartColumn = a.startColumn | 0;\n            var bStartColumn = b.startColumn | 0;\n            var aEndLineNumber = a.endLineNumber | 0;\n            var bEndLineNumber = b.endLineNumber | 0;\n            var aEndColumn = a.endColumn | 0;\n            var bEndColumn = b.endColumn | 0;\n            if (aStartLineNumber === bStartLineNumber) {\n                if (aStartColumn === bStartColumn) {\n                    if (aEndLineNumber === bEndLineNumber) {\n                        return aEndColumn - bEndColumn;\n                    }\n                    return aEndLineNumber - bEndLineNumber;\n                }\n                return aStartColumn - bStartColumn;\n            }\n            return aStartLineNumber - bStartLineNumber;\n        };\n        /**\n         * A function that compares ranges, useful for sorting ranges\n         * It will first compare ranges on the endPosition and then on the startPosition\n         */\n        Range.compareRangesUsingEnds = function (a, b) {\n            if (a.endLineNumber === b.endLineNumber) {\n                if (a.endColumn === b.endColumn) {\n                    if (a.startLineNumber === b.startLineNumber) {\n                        return a.startColumn - b.startColumn;\n                    }\n                    return a.startLineNumber - b.startLineNumber;\n                }\n                return a.endColumn - b.endColumn;\n            }\n            return a.endLineNumber - b.endLineNumber;\n        };\n        /**\n         * Test if the range spans multiple lines.\n         */\n        Range.spansMultipleLines = function (range) {\n            return range.endLineNumber > range.startLineNumber;\n        };\n        return Range;\n    }());\n    exports.Range = Range;\n});\n\ndefine(__m[50], __M([1,0,30]), function (require, exports, arrays_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * A token on a line.\n     */\n    var ViewLineToken = (function () {\n        function ViewLineToken(startIndex, type) {\n            this.startIndex = startIndex | 0; // @perf\n            this.type = type.replace(/[^a-z0-9\\-]/gi, ' ');\n        }\n        ViewLineToken.prototype.equals = function (other) {\n            return (this.startIndex === other.startIndex\n                && this.type === other.type);\n        };\n        ViewLineToken.findIndexInSegmentsArray = function (arr, desiredIndex) {\n            return arrays_1.Arrays.findIndexInSegmentsArray(arr, desiredIndex);\n        };\n        ViewLineToken.equalsArray = function (a, b) {\n            var aLen = a.length;\n            var bLen = b.length;\n            if (aLen !== bLen) {\n                return false;\n            }\n            for (var i = 0; i < aLen; i++) {\n                if (!a[i].equals(b[i])) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        return ViewLineToken;\n    }());\n    exports.ViewLineToken = ViewLineToken;\n    var ViewLineTokens = (function () {\n        function ViewLineTokens(lineTokens, fauxIndentLength, textLength) {\n            this._lineTokens = lineTokens;\n            this._fauxIndentLength = fauxIndentLength | 0;\n            this._textLength = textLength | 0;\n        }\n        ViewLineTokens.prototype.getTokens = function () {\n            return this._lineTokens;\n        };\n        ViewLineTokens.prototype.getFauxIndentLength = function () {\n            return this._fauxIndentLength;\n        };\n        ViewLineTokens.prototype.getTextLength = function () {\n            return this._textLength;\n        };\n        ViewLineTokens.prototype.equals = function (other) {\n            return (this._fauxIndentLength === other._fauxIndentLength\n                && this._textLength === other._textLength\n                && ViewLineToken.equalsArray(this._lineTokens, other._lineTokens));\n        };\n        ViewLineTokens.prototype.findIndexOfOffset = function (offset) {\n            return ViewLineToken.findIndexInSegmentsArray(this._lineTokens, offset);\n        };\n        return ViewLineTokens;\n    }());\n    exports.ViewLineTokens = ViewLineTokens;\n});\n\n\n\n\n\n\ndefine(__m[19], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * Describes how to indent wrapped lines.\n     */\n    (function (WrappingIndent) {\n        /**\n         * No indentation => wrapped lines begin at column 1.\n         */\n        WrappingIndent[WrappingIndent[\"None\"] = 0] = \"None\";\n        /**\n         * Same => wrapped lines get the same indentation as the parent.\n         */\n        WrappingIndent[WrappingIndent[\"Same\"] = 1] = \"Same\";\n        /**\n         * Indent => wrapped lines get +1 indentation as the parent.\n         */\n        WrappingIndent[WrappingIndent[\"Indent\"] = 2] = \"Indent\";\n    })(exports.WrappingIndent || (exports.WrappingIndent = {}));\n    var WrappingIndent = exports.WrappingIndent;\n    var InternalEditorScrollbarOptions = (function () {\n        /**\n         * @internal\n         */\n        function InternalEditorScrollbarOptions(source) {\n            this.arrowSize = source.arrowSize | 0;\n            this.vertical = source.vertical | 0;\n            this.horizontal = source.horizontal | 0;\n            this.useShadows = Boolean(source.useShadows);\n            this.verticalHasArrows = Boolean(source.verticalHasArrows);\n            this.horizontalHasArrows = Boolean(source.horizontalHasArrows);\n            this.handleMouseWheel = Boolean(source.handleMouseWheel);\n            this.horizontalScrollbarSize = source.horizontalScrollbarSize | 0;\n            this.horizontalSliderSize = source.horizontalSliderSize | 0;\n            this.verticalScrollbarSize = source.verticalScrollbarSize | 0;\n            this.verticalSliderSize = source.verticalSliderSize | 0;\n            this.mouseWheelScrollSensitivity = Number(source.mouseWheelScrollSensitivity);\n        }\n        /**\n         * @internal\n         */\n        InternalEditorScrollbarOptions.prototype.equals = function (other) {\n            return (this.arrowSize === other.arrowSize\n                && this.vertical === other.vertical\n                && this.horizontal === other.horizontal\n                && this.useShadows === other.useShadows\n                && this.verticalHasArrows === other.verticalHasArrows\n                && this.horizontalHasArrows === other.horizontalHasArrows\n                && this.handleMouseWheel === other.handleMouseWheel\n                && this.horizontalScrollbarSize === other.horizontalScrollbarSize\n                && this.horizontalSliderSize === other.horizontalSliderSize\n                && this.verticalScrollbarSize === other.verticalScrollbarSize\n                && this.verticalSliderSize === other.verticalSliderSize\n                && this.mouseWheelScrollSensitivity === other.mouseWheelScrollSensitivity);\n        };\n        /**\n         * @internal\n         */\n        InternalEditorScrollbarOptions.prototype.clone = function () {\n            return new InternalEditorScrollbarOptions(this);\n        };\n        return InternalEditorScrollbarOptions;\n    }());\n    exports.InternalEditorScrollbarOptions = InternalEditorScrollbarOptions;\n    var EditorWrappingInfo = (function () {\n        /**\n         * @internal\n         */\n        function EditorWrappingInfo(source) {\n            this.isViewportWrapping = Boolean(source.isViewportWrapping);\n            this.wrappingColumn = source.wrappingColumn | 0;\n            this.wrappingIndent = source.wrappingIndent | 0;\n            this.wordWrapBreakBeforeCharacters = String(source.wordWrapBreakBeforeCharacters);\n            this.wordWrapBreakAfterCharacters = String(source.wordWrapBreakAfterCharacters);\n            this.wordWrapBreakObtrusiveCharacters = String(source.wordWrapBreakObtrusiveCharacters);\n        }\n        /**\n         * @internal\n         */\n        EditorWrappingInfo.prototype.equals = function (other) {\n            return (this.isViewportWrapping === other.isViewportWrapping\n                && this.wrappingColumn === other.wrappingColumn\n                && this.wrappingIndent === other.wrappingIndent\n                && this.wordWrapBreakBeforeCharacters === other.wordWrapBreakBeforeCharacters\n                && this.wordWrapBreakAfterCharacters === other.wordWrapBreakAfterCharacters\n                && this.wordWrapBreakObtrusiveCharacters === other.wordWrapBreakObtrusiveCharacters);\n        };\n        /**\n         * @internal\n         */\n        EditorWrappingInfo.prototype.clone = function () {\n            return new EditorWrappingInfo(this);\n        };\n        return EditorWrappingInfo;\n    }());\n    exports.EditorWrappingInfo = EditorWrappingInfo;\n    var InternalEditorViewOptions = (function () {\n        /**\n         * @internal\n         */\n        function InternalEditorViewOptions(source) {\n            this.theme = String(source.theme);\n            this.canUseTranslate3d = Boolean(source.canUseTranslate3d);\n            this.experimentalScreenReader = Boolean(source.experimentalScreenReader);\n            this.rulers = InternalEditorViewOptions._toSortedIntegerArray(source.rulers);\n            this.ariaLabel = String(source.ariaLabel);\n            this.lineNumbers = source.lineNumbers;\n            this.selectOnLineNumbers = Boolean(source.selectOnLineNumbers);\n            this.glyphMargin = Boolean(source.glyphMargin);\n            this.revealHorizontalRightPadding = source.revealHorizontalRightPadding | 0;\n            this.roundedSelection = Boolean(source.roundedSelection);\n            this.overviewRulerLanes = source.overviewRulerLanes | 0;\n            this.cursorBlinking = String(source.cursorBlinking);\n            this.cursorStyle = source.cursorStyle | 0;\n            this.hideCursorInOverviewRuler = Boolean(source.hideCursorInOverviewRuler);\n            this.scrollBeyondLastLine = Boolean(source.scrollBeyondLastLine);\n            this.editorClassName = String(source.editorClassName);\n            this.stopRenderingLineAfter = source.stopRenderingLineAfter | 0;\n            this.renderWhitespace = Boolean(source.renderWhitespace);\n            this.indentGuides = Boolean(source.indentGuides);\n            this.scrollbar = source.scrollbar.clone();\n        }\n        InternalEditorViewOptions._toSortedIntegerArray = function (source) {\n            if (!Array.isArray(source)) {\n                return [];\n            }\n            var arrSource = source;\n            var result = arrSource.map(function (el) {\n                var r = parseInt(el, 10);\n                if (isNaN(r)) {\n                    return 0;\n                }\n                return r;\n            });\n            result.sort();\n            return result;\n        };\n        InternalEditorViewOptions._numberArraysEqual = function (a, b) {\n            if (a.length !== b.length) {\n                return false;\n            }\n            for (var i = 0; i < a.length; i++) {\n                if (a[i] !== b[i]) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        /**\n         * @internal\n         */\n        InternalEditorViewOptions.prototype.equals = function (other) {\n            return (this.theme === other.theme\n                && this.canUseTranslate3d === other.canUseTranslate3d\n                && this.experimentalScreenReader === other.experimentalScreenReader\n                && InternalEditorViewOptions._numberArraysEqual(this.rulers, other.rulers)\n                && this.ariaLabel === other.ariaLabel\n                && this.lineNumbers === other.lineNumbers\n                && this.selectOnLineNumbers === other.selectOnLineNumbers\n                && this.glyphMargin === other.glyphMargin\n                && this.revealHorizontalRightPadding === other.revealHorizontalRightPadding\n                && this.roundedSelection === other.roundedSelection\n                && this.overviewRulerLanes === other.overviewRulerLanes\n                && this.cursorBlinking === other.cursorBlinking\n                && this.cursorStyle === other.cursorStyle\n                && this.hideCursorInOverviewRuler === other.hideCursorInOverviewRuler\n                && this.scrollBeyondLastLine === other.scrollBeyondLastLine\n                && this.editorClassName === other.editorClassName\n                && this.stopRenderingLineAfter === other.stopRenderingLineAfter\n                && this.renderWhitespace === other.renderWhitespace\n                && this.indentGuides === other.indentGuides\n                && this.scrollbar.equals(other.scrollbar));\n        };\n        /**\n         * @internal\n         */\n        InternalEditorViewOptions.prototype.createChangeEvent = function (newOpts) {\n            return {\n                theme: this.theme !== newOpts.theme,\n                canUseTranslate3d: this.canUseTranslate3d !== newOpts.canUseTranslate3d,\n                experimentalScreenReader: this.experimentalScreenReader !== newOpts.experimentalScreenReader,\n                rulers: (!InternalEditorViewOptions._numberArraysEqual(this.rulers, newOpts.rulers)),\n                ariaLabel: this.ariaLabel !== newOpts.ariaLabel,\n                lineNumbers: this.lineNumbers !== newOpts.lineNumbers,\n                selectOnLineNumbers: this.selectOnLineNumbers !== newOpts.selectOnLineNumbers,\n                glyphMargin: this.glyphMargin !== newOpts.glyphMargin,\n                revealHorizontalRightPadding: this.revealHorizontalRightPadding !== newOpts.revealHorizontalRightPadding,\n                roundedSelection: this.roundedSelection !== newOpts.roundedSelection,\n                overviewRulerLanes: this.overviewRulerLanes !== newOpts.overviewRulerLanes,\n                cursorBlinking: this.cursorBlinking !== newOpts.cursorBlinking,\n                cursorStyle: this.cursorStyle !== newOpts.cursorStyle,\n                hideCursorInOverviewRuler: this.hideCursorInOverviewRuler !== newOpts.hideCursorInOverviewRuler,\n                scrollBeyondLastLine: this.scrollBeyondLastLine !== newOpts.scrollBeyondLastLine,\n                editorClassName: this.editorClassName !== newOpts.editorClassName,\n                stopRenderingLineAfter: this.stopRenderingLineAfter !== newOpts.stopRenderingLineAfter,\n                renderWhitespace: this.renderWhitespace !== newOpts.renderWhitespace,\n                indentGuides: this.indentGuides !== newOpts.indentGuides,\n                scrollbar: (!this.scrollbar.equals(newOpts.scrollbar)),\n            };\n        };\n        /**\n         * @internal\n         */\n        InternalEditorViewOptions.prototype.clone = function () {\n            return new InternalEditorViewOptions(this);\n        };\n        return InternalEditorViewOptions;\n    }());\n    exports.InternalEditorViewOptions = InternalEditorViewOptions;\n    var EditorContribOptions = (function () {\n        /**\n         * @internal\n         */\n        function EditorContribOptions(source) {\n            this.selectionClipboard = Boolean(source.selectionClipboard);\n            this.hover = Boolean(source.hover);\n            this.contextmenu = Boolean(source.contextmenu);\n            this.quickSuggestions = Boolean(source.quickSuggestions);\n            this.quickSuggestionsDelay = source.quickSuggestionsDelay || 0;\n            this.parameterHints = Boolean(source.parameterHints);\n            this.iconsInSuggestions = Boolean(source.iconsInSuggestions);\n            this.formatOnType = Boolean(source.formatOnType);\n            this.suggestOnTriggerCharacters = Boolean(source.suggestOnTriggerCharacters);\n            this.acceptSuggestionOnEnter = Boolean(source.acceptSuggestionOnEnter);\n            this.selectionHighlight = Boolean(source.selectionHighlight);\n            this.outlineMarkers = Boolean(source.outlineMarkers);\n            this.referenceInfos = Boolean(source.referenceInfos);\n            this.folding = Boolean(source.folding);\n        }\n        /**\n         * @internal\n         */\n        EditorContribOptions.prototype.equals = function (other) {\n            return (this.selectionClipboard === other.selectionClipboard\n                && this.hover === other.hover\n                && this.contextmenu === other.contextmenu\n                && this.quickSuggestions === other.quickSuggestions\n                && this.quickSuggestionsDelay === other.quickSuggestionsDelay\n                && this.parameterHints === other.parameterHints\n                && this.iconsInSuggestions === other.iconsInSuggestions\n                && this.formatOnType === other.formatOnType\n                && this.suggestOnTriggerCharacters === other.suggestOnTriggerCharacters\n                && this.acceptSuggestionOnEnter === other.acceptSuggestionOnEnter\n                && this.selectionHighlight === other.selectionHighlight\n                && this.outlineMarkers === other.outlineMarkers\n                && this.referenceInfos === other.referenceInfos\n                && this.folding === other.folding);\n        };\n        /**\n         * @internal\n         */\n        EditorContribOptions.prototype.clone = function () {\n            return new EditorContribOptions(this);\n        };\n        return EditorContribOptions;\n    }());\n    exports.EditorContribOptions = EditorContribOptions;\n    /**\n     * Internal configuration options (transformed or computed) for the editor.\n     */\n    var InternalEditorOptions = (function () {\n        /**\n         * @internal\n         */\n        function InternalEditorOptions(source) {\n            this.lineHeight = source.lineHeight | 0;\n            this.readOnly = Boolean(source.readOnly);\n            this.wordSeparators = String(source.wordSeparators);\n            this.autoClosingBrackets = Boolean(source.autoClosingBrackets);\n            this.useTabStops = Boolean(source.useTabStops);\n            this.tabFocusMode = Boolean(source.tabFocusMode);\n            this.layoutInfo = source.layoutInfo.clone();\n            this.fontInfo = source.fontInfo.clone();\n            this.viewInfo = source.viewInfo.clone();\n            this.wrappingInfo = source.wrappingInfo.clone();\n            this.contribInfo = source.contribInfo.clone();\n        }\n        /**\n         * @internal\n         */\n        InternalEditorOptions.prototype.equals = function (other) {\n            return (this.lineHeight === other.lineHeight\n                && this.readOnly === other.readOnly\n                && this.wordSeparators === other.wordSeparators\n                && this.autoClosingBrackets === other.autoClosingBrackets\n                && this.useTabStops === other.useTabStops\n                && this.tabFocusMode === other.tabFocusMode\n                && this.layoutInfo.equals(other.layoutInfo)\n                && this.fontInfo.equals(other.fontInfo)\n                && this.viewInfo.equals(other.viewInfo)\n                && this.wrappingInfo.equals(other.wrappingInfo)\n                && this.contribInfo.equals(other.contribInfo));\n        };\n        /**\n         * @internal\n         */\n        InternalEditorOptions.prototype.createChangeEvent = function (newOpts) {\n            return {\n                lineHeight: (this.lineHeight !== newOpts.lineHeight),\n                readOnly: (this.readOnly !== newOpts.readOnly),\n                wordSeparators: (this.wordSeparators !== newOpts.wordSeparators),\n                autoClosingBrackets: (this.autoClosingBrackets !== newOpts.autoClosingBrackets),\n                useTabStops: (this.useTabStops !== newOpts.useTabStops),\n                tabFocusMode: (this.tabFocusMode !== newOpts.tabFocusMode),\n                layoutInfo: (!this.layoutInfo.equals(newOpts.layoutInfo)),\n                fontInfo: (!this.fontInfo.equals(newOpts.fontInfo)),\n                viewInfo: this.viewInfo.createChangeEvent(newOpts.viewInfo),\n                wrappingInfo: (!this.wrappingInfo.equals(newOpts.wrappingInfo)),\n                contribInfo: (!this.contribInfo.equals(newOpts.contribInfo)),\n            };\n        };\n        /**\n         * @internal\n         */\n        InternalEditorOptions.prototype.clone = function () {\n            return new InternalEditorOptions(this);\n        };\n        return InternalEditorOptions;\n    }());\n    exports.InternalEditorOptions = InternalEditorOptions;\n    /**\n     * Vertical Lane in the overview ruler of the editor.\n     */\n    (function (OverviewRulerLane) {\n        OverviewRulerLane[OverviewRulerLane[\"Left\"] = 1] = \"Left\";\n        OverviewRulerLane[OverviewRulerLane[\"Center\"] = 2] = \"Center\";\n        OverviewRulerLane[OverviewRulerLane[\"Right\"] = 4] = \"Right\";\n        OverviewRulerLane[OverviewRulerLane[\"Full\"] = 7] = \"Full\";\n    })(exports.OverviewRulerLane || (exports.OverviewRulerLane = {}));\n    var OverviewRulerLane = exports.OverviewRulerLane;\n    /**\n     * End of line character preference.\n     */\n    (function (EndOfLinePreference) {\n        /**\n         * Use the end of line character identified in the text buffer.\n         */\n        EndOfLinePreference[EndOfLinePreference[\"TextDefined\"] = 0] = \"TextDefined\";\n        /**\n         * Use line feed (\\n) as the end of line character.\n         */\n        EndOfLinePreference[EndOfLinePreference[\"LF\"] = 1] = \"LF\";\n        /**\n         * Use carriage return and line feed (\\r\\n) as the end of line character.\n         */\n        EndOfLinePreference[EndOfLinePreference[\"CRLF\"] = 2] = \"CRLF\";\n    })(exports.EndOfLinePreference || (exports.EndOfLinePreference = {}));\n    var EndOfLinePreference = exports.EndOfLinePreference;\n    /**\n     * The default end of line to use when instantiating models.\n     */\n    (function (DefaultEndOfLine) {\n        /**\n         * Use line feed (\\n) as the end of line character.\n         */\n        DefaultEndOfLine[DefaultEndOfLine[\"LF\"] = 1] = \"LF\";\n        /**\n         * Use carriage return and line feed (\\r\\n) as the end of line character.\n         */\n        DefaultEndOfLine[DefaultEndOfLine[\"CRLF\"] = 2] = \"CRLF\";\n    })(exports.DefaultEndOfLine || (exports.DefaultEndOfLine = {}));\n    var DefaultEndOfLine = exports.DefaultEndOfLine;\n    /**\n     * End of line character preference.\n     */\n    (function (EndOfLineSequence) {\n        /**\n         * Use line feed (\\n) as the end of line character.\n         */\n        EndOfLineSequence[EndOfLineSequence[\"LF\"] = 0] = \"LF\";\n        /**\n         * Use carriage return and line feed (\\r\\n) as the end of line character.\n         */\n        EndOfLineSequence[EndOfLineSequence[\"CRLF\"] = 1] = \"CRLF\";\n    })(exports.EndOfLineSequence || (exports.EndOfLineSequence = {}));\n    var EndOfLineSequence = exports.EndOfLineSequence;\n    /**\n     * Describes the behaviour of decorations when typing/editing near their edges.\n     */\n    (function (TrackedRangeStickiness) {\n        TrackedRangeStickiness[TrackedRangeStickiness[\"AlwaysGrowsWhenTypingAtEdges\"] = 0] = \"AlwaysGrowsWhenTypingAtEdges\";\n        TrackedRangeStickiness[TrackedRangeStickiness[\"NeverGrowsWhenTypingAtEdges\"] = 1] = \"NeverGrowsWhenTypingAtEdges\";\n        TrackedRangeStickiness[TrackedRangeStickiness[\"GrowsOnlyWhenTypingBefore\"] = 2] = \"GrowsOnlyWhenTypingBefore\";\n        TrackedRangeStickiness[TrackedRangeStickiness[\"GrowsOnlyWhenTypingAfter\"] = 3] = \"GrowsOnlyWhenTypingAfter\";\n    })(exports.TrackedRangeStickiness || (exports.TrackedRangeStickiness = {}));\n    var TrackedRangeStickiness = exports.TrackedRangeStickiness;\n    /**\n     * Describes the reason the cursor has changed its position.\n     */\n    (function (CursorChangeReason) {\n        /**\n         * Unknown or not set.\n         */\n        CursorChangeReason[CursorChangeReason[\"NotSet\"] = 0] = \"NotSet\";\n        /**\n         * A `model.setValue()` was called.\n         */\n        CursorChangeReason[CursorChangeReason[\"ContentFlush\"] = 1] = \"ContentFlush\";\n        /**\n         * The `model` has been changed outside of this cursor and the cursor recovers its position from associated markers.\n         */\n        CursorChangeReason[CursorChangeReason[\"RecoverFromMarkers\"] = 2] = \"RecoverFromMarkers\";\n        /**\n         * There was an explicit user gesture.\n         */\n        CursorChangeReason[CursorChangeReason[\"Explicit\"] = 3] = \"Explicit\";\n        /**\n         * There was a Paste.\n         */\n        CursorChangeReason[CursorChangeReason[\"Paste\"] = 4] = \"Paste\";\n        /**\n         * There was an Undo.\n         */\n        CursorChangeReason[CursorChangeReason[\"Undo\"] = 5] = \"Undo\";\n        /**\n         * There was a Redo.\n         */\n        CursorChangeReason[CursorChangeReason[\"Redo\"] = 6] = \"Redo\";\n    })(exports.CursorChangeReason || (exports.CursorChangeReason = {}));\n    var CursorChangeReason = exports.CursorChangeReason;\n    /**\n     * @internal\n     */\n    (function (VerticalRevealType) {\n        VerticalRevealType[VerticalRevealType[\"Simple\"] = 0] = \"Simple\";\n        VerticalRevealType[VerticalRevealType[\"Center\"] = 1] = \"Center\";\n        VerticalRevealType[VerticalRevealType[\"CenterIfOutsideViewport\"] = 2] = \"CenterIfOutsideViewport\";\n    })(exports.VerticalRevealType || (exports.VerticalRevealType = {}));\n    var VerticalRevealType = exports.VerticalRevealType;\n    /**\n     * A description for the overview ruler position.\n     */\n    var OverviewRulerPosition = (function () {\n        /**\n         * @internal\n         */\n        function OverviewRulerPosition(source) {\n            this.width = source.width | 0;\n            this.height = source.height | 0;\n            this.top = source.top | 0;\n            this.right = source.right | 0;\n        }\n        /**\n         * @internal\n         */\n        OverviewRulerPosition.prototype.equals = function (other) {\n            return (this.width === other.width\n                && this.height === other.height\n                && this.top === other.top\n                && this.right === other.right);\n        };\n        /**\n         * @internal\n         */\n        OverviewRulerPosition.prototype.clone = function () {\n            return new OverviewRulerPosition(this);\n        };\n        return OverviewRulerPosition;\n    }());\n    exports.OverviewRulerPosition = OverviewRulerPosition;\n    /**\n     * The internal layout details of the editor.\n     */\n    var EditorLayoutInfo = (function () {\n        /**\n         * @internal\n         */\n        function EditorLayoutInfo(source) {\n            this.width = source.width | 0;\n            this.height = source.height | 0;\n            this.glyphMarginLeft = source.glyphMarginLeft | 0;\n            this.glyphMarginWidth = source.glyphMarginWidth | 0;\n            this.glyphMarginHeight = source.glyphMarginHeight | 0;\n            this.lineNumbersLeft = source.lineNumbersLeft | 0;\n            this.lineNumbersWidth = source.lineNumbersWidth | 0;\n            this.lineNumbersHeight = source.lineNumbersHeight | 0;\n            this.decorationsLeft = source.decorationsLeft | 0;\n            this.decorationsWidth = source.decorationsWidth | 0;\n            this.decorationsHeight = source.decorationsHeight | 0;\n            this.contentLeft = source.contentLeft | 0;\n            this.contentWidth = source.contentWidth | 0;\n            this.contentHeight = source.contentHeight | 0;\n            this.verticalScrollbarWidth = source.verticalScrollbarWidth | 0;\n            this.horizontalScrollbarHeight = source.horizontalScrollbarHeight | 0;\n            this.overviewRuler = source.overviewRuler.clone();\n        }\n        /**\n         * @internal\n         */\n        EditorLayoutInfo.prototype.equals = function (other) {\n            return (this.width === other.width\n                && this.height === other.height\n                && this.glyphMarginLeft === other.glyphMarginLeft\n                && this.glyphMarginWidth === other.glyphMarginWidth\n                && this.glyphMarginHeight === other.glyphMarginHeight\n                && this.lineNumbersLeft === other.lineNumbersLeft\n                && this.lineNumbersWidth === other.lineNumbersWidth\n                && this.lineNumbersHeight === other.lineNumbersHeight\n                && this.decorationsLeft === other.decorationsLeft\n                && this.decorationsWidth === other.decorationsWidth\n                && this.decorationsHeight === other.decorationsHeight\n                && this.contentLeft === other.contentLeft\n                && this.contentWidth === other.contentWidth\n                && this.contentHeight === other.contentHeight\n                && this.verticalScrollbarWidth === other.verticalScrollbarWidth\n                && this.horizontalScrollbarHeight === other.horizontalScrollbarHeight\n                && this.overviewRuler.equals(other.overviewRuler));\n        };\n        /**\n         * @internal\n         */\n        EditorLayoutInfo.prototype.clone = function () {\n            return new EditorLayoutInfo(this);\n        };\n        return EditorLayoutInfo;\n    }());\n    exports.EditorLayoutInfo = EditorLayoutInfo;\n    /**\n     * Type of hit element with the mouse in the editor.\n     */\n    (function (MouseTargetType) {\n        /**\n         * Mouse is on top of an unknown element.\n         */\n        MouseTargetType[MouseTargetType[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n        /**\n         * Mouse is on top of the textarea used for input.\n         */\n        MouseTargetType[MouseTargetType[\"TEXTAREA\"] = 1] = \"TEXTAREA\";\n        /**\n         * Mouse is on top of the glyph margin\n         */\n        MouseTargetType[MouseTargetType[\"GUTTER_GLYPH_MARGIN\"] = 2] = \"GUTTER_GLYPH_MARGIN\";\n        /**\n         * Mouse is on top of the line numbers\n         */\n        MouseTargetType[MouseTargetType[\"GUTTER_LINE_NUMBERS\"] = 3] = \"GUTTER_LINE_NUMBERS\";\n        /**\n         * Mouse is on top of the line decorations\n         */\n        MouseTargetType[MouseTargetType[\"GUTTER_LINE_DECORATIONS\"] = 4] = \"GUTTER_LINE_DECORATIONS\";\n        /**\n         * Mouse is on top of the whitespace left in the gutter by a view zone.\n         */\n        MouseTargetType[MouseTargetType[\"GUTTER_VIEW_ZONE\"] = 5] = \"GUTTER_VIEW_ZONE\";\n        /**\n         * Mouse is on top of text in the content.\n         */\n        MouseTargetType[MouseTargetType[\"CONTENT_TEXT\"] = 6] = \"CONTENT_TEXT\";\n        /**\n         * Mouse is on top of empty space in the content (e.g. after line text or below last line)\n         */\n        MouseTargetType[MouseTargetType[\"CONTENT_EMPTY\"] = 7] = \"CONTENT_EMPTY\";\n        /**\n         * Mouse is on top of a view zone in the content.\n         */\n        MouseTargetType[MouseTargetType[\"CONTENT_VIEW_ZONE\"] = 8] = \"CONTENT_VIEW_ZONE\";\n        /**\n         * Mouse is on top of a content widget.\n         */\n        MouseTargetType[MouseTargetType[\"CONTENT_WIDGET\"] = 9] = \"CONTENT_WIDGET\";\n        /**\n         * Mouse is on top of the decorations overview ruler.\n         */\n        MouseTargetType[MouseTargetType[\"OVERVIEW_RULER\"] = 10] = \"OVERVIEW_RULER\";\n        /**\n         * Mouse is on top of a scrollbar.\n         */\n        MouseTargetType[MouseTargetType[\"SCROLLBAR\"] = 11] = \"SCROLLBAR\";\n        /**\n         * Mouse is on top of an overlay widget.\n         */\n        MouseTargetType[MouseTargetType[\"OVERLAY_WIDGET\"] = 12] = \"OVERLAY_WIDGET\";\n    })(exports.MouseTargetType || (exports.MouseTargetType = {}));\n    var MouseTargetType = exports.MouseTargetType;\n    /**\n     * A context key that is set when the editor's text has focus (cursor is blinking).\n     */\n    exports.KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS = 'editorTextFocus';\n    /**\n     * A context key that is set when the editor's text or an editor's widget has focus.\n     */\n    exports.KEYBINDING_CONTEXT_EDITOR_FOCUS = 'editorFocus';\n    /**\n     * @internal\n     */\n    exports.KEYBINDING_CONTEXT_EDITOR_TAB_MOVES_FOCUS = 'editorTabMovesFocus';\n    /**\n     * A context key that is set when the editor has multiple selections (multiple cursors).\n     */\n    exports.KEYBINDING_CONTEXT_EDITOR_HAS_MULTIPLE_SELECTIONS = 'editorHasMultipleSelections';\n    /**\n     * A context key that is set when the editor has a non-collapsed selection.\n     */\n    exports.KEYBINDING_CONTEXT_EDITOR_HAS_NON_EMPTY_SELECTION = 'editorHasSelection';\n    /**\n     * A context key that is set to the language associated with the model associated with the editor.\n     */\n    exports.KEYBINDING_CONTEXT_EDITOR_LANGUAGE_ID = 'editorLangId';\n    /**\n     * @internal\n     */\n    exports.SHOW_ACCESSIBILITY_HELP_ACTION_ID = 'editor.action.showAccessibilityHelp';\n    var BareFontInfo = (function () {\n        /**\n         * @internal\n         */\n        function BareFontInfo(opts) {\n            this.fontFamily = String(opts.fontFamily);\n            this.fontSize = opts.fontSize | 0;\n            this.lineHeight = opts.lineHeight | 0;\n        }\n        /**\n         * @internal\n         */\n        BareFontInfo.prototype.getId = function () {\n            return this.fontFamily + '-' + this.fontSize + '-' + this.lineHeight;\n        };\n        return BareFontInfo;\n    }());\n    exports.BareFontInfo = BareFontInfo;\n    var FontInfo = (function (_super) {\n        __extends(FontInfo, _super);\n        /**\n         * @internal\n         */\n        function FontInfo(opts) {\n            _super.call(this, opts);\n            this.typicalHalfwidthCharacterWidth = opts.typicalHalfwidthCharacterWidth;\n            this.typicalFullwidthCharacterWidth = opts.typicalFullwidthCharacterWidth;\n            this.spaceWidth = opts.spaceWidth;\n            this.maxDigitWidth = opts.maxDigitWidth;\n        }\n        /**\n         * @internal\n         */\n        FontInfo.prototype.equals = function (other) {\n            return (this.fontFamily === other.fontFamily\n                && this.fontSize === other.fontSize\n                && this.lineHeight === other.lineHeight\n                && this.typicalHalfwidthCharacterWidth === other.typicalHalfwidthCharacterWidth\n                && this.typicalFullwidthCharacterWidth === other.typicalFullwidthCharacterWidth\n                && this.spaceWidth === other.spaceWidth\n                && this.maxDigitWidth === other.maxDigitWidth);\n        };\n        /**\n         * @internal\n         */\n        FontInfo.prototype.clone = function () {\n            return new FontInfo(this);\n        };\n        return FontInfo;\n    }(BareFontInfo));\n    exports.FontInfo = FontInfo;\n    /**\n     * @internal\n     */\n    exports.ViewEventNames = {\n        ModelFlushedEvent: 'modelFlushedEvent',\n        LinesDeletedEvent: 'linesDeletedEvent',\n        LinesInsertedEvent: 'linesInsertedEvent',\n        LineChangedEvent: 'lineChangedEvent',\n        TokensChangedEvent: 'tokensChangedEvent',\n        DecorationsChangedEvent: 'decorationsChangedEvent',\n        CursorPositionChangedEvent: 'cursorPositionChangedEvent',\n        CursorSelectionChangedEvent: 'cursorSelectionChangedEvent',\n        RevealRangeEvent: 'revealRangeEvent',\n        LineMappingChangedEvent: 'lineMappingChangedEvent',\n        ScrollRequestEvent: 'scrollRequestEvent'\n    };\n    /**\n     * @internal\n     */\n    var Viewport = (function () {\n        function Viewport(top, left, width, height) {\n            this.top = top | 0;\n            this.left = left | 0;\n            this.width = width | 0;\n            this.height = height | 0;\n        }\n        return Viewport;\n    }());\n    exports.Viewport = Viewport;\n    /**\n     * @internal\n     */\n    (function (CodeEditorStateFlag) {\n        CodeEditorStateFlag[CodeEditorStateFlag[\"Value\"] = 0] = \"Value\";\n        CodeEditorStateFlag[CodeEditorStateFlag[\"Selection\"] = 1] = \"Selection\";\n        CodeEditorStateFlag[CodeEditorStateFlag[\"Position\"] = 2] = \"Position\";\n        CodeEditorStateFlag[CodeEditorStateFlag[\"Scroll\"] = 3] = \"Scroll\";\n    })(exports.CodeEditorStateFlag || (exports.CodeEditorStateFlag = {}));\n    var CodeEditorStateFlag = exports.CodeEditorStateFlag;\n    /**\n     * The type of the `IEditor`.\n     */\n    exports.EditorType = {\n        ICodeEditor: 'vs.editor.ICodeEditor',\n        IDiffEditor: 'vs.editor.IDiffEditor'\n    };\n    /**\n     * @internal\n     */\n    exports.ClassName = {\n        EditorWarningDecoration: 'greensquiggly',\n        EditorErrorDecoration: 'redsquiggly'\n    };\n    /**\n     * @internal\n     */\n    exports.EventType = {\n        Disposed: 'disposed',\n        ConfigurationChanged: 'configurationChanged',\n        ModelDispose: 'modelDispose',\n        ModelChanged: 'modelChanged',\n        ModelTokensChanged: 'modelTokensChanged',\n        ModelModeChanged: 'modelsModeChanged',\n        ModelModeSupportChanged: 'modelsModeSupportChanged',\n        ModelOptionsChanged: 'modelOptionsChanged',\n        ModelRawContentChanged: 'contentChanged',\n        ModelContentChanged2: 'contentChanged2',\n        ModelRawContentChangedFlush: 'flush',\n        ModelRawContentChangedLinesDeleted: 'linesDeleted',\n        ModelRawContentChangedLinesInserted: 'linesInserted',\n        ModelRawContentChangedLineChanged: 'lineChanged',\n        EditorTextBlur: 'blur',\n        EditorTextFocus: 'focus',\n        EditorFocus: 'widgetFocus',\n        EditorBlur: 'widgetBlur',\n        ModelDecorationsChanged: 'decorationsChanged',\n        CursorPositionChanged: 'positionChanged',\n        CursorSelectionChanged: 'selectionChanged',\n        CursorRevealRange: 'revealRange',\n        CursorScrollRequest: 'scrollRequest',\n        ViewFocusGained: 'focusGained',\n        ViewFocusLost: 'focusLost',\n        ViewFocusChanged: 'focusChanged',\n        ViewScrollChanged: 'scrollChanged',\n        ViewZonesChanged: 'zonesChanged',\n        ViewLayoutChanged: 'viewLayoutChanged',\n        ContextMenu: 'contextMenu',\n        MouseDown: 'mousedown',\n        MouseUp: 'mouseup',\n        MouseMove: 'mousemove',\n        MouseLeave: 'mouseleave',\n        KeyDown: 'keydown',\n        KeyUp: 'keyup',\n        EditorLayout: 'editorLayout',\n        DiffUpdated: 'diffUpdated'\n    };\n    /**\n     * Built-in commands.\n     */\n    exports.Handler = {\n        ExecuteCommand: 'executeCommand',\n        ExecuteCommands: 'executeCommands',\n        CursorLeft: 'cursorLeft',\n        CursorLeftSelect: 'cursorLeftSelect',\n        CursorWordLeft: 'cursorWordLeft',\n        CursorWordStartLeft: 'cursorWordStartLeft',\n        CursorWordEndLeft: 'cursorWordEndLeft',\n        CursorWordLeftSelect: 'cursorWordLeftSelect',\n        CursorWordStartLeftSelect: 'cursorWordStartLeftSelect',\n        CursorWordEndLeftSelect: 'cursorWordEndLeftSelect',\n        CursorRight: 'cursorRight',\n        CursorRightSelect: 'cursorRightSelect',\n        CursorWordRight: 'cursorWordRight',\n        CursorWordStartRight: 'cursorWordStartRight',\n        CursorWordEndRight: 'cursorWordEndRight',\n        CursorWordRightSelect: 'cursorWordRightSelect',\n        CursorWordStartRightSelect: 'cursorWordStartRightSelect',\n        CursorWordEndRightSelect: 'cursorWordEndRightSelect',\n        CursorUp: 'cursorUp',\n        CursorUpSelect: 'cursorUpSelect',\n        CursorDown: 'cursorDown',\n        CursorDownSelect: 'cursorDownSelect',\n        CursorPageUp: 'cursorPageUp',\n        CursorPageUpSelect: 'cursorPageUpSelect',\n        CursorPageDown: 'cursorPageDown',\n        CursorPageDownSelect: 'cursorPageDownSelect',\n        CursorHome: 'cursorHome',\n        CursorHomeSelect: 'cursorHomeSelect',\n        CursorEnd: 'cursorEnd',\n        CursorEndSelect: 'cursorEndSelect',\n        ExpandLineSelection: 'expandLineSelection',\n        CursorTop: 'cursorTop',\n        CursorTopSelect: 'cursorTopSelect',\n        CursorBottom: 'cursorBottom',\n        CursorBottomSelect: 'cursorBottomSelect',\n        CursorColumnSelectLeft: 'cursorColumnSelectLeft',\n        CursorColumnSelectRight: 'cursorColumnSelectRight',\n        CursorColumnSelectUp: 'cursorColumnSelectUp',\n        CursorColumnSelectPageUp: 'cursorColumnSelectPageUp',\n        CursorColumnSelectDown: 'cursorColumnSelectDown',\n        CursorColumnSelectPageDown: 'cursorColumnSelectPageDown',\n        AddCursorDown: 'addCursorDown',\n        AddCursorUp: 'addCursorUp',\n        CursorUndo: 'cursorUndo',\n        MoveTo: 'moveTo',\n        MoveToSelect: 'moveToSelect',\n        ColumnSelect: 'columnSelect',\n        CreateCursor: 'createCursor',\n        LastCursorMoveToSelect: 'lastCursorMoveToSelect',\n        JumpToBracket: 'jumpToBracket',\n        Type: 'type',\n        ReplacePreviousChar: 'replacePreviousChar',\n        Paste: 'paste',\n        Tab: 'tab',\n        Indent: 'indent',\n        Outdent: 'outdent',\n        DeleteLeft: 'deleteLeft',\n        DeleteRight: 'deleteRight',\n        DeleteWordLeft: 'deleteWordLeft',\n        DeleteWordStartLeft: 'deleteWordStartLeft',\n        DeleteWordEndLeft: 'deleteWordEndLeft',\n        DeleteWordRight: 'deleteWordRight',\n        DeleteWordStartRight: 'deleteWordStartRight',\n        DeleteWordEndRight: 'deleteWordEndRight',\n        DeleteAllLeft: 'deleteAllLeft',\n        DeleteAllRight: 'deleteAllRight',\n        RemoveSecondaryCursors: 'removeSecondaryCursors',\n        CancelSelection: 'cancelSelection',\n        Cut: 'cut',\n        Undo: 'undo',\n        Redo: 'redo',\n        WordSelect: 'wordSelect',\n        WordSelectDrag: 'wordSelectDrag',\n        LastCursorWordSelect: 'lastCursorWordSelect',\n        LineSelect: 'lineSelect',\n        LineSelectDrag: 'lineSelectDrag',\n        LastCursorLineSelect: 'lastCursorLineSelect',\n        LastCursorLineSelectDrag: 'lastCursorLineSelectDrag',\n        LineInsertBefore: 'lineInsertBefore',\n        LineInsertAfter: 'lineInsertAfter',\n        LineBreakInsert: 'lineBreakInsert',\n        SelectAll: 'selectAll',\n        ScrollLineUp: 'scrollLineUp',\n        ScrollLineDown: 'scrollLineDown',\n        ScrollPageUp: 'scrollPageUp',\n        ScrollPageDown: 'scrollPageDown'\n    };\n    /**\n     * The style in which the editor's cursor should be rendered.\n     */\n    (function (TextEditorCursorStyle) {\n        /**\n         * As a vertical line (sitting between two characters).\n         */\n        TextEditorCursorStyle[TextEditorCursorStyle[\"Line\"] = 1] = \"Line\";\n        /**\n         * As a block (sitting on top of a character).\n         */\n        TextEditorCursorStyle[TextEditorCursorStyle[\"Block\"] = 2] = \"Block\";\n        /**\n         * As a horizontal line (sitting under a character).\n         */\n        TextEditorCursorStyle[TextEditorCursorStyle[\"Underline\"] = 3] = \"Underline\";\n    })(exports.TextEditorCursorStyle || (exports.TextEditorCursorStyle = {}));\n    var TextEditorCursorStyle = exports.TextEditorCursorStyle;\n    /**\n     * @internal\n     */\n    function cursorStyleToString(cursorStyle) {\n        if (cursorStyle === TextEditorCursorStyle.Line) {\n            return 'line';\n        }\n        else if (cursorStyle === TextEditorCursorStyle.Block) {\n            return 'block';\n        }\n        else if (cursorStyle === TextEditorCursorStyle.Underline) {\n            return 'underline';\n        }\n        else {\n            throw new Error('cursorStyleToString: Unknown cursorStyle');\n        }\n    }\n    exports.cursorStyleToString = cursorStyleToString;\n    /**\n     * @internal\n     */\n    var ColorZone = (function () {\n        function ColorZone(from, to, colorId, position) {\n            this.from = from | 0;\n            this.to = to | 0;\n            this.colorId = colorId | 0;\n            this.position = position | 0;\n        }\n        return ColorZone;\n    }());\n    exports.ColorZone = ColorZone;\n    /**\n     * A zone in the overview ruler\n     * @internal\n     */\n    var OverviewRulerZone = (function () {\n        function OverviewRulerZone(startLineNumber, endLineNumber, position, forceHeight, color, darkColor) {\n            this.startLineNumber = startLineNumber;\n            this.endLineNumber = endLineNumber;\n            this.position = position;\n            this.forceHeight = forceHeight;\n            this._color = color;\n            this._darkColor = darkColor;\n            this._colorZones = null;\n        }\n        OverviewRulerZone.prototype.getColor = function (useDarkColor) {\n            if (useDarkColor) {\n                return this._darkColor;\n            }\n            return this._color;\n        };\n        OverviewRulerZone.prototype.equals = function (other) {\n            return (this.startLineNumber === other.startLineNumber\n                && this.endLineNumber === other.endLineNumber\n                && this.position === other.position\n                && this.forceHeight === other.forceHeight\n                && this._color === other._color\n                && this._darkColor === other._darkColor);\n        };\n        OverviewRulerZone.prototype.compareTo = function (other) {\n            if (this.startLineNumber === other.startLineNumber) {\n                if (this.endLineNumber === other.endLineNumber) {\n                    if (this.forceHeight === other.forceHeight) {\n                        if (this.position === other.position) {\n                            if (this._darkColor === other._darkColor) {\n                                if (this._color === other._color) {\n                                    return 0;\n                                }\n                                return this._color < other._color ? -1 : 1;\n                            }\n                            return this._darkColor < other._darkColor ? -1 : 1;\n                        }\n                        return this.position - other.position;\n                    }\n                    return this.forceHeight - other.forceHeight;\n                }\n                return this.endLineNumber - other.endLineNumber;\n            }\n            return this.startLineNumber - other.startLineNumber;\n        };\n        OverviewRulerZone.prototype.setColorZones = function (colorZones) {\n            this._colorZones = colorZones;\n        };\n        OverviewRulerZone.prototype.getColorZones = function () {\n            return this._colorZones;\n        };\n        return OverviewRulerZone;\n    }());\n    exports.OverviewRulerZone = OverviewRulerZone;\n});\n\ndefine(__m[95], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var __space = ' '.charCodeAt(0);\n    var __tab = '\\t'.charCodeAt(0);\n    /**\n     * Compute the diff in spaces between two line's indentation.\n     */\n    function spacesDiff(a, aLength, b, bLength) {\n        // This can go both ways (e.g.):\n        //  - a: \"\\t\"\n        //  - b: \"\\t    \"\n        //  => This should count 1 tab and 4 spaces\n        var i;\n        for (i = 0; i < aLength && i < bLength; i++) {\n            var aCharCode = a.charCodeAt(i);\n            var bCharCode = b.charCodeAt(i);\n            if (aCharCode !== bCharCode) {\n                break;\n            }\n        }\n        var aSpacesCnt = 0, aTabsCount = 0;\n        for (var j = i; j < aLength; j++) {\n            var aCharCode = a.charCodeAt(j);\n            if (aCharCode === __space) {\n                aSpacesCnt++;\n            }\n            else {\n                aTabsCount++;\n            }\n        }\n        var bSpacesCnt = 0, bTabsCount = 0;\n        for (var j = i; j < bLength; j++) {\n            var bCharCode = b.charCodeAt(j);\n            if (bCharCode === __space) {\n                bSpacesCnt++;\n            }\n            else {\n                bTabsCount++;\n            }\n        }\n        if (aSpacesCnt > 0 && aTabsCount > 0) {\n            return 0;\n        }\n        if (bSpacesCnt > 0 && bTabsCount > 0) {\n            return 0;\n        }\n        var tabsDiff = Math.abs(aTabsCount - bTabsCount);\n        var spacesDiff = Math.abs(aSpacesCnt - bSpacesCnt);\n        if (tabsDiff === 0) {\n            return spacesDiff;\n        }\n        if (spacesDiff % tabsDiff === 0) {\n            return spacesDiff / tabsDiff;\n        }\n        return 0;\n    }\n    function guessIndentation(lines, defaultTabSize, defaultInsertSpaces) {\n        var linesIndentedWithTabsCount = 0; // number of lines that contain at least one tab in indentation\n        var linesIndentedWithSpacesCount = 0; // number of lines that contain only spaces in indentation\n        var previousLineText = ''; // content of latest line that contained non-whitespace chars\n        var previousLineIndentation = 0; // index at which latest line contained the first non-whitespace char\n        var ALLOWED_TAB_SIZE_GUESSES = [2, 4, 6, 8]; // limit guesses for `tabSize` to 2, 4, 6 or 8.\n        var MAX_ALLOWED_TAB_SIZE_GUESS = 8; // max(2,4,6,8) = 8\n        var spacesDiffCount = [0, 0, 0, 0, 0, 0, 0, 0, 0]; // `tabSize` scores\n        for (var i = 0, len = lines.length; i < len; i++) {\n            var currentLineText = lines[i];\n            var currentLineHasContent = false; // does `currentLineText` contain non-whitespace chars\n            var currentLineIndentation = 0; // index at which `currentLineText` contains the first non-whitespace char\n            var currentLineSpacesCount = 0; // count of spaces found in `currentLineText` indentation\n            var currentLineTabsCount = 0; // count of tabs found in `currentLineText` indentation\n            for (var j = 0, lenJ = currentLineText.length; j < lenJ; j++) {\n                var charCode = currentLineText.charCodeAt(j);\n                if (charCode === __tab) {\n                    currentLineTabsCount++;\n                }\n                else if (charCode === __space) {\n                    currentLineSpacesCount++;\n                }\n                else {\n                    // Hit non whitespace character on this line\n                    currentLineHasContent = true;\n                    currentLineIndentation = j;\n                    break;\n                }\n            }\n            // Ignore empty or only whitespace lines\n            if (!currentLineHasContent) {\n                continue;\n            }\n            if (currentLineTabsCount > 0) {\n                linesIndentedWithTabsCount++;\n            }\n            else if (currentLineSpacesCount > 1) {\n                linesIndentedWithSpacesCount++;\n            }\n            var currentSpacesDiff = spacesDiff(previousLineText, previousLineIndentation, currentLineText, currentLineIndentation);\n            if (currentSpacesDiff <= MAX_ALLOWED_TAB_SIZE_GUESS) {\n                spacesDiffCount[currentSpacesDiff]++;\n            }\n            previousLineText = currentLineText;\n            previousLineIndentation = currentLineIndentation;\n        }\n        // Take into account the last line as well\n        var deltaSpacesCount = spacesDiff(previousLineText, previousLineIndentation, '', 0);\n        if (deltaSpacesCount <= MAX_ALLOWED_TAB_SIZE_GUESS) {\n            spacesDiffCount[deltaSpacesCount]++;\n        }\n        var insertSpaces = defaultInsertSpaces;\n        if (linesIndentedWithTabsCount !== linesIndentedWithSpacesCount) {\n            insertSpaces = (linesIndentedWithTabsCount < linesIndentedWithSpacesCount);\n        }\n        var tabSize = defaultTabSize;\n        var tabSizeScore = (insertSpaces ? 0 : 0.1 * lines.length);\n        // console.log(\"score threshold: \" + tabSizeScore);\n        ALLOWED_TAB_SIZE_GUESSES.forEach(function (possibleTabSize) {\n            var possibleTabSizeScore = spacesDiffCount[possibleTabSize];\n            if (possibleTabSizeScore > tabSizeScore) {\n                tabSizeScore = possibleTabSizeScore;\n                tabSize = possibleTabSize;\n            }\n        });\n        // console.log('--------------------------');\n        // console.log('linesIndentedWithTabsCount: ' + linesIndentedWithTabsCount + ', linesIndentedWithSpacesCount: ' + linesIndentedWithSpacesCount);\n        // console.log('spacesDiffCount: ' + spacesDiffCount);\n        // console.log('tabSize: ' + tabSize + ', tabSizeScore: ' + tabSizeScore);\n        return {\n            insertSpaces: insertSpaces,\n            tabSize: tabSize\n        };\n    }\n    exports.guessIndentation = guessIndentation;\n});\n\ndefine(__m[101], __M([1,0,30]), function (require, exports, arrays_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * A token on a line.\n     */\n    var LineToken = (function () {\n        function LineToken(startIndex, type) {\n            this.startIndex = startIndex | 0; // @perf\n            this.type = type;\n        }\n        LineToken.prototype.equals = function (other) {\n            return (this.startIndex === other.startIndex\n                && this.type === other.type);\n        };\n        LineToken.findIndexInSegmentsArray = function (arr, desiredIndex) {\n            return arrays_1.Arrays.findIndexInSegmentsArray(arr, desiredIndex);\n        };\n        LineToken.equalsArray = function (a, b) {\n            var aLen = a.length;\n            var bLen = b.length;\n            if (aLen !== bLen) {\n                return false;\n            }\n            for (var i = 0; i < aLen; i++) {\n                if (!a[i].equals(b[i])) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        return LineToken;\n    }());\n    exports.LineToken = LineToken;\n});\n\ndefine(__m[69], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var TokenIterator = (function () {\n        function TokenIterator(model, position) {\n            this._model = model;\n            this._currentLineNumber = position.lineNumber;\n            this._currentTokenIndex = 0;\n            this._readLineTokens(this._currentLineNumber);\n            this._next = null;\n            this._prev = null;\n            // start with a position to next/prev run\n            var columnIndex = position.column - 1, tokenEndIndex = Number.MAX_VALUE;\n            for (var i = this._currentLineTokens.getTokenCount() - 1; i >= 0; i--) {\n                var tokenStartIndex = this._currentLineTokens.getTokenStartIndex(i);\n                if (tokenStartIndex <= columnIndex && columnIndex <= tokenEndIndex) {\n                    this._currentTokenIndex = i;\n                    this._next = this._current();\n                    this._prev = this._current();\n                    break;\n                }\n                tokenEndIndex = tokenStartIndex;\n            }\n        }\n        TokenIterator.prototype._readLineTokens = function (lineNumber) {\n            this._currentLineTokens = this._model.getLineTokens(lineNumber, false);\n        };\n        TokenIterator.prototype._advanceNext = function () {\n            this._prev = this._next;\n            this._next = null;\n            if (this._currentTokenIndex + 1 < this._currentLineTokens.getTokenCount()) {\n                // There are still tokens on current line\n                this._currentTokenIndex++;\n                this._next = this._current();\n            }\n            else {\n                // find the next line with tokens\n                while (this._currentLineNumber + 1 <= this._model.getLineCount()) {\n                    this._currentLineNumber++;\n                    this._readLineTokens(this._currentLineNumber);\n                    if (this._currentLineTokens.getTokenCount() > 0) {\n                        this._currentTokenIndex = 0;\n                        this._next = this._current();\n                        break;\n                    }\n                }\n                if (this._next === null) {\n                    // prepare of a previous run\n                    this._readLineTokens(this._currentLineNumber);\n                    this._currentTokenIndex = this._currentLineTokens.getTokenCount();\n                    this._advancePrev();\n                    this._next = null;\n                }\n            }\n        };\n        TokenIterator.prototype._advancePrev = function () {\n            this._next = this._prev;\n            this._prev = null;\n            if (this._currentTokenIndex > 0) {\n                // There are still tokens on current line\n                this._currentTokenIndex--;\n                this._prev = this._current();\n            }\n            else {\n                // find previous line with tokens\n                while (this._currentLineNumber > 1) {\n                    this._currentLineNumber--;\n                    this._readLineTokens(this._currentLineNumber);\n                    if (this._currentLineTokens.getTokenCount() > 0) {\n                        this._currentTokenIndex = this._currentLineTokens.getTokenCount() - 1;\n                        this._prev = this._current();\n                        break;\n                    }\n                }\n            }\n        };\n        TokenIterator.prototype._current = function () {\n            var startIndex = this._currentLineTokens.getTokenStartIndex(this._currentTokenIndex);\n            var type = this._currentLineTokens.getTokenType(this._currentTokenIndex);\n            var endIndex = this._currentLineTokens.getTokenEndIndex(this._currentTokenIndex, this._model.getLineContent(this._currentLineNumber).length);\n            return {\n                token: {\n                    startIndex: startIndex,\n                    type: type\n                },\n                lineNumber: this._currentLineNumber,\n                startColumn: startIndex + 1,\n                endColumn: endIndex + 1\n            };\n        };\n        TokenIterator.prototype.hasNext = function () {\n            return this._next !== null;\n        };\n        TokenIterator.prototype.next = function () {\n            var result = this._next;\n            this._advanceNext();\n            return result;\n        };\n        TokenIterator.prototype.hasPrev = function () {\n            return this._prev !== null;\n        };\n        TokenIterator.prototype.prev = function () {\n            var result = this._prev;\n            this._advancePrev();\n            return result;\n        };\n        TokenIterator.prototype._invalidate = function () {\n            // replace all public functions with errors\n            var errorFn = function () {\n                throw new Error('iteration isn\\'t valid anymore');\n            };\n            this.hasNext = errorFn;\n            this.next = errorFn;\n            this.hasPrev = errorFn;\n            this.prev = errorFn;\n        };\n        return TokenIterator;\n    }());\n    exports.TokenIterator = TokenIterator;\n});\n\ndefine(__m[17], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.USUAL_WORD_SEPARATORS = '`~!@#$%^&*()-=+[{]}\\\\|;:\\'\",.<>/?';\n    /**\n     * Create a word definition regular expression based on default word separators.\n     * Optionally provide allowed separators that should be included in words.\n     *\n     * The default would look like this:\n     * /(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>\\/\\?\\s]+)/g\n     */\n    function createWordRegExp(allowInWords) {\n        if (allowInWords === void 0) { allowInWords = ''; }\n        var usualSeparators = exports.USUAL_WORD_SEPARATORS;\n        var source = '(-?\\\\d*\\\\.\\\\d\\\\w*)|([^';\n        for (var i = 0; i < usualSeparators.length; i++) {\n            if (allowInWords.indexOf(usualSeparators[i]) >= 0) {\n                continue;\n            }\n            source += '\\\\' + usualSeparators[i];\n        }\n        source += '\\\\s]+)';\n        return new RegExp(source, 'g');\n    }\n    exports.createWordRegExp = createWordRegExp;\n    // catches numbers (including floating numbers) in the first group, and alphanum in the second\n    exports.DEFAULT_WORD_REGEXP = createWordRegExp();\n    function ensureValidWordDefinition(wordDefinition) {\n        var result = exports.DEFAULT_WORD_REGEXP;\n        if (wordDefinition && (wordDefinition instanceof RegExp)) {\n            if (!wordDefinition.global) {\n                var flags = 'g';\n                if (wordDefinition.ignoreCase) {\n                    flags += 'i';\n                }\n                if (wordDefinition.multiline) {\n                    flags += 'm';\n                }\n                result = new RegExp(wordDefinition.source, flags);\n            }\n            else {\n                result = wordDefinition;\n            }\n        }\n        result.lastIndex = 0;\n        return result;\n    }\n    exports.ensureValidWordDefinition = ensureValidWordDefinition;\n    function getWordAtText(column, wordDefinition, text, textOffset) {\n        // console.log('_getWordAtText: ', column, text, textOffset);\n        var words = text.match(wordDefinition), k, startWord, endWord, startColumn, endColumn, word;\n        if (words) {\n            for (k = 0; k < words.length; k++) {\n                word = words[k].trim();\n                if (word.length > 0) {\n                    startWord = text.indexOf(word, endWord);\n                    endWord = startWord + word.length;\n                    startColumn = textOffset + startWord + 1;\n                    endColumn = textOffset + endWord + 1;\n                    if (startColumn <= column && column <= endColumn) {\n                        return {\n                            word: word,\n                            startColumn: startColumn,\n                            endColumn: endColumn\n                        };\n                    }\n                }\n            }\n        }\n        return null;\n    }\n    exports.getWordAtText = getWordAtText;\n});\n\ndefine(__m[39], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var AbstractState = (function () {\n        function AbstractState(mode, stateData) {\n            if (stateData === void 0) { stateData = null; }\n            this.mode = mode;\n            this.stateData = stateData;\n        }\n        AbstractState.prototype.getMode = function () {\n            return this.mode;\n        };\n        AbstractState.prototype.clone = function () {\n            var result = this.makeClone();\n            result.initializeFrom(this);\n            return result;\n        };\n        AbstractState.prototype.makeClone = function () {\n            throw new Error('Abstract Method');\n        };\n        AbstractState.prototype.initializeFrom = function (other) {\n            this.stateData = other.stateData !== null ? other.stateData.clone() : null;\n        };\n        AbstractState.prototype.getStateData = function () {\n            return this.stateData;\n        };\n        AbstractState.prototype.setStateData = function (state) {\n            this.stateData = state;\n        };\n        AbstractState.prototype.equals = function (other) {\n            if (other === null || this.mode !== other.getMode()) {\n                return false;\n            }\n            if (other instanceof AbstractState) {\n                return AbstractState.safeEquals(this.stateData, other.stateData);\n            }\n            return false;\n        };\n        AbstractState.prototype.tokenize = function (stream) {\n            throw new Error('Abstract Method');\n        };\n        AbstractState.safeEquals = function (a, b) {\n            if (a === null && b === null) {\n                return true;\n            }\n            if (a === null || b === null) {\n                return false;\n            }\n            return a.equals(b);\n        };\n        AbstractState.safeClone = function (state) {\n            if (state) {\n                return state.clone();\n            }\n            return null;\n        };\n        return AbstractState;\n    }());\n    exports.AbstractState = AbstractState;\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[82], __M([1,0,55]), function (require, exports, glob_1) {\n    'use strict';\n    function matches(selection, uri, language) {\n        return score(selection, uri, language) > 0;\n    }\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = matches;\n    function score(selector, uri, language) {\n        if (Array.isArray(selector)) {\n            // for each\n            var values = selector.map(function (item) { return score(item, uri, language); });\n            return Math.max.apply(Math, values);\n        }\n        else if (typeof selector === 'string') {\n            // compare language id\n            if (selector === language) {\n                return 10;\n            }\n            else if (selector === '*') {\n                return 5;\n            }\n            else {\n                return 0;\n            }\n        }\n        else if (selector) {\n            var filter = selector;\n            var value = 0;\n            // language id\n            if (filter.language) {\n                if (filter.language === language) {\n                    value += 10;\n                }\n                else if (filter.language === '*') {\n                    value += 5;\n                }\n                else {\n                    return 0;\n                }\n            }\n            // scheme\n            if (filter.scheme) {\n                if (filter.scheme === uri.scheme) {\n                    value += 10;\n                }\n                else {\n                    return 0;\n                }\n            }\n            // match fsPath with pattern\n            if (filter.pattern) {\n                if (filter.pattern === uri.fsPath) {\n                    value += 10;\n                }\n                else if (glob_1.match(filter.pattern, uri.fsPath)) {\n                    value += 5;\n                }\n                else {\n                    return 0;\n                }\n            }\n            return value;\n        }\n    }\n    exports.score = score;\n});\n\ndefine(__m[62], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var LineStream = (function () {\n        function LineStream(source) {\n            this._source = source;\n            this.sourceLength = source.length;\n            this._pos = 0;\n            this.whitespace = '\\t \\u00a0';\n            this.whitespaceArr = this.stringToArray(this.whitespace);\n            this.separators = '';\n            this.separatorsArr = this.stringToArray(this.separators);\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n        }\n        LineStream.prototype.stringToArray = function (str) {\n            if (!LineStream.STRING_TO_ARRAY_CACHE.hasOwnProperty(str)) {\n                LineStream.STRING_TO_ARRAY_CACHE[str] = this.actualStringToArray(str);\n            }\n            return LineStream.STRING_TO_ARRAY_CACHE[str];\n        };\n        LineStream.prototype.actualStringToArray = function (str) {\n            var maxCharCode = 0;\n            for (var i = 0; i < str.length; i++) {\n                maxCharCode = Math.max(maxCharCode, str.charCodeAt(i));\n            }\n            var r = [];\n            for (var i = 0; i <= maxCharCode; i++) {\n                r[i] = false;\n            }\n            for (var i = 0; i < str.length; i++) {\n                r[str.charCodeAt(i)] = true;\n            }\n            return r;\n        };\n        LineStream.prototype.pos = function () {\n            return this._pos;\n        };\n        LineStream.prototype.eos = function () {\n            return this._pos >= this.sourceLength;\n        };\n        LineStream.prototype.peek = function () {\n            // Check EOS\n            if (this._pos >= this.sourceLength) {\n                throw new Error('Stream is at the end');\n            }\n            return this._source[this._pos];\n        };\n        LineStream.prototype.next = function () {\n            // Check EOS\n            if (this._pos >= this.sourceLength) {\n                throw new Error('Stream is at the end');\n            }\n            // Reset peeked token\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n            return this._source[this._pos++];\n        };\n        LineStream.prototype.next2 = function () {\n            // Check EOS\n            if (this._pos >= this.sourceLength) {\n                throw new Error('Stream is at the end');\n            }\n            // Reset peeked token\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n            this._pos++;\n        };\n        LineStream.prototype.advance = function (n) {\n            if (n === 0) {\n                return '';\n            }\n            var oldPos = this._pos;\n            this._pos += n;\n            // Reset peeked token\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n            return this._source.substring(oldPos, this._pos);\n        };\n        LineStream.prototype._advance2 = function (n) {\n            if (n === 0) {\n                return n;\n            }\n            this._pos += n;\n            // Reset peeked token\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n            return n;\n        };\n        LineStream.prototype.advanceToEOS = function () {\n            var oldPos = this._pos;\n            this._pos = this.sourceLength;\n            this.resetPeekedToken();\n            return this._source.substring(oldPos, this._pos);\n        };\n        LineStream.prototype.goBack = function (n) {\n            this._pos -= n;\n            this.resetPeekedToken();\n        };\n        LineStream.prototype.createPeeker = function (condition) {\n            var _this = this;\n            if (condition instanceof RegExp) {\n                return function () {\n                    var result = condition.exec(_this._source.substr(_this._pos));\n                    if (result === null) {\n                        return 0;\n                    }\n                    else if (result.index !== 0) {\n                        throw new Error('Regular expression must begin with the character \"^\"');\n                    }\n                    return result[0].length;\n                };\n            }\n            else if ((condition instanceof String || (typeof condition) === 'string') && condition) {\n                return function () {\n                    var len = condition.length, match = _this._pos + len <= _this.sourceLength;\n                    for (var i = 0; match && i < len; i++) {\n                        match = _this._source.charCodeAt(_this._pos + i) === condition.charCodeAt(i);\n                    }\n                    return match ? len : 0;\n                };\n            }\n            throw new Error('Condition must be either a regular expression, function or a non-empty string');\n        };\n        // --- BEGIN `_advanceIfStringCaseInsensitive`\n        LineStream.prototype._advanceIfStringCaseInsensitive = function (condition) {\n            var oldPos = this._pos, source = this._source, len = condition.length, i;\n            if (len < 1 || oldPos + len > this.sourceLength) {\n                return 0;\n            }\n            for (i = 0; i < len; i++) {\n                if (source.charAt(oldPos + i).toLowerCase() !== condition.charAt(i).toLowerCase()) {\n                    return 0;\n                }\n            }\n            return len;\n        };\n        LineStream.prototype.advanceIfStringCaseInsensitive = function (condition) {\n            return this.advance(this._advanceIfStringCaseInsensitive(condition));\n        };\n        LineStream.prototype.advanceIfStringCaseInsensitive2 = function (condition) {\n            return this._advance2(this._advanceIfStringCaseInsensitive(condition));\n        };\n        // --- END\n        // --- BEGIN `advanceIfString`\n        LineStream.prototype._advanceIfString = function (condition) {\n            var oldPos = this._pos, source = this._source, len = condition.length, i;\n            if (len < 1 || oldPos + len > this.sourceLength) {\n                return 0;\n            }\n            for (i = 0; i < len; i++) {\n                if (source.charCodeAt(oldPos + i) !== condition.charCodeAt(i)) {\n                    return 0;\n                }\n            }\n            return len;\n        };\n        LineStream.prototype.advanceIfString = function (condition) {\n            return this.advance(this._advanceIfString(condition));\n        };\n        LineStream.prototype.advanceIfString2 = function (condition) {\n            return this._advance2(this._advanceIfString(condition));\n        };\n        // --- END\n        // --- BEGIN `advanceIfString`\n        LineStream.prototype._advanceIfCharCode = function (charCode) {\n            if (this._pos < this.sourceLength && this._source.charCodeAt(this._pos) === charCode) {\n                return 1;\n            }\n            return 0;\n        };\n        LineStream.prototype.advanceIfCharCode = function (charCode) {\n            return this.advance(this._advanceIfCharCode(charCode));\n        };\n        LineStream.prototype.advanceIfCharCode2 = function (charCode) {\n            return this._advance2(this._advanceIfCharCode(charCode));\n        };\n        // --- END\n        // --- BEGIN `advanceIfRegExp`\n        LineStream.prototype._advanceIfRegExp = function (condition) {\n            if (this._pos >= this.sourceLength) {\n                return 0;\n            }\n            if (!condition.test(this._source.substr(this._pos))) {\n                return 0;\n            }\n            return RegExp.lastMatch.length;\n        };\n        LineStream.prototype.advanceIfRegExp = function (condition) {\n            return this.advance(this._advanceIfRegExp(condition));\n        };\n        LineStream.prototype.advanceIfRegExp2 = function (condition) {\n            return this._advance2(this._advanceIfRegExp(condition));\n        };\n        // --- END\n        LineStream.prototype.advanceLoop = function (condition, isWhile, including) {\n            if (this.eos()) {\n                return '';\n            }\n            var peeker = this.createPeeker(condition);\n            var oldPos = this._pos;\n            var n = 0;\n            var f = null;\n            if (isWhile) {\n                f = function (n) {\n                    return n > 0;\n                };\n            }\n            else {\n                f = function (n) {\n                    return n === 0;\n                };\n            }\n            while (!this.eos() && f(n = peeker())) {\n                if (n > 0) {\n                    this.advance(n);\n                }\n                else {\n                    this.next();\n                }\n            }\n            if (including && !this.eos()) {\n                this.advance(n);\n            }\n            return this._source.substring(oldPos, this._pos);\n        };\n        LineStream.prototype.advanceWhile = function (condition) {\n            return this.advanceLoop(condition, true, false);\n        };\n        LineStream.prototype.advanceUntil = function (condition, including) {\n            return this.advanceLoop(condition, false, including);\n        };\n        // --- BEGIN `advanceUntilString`\n        LineStream.prototype._advanceUntilString = function (condition, including) {\n            if (this.eos() || condition.length === 0) {\n                return 0;\n            }\n            var oldPos = this._pos;\n            var index = this._source.indexOf(condition, oldPos);\n            if (index === -1) {\n                // String was not found => advanced to `eos`\n                return (this.sourceLength - oldPos);\n            }\n            if (including) {\n                // String was found => advance to include `condition`\n                return (index + condition.length - oldPos);\n            }\n            // String was found => advance right before `condition`\n            return (index - oldPos);\n        };\n        LineStream.prototype.advanceUntilString = function (condition, including) {\n            return this.advance(this._advanceUntilString(condition, including));\n        };\n        LineStream.prototype.advanceUntilString2 = function (condition, including) {\n            return this._advance2(this._advanceUntilString(condition, including));\n        };\n        // --- END\n        LineStream.prototype.resetPeekedToken = function () {\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n        };\n        LineStream.prototype.setTokenRules = function (separators, whitespace) {\n            if (this.separators !== separators || this.whitespace !== whitespace) {\n                this.separators = separators;\n                this.separatorsArr = this.stringToArray(this.separators);\n                this.whitespace = whitespace;\n                this.whitespaceArr = this.stringToArray(this.whitespace);\n                this.resetPeekedToken();\n            }\n        };\n        // --- tokens\n        LineStream.prototype.peekToken = function () {\n            if (this.tokenStart !== -1) {\n                return this._source.substring(this.tokenStart, this.tokenEnd);\n            }\n            var source = this._source, sourceLength = this.sourceLength, whitespaceArr = this.whitespaceArr, separatorsArr = this.separatorsArr, tokenStart = this._pos;\n            // Check EOS\n            if (tokenStart >= sourceLength) {\n                throw new Error('Stream is at the end');\n            }\n            // Skip whitespace\n            while (whitespaceArr[source.charCodeAt(tokenStart)] && tokenStart < sourceLength) {\n                tokenStart++;\n            }\n            var tokenEnd = tokenStart;\n            // If a separator is hit, it is a token\n            if (separatorsArr[source.charCodeAt(tokenEnd)] && tokenEnd < sourceLength) {\n                tokenEnd++;\n            }\n            else {\n                // Advance until a separator or a whitespace is hit\n                while (!separatorsArr[source.charCodeAt(tokenEnd)] && !whitespaceArr[source.charCodeAt(tokenEnd)] && tokenEnd < sourceLength) {\n                    tokenEnd++;\n                }\n            }\n            // Cache peeked token\n            this.tokenStart = tokenStart;\n            this.tokenEnd = tokenEnd;\n            return source.substring(tokenStart, tokenEnd);\n        };\n        LineStream.prototype.nextToken = function () {\n            // Check EOS\n            if (this._pos >= this.sourceLength) {\n                throw new Error('Stream is at the end');\n            }\n            // Peek token if necessary\n            var result;\n            if (this.tokenStart === -1) {\n                result = this.peekToken();\n            }\n            else {\n                result = this._source.substring(this.tokenStart, this.tokenEnd);\n            }\n            // Advance to tokenEnd\n            this._pos = this.tokenEnd;\n            // Reset peeked token\n            this.tokenStart = -1;\n            this.tokenEnd = -1;\n            return result;\n        };\n        // -- whitespace\n        LineStream.prototype.peekWhitespace = function () {\n            var source = this._source, sourceLength = this.sourceLength, whitespaceArr = this.whitespaceArr, peek = this._pos;\n            while (whitespaceArr[source.charCodeAt(peek)] && peek < sourceLength) {\n                peek++;\n            }\n            return source.substring(this._pos, peek);\n        };\n        // --- BEGIN `advanceIfRegExp`\n        LineStream.prototype._skipWhitespace = function () {\n            var source = this._source, sourceLength = this.sourceLength, whitespaceArr = this.whitespaceArr, oldPos = this._pos, peek = this._pos;\n            while (whitespaceArr[source.charCodeAt(peek)] && peek < sourceLength) {\n                peek++;\n            }\n            return (peek - oldPos);\n        };\n        LineStream.prototype.skipWhitespace = function () {\n            return this.advance(this._skipWhitespace());\n        };\n        LineStream.prototype.skipWhitespace2 = function () {\n            return this._advance2(this._skipWhitespace());\n        };\n        LineStream.STRING_TO_ARRAY_CACHE = {};\n        return LineStream;\n    }());\n    exports.LineStream = LineStream;\n});\n\ndefine(__m[25], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /*\n     * This module exports common types and functionality shared between\n     * the Monarch compiler that compiles JSON to ILexer, and the Monarch\n     * Tokenizer (that highlights at runtime)\n     */\n    /*\n     * Type definitions to be used internally to Monarch.\n     * Inside monarch we use fully typed definitions and compiled versions of the more abstract JSON descriptions.\n     */\n    (function (MonarchBracket) {\n        MonarchBracket[MonarchBracket[\"None\"] = 0] = \"None\";\n        MonarchBracket[MonarchBracket[\"Open\"] = 1] = \"Open\";\n        MonarchBracket[MonarchBracket[\"Close\"] = -1] = \"Close\";\n    })(exports.MonarchBracket || (exports.MonarchBracket = {}));\n    var MonarchBracket = exports.MonarchBracket;\n    // Small helper functions\n    /**\n     * Is a string null, undefined, or empty?\n     */\n    function empty(s) {\n        return (s ? false : true);\n    }\n    exports.empty = empty;\n    /**\n     * Puts a string to lower case if 'ignoreCase' is set.\n     */\n    function fixCase(lexer, str) {\n        return (lexer.ignoreCase && str ? str.toLowerCase() : str);\n    }\n    exports.fixCase = fixCase;\n    /**\n     * Ensures there are no bad characters in a CSS token class.\n     */\n    function sanitize(s) {\n        return s.replace(/[&<>'\"_]/g, '-'); // used on all output token CSS classes\n    }\n    exports.sanitize = sanitize;\n    // Logging\n    /**\n     * Logs a message.\n     */\n    function log(lexer, msg) {\n        console.log(lexer.languageId + \": \" + msg);\n    }\n    exports.log = log;\n    // Throwing errors\n    /**\n     * Throws error. May actually just log the error and continue.\n     */\n    function throwError(lexer, msg) {\n        throw new Error(lexer.languageId + \": \" + msg);\n    }\n    exports.throwError = throwError;\n    // Helper functions for rule finding and substitution\n    /**\n     * substituteMatches is used on lexer strings and can substitutes predefined patterns:\n     * \t\t$$  => $\n     * \t\t$#  => id\n     * \t\t$n  => matched entry n\n     * \t\t@attr => contents of lexer[attr]\n     *\n     * See documentation for more info\n     */\n    function substituteMatches(lexer, str, id, matches, state) {\n        var re = /\\$((\\$)|(#)|(\\d\\d?)|[sS](\\d\\d?)|@(\\w+))/g;\n        var stateMatches = null;\n        return str.replace(re, function (full, sub, dollar, hash, n, s, attr, ofs, total) {\n            if (!empty(dollar)) {\n                return '$'; // $$\n            }\n            if (!empty(hash)) {\n                return fixCase(lexer, id); // default $#\n            }\n            if (!empty(n) && n < matches.length) {\n                return fixCase(lexer, matches[n]); // $n\n            }\n            if (!empty(attr) && lexer && typeof (lexer[attr]) === 'string') {\n                return lexer[attr]; //@attribute\n            }\n            if (stateMatches === null) {\n                stateMatches = state.split('.');\n                stateMatches.unshift(state);\n            }\n            if (!empty(s) && s < stateMatches.length) {\n                return fixCase(lexer, stateMatches[s]); //$Sn\n            }\n            return '';\n        });\n    }\n    exports.substituteMatches = substituteMatches;\n    /**\n     * Find the tokenizer rules for a specific state (i.e. next action)\n     */\n    function findRules(lexer, state) {\n        while (state && state.length > 0) {\n            var rules = lexer.tokenizer[state];\n            if (rules) {\n                return rules;\n            }\n            var idx = state.lastIndexOf('.');\n            if (idx < 0) {\n                state = null; // no further parent\n            }\n            else {\n                state = state.substr(0, idx);\n            }\n        }\n        return null;\n    }\n    exports.findRules = findRules;\n    /**\n     * Is a certain state defined? In contrast to 'findRules' this works on a ILexerMin.\n     * This is used during compilation where we may know the defined states\n     * but not yet whether the corresponding rules are correct.\n     */\n    function stateExists(lexer, state) {\n        while (state && state.length > 0) {\n            var exist = lexer.stateNames[state];\n            if (exist) {\n                return true;\n            }\n            var idx = state.lastIndexOf('.');\n            if (idx < 0) {\n                state = null; // no further parent\n            }\n            else {\n                state = state.substr(0, idx);\n            }\n        }\n        return false;\n    }\n    exports.stateExists = stateExists;\n});\n\ndefine(__m[88], __M([1,0,12,25]), function (require, exports, objects, monarchCommon) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /*\n     * Type helpers\n     *\n     * Note: this is just for sanity checks on the JSON description which is\n     * helpful for the programmer. No checks are done anymore once the lexer is\n     * already 'compiled and checked'.\n     *\n     */\n    function isArrayOf(elemType, obj) {\n        if (!obj) {\n            return false;\n        }\n        if (!(Array.isArray(obj))) {\n            return false;\n        }\n        var idx;\n        for (idx in obj) {\n            if (obj.hasOwnProperty(idx)) {\n                if (!(elemType(obj[idx]))) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    function bool(prop, def, onerr) {\n        if (typeof (prop) === 'boolean') {\n            return prop;\n        }\n        if (onerr && (prop || def === undefined)) {\n            onerr(); // type is wrong, or there is no default\n        }\n        return (def === undefined ? null : def);\n    }\n    function string(prop, def, onerr) {\n        if (typeof (prop) === 'string') {\n            return prop;\n        }\n        if (onerr && (prop || def === undefined)) {\n            onerr(); // type is wrong, or there is no default\n        }\n        return (def === undefined ? null : def);\n    }\n    // Lexer helpers\n    /**\n     * Compiles a regular expression string, adding the 'i' flag if 'ignoreCase' is set.\n     * Also replaces @\\w+ or sequences with the content of the specified attribute\n     */\n    function compileRegExp(lexer, str) {\n        if (typeof (str) !== 'string') {\n            return null;\n        }\n        var n = 0;\n        while (str.indexOf('@') >= 0 && n < 5) {\n            n++;\n            str = str.replace(/@(\\w+)/g, function (s, attr) {\n                var sub = '';\n                if (typeof (lexer[attr]) === 'string') {\n                    sub = lexer[attr];\n                }\n                else if (lexer[attr] && lexer[attr] instanceof RegExp) {\n                    sub = lexer[attr].source;\n                }\n                else {\n                    if (lexer[attr] === undefined) {\n                        monarchCommon.throwError(lexer, 'language definition does not contain attribute \\'' + attr + '\\', used at: ' + str);\n                    }\n                    else {\n                        monarchCommon.throwError(lexer, 'attribute reference \\'' + attr + '\\' must be a string, used at: ' + str);\n                    }\n                }\n                return (monarchCommon.empty(sub) ? '' : '(?:' + sub + ')');\n            });\n        }\n        return new RegExp(str, (lexer.ignoreCase ? 'i' : ''));\n    }\n    /**\n     * Compiles guard functions for case matches.\n     * This compiles 'cases' attributes into efficient match functions.\n     *\n     */\n    function selectScrutinee(id, matches, state, num) {\n        if (num < 0) {\n            return id;\n        }\n        if (num < matches.length) {\n            return matches[num];\n        }\n        if (num >= 100) {\n            num = num - 100;\n            var parts = state.split('.');\n            parts.unshift(state);\n            if (num < parts.length) {\n                return parts[num];\n            }\n        }\n        return null;\n    }\n    function createGuard(lexer, ruleName, tkey, val) {\n        // get the scrutinee and pattern\n        var scrut = -1; // -1: $!, 0-99: $n, 100+n: $Sn\n        var oppat = tkey;\n        var matches = tkey.match(/^\\$(([sS]?)(\\d\\d?)|#)(.*)$/);\n        if (matches) {\n            if (matches[3]) {\n                scrut = parseInt(matches[3]);\n                if (matches[2]) {\n                    scrut = scrut + 100; // if [sS] present\n                }\n            }\n            oppat = matches[4];\n        }\n        // get operator\n        var op = '~';\n        var pat = oppat;\n        if (!oppat || oppat.length === 0) {\n            op = '!=';\n            pat = '';\n        }\n        else if (/^\\w*$/.test(pat)) {\n            op = '==';\n        }\n        else {\n            matches = oppat.match(/^(@|!@|~|!~|==|!=)(.*)$/);\n            if (matches) {\n                op = matches[1];\n                pat = matches[2];\n            }\n        }\n        // set the tester function\n        var tester;\n        // special case a regexp that matches just words\n        if ((op === '~' || op === '!~') && /^(\\w|\\|)*$/.test(pat)) {\n            var inWords = objects.createKeywordMatcher(pat.split('|'), lexer.ignoreCase);\n            tester = function (s) { return (op === '~' ? inWords(s) : !inWords(s)); };\n        }\n        else if (op === '@' || op === '!@') {\n            var words = lexer[pat];\n            if (!words) {\n                monarchCommon.throwError(lexer, 'the @ match target \\'' + pat + '\\' is not defined, in rule: ' + ruleName);\n            }\n            if (!(isArrayOf(function (elem) { return (typeof (elem) === 'string'); }, words))) {\n                monarchCommon.throwError(lexer, 'the @ match target \\'' + pat + '\\' must be an array of strings, in rule: ' + ruleName);\n            }\n            var inWords = objects.createKeywordMatcher(words, lexer.ignoreCase);\n            tester = function (s) { return (op === '@' ? inWords(s) : !inWords(s)); };\n        }\n        else if (op === '~' || op === '!~') {\n            if (pat.indexOf('$') < 0) {\n                // precompile regular expression\n                var re = compileRegExp(lexer, '^' + pat + '$');\n                tester = function (s) { return (op === '~' ? re.test(s) : !re.test(s)); };\n            }\n            else {\n                tester = function (s, id, matches, state) {\n                    var re = compileRegExp(lexer, '^' + monarchCommon.substituteMatches(lexer, pat, id, matches, state) + '$');\n                    return re.test(s);\n                };\n            }\n        }\n        else {\n            if (pat.indexOf('$') < 0) {\n                var patx = monarchCommon.fixCase(lexer, pat);\n                tester = function (s) { return (op === '==' ? s === patx : s !== patx); };\n            }\n            else {\n                var patx = monarchCommon.fixCase(lexer, pat);\n                tester = function (s, id, matches, state, eos) {\n                    var patexp = monarchCommon.substituteMatches(lexer, patx, id, matches, state);\n                    return (op === '==' ? s === patexp : s !== patexp);\n                };\n            }\n        }\n        // return the branch object\n        if (scrut === -1) {\n            return {\n                name: tkey, value: val, test: function (id, matches, state, eos) {\n                    return tester(id, id, matches, state, eos);\n                }\n            };\n        }\n        else {\n            return {\n                name: tkey, value: val, test: function (id, matches, state, eos) {\n                    var scrutinee = selectScrutinee(id, matches, state, scrut);\n                    return tester(!scrutinee ? '' : scrutinee, id, matches, state, eos);\n                }\n            };\n        }\n    }\n    /**\n     * Compiles an action: i.e. optimize regular expressions and case matches\n     * and do many sanity checks.\n     *\n     * This is called only during compilation but if the lexer definition\n     * contains user functions as actions (which is usually not allowed), then this\n     * may be called during lexing. It is important therefore to compile common cases efficiently\n     */\n    function compileAction(lexer, ruleName, action) {\n        if (!action) {\n            return { token: '' };\n        }\n        else if (typeof (action) === 'string') {\n            return action; // { token: action };\n        }\n        else if (action.token || action.token === '') {\n            if (typeof (action.token) !== 'string') {\n                monarchCommon.throwError(lexer, 'a \\'token\\' attribute must be of type string, in rule: ' + ruleName);\n                return { token: '' };\n            }\n            else {\n                // only copy specific typed fields (only happens once during compile Lexer)\n                var newAction = { token: action.token };\n                if (action.token.indexOf('$') >= 0) {\n                    newAction.tokenSubst = true;\n                }\n                if (typeof (action.bracket) === 'string') {\n                    if (action.bracket === '@open') {\n                        newAction.bracket = monarchCommon.MonarchBracket.Open;\n                    }\n                    else if (action.bracket === '@close') {\n                        newAction.bracket = monarchCommon.MonarchBracket.Close;\n                    }\n                    else {\n                        monarchCommon.throwError(lexer, 'a \\'bracket\\' attribute must be either \\'@open\\' or \\'@close\\', in rule: ' + ruleName);\n                    }\n                }\n                if (action.next) {\n                    if (typeof (action.next) !== 'string') {\n                        monarchCommon.throwError(lexer, 'the next state must be a string value in rule: ' + ruleName);\n                    }\n                    else {\n                        var next = action.next;\n                        if (!/^(@pop|@push|@popall)$/.test(next)) {\n                            if (next[0] === '@') {\n                                next = next.substr(1); // peel off starting @ sign\n                            }\n                            if (next.indexOf('$') < 0) {\n                                if (!monarchCommon.stateExists(lexer, monarchCommon.substituteMatches(lexer, next, '', [], ''))) {\n                                    monarchCommon.throwError(lexer, 'the next state \\'' + action.next + '\\' is not defined in rule: ' + ruleName);\n                                }\n                            }\n                        }\n                        newAction.next = next;\n                    }\n                }\n                if (typeof (action.goBack) === 'number') {\n                    newAction.goBack = action.goBack;\n                }\n                if (typeof (action.switchTo) === 'string') {\n                    newAction.switchTo = action.switchTo;\n                }\n                if (typeof (action.log) === 'string') {\n                    newAction.log = action.log;\n                }\n                if (typeof (action.nextEmbedded) === 'string') {\n                    newAction.nextEmbedded = action.nextEmbedded;\n                    lexer.usesEmbedded = true;\n                }\n                return newAction;\n            }\n        }\n        else if (Array.isArray(action)) {\n            var results = [];\n            var idx;\n            for (idx in action) {\n                if (action.hasOwnProperty(idx)) {\n                    results[idx] = compileAction(lexer, ruleName, action[idx]);\n                }\n            }\n            return { group: results };\n        }\n        else if (action.cases) {\n            // build an array of test cases\n            var cases = [];\n            // for each case, push a test function and result value\n            var tkey;\n            for (tkey in action.cases) {\n                if (action.cases.hasOwnProperty(tkey)) {\n                    var val = compileAction(lexer, ruleName, action.cases[tkey]);\n                    // what kind of case\n                    if (tkey === '@default' || tkey === '@' || tkey === '') {\n                        cases.push({ test: null, value: val, name: tkey });\n                    }\n                    else if (tkey === '@eos') {\n                        cases.push({ test: function (id, matches, state, eos) { return eos; }, value: val, name: tkey });\n                    }\n                    else {\n                        cases.push(createGuard(lexer, ruleName, tkey, val)); // call separate function to avoid local variable capture\n                    }\n                }\n            }\n            // create a matching function\n            var def = lexer.defaultToken;\n            return {\n                test: function (id, matches, state, eos) {\n                    var idx;\n                    for (idx in cases) {\n                        if (cases.hasOwnProperty(idx)) {\n                            var didmatch = (!cases[idx].test || cases[idx].test(id, matches, state, eos));\n                            if (didmatch) {\n                                return cases[idx].value;\n                            }\n                        }\n                    }\n                    return def;\n                }\n            };\n        }\n        else {\n            monarchCommon.throwError(lexer, 'an action must be a string, an object with a \\'token\\' or \\'cases\\' attribute, or an array of actions; in rule: ' + ruleName);\n            return '';\n        }\n    }\n    /**\n     * Helper class for creating matching rules\n     */\n    var Rule = (function () {\n        function Rule(name) {\n            this.regex = new RegExp('');\n            this.action = { token: '' };\n            this.matchOnlyAtLineStart = false;\n            this.name = '';\n            this.name = name;\n        }\n        Rule.prototype.setRegex = function (lexer, re) {\n            var sregex;\n            if (typeof (re) === 'string') {\n                sregex = re;\n            }\n            else if (re instanceof RegExp) {\n                sregex = re.source;\n            }\n            else {\n                monarchCommon.throwError(lexer, 'rules must start with a match string or regular expression: ' + this.name);\n            }\n            this.matchOnlyAtLineStart = (sregex.length > 0 && sregex[0] === '^');\n            this.name = this.name + ': ' + sregex;\n            this.regex = compileRegExp(lexer, '^(?:' + (this.matchOnlyAtLineStart ? sregex.substr(1) : sregex) + ')');\n        };\n        Rule.prototype.setAction = function (lexer, act) {\n            this.action = compileAction(lexer, this.name, act);\n        };\n        return Rule;\n    }());\n    /**\n     * Compiles a json description function into json where all regular expressions,\n     * case matches etc, are compiled and all include rules are expanded.\n     * We also compile the bracket definitions, supply defaults, and do many sanity checks.\n     * If the 'jsonStrict' parameter is 'false', we allow at certain locations\n     * regular expression objects and functions that get called during lexing.\n     * (Currently we have no samples that need this so perhaps we should always have\n     * jsonStrict to true).\n     */\n    function compile(languageId, json) {\n        if (!json || typeof (json) !== 'object') {\n            throw new Error('Monarch: expecting a language definition object');\n        }\n        // Create our lexer\n        var lexer = {};\n        lexer.languageId = languageId;\n        lexer.noThrow = false; // raise exceptions during compilation\n        lexer.maxStack = 100;\n        // Set standard fields: be defensive about types\n        lexer.start = string(json.start);\n        lexer.ignoreCase = bool(json.ignoreCase, false);\n        lexer.tokenPostfix = string(json.tokenPostfix, '.' + lexer.languageId);\n        lexer.defaultToken = string(json.defaultToken, 'source', function () { monarchCommon.throwError(lexer, 'the \\'defaultToken\\' must be a string'); });\n        lexer.usesEmbedded = false; // becomes true if we find a nextEmbedded action\n        // For calling compileAction later on\n        var lexerMin = json;\n        lexerMin.languageId = languageId;\n        lexerMin.ignoreCase = lexer.ignoreCase;\n        lexerMin.noThrow = lexer.noThrow;\n        lexerMin.usesEmbedded = lexer.usesEmbedded;\n        lexerMin.stateNames = json.tokenizer;\n        lexerMin.defaultToken = lexer.defaultToken;\n        // Compile an array of rules into newrules where RegExp objects are created.\n        function addRules(state, newrules, rules) {\n            var idx;\n            for (idx in rules) {\n                if (rules.hasOwnProperty(idx)) {\n                    var rule = rules[idx];\n                    var include = rule.include;\n                    if (include) {\n                        if (typeof (include) !== 'string') {\n                            monarchCommon.throwError(lexer, 'an \\'include\\' attribute must be a string at: ' + state);\n                        }\n                        if (include[0] === '@') {\n                            include = include.substr(1); // peel off starting @\n                        }\n                        if (!json.tokenizer[include]) {\n                            monarchCommon.throwError(lexer, 'include target \\'' + include + '\\' is not defined at: ' + state);\n                        }\n                        addRules(state + '.' + include, newrules, json.tokenizer[include]);\n                    }\n                    else {\n                        var newrule = new Rule(state);\n                        // Set up new rule attributes\n                        if (Array.isArray(rule) && rule.length >= 1 && rule.length <= 3) {\n                            newrule.setRegex(lexerMin, rule[0]);\n                            if (rule.length >= 3) {\n                                if (typeof (rule[1]) === 'string') {\n                                    newrule.setAction(lexerMin, { token: rule[1], next: rule[2] });\n                                }\n                                else if (typeof (rule[1]) === 'object') {\n                                    var rule1 = rule[1];\n                                    rule1.next = rule[2];\n                                    newrule.setAction(lexerMin, rule1);\n                                }\n                                else {\n                                    monarchCommon.throwError(lexer, 'a next state as the last element of a rule can only be given if the action is either an object or a string, at: ' + state);\n                                }\n                            }\n                            else {\n                                newrule.setAction(lexerMin, rule[1]);\n                            }\n                        }\n                        else {\n                            if (!rule.regex) {\n                                monarchCommon.throwError(lexer, 'a rule must either be an array, or an object with a \\'regex\\' or \\'include\\' field at: ' + state);\n                            }\n                            if (rule.name) {\n                                newrule.name = string(rule.name);\n                            }\n                            if (rule.matchOnlyAtStart) {\n                                newrule.matchOnlyAtLineStart = bool(rule.matchOnlyAtLineStart);\n                            }\n                            newrule.setRegex(lexerMin, rule.regex);\n                            newrule.setAction(lexerMin, rule.action);\n                        }\n                        newrules.push(newrule);\n                    }\n                }\n            }\n        }\n        // compile the tokenizer rules\n        if (!json.tokenizer || typeof (json.tokenizer) !== 'object') {\n            monarchCommon.throwError(lexer, 'a language definition must define the \\'tokenizer\\' attribute as an object');\n        }\n        lexer.tokenizer = [];\n        var key;\n        for (key in json.tokenizer) {\n            if (json.tokenizer.hasOwnProperty(key)) {\n                if (!lexer.start) {\n                    lexer.start = key;\n                }\n                var rules = json.tokenizer[key];\n                lexer.tokenizer[key] = new Array();\n                addRules('tokenizer.' + key, lexer.tokenizer[key], rules);\n            }\n        }\n        lexer.usesEmbedded = lexerMin.usesEmbedded; // can be set during compileAction\n        // Set simple brackets\n        if (json.brackets) {\n            if (!(Array.isArray(json.brackets))) {\n                monarchCommon.throwError(lexer, 'the \\'brackets\\' attribute must be defined as an array');\n            }\n        }\n        else {\n            json.brackets = [\n                { open: '{', close: '}', token: 'delimiter.curly' },\n                { open: '[', close: ']', token: 'delimiter.square' },\n                { open: '(', close: ')', token: 'delimiter.parenthesis' },\n                { open: '<', close: '>', token: 'delimiter.angle' }];\n        }\n        var brackets = [];\n        for (var bracketIdx in json.brackets) {\n            if (json.brackets.hasOwnProperty(bracketIdx)) {\n                var desc = json.brackets[bracketIdx];\n                if (desc && Array.isArray(desc) && desc.length === 3) {\n                    desc = { token: desc[2], open: desc[0], close: desc[1] };\n                }\n                if (desc.open === desc.close) {\n                    monarchCommon.throwError(lexer, 'open and close brackets in a \\'brackets\\' attribute must be different: ' + desc.open +\n                        '\\n hint: use the \\'bracket\\' attribute if matching on equal brackets is required.');\n                }\n                if (typeof (desc.open) === 'string' && typeof (desc.token) === 'string') {\n                    brackets.push({\n                        token: string(desc.token) + lexer.tokenPostfix,\n                        open: monarchCommon.fixCase(lexer, string(desc.open)),\n                        close: monarchCommon.fixCase(lexer, string(desc.close))\n                    });\n                }\n                else {\n                    monarchCommon.throwError(lexer, 'every element in the \\'brackets\\' array must be a \\'{open,close,token}\\' object or array');\n                }\n            }\n        }\n        lexer.brackets = brackets;\n        // Disable throw so the syntax highlighter goes, no matter what\n        lexer.noThrow = true;\n        return lexer;\n    }\n    exports.compile = compile;\n});\n\ndefine(__m[48], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var NullState = (function () {\n        function NullState(mode, stateData) {\n            this.mode = mode;\n            this.stateData = stateData;\n        }\n        NullState.prototype.clone = function () {\n            var stateDataClone = (this.stateData ? this.stateData.clone() : null);\n            return new NullState(this.mode, stateDataClone);\n        };\n        NullState.prototype.equals = function (other) {\n            if (this.mode !== other.getMode()) {\n                return false;\n            }\n            var otherStateData = other.getStateData();\n            if (!this.stateData && !otherStateData) {\n                return true;\n            }\n            if (this.stateData && otherStateData) {\n                return this.stateData.equals(otherStateData);\n            }\n            return false;\n        };\n        NullState.prototype.getMode = function () {\n            return this.mode;\n        };\n        NullState.prototype.tokenize = function (stream) {\n            stream.advanceToEOS();\n            return { type: '' };\n        };\n        NullState.prototype.getStateData = function () {\n            return this.stateData;\n        };\n        NullState.prototype.setStateData = function (stateData) {\n            this.stateData = stateData;\n        };\n        return NullState;\n    }());\n    exports.NullState = NullState;\n    var NullMode = (function () {\n        function NullMode() {\n        }\n        NullMode.prototype.getId = function () {\n            return NullMode.ID;\n        };\n        NullMode.prototype.toSimplifiedMode = function () {\n            return this;\n        };\n        NullMode.ID = 'vs.editor.modes.nullMode';\n        return NullMode;\n    }());\n    exports.NullMode = NullMode;\n    function nullTokenize(mode, buffer, state, deltaOffset, stopAtOffset) {\n        if (deltaOffset === void 0) { deltaOffset = 0; }\n        var tokens = [\n            {\n                startIndex: deltaOffset,\n                type: ''\n            }\n        ];\n        var modeTransitions = [\n            {\n                startIndex: deltaOffset,\n                mode: mode\n            }\n        ];\n        return {\n            tokens: tokens,\n            actualStopOffset: deltaOffset + buffer.length,\n            endState: state,\n            modeTransitions: modeTransitions\n        };\n    }\n    exports.nullTokenize = nullTokenize;\n});\n\ndefine(__m[14], __M([1,0,3,12,18]), function (require, exports, strings, objects, modeTransition_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var Token = (function () {\n        function Token(startIndex, type) {\n            this.startIndex = startIndex;\n            this.type = type;\n        }\n        Token.prototype.toString = function () {\n            return '(' + this.startIndex + ', ' + this.type + ')';\n        };\n        return Token;\n    }());\n    exports.Token = Token;\n    var LineTokens = (function () {\n        function LineTokens(tokens, modeTransitions, actualStopOffset, endState) {\n            this.tokens = tokens;\n            this.modeTransitions = modeTransitions;\n            this.actualStopOffset = actualStopOffset;\n            this.endState = endState;\n            this.retokenize = null;\n        }\n        return LineTokens;\n    }());\n    exports.LineTokens = LineTokens;\n    function handleEvent(context, offset, runner) {\n        var modeTransitions = context.modeTransitions;\n        if (modeTransitions.length === 1) {\n            return runner(modeTransitions[0].modeId, context, offset);\n        }\n        var modeIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, offset);\n        var nestedMode = modeTransitions[modeIndex].mode;\n        var modeStartIndex = modeTransitions[modeIndex].startIndex;\n        var firstTokenInModeIndex = context.findIndexOfOffset(modeStartIndex);\n        var nextCharacterAfterModeIndex = -1;\n        var nextTokenAfterMode = -1;\n        if (modeIndex + 1 < modeTransitions.length) {\n            nextTokenAfterMode = context.findIndexOfOffset(modeTransitions[modeIndex + 1].startIndex);\n            nextCharacterAfterModeIndex = context.getTokenStartIndex(nextTokenAfterMode);\n        }\n        else {\n            nextTokenAfterMode = context.getTokenCount();\n            nextCharacterAfterModeIndex = context.getLineContent().length;\n        }\n        var firstTokenCharacterOffset = context.getTokenStartIndex(firstTokenInModeIndex);\n        var newCtx = new FilteredLineContext(context, nestedMode, firstTokenInModeIndex, nextTokenAfterMode, firstTokenCharacterOffset, nextCharacterAfterModeIndex);\n        return runner(nestedMode.getId(), newCtx, offset - firstTokenCharacterOffset);\n    }\n    exports.handleEvent = handleEvent;\n    var FilteredLineContext = (function () {\n        function FilteredLineContext(actual, mode, firstTokenInModeIndex, nextTokenAfterMode, firstTokenCharacterOffset, nextCharacterAfterModeIndex) {\n            this.modeTransitions = [new modeTransition_1.ModeTransition(0, mode)];\n            this._actual = actual;\n            this._firstTokenInModeIndex = firstTokenInModeIndex;\n            this._nextTokenAfterMode = nextTokenAfterMode;\n            this._firstTokenCharacterOffset = firstTokenCharacterOffset;\n            this._nextCharacterAfterModeIndex = nextCharacterAfterModeIndex;\n        }\n        FilteredLineContext.prototype.getLineContent = function () {\n            var actualLineContent = this._actual.getLineContent();\n            return actualLineContent.substring(this._firstTokenCharacterOffset, this._nextCharacterAfterModeIndex);\n        };\n        FilteredLineContext.prototype.getTokenCount = function () {\n            return this._nextTokenAfterMode - this._firstTokenInModeIndex;\n        };\n        FilteredLineContext.prototype.findIndexOfOffset = function (offset) {\n            return this._actual.findIndexOfOffset(offset + this._firstTokenCharacterOffset) - this._firstTokenInModeIndex;\n        };\n        FilteredLineContext.prototype.getTokenStartIndex = function (tokenIndex) {\n            return this._actual.getTokenStartIndex(tokenIndex + this._firstTokenInModeIndex) - this._firstTokenCharacterOffset;\n        };\n        FilteredLineContext.prototype.getTokenEndIndex = function (tokenIndex) {\n            return this._actual.getTokenEndIndex(tokenIndex + this._firstTokenInModeIndex) - this._firstTokenCharacterOffset;\n        };\n        FilteredLineContext.prototype.getTokenType = function (tokenIndex) {\n            return this._actual.getTokenType(tokenIndex + this._firstTokenInModeIndex);\n        };\n        FilteredLineContext.prototype.getTokenText = function (tokenIndex) {\n            return this._actual.getTokenText(tokenIndex + this._firstTokenInModeIndex);\n        };\n        return FilteredLineContext;\n    }());\n    exports.FilteredLineContext = FilteredLineContext;\n    var IGNORE_IN_TOKENS = /\\b(comment|string|regex)\\b/;\n    function ignoreBracketsInToken(tokenType) {\n        return IGNORE_IN_TOKENS.test(tokenType);\n    }\n    exports.ignoreBracketsInToken = ignoreBracketsInToken;\n    // TODO@Martin: find a better home for this code:\n    // TODO@Martin: modify suggestSupport to return a boolean if snippets should be presented or not\n    //       and turn this into a real registry\n    var SnippetsRegistry = (function () {\n        function SnippetsRegistry() {\n        }\n        SnippetsRegistry.registerDefaultSnippets = function (modeId, snippets) {\n            this._defaultSnippets[modeId] = (this._defaultSnippets[modeId] || []).concat(snippets);\n        };\n        SnippetsRegistry.registerSnippets = function (modeId, path, snippets) {\n            var snippetsByMode = this._snippets[modeId];\n            if (!snippetsByMode) {\n                this._snippets[modeId] = snippetsByMode = {};\n            }\n            snippetsByMode[path] = snippets;\n        };\n        // the previous\n        SnippetsRegistry.getNonWhitespacePrefix = function (model, position) {\n            var line = model.getLineContent(position.lineNumber);\n            var match = line.match(/[^\\s]+$/);\n            if (match) {\n                return match[0];\n            }\n            return '';\n        };\n        SnippetsRegistry.getSnippets = function (model, position) {\n            var word = model.getWordAtPosition(position);\n            var currentWord = word ? word.word.substring(0, position.column - word.startColumn).toLowerCase() : '';\n            var currentFullWord = SnippetsRegistry.getNonWhitespacePrefix(model, position).toLowerCase();\n            var result = {\n                currentWord: currentWord,\n                incomplete: currentWord.length === 0,\n                suggestions: []\n            };\n            var modeId = model.getModeId();\n            var snippets = [];\n            var snipppetsByMode = this._snippets[modeId];\n            if (snipppetsByMode) {\n                for (var s in snipppetsByMode) {\n                    snippets = snippets.concat(snipppetsByMode[s]);\n                }\n            }\n            var defaultSnippets = this._defaultSnippets[modeId];\n            if (defaultSnippets) {\n                snippets = snippets.concat(defaultSnippets);\n            }\n            // to avoid that snippets are too prominent in the intellisense proposals:\n            // enforce that current word is matched or the position is after a whitespace\n            snippets.forEach(function (p) {\n                if (currentWord.length === 0 && currentFullWord.length === 0) {\n                }\n                else {\n                    var label = p.label.toLowerCase();\n                    // force that the current word or full word matches with the snippet prefix\n                    if (currentWord.length > 0 && strings.startsWith(label, currentWord)) {\n                    }\n                    else if (currentFullWord.length > currentWord.length && strings.startsWith(label, currentFullWord)) {\n                        p = objects.clone(p);\n                        p.overwriteBefore = currentFullWord.length;\n                    }\n                    else {\n                        return;\n                    }\n                }\n                result.suggestions.push(p);\n            });\n            // if (result.suggestions.length > 0) {\n            // \tif (word) {\n            // \t\t// Push also the current word as first suggestion, to avoid unexpected snippet acceptance on Enter.\n            // \t\tresult.suggestions = result.suggestions.slice(0);\n            // \t\tresult.suggestions.unshift({\n            // \t\t\tcodeSnippet: word.word,\n            // \t\t\tlabel: word.word,\n            // \t\t\ttype: 'text'\n            // \t\t});\n            // \t}\n            // \tresult.incomplete = true;\n            // }\n            return result;\n        };\n        SnippetsRegistry._defaultSnippets = Object.create(null);\n        SnippetsRegistry._snippets = Object.create(null);\n        return SnippetsRegistry;\n    }());\n    exports.SnippetsRegistry = SnippetsRegistry;\n});\n\ndefine(__m[94], __M([1,0,14]), function (require, exports, supports_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var CharacterPairSupport = (function () {\n        function CharacterPairSupport(registry, modeId, config) {\n            this._registry = registry;\n            this._modeId = modeId;\n            this._autoClosingPairs = config.autoClosingPairs;\n            if (!this._autoClosingPairs) {\n                this._autoClosingPairs = config.brackets ? config.brackets.map(function (b) { return ({ open: b[0], close: b[1] }); }) : [];\n            }\n            this._surroundingPairs = config.surroundingPairs || this._autoClosingPairs;\n        }\n        CharacterPairSupport.prototype.getAutoClosingPairs = function () {\n            return this._autoClosingPairs;\n        };\n        CharacterPairSupport.prototype.shouldAutoClosePair = function (character, context, offset) {\n            var _this = this;\n            return supports_1.handleEvent(context, offset, function (nestedModeId, context, offset) {\n                if (_this._modeId === nestedModeId) {\n                    // Always complete on empty line\n                    if (context.getTokenCount() === 0) {\n                        return true;\n                    }\n                    var tokenIndex = context.findIndexOfOffset(offset - 1);\n                    var tokenType = context.getTokenType(tokenIndex);\n                    for (var i = 0; i < _this._autoClosingPairs.length; ++i) {\n                        if (_this._autoClosingPairs[i].open === character) {\n                            if (_this._autoClosingPairs[i].notIn) {\n                                for (var notInIndex = 0; notInIndex < _this._autoClosingPairs[i].notIn.length; ++notInIndex) {\n                                    if (tokenType.indexOf(_this._autoClosingPairs[i].notIn[notInIndex]) > -1) {\n                                        return false;\n                                    }\n                                }\n                            }\n                            break;\n                        }\n                    }\n                    return true;\n                }\n                var characterPairSupport = _this._registry.getCharacterPairSupport(nestedModeId);\n                if (characterPairSupport) {\n                    return characterPairSupport.shouldAutoClosePair(character, context, offset);\n                }\n                return null;\n            });\n        };\n        CharacterPairSupport.prototype.getSurroundingPairs = function () {\n            return this._surroundingPairs;\n        };\n        return CharacterPairSupport;\n    }());\n    exports.CharacterPairSupport = CharacterPairSupport;\n});\n\ndefine(__m[28], __M([1,0,3,29]), function (require, exports, strings, range_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var RichEditBrackets = (function () {\n        function RichEditBrackets(modeId, brackets) {\n            var _this = this;\n            this.brackets = brackets.map(function (b) {\n                return {\n                    modeId: modeId,\n                    open: b[0],\n                    close: b[1],\n                    forwardRegex: getRegexForBracketPair({ open: b[0], close: b[1] }),\n                    reversedRegex: getReversedRegexForBracketPair({ open: b[0], close: b[1] })\n                };\n            });\n            this.forwardRegex = getRegexForBrackets(this.brackets);\n            this.reversedRegex = getReversedRegexForBrackets(this.brackets);\n            this.textIsBracket = {};\n            this.textIsOpenBracket = {};\n            this.maxBracketLength = 0;\n            this.brackets.forEach(function (b) {\n                _this.textIsBracket[b.open] = b;\n                _this.textIsBracket[b.close] = b;\n                _this.textIsOpenBracket[b.open] = true;\n                _this.textIsOpenBracket[b.close] = false;\n                _this.maxBracketLength = Math.max(_this.maxBracketLength, b.open.length);\n                _this.maxBracketLength = Math.max(_this.maxBracketLength, b.close.length);\n            });\n        }\n        return RichEditBrackets;\n    }());\n    exports.RichEditBrackets = RichEditBrackets;\n    function once(keyFn, computeFn) {\n        var cache = {};\n        return function (input) {\n            var key = keyFn(input);\n            if (!cache.hasOwnProperty(key)) {\n                cache[key] = computeFn(input);\n            }\n            return cache[key];\n        };\n    }\n    var getRegexForBracketPair = once(function (input) { return (input.open + \";\" + input.close); }, function (input) {\n        return createOrRegex([input.open, input.close]);\n    });\n    var getReversedRegexForBracketPair = once(function (input) { return (input.open + \";\" + input.close); }, function (input) {\n        return createOrRegex([toReversedString(input.open), toReversedString(input.close)]);\n    });\n    var getRegexForBrackets = once(function (input) { return input.map(function (b) { return (b.open + \";\" + b.close); }).join(';'); }, function (input) {\n        var pieces = [];\n        input.forEach(function (b) {\n            pieces.push(b.open);\n            pieces.push(b.close);\n        });\n        return createOrRegex(pieces);\n    });\n    var getReversedRegexForBrackets = once(function (input) { return input.map(function (b) { return (b.open + \";\" + b.close); }).join(';'); }, function (input) {\n        var pieces = [];\n        input.forEach(function (b) {\n            pieces.push(toReversedString(b.open));\n            pieces.push(toReversedString(b.close));\n        });\n        return createOrRegex(pieces);\n    });\n    function createOrRegex(pieces) {\n        var regexStr = \"(\" + pieces.map(strings.escapeRegExpCharacters).join(')|(') + \")\";\n        return strings.createRegExp(regexStr, true, false, false, false);\n    }\n    function toReversedString(str) {\n        var reversedStr = '';\n        for (var i = str.length - 1; i >= 0; i--) {\n            reversedStr += str.charAt(i);\n        }\n        return reversedStr;\n    }\n    var BracketsUtils = (function () {\n        function BracketsUtils() {\n        }\n        BracketsUtils._findPrevBracketInText = function (reversedBracketRegex, lineNumber, reversedText, offset) {\n            var m = reversedText.match(reversedBracketRegex);\n            if (!m) {\n                return null;\n            }\n            var matchOffset = reversedText.length - m.index;\n            var matchLength = m[0].length;\n            var absoluteMatchOffset = offset + matchOffset;\n            return new range_1.Range(lineNumber, absoluteMatchOffset - matchLength + 1, lineNumber, absoluteMatchOffset + 1);\n        };\n        BracketsUtils.findPrevBracketInToken = function (reversedBracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd) {\n            // Because JS does not support backwards regex search, we search forwards in a reversed string with a reversed regex ;)\n            var currentTokenReversedText = '';\n            for (var index = currentTokenEnd - 1; index >= currentTokenStart; index--) {\n                currentTokenReversedText += lineText.charAt(index);\n            }\n            return this._findPrevBracketInText(reversedBracketRegex, lineNumber, currentTokenReversedText, currentTokenStart);\n        };\n        BracketsUtils.findNextBracketInText = function (bracketRegex, lineNumber, text, offset) {\n            var m = text.match(bracketRegex);\n            if (!m) {\n                return null;\n            }\n            var matchOffset = m.index;\n            var matchLength = m[0].length;\n            var absoluteMatchOffset = offset + matchOffset;\n            return new range_1.Range(lineNumber, absoluteMatchOffset + 1, lineNumber, absoluteMatchOffset + 1 + matchLength);\n        };\n        BracketsUtils.findNextBracketInToken = function (bracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd) {\n            var currentTokenText = lineText.substring(currentTokenStart, currentTokenEnd);\n            return this.findNextBracketInText(bracketRegex, lineNumber, currentTokenText, currentTokenStart);\n        };\n        return BracketsUtils;\n    }());\n    exports.BracketsUtils = BracketsUtils;\n});\n\ndefine(__m[99], __M([1,0,3,14,28]), function (require, exports, strings, supports_1, richEditBrackets_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var BracketElectricCharacterSupport = (function () {\n        function BracketElectricCharacterSupport(registry, modeId, brackets, contribution) {\n            this._registry = registry;\n            this._modeId = modeId;\n            this.contribution = contribution || {};\n            this.brackets = new Brackets(modeId, brackets, this.contribution.docComment);\n        }\n        BracketElectricCharacterSupport.prototype.getElectricCharacters = function () {\n            if (Array.isArray(this.contribution.embeddedElectricCharacters)) {\n                return this.contribution.embeddedElectricCharacters.concat(this.brackets.getElectricCharacters());\n            }\n            return this.brackets.getElectricCharacters();\n        };\n        BracketElectricCharacterSupport.prototype.onElectricCharacter = function (context, offset) {\n            var _this = this;\n            return supports_1.handleEvent(context, offset, function (nestedModeId, context, offset) {\n                if (_this._modeId === nestedModeId) {\n                    return _this.brackets.onElectricCharacter(context, offset);\n                }\n                var electricCharacterSupport = _this._registry.getElectricCharacterSupport(nestedModeId);\n                if (electricCharacterSupport) {\n                    return electricCharacterSupport.onElectricCharacter(context, offset);\n                }\n                return null;\n            });\n        };\n        return BracketElectricCharacterSupport;\n    }());\n    exports.BracketElectricCharacterSupport = BracketElectricCharacterSupport;\n    var Brackets = (function () {\n        function Brackets(modeId, richEditBrackets, docComment) {\n            if (docComment === void 0) { docComment = null; }\n            this._modeId = modeId;\n            this._richEditBrackets = richEditBrackets;\n            this._docComment = docComment ? docComment : null;\n        }\n        Brackets.prototype.getElectricCharacters = function () {\n            var result = [];\n            if (this._richEditBrackets) {\n                for (var i = 0, len = this._richEditBrackets.brackets.length; i < len; i++) {\n                    var bracketPair = this._richEditBrackets.brackets[i];\n                    var lastChar = bracketPair.close.charAt(bracketPair.close.length - 1);\n                    result.push(lastChar);\n                }\n            }\n            // Doc comments\n            if (this._docComment) {\n                result.push(this._docComment.open.charAt(this._docComment.open.length - 1));\n            }\n            // Filter duplicate entries\n            result = result.filter(function (item, pos, array) {\n                return array.indexOf(item) === pos;\n            });\n            return result;\n        };\n        Brackets.prototype.onElectricCharacter = function (context, offset) {\n            if (context.getTokenCount() === 0) {\n                return null;\n            }\n            return (this._onElectricCharacterDocComment(context, offset) ||\n                this._onElectricCharacterStandardBrackets(context, offset));\n        };\n        Brackets.prototype.containsTokenTypes = function (fullTokenSpec, tokensToLookFor) {\n            var array = tokensToLookFor.split('.');\n            for (var i = 0; i < array.length; ++i) {\n                if (fullTokenSpec.indexOf(array[i]) < 0) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        Brackets.prototype._onElectricCharacterStandardBrackets = function (context, offset) {\n            if (!this._richEditBrackets || this._richEditBrackets.brackets.length === 0) {\n                return null;\n            }\n            var reversedBracketRegex = this._richEditBrackets.reversedRegex;\n            var lineText = context.getLineContent();\n            var tokenIndex = context.findIndexOfOffset(offset);\n            var tokenStart = context.getTokenStartIndex(tokenIndex);\n            var tokenEnd = offset + 1;\n            var firstNonWhitespaceIndex = strings.firstNonWhitespaceIndex(context.getLineContent());\n            if (firstNonWhitespaceIndex !== -1 && firstNonWhitespaceIndex < tokenStart) {\n                return null;\n            }\n            if (!supports_1.ignoreBracketsInToken(context.getTokenType(tokenIndex))) {\n                var r = richEditBrackets_1.BracketsUtils.findPrevBracketInToken(reversedBracketRegex, 1, lineText, tokenStart, tokenEnd);\n                if (r) {\n                    var text = lineText.substring(r.startColumn - 1, r.endColumn - 1);\n                    var isOpen = this._richEditBrackets.textIsOpenBracket[text];\n                    if (!isOpen) {\n                        return {\n                            matchOpenBracket: text\n                        };\n                    }\n                }\n            }\n            return null;\n        };\n        Brackets.prototype._onElectricCharacterDocComment = function (context, offset) {\n            // We only auto-close, so do nothing if there is no closing part.\n            if (!this._docComment || !this._docComment.close) {\n                return null;\n            }\n            var line = context.getLineContent();\n            var char = line[offset];\n            // See if the right electric character was pressed\n            if (char !== this._docComment.open.charAt(this._docComment.open.length - 1)) {\n                return null;\n            }\n            // If this line already contains the closing tag, do nothing.\n            if (line.indexOf(this._docComment.close, offset) >= 0) {\n                return null;\n            }\n            // If we're not in a documentation comment, do nothing.\n            var lastTokenIndex = context.findIndexOfOffset(offset);\n            if (!this.containsTokenTypes(context.getTokenType(lastTokenIndex), this._docComment.scope)) {\n                return null;\n            }\n            if (line.substring(context.getTokenStartIndex(lastTokenIndex), offset + 1 /* include electric char*/) !== this._docComment.open) {\n                return null;\n            }\n            return { appendText: this._docComment.close };\n        };\n        return Brackets;\n    }());\n    exports.Brackets = Brackets;\n});\n\ndefine(__m[53], __M([1,0,62,48,14]), function (require, exports, lineStream_1, nullMode_1, supports_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function isFunction(something) {\n        return typeof something === 'function';\n    }\n    var TokenizationSupport = (function () {\n        function TokenizationSupport(mode, customization, supportsNestedModes) {\n            this._mode = mode;\n            this.customization = customization;\n            this.supportsNestedModes = supportsNestedModes;\n            this._embeddedModesListeners = {};\n            if (this.supportsNestedModes) {\n                if (!this._mode.setTokenizationSupport) {\n                    throw new Error('Cannot be a mode with nested modes unless I can emit a tokenizationSupport changed event!');\n                }\n            }\n            this.defaults = {\n                enterNestedMode: !isFunction(customization.enterNestedMode),\n                getNestedMode: !isFunction(customization.getNestedMode),\n                getNestedModeInitialState: !isFunction(customization.getNestedModeInitialState),\n                getLeavingNestedModeData: !isFunction(customization.getLeavingNestedModeData),\n                onReturningFromNestedMode: !isFunction(customization.onReturningFromNestedMode)\n            };\n        }\n        TokenizationSupport.prototype.dispose = function () {\n            for (var listener in this._embeddedModesListeners) {\n                this._embeddedModesListeners[listener].dispose();\n                delete this._embeddedModesListeners[listener];\n            }\n        };\n        TokenizationSupport.prototype.getInitialState = function () {\n            return this.customization.getInitialState();\n        };\n        TokenizationSupport.prototype.tokenize = function (line, state, deltaOffset, stopAtOffset) {\n            if (deltaOffset === void 0) { deltaOffset = 0; }\n            if (stopAtOffset === void 0) { stopAtOffset = deltaOffset + line.length; }\n            if (state.getMode() !== this._mode) {\n                return this._nestedTokenize(line, state, deltaOffset, stopAtOffset, [], []);\n            }\n            else {\n                return this._myTokenize(line, state, deltaOffset, stopAtOffset, [], []);\n            }\n        };\n        /**\n         * Precondition is: nestedModeState.getMode() !== this\n         * This means we are in a nested mode when parsing starts on this line.\n         */\n        TokenizationSupport.prototype._nestedTokenize = function (buffer, nestedModeState, deltaOffset, stopAtOffset, prependTokens, prependModeTransitions) {\n            var myStateBeforeNestedMode = nestedModeState.getStateData();\n            var leavingNestedModeData = this.getLeavingNestedModeData(buffer, myStateBeforeNestedMode);\n            // Be sure to give every embedded mode the\n            // opportunity to leave nested mode.\n            // i.e. Don't go straight to the most nested mode\n            var stepOnceNestedState = nestedModeState;\n            while (stepOnceNestedState.getStateData() && stepOnceNestedState.getStateData().getMode() !== this._mode) {\n                stepOnceNestedState = stepOnceNestedState.getStateData();\n            }\n            var nestedMode = stepOnceNestedState.getMode();\n            if (!leavingNestedModeData) {\n                // tokenization will not leave nested mode\n                var result;\n                if (nestedMode.tokenizationSupport) {\n                    result = nestedMode.tokenizationSupport.tokenize(buffer, nestedModeState, deltaOffset, stopAtOffset);\n                }\n                else {\n                    // The nested mode doesn't have tokenization support,\n                    // unfortunatelly this means we have to fake it\n                    result = nullMode_1.nullTokenize(nestedMode, buffer, nestedModeState, deltaOffset);\n                }\n                result.tokens = prependTokens.concat(result.tokens);\n                result.modeTransitions = prependModeTransitions.concat(result.modeTransitions);\n                return result;\n            }\n            var nestedModeBuffer = leavingNestedModeData.nestedModeBuffer;\n            if (nestedModeBuffer.length > 0) {\n                // Tokenize with the nested mode\n                var nestedModeLineTokens;\n                if (nestedMode.tokenizationSupport) {\n                    nestedModeLineTokens = nestedMode.tokenizationSupport.tokenize(nestedModeBuffer, nestedModeState, deltaOffset, stopAtOffset);\n                }\n                else {\n                    // The nested mode doesn't have tokenization support,\n                    // unfortunatelly this means we have to fake it\n                    nestedModeLineTokens = nullMode_1.nullTokenize(nestedMode, nestedModeBuffer, nestedModeState, deltaOffset);\n                }\n                // Save last state of nested mode\n                nestedModeState = nestedModeLineTokens.endState;\n                // Prepend nested mode's result to our result\n                prependTokens = prependTokens.concat(nestedModeLineTokens.tokens);\n                prependModeTransitions = prependModeTransitions.concat(nestedModeLineTokens.modeTransitions);\n            }\n            var bufferAfterNestedMode = leavingNestedModeData.bufferAfterNestedMode;\n            var myStateAfterNestedMode = leavingNestedModeData.stateAfterNestedMode;\n            myStateAfterNestedMode.setStateData(myStateBeforeNestedMode.getStateData());\n            this.onReturningFromNestedMode(myStateAfterNestedMode, nestedModeState);\n            return this._myTokenize(bufferAfterNestedMode, myStateAfterNestedMode, deltaOffset + nestedModeBuffer.length, stopAtOffset, prependTokens, prependModeTransitions);\n        };\n        /**\n         * Precondition is: state.getMode() === this\n         * This means we are in the current mode when parsing starts on this line.\n         */\n        TokenizationSupport.prototype._myTokenize = function (buffer, myState, deltaOffset, stopAtOffset, prependTokens, prependModeTransitions) {\n            var _this = this;\n            var lineStream = new lineStream_1.LineStream(buffer);\n            var tokenResult, beforeTokenizeStreamPos;\n            var previousType = null;\n            var retokenize = null;\n            myState = myState.clone();\n            if (prependModeTransitions.length <= 0 || prependModeTransitions[prependModeTransitions.length - 1].mode !== this._mode) {\n                // Avoid transitioning to the same mode (this can happen in case of empty embedded modes)\n                prependModeTransitions.push({\n                    startIndex: deltaOffset,\n                    mode: this._mode\n                });\n            }\n            var maxPos = Math.min(stopAtOffset - deltaOffset, buffer.length);\n            while (lineStream.pos() < maxPos) {\n                beforeTokenizeStreamPos = lineStream.pos();\n                do {\n                    tokenResult = myState.tokenize(lineStream);\n                    if (tokenResult === null || tokenResult === undefined ||\n                        ((tokenResult.type === undefined || tokenResult.type === null) &&\n                            (tokenResult.nextState === undefined || tokenResult.nextState === null))) {\n                        throw new Error('Tokenizer must return a valid state');\n                    }\n                    if (tokenResult.nextState) {\n                        tokenResult.nextState.setStateData(myState.getStateData());\n                        myState = tokenResult.nextState;\n                    }\n                    if (lineStream.pos() <= beforeTokenizeStreamPos) {\n                        throw new Error('Stream did not advance while tokenizing. Mode id is ' + this._mode.getId() + ' (stuck at token type: \"' + tokenResult.type + '\", prepend tokens: \"' + (prependTokens.map(function (t) { return t.type; }).join(',')) + '\").');\n                    }\n                } while (!tokenResult.type && tokenResult.type !== '');\n                if (previousType !== tokenResult.type || tokenResult.dontMergeWithPrev || previousType === null) {\n                    prependTokens.push(new supports_1.Token(beforeTokenizeStreamPos + deltaOffset, tokenResult.type));\n                }\n                previousType = tokenResult.type;\n                if (this.supportsNestedModes && this.enterNestedMode(myState)) {\n                    var currentEmbeddedLevels = this._getEmbeddedLevel(myState);\n                    if (currentEmbeddedLevels < TokenizationSupport.MAX_EMBEDDED_LEVELS) {\n                        var nestedModeState = this.getNestedModeInitialState(myState);\n                        // Re-emit tokenizationSupport change events from all modes that I ever embedded\n                        var embeddedMode = nestedModeState.state.getMode();\n                        if (typeof embeddedMode.addSupportChangedListener === 'function' && !this._embeddedModesListeners.hasOwnProperty(embeddedMode.getId())) {\n                            var emitting = false;\n                            this._embeddedModesListeners[embeddedMode.getId()] = embeddedMode.addSupportChangedListener(function (e) {\n                                if (emitting) {\n                                    return;\n                                }\n                                if (e.tokenizationSupport) {\n                                    emitting = true;\n                                    _this._mode.setTokenizationSupport(function (mode) {\n                                        return mode.tokenizationSupport;\n                                    });\n                                    emitting = false;\n                                }\n                            });\n                        }\n                        if (!lineStream.eos()) {\n                            // There is content from the embedded mode\n                            var restOfBuffer = buffer.substr(lineStream.pos());\n                            var result = this._nestedTokenize(restOfBuffer, nestedModeState.state, deltaOffset + lineStream.pos(), stopAtOffset, prependTokens, prependModeTransitions);\n                            result.retokenize = result.retokenize || nestedModeState.missingModePromise;\n                            return result;\n                        }\n                        else {\n                            // Transition to the nested mode state\n                            myState = nestedModeState.state;\n                            retokenize = nestedModeState.missingModePromise;\n                        }\n                    }\n                }\n            }\n            return {\n                tokens: prependTokens,\n                actualStopOffset: lineStream.pos() + deltaOffset,\n                modeTransitions: prependModeTransitions,\n                endState: myState,\n                retokenize: retokenize\n            };\n        };\n        TokenizationSupport.prototype._getEmbeddedLevel = function (state) {\n            var result = -1;\n            while (state) {\n                result++;\n                state = state.getStateData();\n            }\n            return result;\n        };\n        TokenizationSupport.prototype.enterNestedMode = function (state) {\n            if (this.defaults.enterNestedMode) {\n                return false;\n            }\n            return this.customization.enterNestedMode(state);\n        };\n        TokenizationSupport.prototype.getNestedMode = function (state) {\n            if (this.defaults.getNestedMode) {\n                return null;\n            }\n            return this.customization.getNestedMode(state);\n        };\n        TokenizationSupport._validatedNestedMode = function (input) {\n            var mode = new nullMode_1.NullMode(), missingModePromise = null;\n            if (input && input.mode) {\n                mode = input.mode;\n            }\n            if (input && input.missingModePromise) {\n                missingModePromise = input.missingModePromise;\n            }\n            return {\n                mode: mode,\n                missingModePromise: missingModePromise\n            };\n        };\n        TokenizationSupport.prototype.getNestedModeInitialState = function (state) {\n            if (this.defaults.getNestedModeInitialState) {\n                var nestedMode = TokenizationSupport._validatedNestedMode(this.getNestedMode(state));\n                var missingModePromise = nestedMode.missingModePromise;\n                var nestedModeState;\n                if (nestedMode.mode.tokenizationSupport) {\n                    nestedModeState = nestedMode.mode.tokenizationSupport.getInitialState();\n                }\n                else {\n                    nestedModeState = new nullMode_1.NullState(nestedMode.mode, null);\n                }\n                nestedModeState.setStateData(state);\n                return {\n                    state: nestedModeState,\n                    missingModePromise: missingModePromise\n                };\n            }\n            return this.customization.getNestedModeInitialState(state);\n        };\n        TokenizationSupport.prototype.getLeavingNestedModeData = function (line, state) {\n            if (this.defaults.getLeavingNestedModeData) {\n                return null;\n            }\n            return this.customization.getLeavingNestedModeData(line, state);\n        };\n        TokenizationSupport.prototype.onReturningFromNestedMode = function (myStateAfterNestedMode, lastNestedModeState) {\n            if (this.defaults.onReturningFromNestedMode) {\n                return null;\n            }\n            return this.customization.onReturningFromNestedMode(myStateAfterNestedMode, lastNestedModeState);\n        };\n        TokenizationSupport.MAX_EMBEDDED_LEVELS = 5;\n        return TokenizationSupport;\n    }());\n    exports.TokenizationSupport = TokenizationSupport;\n});\n\n\n\n\n\n\ndefine(__m[105], __M([1,0,39,62,25,53]), function (require, exports, abstractState_1, lineStream_1, monarchCommon, tokenizationSupport_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * The MonarchLexer class implements a monaco lexer that highlights source code.\n     * It takes a compiled lexer to guide the tokenizer and maintains a stack of\n     * lexer states.\n     */\n    var MonarchLexer = (function (_super) {\n        __extends(MonarchLexer, _super);\n        function MonarchLexer(mode, modeService, lexer, stack, embeddedMode) {\n            _super.call(this, mode);\n            this.id = MonarchLexer.ID++; // for debugging, assigns unique id to each instance\n            this.modeService = modeService;\n            this.lexer = lexer; // (compiled) lexer description\n            this.stack = (stack ? stack : [lexer.start]); // stack of states\n            this.embeddedMode = (embeddedMode ? embeddedMode : null); // are we scanning an embedded section?\n            // did we encounter an embedded start on this line?\n            // no need for cloning or equality since it is used only within a line\n            this.embeddedEntered = false;\n            // regular expression group matching\n            // these never need cloning or equality since they are only used within a line match\n            this.groupActions = null;\n            this.groupMatches = null;\n            this.groupMatched = null;\n            this.groupRule = null;\n        }\n        MonarchLexer.prototype.makeClone = function () {\n            return new MonarchLexer(this.getMode(), this.modeService, this.lexer, this.stack.slice(0), this.embeddedMode);\n        };\n        MonarchLexer.prototype.equals = function (other) {\n            if (!_super.prototype.equals.call(this, other)) {\n                return false;\n            }\n            if (!(other instanceof MonarchLexer)) {\n                return false;\n            }\n            var otherm = other;\n            if ((this.stack.length !== otherm.stack.length) || (this.lexer.languageId !== otherm.lexer.languageId) ||\n                (this.embeddedMode !== otherm.embeddedMode)) {\n                return false;\n            }\n            var idx;\n            for (idx in this.stack) {\n                if (this.stack.hasOwnProperty(idx)) {\n                    if (this.stack[idx] !== otherm.stack[idx]) {\n                        return false;\n                    }\n                }\n            }\n            return true;\n        };\n        /**\n         * The main tokenizer: this function gets called by monaco to tokenize lines\n         * Note: we don't want to raise exceptions here and always keep going..\n         *\n         * TODO: there are many optimizations possible here for the common cases\n         * but for now I concentrated on functionality and correctness.\n         */\n        MonarchLexer.prototype.tokenize = function (stream, noConsumeIsOk) {\n            var stackLen0 = this.stack.length; // these are saved to check progress\n            var groupLen0 = 0;\n            var state = this.stack[0]; // the current state\n            this.embeddedEntered = false;\n            var matches = null;\n            var matched = null;\n            var action = null;\n            var next = null;\n            var rule = null;\n            // check if we need to process group matches first\n            if (this.groupActions) {\n                groupLen0 = this.groupActions.length;\n                matches = this.groupMatches;\n                matched = this.groupMatched.shift();\n                action = this.groupActions.shift();\n                rule = this.groupRule;\n                // cleanup if necessary\n                if (this.groupActions.length === 0) {\n                    this.groupActions = null;\n                    this.groupMatches = null;\n                    this.groupMatched = null;\n                    this.groupRule = null;\n                }\n            }\n            else {\n                // nothing to do\n                if (stream.eos()) {\n                    return { type: '' };\n                }\n                // get the entire line\n                var line = stream.advanceToEOS();\n                stream.goBack(line.length);\n                // get the rules for this state\n                var rules = this.lexer.tokenizer[state];\n                if (!rules) {\n                    rules = monarchCommon.findRules(this.lexer, state); // do parent matching\n                }\n                if (!rules) {\n                    monarchCommon.throwError(this.lexer, 'tokenizer state is not defined: ' + state);\n                }\n                else {\n                    // try each rule until we match\n                    rule = null;\n                    var pos = stream.pos();\n                    var idx;\n                    for (idx in rules) {\n                        if (rules.hasOwnProperty(idx)) {\n                            rule = rules[idx];\n                            if (pos === 0 || !rule.matchOnlyAtLineStart) {\n                                matches = line.match(rule.regex);\n                                if (matches) {\n                                    matched = matches[0];\n                                    action = rule.action;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            // We matched 'rule' with 'matches' and 'action'\n            if (!matches) {\n                matches = [''];\n                matched = '';\n            }\n            if (!action) {\n                // bad: we didn't match anything, and there is no action to take\n                // we need to advance the stream or we get progress trouble\n                if (!stream.eos()) {\n                    matches = [stream.peek()];\n                    matched = matches[0];\n                }\n                action = this.lexer.defaultToken;\n            }\n            // advance stream\n            stream.advance(matched.length);\n            // maybe call action function (used for 'cases')\n            while (action.test) {\n                var callres = action.test(matched, matches, state, stream.eos());\n                action = callres;\n            }\n            // set the result: either a string or an array of actions\n            var result = null;\n            if (typeof (action) === 'string' || Array.isArray(action)) {\n                result = action;\n            }\n            else if (action.group) {\n                result = action.group;\n            }\n            else if (action.token !== null && action.token !== undefined) {\n                result = action.token;\n                // do $n replacements?\n                if (action.tokenSubst) {\n                    result = monarchCommon.substituteMatches(this.lexer, result, matched, matches, state);\n                }\n                // enter embedded mode?\n                if (action.nextEmbedded) {\n                    if (action.nextEmbedded === '@pop') {\n                        if (!this.embeddedMode) {\n                            monarchCommon.throwError(this.lexer, 'cannot pop embedded mode if not inside one');\n                        }\n                        this.embeddedMode = null;\n                    }\n                    else if (this.embeddedMode) {\n                        monarchCommon.throwError(this.lexer, 'cannot enter embedded mode from within an embedded mode');\n                    }\n                    else {\n                        this.embeddedMode = monarchCommon.substituteMatches(this.lexer, action.nextEmbedded, matched, matches, state);\n                        // substitute language alias to known modes to support syntax highlighting\n                        var embeddedMode = this.modeService.getModeIdForLanguageName(this.embeddedMode);\n                        if (this.embeddedMode && embeddedMode) {\n                            this.embeddedMode = embeddedMode;\n                        }\n                        this.embeddedEntered = true;\n                    }\n                }\n                // state transformations\n                if (action.goBack) {\n                    stream.goBack(action.goBack);\n                }\n                if (action.switchTo && typeof action.switchTo === 'string') {\n                    var nextState = monarchCommon.substituteMatches(this.lexer, action.switchTo, matched, matches, state); // switch state without a push...\n                    if (nextState[0] === '@') {\n                        nextState = nextState.substr(1); // peel off starting '@'\n                    }\n                    if (!monarchCommon.findRules(this.lexer, nextState)) {\n                        monarchCommon.throwError(this.lexer, 'trying to switch to a state \\'' + nextState + '\\' that is undefined in rule: ' + rule.name);\n                    }\n                    else {\n                        this.stack[0] = nextState;\n                    }\n                    next = null;\n                }\n                else if (action.transform && typeof action.transform === 'function') {\n                    this.stack = action.transform(this.stack); // if you need to do really funky stuff...\n                    next = null;\n                }\n                else if (action.next) {\n                    if (action.next === '@push') {\n                        if (this.stack.length >= this.lexer.maxStack) {\n                            monarchCommon.throwError(this.lexer, 'maximum tokenizer stack size reached: [' +\n                                this.stack[0] + ',' + this.stack[1] + ',...,' +\n                                this.stack[this.stack.length - 2] + ',' + this.stack[this.stack.length - 1] + ']');\n                        }\n                        else {\n                            this.stack.unshift(state);\n                        }\n                    }\n                    else if (action.next === '@pop') {\n                        if (this.stack.length <= 1) {\n                            monarchCommon.throwError(this.lexer, 'trying to pop an empty stack in rule: ' + rule.name);\n                        }\n                        else {\n                            this.stack.shift();\n                        }\n                    }\n                    else if (action.next === '@popall') {\n                        if (this.stack.length > 1) {\n                            this.stack = [this.stack[this.stack.length - 1]];\n                        }\n                    }\n                    else {\n                        var nextState = monarchCommon.substituteMatches(this.lexer, action.next, matched, matches, state);\n                        if (nextState[0] === '@') {\n                            nextState = nextState.substr(1); // peel off starting '@'\n                        }\n                        if (!monarchCommon.findRules(this.lexer, nextState)) {\n                            monarchCommon.throwError(this.lexer, 'trying to set a next state \\'' + nextState + '\\' that is undefined in rule: ' + rule.name);\n                        }\n                        else {\n                            this.stack.unshift(nextState);\n                        }\n                    }\n                }\n                if (action.log && typeof (action.log) === 'string') {\n                    monarchCommon.log(this.lexer, this.lexer.languageId + ': ' + monarchCommon.substituteMatches(this.lexer, action.log, matched, matches, state));\n                }\n            }\n            // check result\n            if (result === null) {\n                monarchCommon.throwError(this.lexer, 'lexer rule has no well-defined action in rule: ' + rule.name);\n                result = this.lexer.defaultToken;\n            }\n            // is the result a group match?\n            if (Array.isArray(result)) {\n                if (this.groupActions && this.groupActions.length > 0) {\n                    monarchCommon.throwError(this.lexer, 'groups cannot be nested: ' + rule.name);\n                }\n                if (matches.length !== result.length + 1) {\n                    monarchCommon.throwError(this.lexer, 'matched number of groups does not match the number of actions in rule: ' + rule.name);\n                }\n                var totalLen = 0;\n                for (var i = 1; i < matches.length; i++) {\n                    totalLen += matches[i].length;\n                }\n                if (totalLen !== matched.length) {\n                    monarchCommon.throwError(this.lexer, 'with groups, all characters should be matched in consecutive groups in rule: ' + rule.name);\n                }\n                this.groupMatches = matches;\n                this.groupMatched = matches.slice(1);\n                this.groupActions = result.slice(0);\n                this.groupRule = rule;\n                stream.goBack(matched.length);\n                return this.tokenize(stream); // call recursively to initiate first result match\n            }\n            else {\n                // check for '@rematch'\n                if (result === '@rematch') {\n                    stream.goBack(matched.length);\n                    matched = ''; // better set the next state too..\n                    matches = null;\n                    result = '';\n                }\n                // check progress\n                if (matched.length === 0) {\n                    if (stackLen0 !== this.stack.length || state !== this.stack[0]\n                        || (!this.groupActions ? 0 : this.groupActions.length) !== groupLen0) {\n                        if (!noConsumeIsOk) {\n                            return this.tokenize(stream); // tokenize again in the new state\n                        }\n                    }\n                    else {\n                        monarchCommon.throwError(this.lexer, 'no progress in tokenizer in rule: ' + rule.name);\n                        stream.advanceToEOS(); // must make progress or editor loops\n                    }\n                }\n                // return the result (and check for brace matching)\n                // todo: for efficiency we could pre-sanitize tokenPostfix and substitutions\n                if (result.indexOf('@brackets') === 0) {\n                    var rest = result.substr('@brackets'.length);\n                    var bracket = findBracket(this.lexer, matched);\n                    if (!bracket) {\n                        monarchCommon.throwError(this.lexer, '@brackets token returned but no bracket defined as: ' + matched);\n                        bracket = { token: '', bracketType: monarchCommon.MonarchBracket.None };\n                    }\n                    return { type: monarchCommon.sanitize(bracket.token + rest) };\n                }\n                else {\n                    var token = (result === '' ? '' : result + this.lexer.tokenPostfix);\n                    return { type: monarchCommon.sanitize(token) };\n                }\n            }\n        };\n        MonarchLexer.ID = 0;\n        return MonarchLexer;\n    }(abstractState_1.AbstractState));\n    exports.MonarchLexer = MonarchLexer;\n    /**\n     * Searches for a bracket in the 'brackets' attribute that matches the input.\n     */\n    function findBracket(lexer, matched) {\n        if (!matched) {\n            return null;\n        }\n        matched = monarchCommon.fixCase(lexer, matched);\n        var brackets = lexer.brackets;\n        for (var i = 0; i < brackets.length; i++) {\n            var bracket = brackets[i];\n            if (bracket.open === matched) {\n                return { token: bracket.token, bracketType: monarchCommon.MonarchBracket.Open };\n            }\n            else if (bracket.close === matched) {\n                return { token: bracket.token, bracketType: monarchCommon.MonarchBracket.Close };\n            }\n        }\n        return null;\n    }\n    function createTokenizationSupport(modeService, mode, lexer) {\n        return new tokenizationSupport_1.TokenizationSupport(mode, {\n            getInitialState: function () {\n                return new MonarchLexer(mode, modeService, lexer);\n            },\n            enterNestedMode: function (state) {\n                if (state instanceof MonarchLexer) {\n                    return state.embeddedEntered;\n                }\n                return false;\n            },\n            getNestedMode: function (rawState) {\n                var mime = rawState.embeddedMode;\n                if (!modeService.isRegisteredMode(mime)) {\n                    // unknown mode\n                    return {\n                        mode: modeService.getMode('text/plain'),\n                        missingModePromise: null\n                    };\n                }\n                var mode = modeService.getMode(mime);\n                if (mode) {\n                    // mode is available\n                    return {\n                        mode: mode,\n                        missingModePromise: null\n                    };\n                }\n                // mode is not yet loaded\n                return {\n                    mode: modeService.getMode('text/plain'),\n                    missingModePromise: modeService.getOrCreateMode(mime).then(function () { return null; })\n                };\n            },\n            getLeavingNestedModeData: function (line, state) {\n                // state = state.clone();\n                var mstate = state.clone();\n                var stream = new lineStream_1.LineStream(line);\n                while (!stream.eos() && mstate.embeddedMode) {\n                    mstate.tokenize(stream, true); // allow no consumption for @rematch\n                }\n                if (mstate.embeddedMode) {\n                    return null; // don't leave yet\n                }\n                var end = stream.pos();\n                return {\n                    nestedModeBuffer: line.substring(0, end),\n                    bufferAfterNestedMode: line.substring(end),\n                    stateAfterNestedMode: mstate\n                };\n            }\n        }, lexer.usesEmbedded);\n    }\n    exports.createTokenizationSupport = createTokenizationSupport;\n});\n\ndefine(__m[108], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var PrefixSumIndexOfResult = (function () {\n        function PrefixSumIndexOfResult(index, remainder) {\n            this.index = index;\n            this.remainder = remainder;\n        }\n        return PrefixSumIndexOfResult;\n    }());\n    exports.PrefixSumIndexOfResult = PrefixSumIndexOfResult;\n    var PrefixSumComputer = (function () {\n        function PrefixSumComputer(values) {\n            this.values = values;\n            this.prefixSum = [];\n            for (var i = 0, len = this.values.length; i < len; i++) {\n                this.prefixSum[i] = 0;\n            }\n            this.prefixSumValidIndex = -1;\n        }\n        PrefixSumComputer.prototype.getCount = function () {\n            return this.values.length;\n        };\n        PrefixSumComputer.prototype.insertValue = function (insertIndex, value) {\n            insertIndex = Math.floor(insertIndex); //@perf\n            value = Math.floor(value); //@perf\n            this.values.splice(insertIndex, 0, value);\n            this.prefixSum.splice(insertIndex, 0, 0);\n            if (insertIndex - 1 < this.prefixSumValidIndex) {\n                this.prefixSumValidIndex = insertIndex - 1;\n            }\n        };\n        PrefixSumComputer.prototype.insertValues = function (insertIndex, values) {\n            insertIndex = Math.floor(insertIndex); //@perf\n            if (values.length === 0) {\n                return;\n            }\n            this.values = this.values.slice(0, insertIndex).concat(values).concat(this.values.slice(insertIndex));\n            this.prefixSum = this.prefixSum.slice(0, insertIndex).concat(PrefixSumComputer._zeroArray(values.length)).concat(this.prefixSum.slice(insertIndex));\n            if (insertIndex - 1 < this.prefixSumValidIndex) {\n                this.prefixSumValidIndex = insertIndex - 1;\n            }\n        };\n        PrefixSumComputer._zeroArray = function (count) {\n            count = Math.floor(count); //@perf\n            var r = [];\n            for (var i = 0; i < count; i++) {\n                r[i] = 0;\n            }\n            return r;\n        };\n        PrefixSumComputer.prototype.changeValue = function (index, value) {\n            index = Math.floor(index); //@perf\n            value = Math.floor(value); //@perf\n            if (this.values[index] === value) {\n                return;\n            }\n            this.values[index] = value;\n            if (index - 1 < this.prefixSumValidIndex) {\n                this.prefixSumValidIndex = index - 1;\n            }\n        };\n        PrefixSumComputer.prototype.removeValues = function (startIndex, cnt) {\n            startIndex = Math.floor(startIndex); //@perf\n            cnt = Math.floor(cnt); //@perf\n            this.values.splice(startIndex, cnt);\n            this.prefixSum.splice(startIndex, cnt);\n            if (startIndex - 1 < this.prefixSumValidIndex) {\n                this.prefixSumValidIndex = startIndex - 1;\n            }\n        };\n        PrefixSumComputer.prototype.getTotalValue = function () {\n            if (this.values.length === 0) {\n                return 0;\n            }\n            return this.getAccumulatedValue(this.values.length - 1);\n        };\n        PrefixSumComputer.prototype.getAccumulatedValue = function (index) {\n            index = Math.floor(index); //@perf\n            if (index < 0) {\n                return 0;\n            }\n            if (index <= this.prefixSumValidIndex) {\n                return this.prefixSum[index];\n            }\n            var startIndex = this.prefixSumValidIndex + 1;\n            if (startIndex === 0) {\n                this.prefixSum[0] = this.values[0];\n                startIndex++;\n            }\n            if (index >= this.values.length) {\n                index = this.values.length - 1;\n            }\n            for (var i = startIndex; i <= index; i++) {\n                this.prefixSum[i] = this.prefixSum[i - 1] + this.values[i];\n            }\n            this.prefixSumValidIndex = Math.max(this.prefixSumValidIndex, index);\n            return this.prefixSum[index];\n        };\n        PrefixSumComputer.prototype.getIndexOf = function (accumulatedValue) {\n            accumulatedValue = Math.floor(accumulatedValue); //@perf\n            var low = 0;\n            var high = this.values.length - 1;\n            var mid;\n            var midStop;\n            var midStart;\n            while (low <= high) {\n                mid = low + ((high - low) / 2) | 0;\n                midStop = this.getAccumulatedValue(mid);\n                midStart = midStop - this.values[mid];\n                if (accumulatedValue < midStart) {\n                    high = mid - 1;\n                }\n                else if (accumulatedValue >= midStop) {\n                    low = mid + 1;\n                }\n                else {\n                    break;\n                }\n            }\n            return new PrefixSumIndexOfResult(mid, accumulatedValue - midStart);\n        };\n        return PrefixSumComputer;\n    }());\n    exports.PrefixSumComputer = PrefixSumComputer;\n});\n\ndefine(__m[66], __M([7,6]), function(nls, data) { return nls.create(\"vs/base/common/errors\", data); });\ndefine(__m[2], __M([1,0,66,12,10,9,58,3]), function (require, exports, nls, objects, platform, types, arrays, strings) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // Avoid circular dependency on EventEmitter by implementing a subset of the interface.\n    var ErrorHandler = (function () {\n        function ErrorHandler() {\n            this.listeners = [];\n            this.unexpectedErrorHandler = function (e) {\n                platform.setTimeout(function () {\n                    if (e.stack) {\n                        throw new Error(e.message + '\\n\\n' + e.stack);\n                    }\n                    throw e;\n                }, 0);\n            };\n        }\n        ErrorHandler.prototype.addListener = function (listener) {\n            var _this = this;\n            this.listeners.push(listener);\n            return function () {\n                _this._removeListener(listener);\n            };\n        };\n        ErrorHandler.prototype.emit = function (e) {\n            this.listeners.forEach(function (listener) {\n                listener(e);\n            });\n        };\n        ErrorHandler.prototype._removeListener = function (listener) {\n            this.listeners.splice(this.listeners.indexOf(listener), 1);\n        };\n        ErrorHandler.prototype.setUnexpectedErrorHandler = function (newUnexpectedErrorHandler) {\n            this.unexpectedErrorHandler = newUnexpectedErrorHandler;\n        };\n        ErrorHandler.prototype.getUnexpectedErrorHandler = function () {\n            return this.unexpectedErrorHandler;\n        };\n        ErrorHandler.prototype.onUnexpectedError = function (e) {\n            this.unexpectedErrorHandler(e);\n            this.emit(e);\n        };\n        return ErrorHandler;\n    }());\n    exports.ErrorHandler = ErrorHandler;\n    exports.errorHandler = new ErrorHandler();\n    function setUnexpectedErrorHandler(newUnexpectedErrorHandler) {\n        exports.errorHandler.setUnexpectedErrorHandler(newUnexpectedErrorHandler);\n    }\n    exports.setUnexpectedErrorHandler = setUnexpectedErrorHandler;\n    function onUnexpectedError(e) {\n        // ignore errors from cancelled promises\n        if (!isPromiseCanceledError(e)) {\n            exports.errorHandler.onUnexpectedError(e);\n        }\n    }\n    exports.onUnexpectedError = onUnexpectedError;\n    function onUnexpectedPromiseError(promise) {\n        return promise.then(null, onUnexpectedError);\n    }\n    exports.onUnexpectedPromiseError = onUnexpectedPromiseError;\n    function transformErrorForSerialization(error) {\n        if (error instanceof Error) {\n            var name_1 = error.name, message = error.message;\n            var stack = error.stacktrace || error.stack;\n            return {\n                $isError: true,\n                name: name_1,\n                message: message,\n                stack: stack\n            };\n        }\n        // return as is\n        return error;\n    }\n    exports.transformErrorForSerialization = transformErrorForSerialization;\n    /**\n     * The base class for all connection errors originating from XHR requests.\n     */\n    var ConnectionError = (function () {\n        function ConnectionError(arg) {\n            this.status = arg.status;\n            this.statusText = arg.statusText;\n            this.name = 'ConnectionError';\n            try {\n                this.responseText = arg.responseText;\n            }\n            catch (e) {\n                this.responseText = '';\n            }\n            this.errorMessage = null;\n            this.errorCode = null;\n            this.errorObject = null;\n            if (this.responseText) {\n                try {\n                    var errorObj = JSON.parse(this.responseText);\n                    this.errorMessage = errorObj.message;\n                    this.errorCode = errorObj.code;\n                    this.errorObject = errorObj;\n                }\n                catch (error) {\n                }\n            }\n        }\n        Object.defineProperty(ConnectionError.prototype, \"message\", {\n            get: function () {\n                return this.connectionErrorToMessage(this, false);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ConnectionError.prototype, \"verboseMessage\", {\n            get: function () {\n                return this.connectionErrorToMessage(this, true);\n            },\n            enumerable: true,\n            configurable: true\n        });\n        ConnectionError.prototype.connectionErrorDetailsToMessage = function (error, verbose) {\n            var errorCode = error.errorCode;\n            var errorMessage = error.errorMessage;\n            if (errorCode !== null && errorMessage !== null) {\n                return nls.localize(0, null, strings.rtrim(errorMessage, '.'), errorCode);\n\n\n\n\n\n\n            }\n            if (errorMessage !== null) {\n                return errorMessage;\n            }\n            if (verbose && error.responseText !== null) {\n                return error.responseText;\n            }\n            return null;\n        };\n        ConnectionError.prototype.connectionErrorToMessage = function (error, verbose) {\n            var details = this.connectionErrorDetailsToMessage(error, verbose);\n            // Status Code based Error\n            if (error.status === 401) {\n                if (details !== null) {\n                    return nls.localize(1, null, details);\n\n\n\n\n\n                }\n                return nls.localize(2, null);\n            }\n            // Return error details if present\n            if (details) {\n                return details;\n            }\n            // Fallback to HTTP Status and Code\n            if (error.status > 0 && error.statusText !== null) {\n                if (verbose && error.responseText !== null && error.responseText.length > 0) {\n                    return nls.localize(3, null, error.statusText, error.status, error.responseText);\n                }\n                return nls.localize(4, null, error.statusText, error.status);\n            }\n            // Finally its an Unknown Connection Error\n            if (verbose && error.responseText !== null && error.responseText.length > 0) {\n                return nls.localize(5, null, error.responseText);\n            }\n            return nls.localize(6, null);\n        };\n        return ConnectionError;\n    }());\n    exports.ConnectionError = ConnectionError;\n    // Bug: Can not subclass a JS Type. Do it manually (as done in WinJS.Class.derive)\n    objects.derive(Error, ConnectionError);\n    function xhrToErrorMessage(xhr, verbose) {\n        var ce = new ConnectionError(xhr);\n        if (verbose) {\n            return ce.verboseMessage;\n        }\n        else {\n            return ce.message;\n        }\n    }\n    function exceptionToErrorMessage(exception, verbose) {\n        if (exception.message) {\n            if (verbose && (exception.stack || exception.stacktrace)) {\n                return nls.localize(7, null, detectSystemErrorMessage(exception), exception.stack || exception.stacktrace);\n            }\n            return detectSystemErrorMessage(exception);\n        }\n        return nls.localize(8, null);\n    }\n    function detectSystemErrorMessage(exception) {\n        // See https://nodejs.org/api/errors.html#errors_class_system_error\n        if (typeof exception.code === 'string' && typeof exception.errno === 'number' && typeof exception.syscall === 'string') {\n            return nls.localize(9, null, exception.message);\n        }\n        return exception.message;\n    }\n    /**\n     * Tries to generate a human readable error message out of the error. If the verbose parameter\n     * is set to true, the error message will include stacktrace details if provided.\n     * @returns A string containing the error message.\n     */\n    function toErrorMessage(error, verbose) {\n        if (error === void 0) { error = null; }\n        if (verbose === void 0) { verbose = false; }\n        if (!error) {\n            return nls.localize(10, null);\n        }\n        if (Array.isArray(error)) {\n            var errors = arrays.coalesce(error);\n            var msg = toErrorMessage(errors[0], verbose);\n            if (errors.length > 1) {\n                return nls.localize(11, null, msg, errors.length);\n            }\n            return msg;\n        }\n        if (types.isString(error)) {\n            return error;\n        }\n        if (!types.isUndefinedOrNull(error.status)) {\n            return xhrToErrorMessage(error, verbose);\n        }\n        if (error.detail) {\n            var detail = error.detail;\n            if (detail.error) {\n                if (detail.error && !types.isUndefinedOrNull(detail.error.status)) {\n                    return xhrToErrorMessage(detail.error, verbose);\n                }\n                if (types.isArray(detail.error)) {\n                    for (var i = 0; i < detail.error.length; i++) {\n                        if (detail.error[i] && !types.isUndefinedOrNull(detail.error[i].status)) {\n                            return xhrToErrorMessage(detail.error[i], verbose);\n                        }\n                    }\n                }\n                else {\n                    return exceptionToErrorMessage(detail.error, verbose);\n                }\n            }\n            if (detail.exception) {\n                if (!types.isUndefinedOrNull(detail.exception.status)) {\n                    return xhrToErrorMessage(detail.exception, verbose);\n                }\n                return exceptionToErrorMessage(detail.exception, verbose);\n            }\n        }\n        if (error.stack) {\n            return exceptionToErrorMessage(error, verbose);\n        }\n        if (error.message) {\n            return error.message;\n        }\n        return nls.localize(12, null);\n    }\n    exports.toErrorMessage = toErrorMessage;\n    var canceledName = 'Canceled';\n    /**\n     * Checks if the given error is a promise in canceled state\n     */\n    function isPromiseCanceledError(error) {\n        return error instanceof Error && error.name === canceledName && error.message === canceledName;\n    }\n    exports.isPromiseCanceledError = isPromiseCanceledError;\n    /**\n     * Returns an error that signals cancellation.\n     */\n    function canceled() {\n        var error = new Error(canceledName);\n        error.name = error.message;\n        return error;\n    }\n    exports.canceled = canceled;\n    /**\n     * Returns an error that signals something is not implemented.\n     */\n    function notImplemented() {\n        return new Error(nls.localize(13, null));\n    }\n    exports.notImplemented = notImplemented;\n    function illegalArgument(name) {\n        if (name) {\n            return new Error(nls.localize(14, null, name));\n        }\n        else {\n            return new Error(nls.localize(15, null));\n        }\n    }\n    exports.illegalArgument = illegalArgument;\n    function illegalState(name) {\n        if (name) {\n            return new Error(nls.localize(16, null, name));\n        }\n        else {\n            return new Error(nls.localize(17, null));\n        }\n    }\n    exports.illegalState = illegalState;\n    function readonly(name) {\n        return name\n            ? new Error(\"readonly property '\" + name + \" cannot be changed'\")\n            : new Error('readonly property cannot be changed');\n    }\n    exports.readonly = readonly;\n    function loaderError(err) {\n        if (platform.isWeb) {\n            return new Error(nls.localize(18, null));\n        }\n        return new Error(nls.localize(19, null, JSON.stringify(err)));\n    }\n    exports.loaderError = loaderError;\n    function create(message, options) {\n        if (options === void 0) { options = {}; }\n        var result = new Error(message);\n        if (types.isNumber(options.severity)) {\n            result.severity = options.severity;\n        }\n        if (options.actions) {\n            result.actions = options.actions;\n        }\n        return result;\n    }\n    exports.create = create;\n});\n\ndefine(__m[63], __M([1,0,2]), function (require, exports, errors_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var CallbackList = (function () {\n        function CallbackList() {\n        }\n        CallbackList.prototype.add = function (callback, context, bucket) {\n            var _this = this;\n            if (context === void 0) { context = null; }\n            if (!this._callbacks) {\n                this._callbacks = [];\n                this._contexts = [];\n            }\n            this._callbacks.push(callback);\n            this._contexts.push(context);\n            if (Array.isArray(bucket)) {\n                bucket.push({ dispose: function () { return _this.remove(callback, context); } });\n            }\n        };\n        CallbackList.prototype.remove = function (callback, context) {\n            if (context === void 0) { context = null; }\n            if (!this._callbacks) {\n                return;\n            }\n            var foundCallbackWithDifferentContext = false;\n            for (var i = 0, len = this._callbacks.length; i < len; i++) {\n                if (this._callbacks[i] === callback) {\n                    if (this._contexts[i] === context) {\n                        // callback & context match => remove it\n                        this._callbacks.splice(i, 1);\n                        this._contexts.splice(i, 1);\n                        return;\n                    }\n                    else {\n                        foundCallbackWithDifferentContext = true;\n                    }\n                }\n            }\n            if (foundCallbackWithDifferentContext) {\n                throw new Error('When adding a listener with a context, you should remove it with the same context');\n            }\n        };\n        CallbackList.prototype.invoke = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i - 0] = arguments[_i];\n            }\n            if (!this._callbacks) {\n                return;\n            }\n            var ret = [], callbacks = this._callbacks.slice(0), contexts = this._contexts.slice(0);\n            for (var i = 0, len = callbacks.length; i < len; i++) {\n                try {\n                    ret.push(callbacks[i].apply(contexts[i], args));\n                }\n                catch (e) {\n                    errors_1.onUnexpectedError(e);\n                }\n            }\n            return ret;\n        };\n        CallbackList.prototype.isEmpty = function () {\n            return !this._callbacks || this._callbacks.length === 0;\n        };\n        CallbackList.prototype.dispose = function () {\n            this._callbacks = undefined;\n            this._contexts = undefined;\n        };\n        return CallbackList;\n    }());\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = CallbackList;\n});\n\ndefine(__m[8], __M([1,0,63]), function (require, exports, callbackList_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var Event;\n    (function (Event) {\n        var _disposable = { dispose: function () { } };\n        Event.None = function () { return _disposable; };\n    })(Event || (Event = {}));\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = Event;\n    /**\n     * The Emitter can be used to expose an Event to the public\n     * to fire it from the insides.\n     * Sample:\n        class Document {\n    \n            private _onDidChange = new Emitter<(value:string)=>any>();\n    \n            public onDidChange = this._onDidChange.event;\n    \n            // getter-style\n            // get onDidChange(): Event<(value:string)=>any> {\n            // \treturn this._onDidChange.event;\n            // }\n    \n            private _doIt() {\n                //...\n                this._onDidChange.fire(value);\n            }\n        }\n     */\n    var Emitter = (function () {\n        function Emitter(_options) {\n            this._options = _options;\n        }\n        Object.defineProperty(Emitter.prototype, \"event\", {\n            /**\n             * For the public to allow to subscribe\n             * to events from this Emitter\n             */\n            get: function () {\n                var _this = this;\n                if (!this._event) {\n                    this._event = function (listener, thisArgs, disposables) {\n                        if (!_this._callbacks) {\n                            _this._callbacks = new callbackList_1.default();\n                        }\n                        if (_this._options && _this._options.onFirstListenerAdd && _this._callbacks.isEmpty()) {\n                            _this._options.onFirstListenerAdd(_this);\n                        }\n                        _this._callbacks.add(listener, thisArgs);\n                        var result;\n                        result = {\n                            dispose: function () {\n                                result.dispose = Emitter._noop;\n                                if (!_this._disposed) {\n                                    _this._callbacks.remove(listener, thisArgs);\n                                    if (_this._options && _this._options.onLastListenerRemove && _this._callbacks.isEmpty()) {\n                                        _this._options.onLastListenerRemove(_this);\n                                    }\n                                }\n                            }\n                        };\n                        if (Array.isArray(disposables)) {\n                            disposables.push(result);\n                        }\n                        return result;\n                    };\n                }\n                return this._event;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        /**\n         * To be kept private to fire an event to\n         * subscribers\n         */\n        Emitter.prototype.fire = function (event) {\n            if (this._callbacks) {\n                this._callbacks.invoke.call(this._callbacks, event);\n            }\n        };\n        Emitter.prototype.dispose = function () {\n            if (this._callbacks) {\n                this._callbacks.dispose();\n                this._callbacks = undefined;\n                this._disposed = true;\n            }\n        };\n        Emitter._noop = function () { };\n        return Emitter;\n    }());\n    exports.Emitter = Emitter;\n    /**\n     * Creates an Event which is backed-up by the event emitter. This allows\n     * to use the existing eventing pattern and is likely using less memory.\n     * Sample:\n     *\n     * \tclass Document {\n     *\n     *\t\tprivate _eventbus = new EventEmitter();\n     *\n     *\t\tpublic onDidChange = fromEventEmitter(this._eventbus, 'changed');\n     *\n     *\t\t// getter-style\n     *\t\t// get onDidChange(): Event<(value:string)=>any> {\n     *\t\t// \tcache fromEventEmitter result and return\n     *\t\t// }\n     *\n     *\t\tprivate _doIt() {\n     *\t\t\t// ...\n     *\t\t\tthis._eventbus.emit('changed', value)\n     *\t\t}\n     *\t}\n     */\n    function fromEventEmitter(emitter, eventType) {\n        return function (listener, thisArgs, disposables) {\n            var result = emitter.addListener2(eventType, function () {\n                listener.apply(thisArgs, arguments);\n            });\n            if (Array.isArray(disposables)) {\n                disposables.push(result);\n            }\n            return result;\n        };\n    }\n    exports.fromEventEmitter = fromEventEmitter;\n    function mapEvent(event, map) {\n        return function (listener, thisArgs, disposables) {\n            if (thisArgs === void 0) { thisArgs = null; }\n            return event(function (i) { return listener.call(thisArgs, map(i)); }, null, disposables);\n        };\n    }\n    exports.mapEvent = mapEvent;\n    function filterEvent(event, filter) {\n        return function (listener, thisArgs, disposables) {\n            if (thisArgs === void 0) { thisArgs = null; }\n            return event(function (e) { return filter(e) && listener.call(thisArgs, e); }, null, disposables);\n        };\n    }\n    exports.filterEvent = filterEvent;\n    function debounceEvent(event, merger, delay) {\n        if (delay === void 0) { delay = 100; }\n        var subscription;\n        var output;\n        var handle;\n        var emitter = new Emitter({\n            onFirstListenerAdd: function () {\n                subscription = event(function (cur) {\n                    output = merger(output, cur);\n                    clearTimeout(handle);\n                    handle = setTimeout(function () {\n                        emitter.fire(output);\n                        output = undefined;\n                    }, delay);\n                });\n            },\n            onLastListenerRemove: function () {\n                subscription.dispose();\n            }\n        });\n        return emitter.event;\n    }\n    exports.debounceEvent = debounceEvent;\n    var EventDelayerState;\n    (function (EventDelayerState) {\n        EventDelayerState[EventDelayerState[\"Idle\"] = 0] = \"Idle\";\n        EventDelayerState[EventDelayerState[\"Running\"] = 1] = \"Running\";\n    })(EventDelayerState || (EventDelayerState = {}));\n    /**\n     * The EventDelayer is useful in situations in which you want\n     * to delay firing your events during some code.\n     * You can wrap that code and be sure that the event will not\n     * be fired during that wrap.\n     *\n     * ```\n     * const emitter: Emitter;\n     * const delayer = new EventDelayer();\n     * const delayedEvent = delayer.delay(emitter.event);\n     *\n     * delayedEvent(console.log);\n     *\n     * delayer.wrap(() => {\n     *   emitter.fire(); // event will not be fired yet\n     * });\n     *\n     * // event will only be fired at this point\n     * ```\n     */\n    var EventBufferer = (function () {\n        function EventBufferer() {\n            this.buffers = [];\n        }\n        EventBufferer.prototype.wrapEvent = function (event) {\n            var _this = this;\n            return function (listener, thisArgs, disposables) {\n                return event(function (i) {\n                    var buffer = _this.buffers[_this.buffers.length - 1];\n                    if (buffer) {\n                        buffer.push(function () { return listener.call(thisArgs, i); });\n                    }\n                    else {\n                        listener.call(thisArgs, i);\n                    }\n                }, void 0, disposables);\n            };\n        };\n        EventBufferer.prototype.bufferEvents = function (fn) {\n            var buffer = [];\n            this.buffers.push(buffer);\n            fn();\n            this.buffers.pop();\n            buffer.forEach(function (flush) { return flush(); });\n        };\n        return EventBufferer;\n    }());\n    exports.EventBufferer = EventBufferer;\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[47], __M([1,0,8]), function (require, exports, event_1) {\n    'use strict';\n    var CancellationToken;\n    (function (CancellationToken) {\n        CancellationToken.None = Object.freeze({\n            isCancellationRequested: false,\n            onCancellationRequested: event_1.default.None\n        });\n        CancellationToken.Cancelled = Object.freeze({\n            isCancellationRequested: true,\n            onCancellationRequested: event_1.default.None\n        });\n    })(CancellationToken = exports.CancellationToken || (exports.CancellationToken = {}));\n    var shortcutEvent = Object.freeze(function (callback, context) {\n        var handle = setTimeout(callback.bind(context), 0);\n        return { dispose: function () { clearTimeout(handle); } };\n    });\n    var MutableToken = (function () {\n        function MutableToken() {\n            this._isCancelled = false;\n        }\n        MutableToken.prototype.cancel = function () {\n            if (!this._isCancelled) {\n                this._isCancelled = true;\n                if (this._emitter) {\n                    this._emitter.fire(undefined);\n                    this._emitter = undefined;\n                }\n            }\n        };\n        Object.defineProperty(MutableToken.prototype, \"isCancellationRequested\", {\n            get: function () {\n                return this._isCancelled;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(MutableToken.prototype, \"onCancellationRequested\", {\n            get: function () {\n                if (this._isCancelled) {\n                    return shortcutEvent;\n                }\n                if (!this._emitter) {\n                    this._emitter = new event_1.Emitter();\n                }\n                return this._emitter.event;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        return MutableToken;\n    }());\n    var CancellationTokenSource = (function () {\n        function CancellationTokenSource() {\n        }\n        Object.defineProperty(CancellationTokenSource.prototype, \"token\", {\n            get: function () {\n                if (!this._token) {\n                    // be lazy and create the token only when\n                    // actually needed\n                    this._token = new MutableToken();\n                }\n                return this._token;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        CancellationTokenSource.prototype.cancel = function () {\n            if (!this._token) {\n                // save an object by returning the default\n                // cancelled token when cancellation happens\n                // before someone asks for the token\n                this._token = CancellationToken.Cancelled;\n            }\n            else {\n                this._token.cancel();\n            }\n        };\n        CancellationTokenSource.prototype.dispose = function () {\n            this.cancel();\n        };\n        return CancellationTokenSource;\n    }());\n    exports.CancellationTokenSource = CancellationTokenSource;\n});\n\n\n\n\n\n\ndefine(__m[15], __M([1,0,2]), function (require, exports, Errors) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var EmitterEvent = (function () {\n        function EmitterEvent(eventType, data) {\n            if (eventType === void 0) { eventType = null; }\n            if (data === void 0) { data = null; }\n            this._type = eventType;\n            this._data = data;\n        }\n        EmitterEvent.prototype.getType = function () {\n            return this._type;\n        };\n        EmitterEvent.prototype.getData = function () {\n            return this._data;\n        };\n        return EmitterEvent;\n    }());\n    exports.EmitterEvent = EmitterEvent;\n    var EventEmitter = (function () {\n        function EventEmitter(allowedEventTypes) {\n            if (allowedEventTypes === void 0) { allowedEventTypes = null; }\n            this._listeners = {};\n            this._bulkListeners = [];\n            this._collectedEvents = [];\n            this._deferredCnt = 0;\n            if (allowedEventTypes) {\n                this._allowedEventTypes = {};\n                for (var i = 0; i < allowedEventTypes.length; i++) {\n                    this._allowedEventTypes[allowedEventTypes[i]] = true;\n                }\n            }\n            else {\n                this._allowedEventTypes = null;\n            }\n        }\n        EventEmitter.prototype.dispose = function () {\n            this._listeners = {};\n            this._bulkListeners = [];\n            this._collectedEvents = [];\n            this._deferredCnt = 0;\n            this._allowedEventTypes = null;\n        };\n        EventEmitter.prototype.addListener = function (eventType, listener) {\n            if (eventType === '*') {\n                throw new Error('Use addBulkListener(listener) to register your listener!');\n            }\n            if (this._allowedEventTypes && !this._allowedEventTypes.hasOwnProperty(eventType)) {\n                throw new Error('This object will never emit this event type!');\n            }\n            if (this._listeners.hasOwnProperty(eventType)) {\n                this._listeners[eventType].push(listener);\n            }\n            else {\n                this._listeners[eventType] = [listener];\n            }\n            var bound = this;\n            return {\n                dispose: function () {\n                    if (!bound) {\n                        // Already called\n                        return;\n                    }\n                    bound._removeListener(eventType, listener);\n                    // Prevent leakers from holding on to the event emitter\n                    bound = null;\n                    listener = null;\n                }\n            };\n        };\n        EventEmitter.prototype.addListener2 = function (eventType, listener) {\n            return this.addListener(eventType, listener);\n        };\n        EventEmitter.prototype.addOneTimeDisposableListener = function (eventType, listener) {\n            var disposable = this.addListener(eventType, function (value) {\n                disposable.dispose();\n                listener(value);\n            });\n            return disposable;\n        };\n        EventEmitter.prototype.addBulkListener = function (listener) {\n            var _this = this;\n            this._bulkListeners.push(listener);\n            return {\n                dispose: function () {\n                    _this._removeBulkListener(listener);\n                }\n            };\n        };\n        EventEmitter.prototype.addBulkListener2 = function (listener) {\n            return this.addBulkListener(listener);\n        };\n        EventEmitter.prototype.addEmitter = function (eventEmitter) {\n            var _this = this;\n            return eventEmitter.addBulkListener2(function (events) {\n                var newEvents = events;\n                if (_this._deferredCnt === 0) {\n                    _this._emitEvents(newEvents);\n                }\n                else {\n                    // Collect for later\n                    _this._collectedEvents.push.apply(_this._collectedEvents, newEvents);\n                }\n            });\n        };\n        EventEmitter.prototype.addEmitter2 = function (eventEmitter) {\n            return this.addEmitter(eventEmitter);\n        };\n        EventEmitter.prototype._removeListener = function (eventType, listener) {\n            if (this._listeners.hasOwnProperty(eventType)) {\n                var listeners = this._listeners[eventType];\n                for (var i = 0, len = listeners.length; i < len; i++) {\n                    if (listeners[i] === listener) {\n                        listeners.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        };\n        EventEmitter.prototype._removeBulkListener = function (listener) {\n            for (var i = 0, len = this._bulkListeners.length; i < len; i++) {\n                if (this._bulkListeners[i] === listener) {\n                    this._bulkListeners.splice(i, 1);\n                    break;\n                }\n            }\n        };\n        EventEmitter.prototype._emitToSpecificTypeListeners = function (eventType, data) {\n            if (this._listeners.hasOwnProperty(eventType)) {\n                var listeners = this._listeners[eventType].slice(0);\n                for (var i = 0, len = listeners.length; i < len; i++) {\n                    safeInvoke1Arg(listeners[i], data);\n                }\n            }\n        };\n        EventEmitter.prototype._emitToBulkListeners = function (events) {\n            var bulkListeners = this._bulkListeners.slice(0);\n            for (var i = 0, len = bulkListeners.length; i < len; i++) {\n                safeInvoke1Arg(bulkListeners[i], events);\n            }\n        };\n        EventEmitter.prototype._emitEvents = function (events) {\n            if (this._bulkListeners.length > 0) {\n                this._emitToBulkListeners(events);\n            }\n            for (var i = 0, len = events.length; i < len; i++) {\n                var e = events[i];\n                this._emitToSpecificTypeListeners(e.getType(), e.getData());\n            }\n        };\n        EventEmitter.prototype.emit = function (eventType, data) {\n            if (data === void 0) { data = {}; }\n            if (this._allowedEventTypes && !this._allowedEventTypes.hasOwnProperty(eventType)) {\n                throw new Error('Cannot emit this event type because it wasn\\'t white-listed!');\n            }\n            // Early return if no listeners would get this\n            if (!this._listeners.hasOwnProperty(eventType) && this._bulkListeners.length === 0) {\n                return;\n            }\n            var emitterEvent = new EmitterEvent(eventType, data);\n            if (this._deferredCnt === 0) {\n                this._emitEvents([emitterEvent]);\n            }\n            else {\n                // Collect for later\n                this._collectedEvents.push(emitterEvent);\n            }\n        };\n        EventEmitter.prototype.deferredEmit = function (callback) {\n            this._deferredCnt = this._deferredCnt + 1;\n            var result = safeInvokeNoArg(callback);\n            this._deferredCnt = this._deferredCnt - 1;\n            if (this._deferredCnt === 0) {\n                this._emitCollected();\n            }\n            return result;\n        };\n        EventEmitter.prototype._emitCollected = function () {\n            // Flush collected events\n            var events = this._collectedEvents;\n            this._collectedEvents = [];\n            if (events.length > 0) {\n                this._emitEvents(events);\n            }\n        };\n        return EventEmitter;\n    }());\n    exports.EventEmitter = EventEmitter;\n    var EmitQueueElement = (function () {\n        function EmitQueueElement(target, arg) {\n            this.target = target;\n            this.arg = arg;\n        }\n        return EmitQueueElement;\n    }());\n    /**\n     * Same as EventEmitter, but guarantees events are delivered in order to each listener\n     */\n    var OrderGuaranteeEventEmitter = (function (_super) {\n        __extends(OrderGuaranteeEventEmitter, _super);\n        function OrderGuaranteeEventEmitter(allowedEventTypes) {\n            if (allowedEventTypes === void 0) { allowedEventTypes = null; }\n            _super.call(this, allowedEventTypes);\n            this._emitQueue = [];\n        }\n        OrderGuaranteeEventEmitter.prototype._emitToSpecificTypeListeners = function (eventType, data) {\n            if (this._listeners.hasOwnProperty(eventType)) {\n                var listeners = this._listeners[eventType];\n                for (var i = 0, len = listeners.length; i < len; i++) {\n                    this._emitQueue.push(new EmitQueueElement(listeners[i], data));\n                }\n            }\n        };\n        OrderGuaranteeEventEmitter.prototype._emitToBulkListeners = function (events) {\n            var bulkListeners = this._bulkListeners;\n            for (var i = 0, len = bulkListeners.length; i < len; i++) {\n                this._emitQueue.push(new EmitQueueElement(bulkListeners[i], events));\n            }\n        };\n        OrderGuaranteeEventEmitter.prototype._emitEvents = function (events) {\n            _super.prototype._emitEvents.call(this, events);\n            while (this._emitQueue.length > 0) {\n                var queueElement = this._emitQueue.shift();\n                safeInvoke1Arg(queueElement.target, queueElement.arg);\n            }\n        };\n        return OrderGuaranteeEventEmitter;\n    }(EventEmitter));\n    exports.OrderGuaranteeEventEmitter = OrderGuaranteeEventEmitter;\n    function safeInvokeNoArg(func) {\n        try {\n            return func();\n        }\n        catch (e) {\n            Errors.onUnexpectedError(e);\n        }\n    }\n    function safeInvoke1Arg(func, arg1) {\n        try {\n            return func(arg1);\n        }\n        catch (e) {\n            Errors.onUnexpectedError(e);\n        }\n    }\n});\n\ndefine(__m[26], __M([1,0,10,2,61]), function (require, exports, Platform, errors, precision) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.ENABLE_TIMER = false;\n    var msWriteProfilerMark = Platform.globals['msWriteProfilerMark'];\n    (function (Topic) {\n        Topic[Topic[\"EDITOR\"] = 0] = \"EDITOR\";\n        Topic[Topic[\"LANGUAGES\"] = 1] = \"LANGUAGES\";\n        Topic[Topic[\"WORKER\"] = 2] = \"WORKER\";\n        Topic[Topic[\"WORKBENCH\"] = 3] = \"WORKBENCH\";\n        Topic[Topic[\"STARTUP\"] = 4] = \"STARTUP\";\n    })(exports.Topic || (exports.Topic = {}));\n    var Topic = exports.Topic;\n    var NullTimerEvent = (function () {\n        function NullTimerEvent() {\n        }\n        NullTimerEvent.prototype.stop = function () {\n            return;\n        };\n        NullTimerEvent.prototype.timeTaken = function () {\n            return -1;\n        };\n        return NullTimerEvent;\n    }());\n    var TimerEvent = (function () {\n        function TimerEvent(timeKeeper, name, topic, startTime, description) {\n            this.timeKeeper = timeKeeper;\n            this.name = name;\n            this.description = description;\n            this.topic = topic;\n            this.stopTime = null;\n            if (startTime) {\n                this.startTime = startTime;\n                return;\n            }\n            this.startTime = new Date();\n            this.sw = precision.StopWatch.create();\n            if (msWriteProfilerMark) {\n                var profilerName = ['Monaco', this.topic, this.name, 'start'];\n                msWriteProfilerMark(profilerName.join('|'));\n            }\n        }\n        TimerEvent.prototype.stop = function (stopTime) {\n            // already stopped\n            if (this.stopTime !== null) {\n                return;\n            }\n            if (stopTime) {\n                this.stopTime = stopTime;\n                this.sw = null;\n                this.timeKeeper._onEventStopped(this);\n                return;\n            }\n            this.stopTime = new Date();\n            if (this.sw) {\n                this.sw.stop();\n            }\n            this.timeKeeper._onEventStopped(this);\n            if (msWriteProfilerMark) {\n                var profilerName = ['Monaco', this.topic, this.name, 'stop'];\n                msWriteProfilerMark(profilerName.join('|'));\n            }\n        };\n        TimerEvent.prototype.timeTaken = function () {\n            if (this.sw) {\n                return this.sw.elapsed();\n            }\n            if (this.stopTime) {\n                return this.stopTime.getTime() - this.startTime.getTime();\n            }\n            return -1;\n        };\n        return TimerEvent;\n    }());\n    var TimeKeeper = (function () {\n        function TimeKeeper() {\n            this.cleaningIntervalId = -1;\n            this.collectedEvents = [];\n            this.listeners = [];\n        }\n        TimeKeeper.prototype.isEnabled = function () {\n            return exports.ENABLE_TIMER;\n        };\n        TimeKeeper.prototype.start = function (topic, name, start, description) {\n            if (!this.isEnabled()) {\n                return exports.nullEvent;\n            }\n            var strTopic;\n            if (typeof topic === 'string') {\n                strTopic = topic;\n            }\n            else if (topic === Topic.EDITOR) {\n                strTopic = 'Editor';\n            }\n            else if (topic === Topic.LANGUAGES) {\n                strTopic = 'Languages';\n            }\n            else if (topic === Topic.WORKER) {\n                strTopic = 'Worker';\n            }\n            else if (topic === Topic.WORKBENCH) {\n                strTopic = 'Workbench';\n            }\n            else if (topic === Topic.STARTUP) {\n                strTopic = 'Startup';\n            }\n            this.initAutoCleaning();\n            var event = new TimerEvent(this, name, strTopic, start, description);\n            this.addEvent(event);\n            return event;\n        };\n        TimeKeeper.prototype.dispose = function () {\n            if (this.cleaningIntervalId !== -1) {\n                Platform.clearInterval(this.cleaningIntervalId);\n                this.cleaningIntervalId = -1;\n            }\n        };\n        TimeKeeper.prototype.addListener = function (listener) {\n            var _this = this;\n            this.listeners.push(listener);\n            return {\n                dispose: function () {\n                    for (var i = 0; i < _this.listeners.length; i++) {\n                        if (_this.listeners[i] === listener) {\n                            _this.listeners.splice(i, 1);\n                            return;\n                        }\n                    }\n                }\n            };\n        };\n        TimeKeeper.prototype.addEvent = function (event) {\n            event.id = TimeKeeper.EVENT_ID;\n            TimeKeeper.EVENT_ID++;\n            this.collectedEvents.push(event);\n            // expire items from the front of the cache\n            if (this.collectedEvents.length > TimeKeeper._EVENT_CACHE_LIMIT) {\n                this.collectedEvents.shift();\n            }\n        };\n        TimeKeeper.prototype.initAutoCleaning = function () {\n            var _this = this;\n            if (this.cleaningIntervalId === -1) {\n                this.cleaningIntervalId = Platform.setInterval(function () {\n                    var now = Date.now();\n                    _this.collectedEvents.forEach(function (event) {\n                        if (!event.stopTime && (now - event.startTime.getTime()) >= TimeKeeper._MAX_TIMER_LENGTH) {\n                            event.stop();\n                        }\n                    });\n                }, TimeKeeper._CLEAN_UP_INTERVAL);\n            }\n        };\n        TimeKeeper.prototype.getCollectedEvents = function () {\n            return this.collectedEvents.slice(0);\n        };\n        TimeKeeper.prototype.clearCollectedEvents = function () {\n            this.collectedEvents = [];\n        };\n        TimeKeeper.prototype._onEventStopped = function (event) {\n            var emitEvents = [event];\n            var listeners = this.listeners.slice(0);\n            for (var i = 0; i < listeners.length; i++) {\n                try {\n                    listeners[i](emitEvents);\n                }\n                catch (e) {\n                    errors.onUnexpectedError(e);\n                }\n            }\n        };\n        TimeKeeper.prototype.setInitialCollectedEvents = function (events, startTime) {\n            var _this = this;\n            if (!this.isEnabled()) {\n                return;\n            }\n            if (startTime) {\n                TimeKeeper.PARSE_TIME = startTime;\n            }\n            events.forEach(function (event) {\n                var e = new TimerEvent(_this, event.name, event.topic, event.startTime, event.description);\n                e.stop(event.stopTime);\n                _this.addEvent(e);\n            });\n        };\n        /**\n         * After being started for 1 minute, all timers are automatically stopped.\n         */\n        TimeKeeper._MAX_TIMER_LENGTH = 60000; // 1 minute\n        /**\n         * Every 2 minutes, a sweep of current started timers is done.\n         */\n        TimeKeeper._CLEAN_UP_INTERVAL = 120000; // 2 minutes\n        /**\n         * Collect at most 1000 events.\n         */\n        TimeKeeper._EVENT_CACHE_LIMIT = 1000;\n        TimeKeeper.EVENT_ID = 1;\n        TimeKeeper.PARSE_TIME = new Date();\n        return TimeKeeper;\n    }());\n    exports.TimeKeeper = TimeKeeper;\n    var timeKeeper = new TimeKeeper();\n    exports.nullEvent = new NullTimerEvent();\n    function start(topic, name, start, description) {\n        return timeKeeper.start(topic, name, start, description);\n    }\n    exports.start = start;\n    function getTimeKeeper() {\n        return timeKeeper;\n    }\n    exports.getTimeKeeper = getTimeKeeper;\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\ndefine(__m[5], __M([110,2]), function (winjs, __Errors__) {\n\t'use strict';\n\n\tvar outstandingPromiseErrors = {};\n\tfunction promiseErrorHandler(e) {\n\n\t\t//\n\t\t// e.detail looks like: { exception, error, promise, handler, id, parent }\n\t\t//\n\t\tvar details = e.detail;\n\t\tvar id = details.id;\n\n\t\t// If the error has a parent promise then this is not the origination of the\n\t\t//  error so we check if it has a handler, and if so we mark that the error\n\t\t//  was handled by removing it from outstandingPromiseErrors\n\t\t//\n\t\tif (details.parent) {\n\t\t\tif (details.handler && outstandingPromiseErrors) {\n\t\t\t\tdelete outstandingPromiseErrors[id];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Indicate that this error was originated and needs to be handled\n\t\toutstandingPromiseErrors[id] = details;\n\n\t\t// The first time the queue fills up this iteration, schedule a timeout to\n\t\t// check if any errors are still unhandled.\n\t\tif (Object.keys(outstandingPromiseErrors).length === 1) {\n\t\t\tsetTimeout(function () {\n\t\t\t\tvar errors = outstandingPromiseErrors;\n\t\t\t\toutstandingPromiseErrors = {};\n\t\t\t\tObject.keys(errors).forEach(function (errorId) {\n\t\t\t\t\tvar error = errors[errorId];\n\t\t\t\t\tif(error.exception) {\n\t\t\t\t\t\t__Errors__.onUnexpectedError(error.exception);\n\t\t\t\t\t} else if(error.error) {\n\t\t\t\t\t\t__Errors__.onUnexpectedError(error.error);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"WARNING: Promise with no error callback:\" + error.id);\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif(error.exception) {\n\t\t\t\t\t\tconsole.log(error.exception.stack);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\twinjs.Promise.addEventListener(\"error\", promiseErrorHandler);\n\n\treturn {\n\t\tPromise: winjs.Promise,\n\t\tTPromise: winjs.Promise,\n\t\tPPromise: winjs.Promise\n\t};\n});\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\n\n\n\ndefine(__m[24], __M([1,0,2,10,5,47,16]), function (require, exports, errors, platform, winjs_base_1, cancellation_1, lifecycle_1) {\n    'use strict';\n    function isThenable(obj) {\n        return obj && typeof obj.then === 'function';\n    }\n    function toThenable(arg) {\n        if (isThenable(arg)) {\n            return arg;\n        }\n        else {\n            return winjs_base_1.TPromise.as(arg);\n        }\n    }\n    exports.toThenable = toThenable;\n    function asWinJsPromise(callback) {\n        var source = new cancellation_1.CancellationTokenSource();\n        return new winjs_base_1.TPromise(function (resolve, reject) {\n            var item = callback(source.token);\n            if (isThenable(item)) {\n                item.then(resolve, reject);\n            }\n            else {\n                resolve(item);\n            }\n        }, function () {\n            source.cancel();\n        });\n    }\n    exports.asWinJsPromise = asWinJsPromise;\n    /**\n     * Hook a cancellation token to a WinJS Promise\n     */\n    function wireCancellationToken(token, promise) {\n        token.onCancellationRequested(function () { return promise.cancel(); });\n        return promise;\n    }\n    exports.wireCancellationToken = wireCancellationToken;\n    /**\n     * A helper to prevent accumulation of sequential async tasks.\n     *\n     * Imagine a mail man with the sole task of delivering letters. As soon as\n     * a letter submitted for delivery, he drives to the destination, delivers it\n     * and returns to his base. Imagine that during the trip, N more letters were submitted.\n     * When the mail man returns, he picks those N letters and delivers them all in a\n     * single trip. Even though N+1 submissions occurred, only 2 deliveries were made.\n     *\n     * The throttler implements this via the queue() method, by providing it a task\n     * factory. Following the example:\n     *\n     * \t\tvar throttler = new Throttler();\n     * \t\tvar letters = [];\n     *\n     * \t\tfunction deliver() {\n     * \t\t\tconst lettersToDeliver = letters;\n     * \t\t\tletters = [];\n     * \t\t\treturn makeTheTrip(lettersToDeliver);\n     * \t\t}\n     *\n     * \t\tfunction onLetterReceived(l) {\n     * \t\t\tletters.push(l);\n     * \t\t\tthrottler.queue(deliver);\n     * \t\t}\n     */\n    var Throttler = (function () {\n        function Throttler() {\n            this.activePromise = null;\n            this.queuedPromise = null;\n            this.queuedPromiseFactory = null;\n        }\n        Throttler.prototype.queue = function (promiseFactory) {\n            var _this = this;\n            if (this.activePromise) {\n                this.queuedPromiseFactory = promiseFactory;\n                if (!this.queuedPromise) {\n                    var onComplete_1 = function () {\n                        _this.queuedPromise = null;\n                        var result = _this.queue(_this.queuedPromiseFactory);\n                        _this.queuedPromiseFactory = null;\n                        return result;\n                    };\n                    this.queuedPromise = new winjs_base_1.Promise(function (c, e, p) {\n                        _this.activePromise.then(onComplete_1, onComplete_1, p).done(c);\n                    }, function () {\n                        _this.activePromise.cancel();\n                    });\n                }\n                return new winjs_base_1.Promise(function (c, e, p) {\n                    _this.queuedPromise.then(c, e, p);\n                }, function () {\n                    // no-op\n                });\n            }\n            this.activePromise = promiseFactory();\n            return new winjs_base_1.Promise(function (c, e, p) {\n                _this.activePromise.done(function (result) {\n                    _this.activePromise = null;\n                    c(result);\n                }, function (err) {\n                    _this.activePromise = null;\n                    e(err);\n                }, p);\n            }, function () {\n                _this.activePromise.cancel();\n            });\n        };\n        return Throttler;\n    }());\n    exports.Throttler = Throttler;\n    // TODO@Joao: can the previous throttler be replaced with this?\n    var SimpleThrottler = (function () {\n        function SimpleThrottler() {\n            this.current = winjs_base_1.TPromise.as(null);\n        }\n        SimpleThrottler.prototype.queue = function (promiseTask) {\n            return this.current = this.current.then(function () { return promiseTask(); });\n        };\n        return SimpleThrottler;\n    }());\n    exports.SimpleThrottler = SimpleThrottler;\n    /**\n     * A helper to delay execution of a task that is being requested often.\n     *\n     * Following the throttler, now imagine the mail man wants to optimize the number of\n     * trips proactively. The trip itself can be long, so the he decides not to make the trip\n     * as soon as a letter is submitted. Instead he waits a while, in case more\n     * letters are submitted. After said waiting period, if no letters were submitted, he\n     * decides to make the trip. Imagine that N more letters were submitted after the first\n     * one, all within a short period of time between each other. Even though N+1\n     * submissions occurred, only 1 delivery was made.\n     *\n     * The delayer offers this behavior via the trigger() method, into which both the task\n     * to be executed and the waiting period (delay) must be passed in as arguments. Following\n     * the example:\n     *\n     * \t\tvar delayer = new Delayer(WAITING_PERIOD);\n     * \t\tvar letters = [];\n     *\n     * \t\tfunction letterReceived(l) {\n     * \t\t\tletters.push(l);\n     * \t\t\tdelayer.trigger(() => { return makeTheTrip(); });\n     * \t\t}\n     */\n    var Delayer = (function () {\n        function Delayer(defaultDelay) {\n            this.defaultDelay = defaultDelay;\n            this.timeout = null;\n            this.completionPromise = null;\n            this.onSuccess = null;\n            this.task = null;\n        }\n        Delayer.prototype.trigger = function (task, delay) {\n            var _this = this;\n            if (delay === void 0) { delay = this.defaultDelay; }\n            this.task = task;\n            this.cancelTimeout();\n            if (!this.completionPromise) {\n                this.completionPromise = new winjs_base_1.Promise(function (c) {\n                    _this.onSuccess = c;\n                }, function () {\n                    // no-op\n                }).then(function () {\n                    _this.completionPromise = null;\n                    _this.onSuccess = null;\n                    var task = _this.task;\n                    _this.task = null;\n                    return task();\n                });\n            }\n            this.timeout = setTimeout(function () {\n                _this.timeout = null;\n                _this.onSuccess(null);\n            }, delay);\n            return this.completionPromise;\n        };\n        Delayer.prototype.isTriggered = function () {\n            return this.timeout !== null;\n        };\n        Delayer.prototype.cancel = function () {\n            this.cancelTimeout();\n            if (this.completionPromise) {\n                this.completionPromise.cancel();\n                this.completionPromise = null;\n            }\n        };\n        Delayer.prototype.cancelTimeout = function () {\n            if (this.timeout !== null) {\n                clearTimeout(this.timeout);\n                this.timeout = null;\n            }\n        };\n        return Delayer;\n    }());\n    exports.Delayer = Delayer;\n    /**\n     * A helper to delay execution of a task that is being requested often, while\n     * preventing accumulation of consecutive executions, while the task runs.\n     *\n     * Simply combine the two mail man strategies from the Throttler and Delayer\n     * helpers, for an analogy.\n     */\n    var ThrottledDelayer = (function (_super) {\n        __extends(ThrottledDelayer, _super);\n        function ThrottledDelayer(defaultDelay) {\n            _super.call(this, defaultDelay);\n            this.throttler = new Throttler();\n        }\n        ThrottledDelayer.prototype.trigger = function (promiseFactory, delay) {\n            var _this = this;\n            return _super.prototype.trigger.call(this, function () { return _this.throttler.queue(promiseFactory); }, delay);\n        };\n        return ThrottledDelayer;\n    }(Delayer));\n    exports.ThrottledDelayer = ThrottledDelayer;\n    /**\n     * Similar to the ThrottledDelayer, except it also guarantees that the promise\n     * factory doesn't get called more often than every `minimumPeriod` milliseconds.\n     */\n    var PeriodThrottledDelayer = (function (_super) {\n        __extends(PeriodThrottledDelayer, _super);\n        function PeriodThrottledDelayer(defaultDelay, minimumPeriod) {\n            if (minimumPeriod === void 0) { minimumPeriod = 0; }\n            _super.call(this, defaultDelay);\n            this.minimumPeriod = minimumPeriod;\n            this.periodThrottler = new Throttler();\n        }\n        PeriodThrottledDelayer.prototype.trigger = function (promiseFactory, delay) {\n            var _this = this;\n            return _super.prototype.trigger.call(this, function () {\n                return _this.periodThrottler.queue(function () {\n                    return winjs_base_1.Promise.join([\n                        winjs_base_1.TPromise.timeout(_this.minimumPeriod),\n                        promiseFactory()\n                    ]).then(function (r) { return r[1]; });\n                });\n            }, delay);\n        };\n        return PeriodThrottledDelayer;\n    }(ThrottledDelayer));\n    exports.PeriodThrottledDelayer = PeriodThrottledDelayer;\n    var PromiseSource = (function () {\n        function PromiseSource() {\n            var _this = this;\n            this._value = new winjs_base_1.TPromise(function (c, e) {\n                _this._completeCallback = c;\n                _this._errorCallback = e;\n            });\n        }\n        Object.defineProperty(PromiseSource.prototype, \"value\", {\n            get: function () {\n                return this._value;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        PromiseSource.prototype.complete = function (value) {\n            this._completeCallback(value);\n        };\n        PromiseSource.prototype.error = function (err) {\n            this._errorCallback(err);\n        };\n        return PromiseSource;\n    }());\n    exports.PromiseSource = PromiseSource;\n    var ShallowCancelThenPromise = (function (_super) {\n        __extends(ShallowCancelThenPromise, _super);\n        function ShallowCancelThenPromise(outer) {\n            var completeCallback, errorCallback, progressCallback;\n            _super.call(this, function (c, e, p) {\n                completeCallback = c;\n                errorCallback = e;\n                progressCallback = p;\n            }, function () {\n                // cancel this promise but not the\n                // outer promise\n                errorCallback(errors.canceled());\n            });\n            outer.then(completeCallback, errorCallback, progressCallback);\n        }\n        return ShallowCancelThenPromise;\n    }(winjs_base_1.TPromise));\n    exports.ShallowCancelThenPromise = ShallowCancelThenPromise;\n    /**\n     * Returns a new promise that joins the provided promise. Upon completion of\n     * the provided promise the provided function will always be called. This\n     * method is comparable to a try-finally code block.\n     * @param promise a promise\n     * @param f a function that will be call in the success and error case.\n     */\n    function always(promise, f) {\n        return new winjs_base_1.TPromise(function (c, e, p) {\n            promise.done(function (result) {\n                try {\n                    f(result);\n                }\n                catch (e1) {\n                    errors.onUnexpectedError(e1);\n                }\n                c(result);\n            }, function (err) {\n                try {\n                    f(err);\n                }\n                catch (e1) {\n                    errors.onUnexpectedError(e1);\n                }\n                e(err);\n            }, function (progress) {\n                p(progress);\n            });\n        }, function () {\n            promise.cancel();\n        });\n    }\n    exports.always = always;\n    /**\n     * Runs the provided list of promise factories in sequential order. The returned\n     * promise will complete to an array of results from each promise.\n     */\n    function sequence(promiseFactory) {\n        var results = [];\n        // reverse since we start with last element using pop()\n        promiseFactory = promiseFactory.reverse();\n        function next() {\n            if (promiseFactory.length) {\n                return promiseFactory.pop()();\n            }\n            return null;\n        }\n        function thenHandler(result) {\n            if (result) {\n                results.push(result);\n            }\n            var n = next();\n            if (n) {\n                return n.then(thenHandler);\n            }\n            return winjs_base_1.TPromise.as(results);\n        }\n        return winjs_base_1.TPromise.as(null).then(thenHandler);\n    }\n    exports.sequence = sequence;\n    function once(fn) {\n        var _this = this;\n        var didCall = false;\n        var result;\n        return function () {\n            if (didCall) {\n                return result;\n            }\n            didCall = true;\n            result = fn.apply(_this, arguments);\n            return result;\n        };\n    }\n    exports.once = once;\n    /**\n     * A helper to queue N promises and run them all with a max degree of parallelism. The helper\n     * ensures that at any time no more than M promises are running at the same time.\n     */\n    var Limiter = (function () {\n        function Limiter(maxDegreeOfParalellism) {\n            this.maxDegreeOfParalellism = maxDegreeOfParalellism;\n            this.outstandingPromises = [];\n            this.runningPromises = 0;\n        }\n        Limiter.prototype.queue = function (promiseFactory) {\n            var _this = this;\n            return new winjs_base_1.TPromise(function (c, e, p) {\n                _this.outstandingPromises.push({\n                    factory: promiseFactory,\n                    c: c,\n                    e: e,\n                    p: p\n                });\n                _this.consume();\n            });\n        };\n        Limiter.prototype.consume = function () {\n            var _this = this;\n            while (this.outstandingPromises.length && this.runningPromises < this.maxDegreeOfParalellism) {\n                var iLimitedTask = this.outstandingPromises.shift();\n                this.runningPromises++;\n                var promise = iLimitedTask.factory();\n                promise.done(iLimitedTask.c, iLimitedTask.e, iLimitedTask.p);\n                promise.done(function () { return _this.consumed(); }, function () { return _this.consumed(); });\n            }\n        };\n        Limiter.prototype.consumed = function () {\n            this.runningPromises--;\n            this.consume();\n        };\n        return Limiter;\n    }());\n    exports.Limiter = Limiter;\n    var TimeoutTimer = (function (_super) {\n        __extends(TimeoutTimer, _super);\n        function TimeoutTimer() {\n            _super.call(this);\n            this._token = -1;\n        }\n        TimeoutTimer.prototype.dispose = function () {\n            this.cancel();\n            _super.prototype.dispose.call(this);\n        };\n        TimeoutTimer.prototype.cancel = function () {\n            if (this._token !== -1) {\n                platform.clearTimeout(this._token);\n                this._token = -1;\n            }\n        };\n        TimeoutTimer.prototype.cancelAndSet = function (runner, timeout) {\n            var _this = this;\n            this.cancel();\n            this._token = platform.setTimeout(function () {\n                _this._token = -1;\n                runner();\n            }, timeout);\n        };\n        TimeoutTimer.prototype.setIfNotSet = function (runner, timeout) {\n            var _this = this;\n            if (this._token !== -1) {\n                // timer is already set\n                return;\n            }\n            this._token = platform.setTimeout(function () {\n                _this._token = -1;\n                runner();\n            }, timeout);\n        };\n        return TimeoutTimer;\n    }(lifecycle_1.Disposable));\n    exports.TimeoutTimer = TimeoutTimer;\n    var IntervalTimer = (function (_super) {\n        __extends(IntervalTimer, _super);\n        function IntervalTimer() {\n            _super.call(this);\n            this._token = -1;\n        }\n        IntervalTimer.prototype.dispose = function () {\n            this.cancel();\n            _super.prototype.dispose.call(this);\n        };\n        IntervalTimer.prototype.cancel = function () {\n            if (this._token !== -1) {\n                platform.clearInterval(this._token);\n                this._token = -1;\n            }\n        };\n        IntervalTimer.prototype.cancelAndSet = function (runner, interval) {\n            this.cancel();\n            this._token = platform.setInterval(function () {\n                runner();\n            }, interval);\n        };\n        return IntervalTimer;\n    }(lifecycle_1.Disposable));\n    exports.IntervalTimer = IntervalTimer;\n    var RunOnceScheduler = (function () {\n        function RunOnceScheduler(runner, timeout) {\n            this.timeoutToken = -1;\n            this.runner = runner;\n            this.timeout = timeout;\n            this.timeoutHandler = this.onTimeout.bind(this);\n        }\n        /**\n         * Dispose RunOnceScheduler\n         */\n        RunOnceScheduler.prototype.dispose = function () {\n            this.cancel();\n            this.runner = null;\n        };\n        /**\n         * Cancel current scheduled runner (if any).\n         */\n        RunOnceScheduler.prototype.cancel = function () {\n            if (this.isScheduled()) {\n                platform.clearTimeout(this.timeoutToken);\n                this.timeoutToken = -1;\n            }\n        };\n        /**\n         * Replace runner. If there is a runner already scheduled, the new runner will be called.\n         */\n        RunOnceScheduler.prototype.setRunner = function (runner) {\n            this.runner = runner;\n        };\n        /**\n         * Cancel previous runner (if any) & schedule a new runner.\n         */\n        RunOnceScheduler.prototype.schedule = function (delay) {\n            if (delay === void 0) { delay = this.timeout; }\n            this.cancel();\n            this.timeoutToken = platform.setTimeout(this.timeoutHandler, delay);\n        };\n        /**\n         * Returns true if scheduled.\n         */\n        RunOnceScheduler.prototype.isScheduled = function () {\n            return this.timeoutToken !== -1;\n        };\n        RunOnceScheduler.prototype.onTimeout = function () {\n            this.timeoutToken = -1;\n            if (this.runner) {\n                this.runner();\n            }\n        };\n        return RunOnceScheduler;\n    }());\n    exports.RunOnceScheduler = RunOnceScheduler;\n    function nfcall(fn) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        return new winjs_base_1.Promise(function (c, e) { return fn.apply(void 0, args.concat([function (err, result) { return err ? e(err) : c(result); }])); });\n    }\n    exports.nfcall = nfcall;\n    function ninvoke(thisArg, fn) {\n        var args = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            args[_i - 2] = arguments[_i];\n        }\n        return new winjs_base_1.Promise(function (c, e) { return fn.call.apply(fn, [thisArg].concat(args, [function (err, result) { return err ? e(err) : c(result); }])); });\n    }\n    exports.ninvoke = ninvoke;\n});\n\ndefine(__m[84], __M([1,0,5]), function (require, exports, winjs_base_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var Schemas;\n    (function (Schemas) {\n        /**\n         * A schema that is used for models that exist in memory\n         * only and that have no correspondence on a server or such.\n         */\n        Schemas.inMemory = 'inmemory';\n        /**\n         * A schema that is used for setting files\n         */\n        Schemas.vscode = 'vscode';\n        /**\n         * A schema that is used for internal private files\n         */\n        Schemas.internal = 'private';\n        Schemas.http = 'http';\n        Schemas.https = 'https';\n        Schemas.file = 'file';\n    })(Schemas = exports.Schemas || (exports.Schemas = {}));\n    function xhr(options) {\n        var req = null;\n        var canceled = false;\n        return new winjs_base_1.TPromise(function (c, e, p) {\n            req = new XMLHttpRequest();\n            req.onreadystatechange = function () {\n                if (canceled) {\n                    return;\n                }\n                if (req.readyState === 4) {\n                    // Handle 1223: http://bugs.jquery.com/ticket/1450\n                    if ((req.status >= 200 && req.status < 300) || req.status === 1223) {\n                        c(req);\n                    }\n                    else {\n                        e(req);\n                    }\n                    req.onreadystatechange = function () { };\n                }\n                else {\n                    p(req);\n                }\n            };\n            req.open(options.type || 'GET', options.url, \n            // Promise based XHR does not support sync.\n            //\n            true, options.user, options.password);\n            req.responseType = options.responseType || '';\n            Object.keys(options.headers || {}).forEach(function (k) {\n                req.setRequestHeader(k, options.headers[k]);\n            });\n            if (options.customRequestInitializer) {\n                options.customRequestInitializer(req);\n            }\n            req.send(options.data);\n        }, function () {\n            canceled = true;\n            req.abort();\n        });\n    }\n    exports.xhr = xhr;\n});\n\ndefine(__m[109], __M([1,0,2,89,91]), function (require, exports, errors_1, marshalling_1, workerProtocol) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var WorkerServer = (function () {\n        function WorkerServer(postSerializedMessage) {\n            this._postSerializedMessage = postSerializedMessage;\n            this._workerId = 0;\n            this._requestHandler = null;\n            this._bindConsole();\n        }\n        WorkerServer.prototype._bindConsole = function () {\n            self.console = {\n                log: this._sendPrintMessage.bind(this, workerProtocol.PrintType.LOG),\n                debug: this._sendPrintMessage.bind(this, workerProtocol.PrintType.DEBUG),\n                info: this._sendPrintMessage.bind(this, workerProtocol.PrintType.INFO),\n                warn: this._sendPrintMessage.bind(this, workerProtocol.PrintType.WARN),\n                error: this._sendPrintMessage.bind(this, workerProtocol.PrintType.ERROR)\n            };\n            errors_1.setUnexpectedErrorHandler(function (e) {\n                self.console.error(e);\n            });\n        };\n        WorkerServer.prototype._sendPrintMessage = function (level) {\n            var objects = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                objects[_i - 1] = arguments[_i];\n            }\n            var transformedObjects = objects.map(function (obj) { return (obj instanceof Error) ? errors_1.transformErrorForSerialization(obj) : obj; });\n            var msg = {\n                monacoWorker: true,\n                from: this._workerId,\n                req: '0',\n                type: workerProtocol.MessageType.PRINT,\n                level: level,\n                payload: (transformedObjects.length === 1 ? transformedObjects[0] : transformedObjects)\n            };\n            this._postMessage(msg);\n        };\n        WorkerServer.prototype._sendReply = function (msgId, action, payload) {\n            var msg = {\n                monacoWorker: true,\n                from: this._workerId,\n                req: '0',\n                id: msgId,\n                type: workerProtocol.MessageType.REPLY,\n                action: action,\n                payload: (payload instanceof Error) ? errors_1.transformErrorForSerialization(payload) : payload\n            };\n            this._postMessage(msg);\n        };\n        WorkerServer.prototype.loadModule = function (moduleId, callback, errorback) {\n            // Use the global require to be sure to get the global config\n            self.require([moduleId], function () {\n                var result = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    result[_i - 0] = arguments[_i];\n                }\n                callback(result[0]);\n            }, errorback);\n        };\n        WorkerServer.prototype.onmessage = function (msg) {\n            this._onmessage(marshalling_1.parse(msg));\n        };\n        WorkerServer.prototype._postMessage = function (msg) {\n            this._postSerializedMessage(marshalling_1.stringify(msg));\n        };\n        WorkerServer.prototype._onmessage = function (msg) {\n            var _this = this;\n            var c = this._sendReply.bind(this, msg.id, workerProtocol.ReplyType.COMPLETE);\n            var e = this._sendReply.bind(this, msg.id, workerProtocol.ReplyType.ERROR);\n            var p = this._sendReply.bind(this, msg.id, workerProtocol.ReplyType.PROGRESS);\n            switch (msg.type) {\n                case workerProtocol.MessageType.INITIALIZE:\n                    this._workerId = msg.payload.id;\n                    var loaderConfig = msg.payload.loaderConfiguration;\n                    // TODO@Alex: share this code with simpleWorker\n                    if (loaderConfig) {\n                        // Remove 'baseUrl', handling it is beyond scope for now\n                        if (typeof loaderConfig.baseUrl !== 'undefined') {\n                            delete loaderConfig['baseUrl'];\n                        }\n                        if (typeof loaderConfig.paths !== 'undefined') {\n                            if (typeof loaderConfig.paths.vs !== 'undefined') {\n                                delete loaderConfig.paths['vs'];\n                            }\n                        }\n                        var nlsConfig_1 = loaderConfig['vs/nls'];\n                        // We need to have pseudo translation\n                        if (nlsConfig_1 && nlsConfig_1.pseudo) {\n                            require(['vs/nls'], function (nlsPlugin) {\n                                nlsPlugin.setPseudoTranslation(nlsConfig_1.pseudo);\n                            });\n                        }\n                        // Since this is in a web worker, enable catching errors\n                        loaderConfig.catchError = true;\n                        self.require.config(loaderConfig);\n                    }\n                    this.loadModule(msg.payload.moduleId, function (handlerModule) {\n                        _this._requestHandler = handlerModule.value;\n                        c();\n                    }, e);\n                    break;\n                default:\n                    this._handleMessage(msg, c, e, p);\n                    break;\n            }\n        };\n        WorkerServer.prototype._handleMessage = function (msg, c, e, p) {\n            if (!this._requestHandler) {\n                e('Request handler not loaded');\n                return;\n            }\n            var handlerMethod = this._requestHandler[msg.type];\n            if (typeof handlerMethod !== 'function') {\n                e('Handler does not have method ' + msg.type);\n                return;\n            }\n            try {\n                handlerMethod.call(this._requestHandler, this, c, e, p, msg.payload);\n            }\n            catch (handlerError) {\n                e(errors_1.transformErrorForSerialization(handlerError));\n            }\n        };\n        return WorkerServer;\n    }());\n    exports.WorkerServer = WorkerServer;\n    function create(postMessage) {\n        return new WorkerServer(postMessage);\n    }\n    exports.create = create;\n});\n\ndefine(__m[56], __M([1,0,2,3,50]), function (require, exports, errors_1, strings, viewLineToken_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var START_INDEX_MASK = 0xffffffff;\n    var TYPE_MASK = 0xffff;\n    var START_INDEX_OFFSET = 1;\n    var TYPE_OFFSET = Math.pow(2, 32);\n    var DEFAULT_VIEW_TOKEN = new viewLineToken_1.ViewLineToken(0, '');\n    var INFLATED_TOKENS_EMPTY_TEXT = [];\n    var DEFLATED_TOKENS_EMPTY_TEXT = [];\n    var INFLATED_TOKENS_NON_EMPTY_TEXT = [DEFAULT_VIEW_TOKEN];\n    var DEFLATED_TOKENS_NON_EMPTY_TEXT = [0];\n    var TokensInflatorMap = (function () {\n        function TokensInflatorMap() {\n            this._inflate = [''];\n            this._deflate = { '': 0 };\n        }\n        return TokensInflatorMap;\n    }());\n    exports.TokensInflatorMap = TokensInflatorMap;\n    var TokensBinaryEncoding = (function () {\n        function TokensBinaryEncoding() {\n        }\n        TokensBinaryEncoding.deflateArr = function (map, tokens) {\n            if (tokens.length === 0) {\n                return DEFLATED_TOKENS_EMPTY_TEXT;\n            }\n            if (tokens.length === 1 && tokens[0].startIndex === 0 && !tokens[0].type) {\n                return DEFLATED_TOKENS_NON_EMPTY_TEXT;\n            }\n            var i, len, deflatedToken, deflated, token, inflateMap = map._inflate, deflateMap = map._deflate, prevStartIndex = -1, result = new Array(tokens.length);\n            for (i = 0, len = tokens.length; i < len; i++) {\n                token = tokens[i];\n                if (token.startIndex <= prevStartIndex) {\n                    token.startIndex = prevStartIndex + 1;\n                    errors_1.onUnexpectedError({\n                        message: 'Invalid tokens detected',\n                        tokens: tokens\n                    });\n                }\n                if (deflateMap.hasOwnProperty(token.type)) {\n                    deflatedToken = deflateMap[token.type];\n                }\n                else {\n                    deflatedToken = inflateMap.length;\n                    deflateMap[token.type] = deflatedToken;\n                    inflateMap.push(token.type);\n                }\n                // http://stackoverflow.com/a/2803010\n                // All numbers in JavaScript are actually IEEE-754 compliant floating-point doubles.\n                // These have a 53-bit mantissa which should mean that any integer value with a magnitude\n                // of approximately 9 quadrillion or less -- more specifically, 9,007,199,254,740,991 --\n                // will be represented accurately.\n                // http://stackoverflow.com/a/6729252\n                // Bitwise operations cast numbers to 32bit representation in JS\n                // 32 bits for startIndex => up to 2^32 = 4,294,967,296\n                // 16 bits for token => up to 2^16 = 65,536\n                // [token][startIndex]\n                deflated = deflatedToken * TYPE_OFFSET + token.startIndex * START_INDEX_OFFSET;\n                result[i] = deflated;\n                prevStartIndex = token.startIndex;\n            }\n            return result;\n        };\n        TokensBinaryEncoding.getStartIndex = function (binaryEncodedToken) {\n            return (binaryEncodedToken / START_INDEX_OFFSET) & START_INDEX_MASK;\n        };\n        TokensBinaryEncoding.getType = function (map, binaryEncodedToken) {\n            var deflatedType = (binaryEncodedToken / TYPE_OFFSET) & TYPE_MASK;\n            if (deflatedType === 0) {\n                return strings.empty;\n            }\n            return map._inflate[deflatedType];\n        };\n        TokensBinaryEncoding.inflateArr = function (map, binaryEncodedTokens) {\n            if (binaryEncodedTokens.length === 0) {\n                return INFLATED_TOKENS_EMPTY_TEXT;\n            }\n            if (binaryEncodedTokens.length === 1 && binaryEncodedTokens[0] === 0) {\n                return INFLATED_TOKENS_NON_EMPTY_TEXT;\n            }\n            var result = [];\n            var inflateMap = map._inflate;\n            for (var i = 0, len = binaryEncodedTokens.length; i < len; i++) {\n                var deflated = binaryEncodedTokens[i];\n                var startIndex = (deflated / START_INDEX_OFFSET) & START_INDEX_MASK;\n                var deflatedType = (deflated / TYPE_OFFSET) & TYPE_MASK;\n                result.push(new viewLineToken_1.ViewLineToken(startIndex, inflateMap[deflatedType]));\n            }\n            return result;\n        };\n        TokensBinaryEncoding.findIndexOfOffset = function (binaryEncodedTokens, offset) {\n            return this.findIndexInSegmentsArray(binaryEncodedTokens, offset);\n        };\n        TokensBinaryEncoding.sliceAndInflate = function (map, binaryEncodedTokens, startOffset, endOffset, deltaStartIndex) {\n            if (binaryEncodedTokens.length === 0) {\n                return INFLATED_TOKENS_EMPTY_TEXT;\n            }\n            if (binaryEncodedTokens.length === 1 && binaryEncodedTokens[0] === 0) {\n                return INFLATED_TOKENS_NON_EMPTY_TEXT;\n            }\n            var startIndex = this.findIndexInSegmentsArray(binaryEncodedTokens, startOffset);\n            var result = [];\n            var inflateMap = map._inflate;\n            var originalToken = binaryEncodedTokens[startIndex];\n            var deflatedType = (originalToken / TYPE_OFFSET) & TYPE_MASK;\n            var newStartIndex = 0;\n            result.push(new viewLineToken_1.ViewLineToken(newStartIndex, inflateMap[deflatedType]));\n            for (var i = startIndex + 1, len = binaryEncodedTokens.length; i < len; i++) {\n                originalToken = binaryEncodedTokens[i];\n                var originalStartIndex = (originalToken / START_INDEX_OFFSET) & START_INDEX_MASK;\n                if (originalStartIndex >= endOffset) {\n                    break;\n                }\n                deflatedType = (originalToken / TYPE_OFFSET) & TYPE_MASK;\n                newStartIndex = originalStartIndex - startOffset + deltaStartIndex;\n                result.push(new viewLineToken_1.ViewLineToken(newStartIndex, inflateMap[deflatedType]));\n            }\n            return result;\n        };\n        TokensBinaryEncoding.findIndexInSegmentsArray = function (arr, desiredIndex) {\n            var low = 0, high = arr.length - 1, mid, value;\n            while (low < high) {\n                mid = low + Math.ceil((high - low) / 2);\n                value = arr[mid] & 0xffffffff;\n                if (value > desiredIndex) {\n                    high = mid - 1;\n                }\n                else {\n                    low = mid;\n                }\n            }\n            return low;\n        };\n        TokensBinaryEncoding.START_INDEX_MASK = START_INDEX_MASK;\n        TokensBinaryEncoding.TYPE_MASK = TYPE_MASK;\n        TokensBinaryEncoding.START_INDEX_OFFSET = START_INDEX_OFFSET;\n        TokensBinaryEncoding.TYPE_OFFSET = TYPE_OFFSET;\n        return TokensBinaryEncoding;\n    }());\n    exports.TokensBinaryEncoding = TokensBinaryEncoding;\n});\n\ndefine(__m[57], __M([1,0,3,56,18,50]), function (require, exports, strings, tokensBinaryEncoding_1, modeTransition_1, viewLineToken_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var START_INDEX_MASK = tokensBinaryEncoding_1.TokensBinaryEncoding.START_INDEX_MASK;\n    var TYPE_MASK = tokensBinaryEncoding_1.TokensBinaryEncoding.TYPE_MASK;\n    var START_INDEX_OFFSET = tokensBinaryEncoding_1.TokensBinaryEncoding.START_INDEX_OFFSET;\n    var TYPE_OFFSET = tokensBinaryEncoding_1.TokensBinaryEncoding.TYPE_OFFSET;\n    var NO_OP_TOKENS_ADJUSTER = {\n        adjust: function () { },\n        finish: function () { }\n    };\n    var NO_OP_MARKERS_ADJUSTER = {\n        adjustDelta: function () { },\n        adjustSet: function () { },\n        finish: function () { }\n    };\n    var MarkerMoveSemantics;\n    (function (MarkerMoveSemantics) {\n        MarkerMoveSemantics[MarkerMoveSemantics[\"MarkerDefined\"] = 0] = \"MarkerDefined\";\n        MarkerMoveSemantics[MarkerMoveSemantics[\"ForceMove\"] = 1] = \"ForceMove\";\n        MarkerMoveSemantics[MarkerMoveSemantics[\"ForceStay\"] = 2] = \"ForceStay\";\n    })(MarkerMoveSemantics || (MarkerMoveSemantics = {}));\n    var ModelLine = (function () {\n        function ModelLine(lineNumber, text) {\n            this._lineNumber = lineNumber | 0;\n            this._text = text;\n            this._isInvalid = false;\n            this._state = null;\n            this._modeTransitions = null;\n            this._lineTokens = null;\n            this._markers = null;\n        }\n        Object.defineProperty(ModelLine.prototype, \"lineNumber\", {\n            get: function () { return this._lineNumber; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ModelLine.prototype, \"text\", {\n            get: function () { return this._text; },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(ModelLine.prototype, \"isInvalid\", {\n            get: function () { return this._isInvalid; },\n            set: function (value) { this._isInvalid = value; },\n            enumerable: true,\n            configurable: true\n        });\n        // --- BEGIN STATE\n        ModelLine.prototype.setState = function (state) {\n            this._state = state;\n        };\n        ModelLine.prototype.getState = function () {\n            return this._state || null;\n        };\n        // --- END STATE\n        // --- BEGIN MODE TRANSITIONS\n        ModelLine.prototype.getModeTransitions = function (topLevelMode) {\n            if (this._modeTransitions) {\n                return this._modeTransitions;\n            }\n            else {\n                return [new modeTransition_1.ModeTransition(0, topLevelMode)];\n            }\n        };\n        // --- END MODE TRANSITIONS\n        // --- BEGIN TOKENS\n        ModelLine.prototype.setTokens = function (map, tokens, topLevelMode, modeTransitions) {\n            this._lineTokens = toLineTokensFromInflated(map, tokens, this._text.length);\n            this._modeTransitions = toModeTransitions(topLevelMode, modeTransitions);\n        };\n        ModelLine.prototype._setLineTokensFromDeflated = function (map, tokens) {\n            this._lineTokens = toLineTokensFromDeflated(map, tokens, this._text.length);\n        };\n        ModelLine.prototype.getTokens = function () {\n            if (this._lineTokens) {\n                return this._lineTokens;\n            }\n            if (this._text.length === 0) {\n                return EmptyLineTokens.INSTANCE;\n            }\n            return DefaultLineTokens.INSTANCE;\n        };\n        // --- END TOKENS\n        ModelLine.prototype._createTokensAdjuster = function () {\n            if (!this._lineTokens) {\n                // This line does not have real tokens, so there is nothing to adjust\n                return NO_OP_TOKENS_ADJUSTER;\n            }\n            var lineTokens = this._lineTokens;\n            var tokens = lineTokens.getBinaryEncodedTokens();\n            var tokensLength = tokens.length;\n            var tokensIndex = 0;\n            var currentTokenStartIndex = 0;\n            var adjust = function (toColumn, delta, minimumAllowedColumn) {\n                // console.log('before call: tokensIndex: ' + tokensIndex + ': ' + String(this.getTokens()));\n                // console.log('adjustTokens: ' + toColumn + ' with delta: ' + delta + ' and [' + minimumAllowedColumn + ']');\n                // console.log('currentTokenStartIndex: ' + currentTokenStartIndex);\n                var minimumAllowedIndex = minimumAllowedColumn - 1;\n                while (currentTokenStartIndex < toColumn && tokensIndex < tokensLength) {\n                    if (currentTokenStartIndex > 0 && delta !== 0) {\n                        // adjust token's `startIndex` by `delta`\n                        var deflatedType = (tokens[tokensIndex] / TYPE_OFFSET) & TYPE_MASK;\n                        var newStartIndex = Math.max(minimumAllowedIndex, currentTokenStartIndex + delta);\n                        var newToken = deflatedType * TYPE_OFFSET + newStartIndex * START_INDEX_OFFSET;\n                        if (delta < 0) {\n                            // pop all previous tokens that have become `collapsed`\n                            while (tokensIndex > 0) {\n                                var prevTokenStartIndex = (tokens[tokensIndex - 1] / START_INDEX_OFFSET) & START_INDEX_MASK;\n                                if (prevTokenStartIndex >= newStartIndex) {\n                                    // Token at `tokensIndex` - 1 is now `collapsed` => pop it\n                                    tokens.splice(tokensIndex - 1, 1);\n                                    tokensLength--;\n                                    tokensIndex--;\n                                }\n                                else {\n                                    break;\n                                }\n                            }\n                        }\n                        tokens[tokensIndex] = newToken;\n                    }\n                    tokensIndex++;\n                    if (tokensIndex < tokensLength) {\n                        currentTokenStartIndex = (tokens[tokensIndex] / START_INDEX_OFFSET) & START_INDEX_MASK;\n                    }\n                }\n                // console.log('after call: tokensIndex: ' + tokensIndex + ': ' + String(this.getTokens()));\n            };\n            var finish = function (delta, lineTextLength) {\n                adjust(Number.MAX_VALUE, delta, 1);\n            };\n            return {\n                adjust: adjust,\n                finish: finish\n            };\n        };\n        ModelLine.prototype._setText = function (text) {\n            this._text = text;\n            if (this._lineTokens) {\n                var map = this._lineTokens.getBinaryEncodedTokensMap(), tokens = this._lineTokens.getBinaryEncodedTokens(), lineTextLength = this._text.length;\n                // Remove overflowing tokens\n                while (tokens.length > 0) {\n                    var lastTokenStartIndex = (tokens[tokens.length - 1] / START_INDEX_OFFSET) & START_INDEX_MASK;\n                    if (lastTokenStartIndex < lineTextLength) {\n                        // Valid token\n                        break;\n                    }\n                    // This token now overflows the text => remove it\n                    tokens.pop();\n                }\n                this._setLineTokensFromDeflated(map, tokens);\n            }\n        };\n        // private _printMarkers(): string {\n        // \tif (!this._markers) {\n        // \t\treturn '[]';\n        // \t}\n        // \tif (this._markers.length === 0) {\n        // \t\treturn '[]';\n        // \t}\n        // \tvar markers = this._markers;\n        // \tvar printMarker = (m:ILineMarker) => {\n        // \t\tif (m.stickToPreviousCharacter) {\n        // \t\t\treturn '|' + m.column;\n        // \t\t}\n        // \t\treturn m.column + '|';\n        // \t};\n        // \treturn '[' + markers.map(printMarker).join(', ') + ']';\n        // }\n        ModelLine.prototype._createMarkersAdjuster = function (changedMarkers) {\n            var _this = this;\n            if (!this._markers) {\n                return NO_OP_MARKERS_ADJUSTER;\n            }\n            if (this._markers.length === 0) {\n                return NO_OP_MARKERS_ADJUSTER;\n            }\n            this._markers.sort(ModelLine._compareMarkers);\n            var markers = this._markers;\n            var markersLength = markers.length;\n            var markersIndex = 0;\n            var marker = markers[markersIndex];\n            // console.log('------------- INITIAL MARKERS: ' + this._printMarkers());\n            var adjustMarkerBeforeColumn = function (toColumn, moveSemantics) {\n                if (marker.column < toColumn) {\n                    return true;\n                }\n                if (marker.column > toColumn) {\n                    return false;\n                }\n                if (moveSemantics === MarkerMoveSemantics.ForceMove) {\n                    return false;\n                }\n                if (moveSemantics === MarkerMoveSemantics.ForceStay) {\n                    return true;\n                }\n                return marker.stickToPreviousCharacter;\n            };\n            var adjustDelta = function (toColumn, delta, minimumAllowedColumn, moveSemantics) {\n                // console.log('------------------------------');\n                // console.log('adjustDelta called: toColumn: ' + toColumn + ', delta: ' + delta + ', minimumAllowedColumn: ' + minimumAllowedColumn + ', moveSemantics: ' + MarkerMoveSemantics[moveSemantics]);\n                // console.log('BEFORE::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n                while (markersIndex < markersLength && adjustMarkerBeforeColumn(toColumn, moveSemantics)) {\n                    if (delta !== 0) {\n                        var newColumn = Math.max(minimumAllowedColumn, marker.column + delta);\n                        if (marker.column !== newColumn) {\n                            changedMarkers[marker.id] = true;\n                            marker.oldLineNumber = marker.oldLineNumber || _this._lineNumber;\n                            marker.oldColumn = marker.oldColumn || marker.column;\n                            marker.column = newColumn;\n                        }\n                    }\n                    markersIndex++;\n                    if (markersIndex < markersLength) {\n                        marker = markers[markersIndex];\n                    }\n                }\n                // console.log('AFTER::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n            };\n            var adjustSet = function (toColumn, newColumn, moveSemantics) {\n                // console.log('------------------------------');\n                // console.log('adjustSet called: toColumn: ' + toColumn + ', newColumn: ' + newColumn + ', moveSemantics: ' + MarkerMoveSemantics[moveSemantics]);\n                // console.log('BEFORE::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n                while (markersIndex < markersLength && adjustMarkerBeforeColumn(toColumn, moveSemantics)) {\n                    if (marker.column !== newColumn) {\n                        changedMarkers[marker.id] = true;\n                        marker.oldLineNumber = marker.oldLineNumber || _this._lineNumber;\n                        marker.oldColumn = marker.oldColumn || marker.column;\n                        marker.column = newColumn;\n                    }\n                    markersIndex++;\n                    if (markersIndex < markersLength) {\n                        marker = markers[markersIndex];\n                    }\n                }\n                // console.log('AFTER::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n            };\n            var finish = function (delta, lineTextLength) {\n                adjustDelta(Number.MAX_VALUE, delta, 1, MarkerMoveSemantics.MarkerDefined);\n                // console.log('------------- FINAL MARKERS: ' + this._printMarkers());\n            };\n            return {\n                adjustDelta: adjustDelta,\n                adjustSet: adjustSet,\n                finish: finish\n            };\n        };\n        ModelLine.prototype.applyEdits = function (changedMarkers, edits) {\n            var deltaColumn = 0;\n            var resultText = this._text;\n            var tokensAdjuster = this._createTokensAdjuster();\n            var markersAdjuster = this._createMarkersAdjuster(changedMarkers);\n            for (var i = 0, len = edits.length; i < len; i++) {\n                var edit = edits[i];\n                // console.log();\n                // console.log('=============================');\n                // console.log('EDIT #' + i + ' [ ' + edit.startColumn + ' -> ' + edit.endColumn + ' ] : <<<' + edit.text + '>>>, forceMoveMarkers: ' + edit.forceMoveMarkers);\n                // console.log('deltaColumn: ' + deltaColumn);\n                var startColumn = deltaColumn + edit.startColumn;\n                var endColumn = deltaColumn + edit.endColumn;\n                var deletingCnt = endColumn - startColumn;\n                var insertingCnt = edit.text.length;\n                // Adjust tokens & markers before this edit\n                // console.log('Adjust tokens & markers before this edit');\n                tokensAdjuster.adjust(edit.startColumn - 1, deltaColumn, 1);\n                markersAdjuster.adjustDelta(edit.startColumn, deltaColumn, 1, edit.forceMoveMarkers ? MarkerMoveSemantics.ForceMove : (deletingCnt > 0 ? MarkerMoveSemantics.ForceStay : MarkerMoveSemantics.MarkerDefined));\n                // Adjust tokens & markers for the common part of this edit\n                var commonLength = Math.min(deletingCnt, insertingCnt);\n                if (commonLength > 0) {\n                    // console.log('Adjust tokens & markers for the common part of this edit');\n                    tokensAdjuster.adjust(edit.startColumn - 1 + commonLength, deltaColumn, startColumn);\n                    if (!edit.forceMoveMarkers) {\n                        markersAdjuster.adjustDelta(edit.startColumn + commonLength, deltaColumn, startColumn, edit.forceMoveMarkers ? MarkerMoveSemantics.ForceMove : (deletingCnt > insertingCnt ? MarkerMoveSemantics.ForceStay : MarkerMoveSemantics.MarkerDefined));\n                    }\n                }\n                // Perform the edit & update `deltaColumn`\n                resultText = resultText.substring(0, startColumn - 1) + edit.text + resultText.substring(endColumn - 1);\n                deltaColumn += insertingCnt - deletingCnt;\n                // Adjust tokens & markers inside this edit\n                // console.log('Adjust tokens & markers inside this edit');\n                tokensAdjuster.adjust(edit.endColumn, deltaColumn, startColumn);\n                markersAdjuster.adjustSet(edit.endColumn, startColumn + insertingCnt, edit.forceMoveMarkers ? MarkerMoveSemantics.ForceMove : MarkerMoveSemantics.MarkerDefined);\n            }\n            // Wrap up tokens & markers; adjust remaining if needed\n            tokensAdjuster.finish(deltaColumn, resultText.length);\n            markersAdjuster.finish(deltaColumn, resultText.length);\n            // Save the resulting text\n            this._setText(resultText);\n            return deltaColumn;\n        };\n        ModelLine.prototype.split = function (changedMarkers, splitColumn, forceMoveMarkers) {\n            // console.log('--> split @ ' + splitColumn + '::: ' + this._printMarkers());\n            var myText = this._text.substring(0, splitColumn - 1);\n            var otherText = this._text.substring(splitColumn - 1);\n            var otherMarkers = null;\n            if (this._markers) {\n                this._markers.sort(ModelLine._compareMarkers);\n                for (var i = 0, len = this._markers.length; i < len; i++) {\n                    var marker = this._markers[i];\n                    if (marker.column > splitColumn\n                        || (marker.column === splitColumn\n                            && (forceMoveMarkers\n                                || !marker.stickToPreviousCharacter))) {\n                        var myMarkers = this._markers.slice(0, i);\n                        otherMarkers = this._markers.slice(i);\n                        this._markers = myMarkers;\n                        break;\n                    }\n                }\n                if (otherMarkers) {\n                    for (var i = 0, len = otherMarkers.length; i < len; i++) {\n                        var marker = otherMarkers[i];\n                        changedMarkers[marker.id] = true;\n                        marker.oldLineNumber = marker.oldLineNumber || this._lineNumber;\n                        marker.oldColumn = marker.oldColumn || marker.column;\n                        marker.column -= splitColumn - 1;\n                    }\n                }\n            }\n            this._setText(myText);\n            var otherLine = new ModelLine(this._lineNumber + 1, otherText);\n            if (otherMarkers) {\n                otherLine.addMarkers(otherMarkers);\n            }\n            return otherLine;\n        };\n        ModelLine.prototype.append = function (changedMarkers, other) {\n            // console.log('--> append: THIS :: ' + this._printMarkers());\n            // console.log('--> append: OTHER :: ' + this._printMarkers());\n            var thisTextLength = this._text.length;\n            this._setText(this._text + other._text);\n            var otherLineTokens = other._lineTokens;\n            if (otherLineTokens) {\n                // Other has real tokens\n                var otherTokens = otherLineTokens.getBinaryEncodedTokens();\n                // Adjust other tokens\n                if (thisTextLength > 0) {\n                    for (var i = 0, len = otherTokens.length; i < len; i++) {\n                        var token = otherTokens[i];\n                        var deflatedStartIndex = (token / START_INDEX_OFFSET) & START_INDEX_MASK;\n                        var deflatedType = (token / TYPE_OFFSET) & TYPE_MASK;\n                        var newStartIndex = deflatedStartIndex + thisTextLength;\n                        var newToken = deflatedType * TYPE_OFFSET + newStartIndex * START_INDEX_OFFSET;\n                        otherTokens[i] = newToken;\n                    }\n                }\n                // Append other tokens\n                var myLineTokens = this._lineTokens;\n                if (myLineTokens) {\n                    // I have real tokens\n                    this._setLineTokensFromDeflated(myLineTokens.getBinaryEncodedTokensMap(), myLineTokens.getBinaryEncodedTokens().concat(otherTokens));\n                }\n                else {\n                    // I don't have real tokens\n                    this._setLineTokensFromDeflated(otherLineTokens.getBinaryEncodedTokensMap(), otherTokens);\n                }\n            }\n            if (other._markers) {\n                // Other has markers\n                var otherMarkers = other._markers;\n                // Adjust other markers\n                for (var i = 0, len = otherMarkers.length; i < len; i++) {\n                    var marker = otherMarkers[i];\n                    changedMarkers[marker.id] = true;\n                    marker.oldLineNumber = marker.oldLineNumber || other.lineNumber;\n                    marker.oldColumn = marker.oldColumn || marker.column;\n                    marker.column += thisTextLength;\n                }\n                this.addMarkers(otherMarkers);\n            }\n        };\n        ModelLine.prototype.addMarker = function (marker) {\n            marker.line = this;\n            if (!this._markers) {\n                this._markers = [marker];\n            }\n            else {\n                this._markers.push(marker);\n            }\n        };\n        ModelLine.prototype.addMarkers = function (markers) {\n            if (markers.length === 0) {\n                return;\n            }\n            var i, len;\n            for (i = 0, len = markers.length; i < len; i++) {\n                markers[i].line = this;\n            }\n            if (!this._markers) {\n                this._markers = markers.slice(0);\n            }\n            else {\n                this._markers = this._markers.concat(markers);\n            }\n        };\n        ModelLine._compareMarkers = function (a, b) {\n            if (a.column === b.column) {\n                return (a.stickToPreviousCharacter ? 0 : 1) - (b.stickToPreviousCharacter ? 0 : 1);\n            }\n            return a.column - b.column;\n        };\n        ModelLine.prototype.removeMarker = function (marker) {\n            if (!this._markers) {\n                return;\n            }\n            var index = this._indexOfMarkerId(marker.id);\n            if (index >= 0) {\n                marker.line = null;\n                this._markers.splice(index, 1);\n            }\n            if (this._markers.length === 0) {\n                this._markers = null;\n            }\n        };\n        ModelLine.prototype.removeMarkers = function (deleteMarkers) {\n            if (!this._markers) {\n                return;\n            }\n            for (var i = 0, len = this._markers.length; i < len; i++) {\n                var marker = this._markers[i];\n                if (deleteMarkers[marker.id]) {\n                    marker.line = null;\n                    this._markers.splice(i, 1);\n                    len--;\n                    i--;\n                }\n            }\n            if (this._markers.length === 0) {\n                this._markers = null;\n            }\n        };\n        ModelLine.prototype.getMarkers = function () {\n            if (!this._markers) {\n                return [];\n            }\n            return this._markers.slice(0);\n        };\n        ModelLine.prototype.updateLineNumber = function (changedMarkers, newLineNumber) {\n            if (this._markers) {\n                var markers = this._markers, i, len, marker;\n                for (i = 0, len = markers.length; i < len; i++) {\n                    marker = markers[i];\n                    changedMarkers[marker.id] = true;\n                    marker.oldLineNumber = marker.oldLineNumber || this._lineNumber;\n                }\n            }\n            this._lineNumber = newLineNumber;\n        };\n        ModelLine.prototype.deleteLine = function (changedMarkers, setMarkersColumn, setMarkersOldLineNumber) {\n            // console.log('--> deleteLine: ');\n            if (this._markers) {\n                var markers = this._markers, i, len, marker;\n                // Mark all these markers as changed\n                for (i = 0, len = markers.length; i < len; i++) {\n                    marker = markers[i];\n                    changedMarkers[marker.id] = true;\n                    marker.oldColumn = marker.oldColumn || marker.column;\n                    marker.oldLineNumber = marker.oldLineNumber || setMarkersOldLineNumber;\n                    marker.column = setMarkersColumn;\n                }\n                return markers;\n            }\n            return [];\n        };\n        ModelLine.prototype._indexOfMarkerId = function (markerId) {\n            var markers = this._markers;\n            for (var i = 0, len = markers.length; i < len; i++) {\n                if (markers[i].id === markerId) {\n                    return i;\n                }\n            }\n        };\n        return ModelLine;\n    }());\n    exports.ModelLine = ModelLine;\n    function toLineTokensFromInflated(map, tokens, textLength) {\n        if (textLength === 0) {\n            return null;\n        }\n        if (!tokens || tokens.length === 0) {\n            return null;\n        }\n        if (tokens.length === 1) {\n            if (tokens[0].startIndex === 0 && tokens[0].type === '') {\n                return null;\n            }\n        }\n        var deflated = tokensBinaryEncoding_1.TokensBinaryEncoding.deflateArr(map, tokens);\n        return new LineTokens(map, deflated);\n    }\n    function toLineTokensFromDeflated(map, tokens, textLength) {\n        if (textLength === 0) {\n            return null;\n        }\n        if (!tokens || tokens.length === 0) {\n            return null;\n        }\n        if (tokens.length === 1) {\n            if (tokens[0] === 0) {\n                return null;\n            }\n        }\n        return new LineTokens(map, tokens);\n    }\n    var LineTokens = (function () {\n        function LineTokens(map, tokens) {\n            this.map = map;\n            this._tokens = tokens;\n        }\n        LineTokens.prototype.getBinaryEncodedTokensMap = function () {\n            return this.map;\n        };\n        LineTokens.prototype.getBinaryEncodedTokens = function () {\n            return this._tokens;\n        };\n        LineTokens.prototype.getTokenCount = function () {\n            return this._tokens.length;\n        };\n        LineTokens.prototype.getTokenStartIndex = function (tokenIndex) {\n            return tokensBinaryEncoding_1.TokensBinaryEncoding.getStartIndex(this._tokens[tokenIndex]);\n        };\n        LineTokens.prototype.getTokenType = function (tokenIndex) {\n            return tokensBinaryEncoding_1.TokensBinaryEncoding.getType(this.map, this._tokens[tokenIndex]);\n        };\n        LineTokens.prototype.getTokenEndIndex = function (tokenIndex, textLength) {\n            if (tokenIndex + 1 < this._tokens.length) {\n                return tokensBinaryEncoding_1.TokensBinaryEncoding.getStartIndex(this._tokens[tokenIndex + 1]);\n            }\n            return textLength;\n        };\n        LineTokens.prototype.equals = function (other) {\n            if (other instanceof LineTokens) {\n                if (this.map !== other.map) {\n                    return false;\n                }\n                if (this._tokens.length !== other._tokens.length) {\n                    return false;\n                }\n                for (var i = 0, len = this._tokens.length; i < len; i++) {\n                    if (this._tokens[i] !== other._tokens[i]) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n            if (!(other instanceof LineTokens)) {\n                return false;\n            }\n        };\n        LineTokens.prototype.findIndexOfOffset = function (offset) {\n            return tokensBinaryEncoding_1.TokensBinaryEncoding.findIndexOfOffset(this._tokens, offset);\n        };\n        LineTokens.prototype.inflate = function () {\n            return tokensBinaryEncoding_1.TokensBinaryEncoding.inflateArr(this.map, this._tokens);\n        };\n        LineTokens.prototype.sliceAndInflate = function (startOffset, endOffset, deltaStartIndex) {\n            return tokensBinaryEncoding_1.TokensBinaryEncoding.sliceAndInflate(this.map, this._tokens, startOffset, endOffset, deltaStartIndex);\n        };\n        return LineTokens;\n    }());\n    exports.LineTokens = LineTokens;\n    var EmptyLineTokens = (function () {\n        function EmptyLineTokens() {\n        }\n        EmptyLineTokens.prototype.getTokenCount = function () {\n            return 0;\n        };\n        EmptyLineTokens.prototype.getTokenStartIndex = function (tokenIndex) {\n            return 0;\n        };\n        EmptyLineTokens.prototype.getTokenType = function (tokenIndex) {\n            return strings.empty;\n        };\n        EmptyLineTokens.prototype.getTokenEndIndex = function (tokenIndex, textLength) {\n            return 0;\n        };\n        EmptyLineTokens.prototype.equals = function (other) {\n            return other === this;\n        };\n        EmptyLineTokens.prototype.findIndexOfOffset = function (offset) {\n            return 0;\n        };\n        EmptyLineTokens.prototype.inflate = function () {\n            return [];\n        };\n        EmptyLineTokens.prototype.sliceAndInflate = function (startOffset, endOffset, deltaStartIndex) {\n            return [];\n        };\n        EmptyLineTokens.INSTANCE = new EmptyLineTokens();\n        return EmptyLineTokens;\n    }());\n    var DefaultLineTokens = (function () {\n        function DefaultLineTokens() {\n        }\n        DefaultLineTokens.prototype.getTokenCount = function () {\n            return 1;\n        };\n        DefaultLineTokens.prototype.getTokenStartIndex = function (tokenIndex) {\n            return 0;\n        };\n        DefaultLineTokens.prototype.getTokenType = function (tokenIndex) {\n            return strings.empty;\n        };\n        DefaultLineTokens.prototype.getTokenEndIndex = function (tokenIndex, textLength) {\n            return textLength;\n        };\n        DefaultLineTokens.prototype.equals = function (other) {\n            return this === other;\n        };\n        DefaultLineTokens.prototype.findIndexOfOffset = function (offset) {\n            return 0;\n        };\n        DefaultLineTokens.prototype.inflate = function () {\n            return [new viewLineToken_1.ViewLineToken(0, '')];\n        };\n        DefaultLineTokens.prototype.sliceAndInflate = function (startOffset, endOffset, deltaStartIndex) {\n            return [new viewLineToken_1.ViewLineToken(0, '')];\n        };\n        DefaultLineTokens.INSTANCE = new DefaultLineTokens();\n        return DefaultLineTokens;\n    }());\n    exports.DefaultLineTokens = DefaultLineTokens;\n    function toModeTransitions(topLevelMode, modeTransitions) {\n        if (!modeTransitions || modeTransitions.length === 0) {\n            return null;\n        }\n        else if (modeTransitions.length === 1 && modeTransitions[0].startIndex === 0 && modeTransitions[0].mode === topLevelMode) {\n            return null;\n        }\n        return modeTransitions;\n    }\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[102], __M([1,0,8,82]), function (require, exports, event_1, languageSelector_1) {\n    'use strict';\n    var LanguageFeatureRegistry = (function () {\n        function LanguageFeatureRegistry() {\n            this._clock = 0;\n            this._entries = [];\n            this._onDidChange = new event_1.Emitter();\n        }\n        Object.defineProperty(LanguageFeatureRegistry.prototype, \"onDidChange\", {\n            get: function () {\n                return this._onDidChange.event;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        LanguageFeatureRegistry.prototype.register = function (selector, provider, isBuiltin) {\n            var _this = this;\n            if (isBuiltin === void 0) { isBuiltin = false; }\n            var entry = {\n                selector: selector,\n                provider: provider,\n                isBuiltin: isBuiltin,\n                _score: -1,\n                _time: this._clock++\n            };\n            this._entries.push(entry);\n            this._lastCandidate = undefined;\n            this._onDidChange.fire(this._entries.length);\n            return {\n                dispose: function () {\n                    if (entry) {\n                        var idx = _this._entries.indexOf(entry);\n                        if (idx >= 0) {\n                            _this._entries.splice(idx, 1);\n                            _this._lastCandidate = undefined;\n                            _this._onDidChange.fire(_this._entries.length);\n                            entry = undefined;\n                        }\n                    }\n                }\n            };\n        };\n        LanguageFeatureRegistry.prototype.has = function (model) {\n            return this.all(model).length > 0;\n        };\n        LanguageFeatureRegistry.prototype.all = function (model) {\n            if (!model || model.isTooLargeForHavingAMode()) {\n                return [];\n            }\n            this._updateScores(model);\n            var result = [];\n            // from registry\n            for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\n                var entry = _a[_i];\n                if (entry._score > 0) {\n                    result.push(entry.provider);\n                }\n            }\n            return result;\n        };\n        LanguageFeatureRegistry.prototype.ordered = function (model) {\n            var result = [];\n            this._orderedForEach(model, function (entry) { return result.push(entry.provider); });\n            return result;\n        };\n        LanguageFeatureRegistry.prototype.orderedGroups = function (model) {\n            var result = [];\n            var lastBucket;\n            var lastBucketScore;\n            this._orderedForEach(model, function (entry) {\n                if (lastBucket && lastBucketScore === entry._score) {\n                    lastBucket.push(entry.provider);\n                }\n                else {\n                    lastBucketScore = entry._score;\n                    lastBucket = [entry.provider];\n                    result.push(lastBucket);\n                }\n            });\n            return result;\n        };\n        LanguageFeatureRegistry.prototype._orderedForEach = function (model, callback) {\n            if (!model || model.isTooLargeForHavingAMode()) {\n                return;\n            }\n            this._updateScores(model);\n            for (var from = 0; from < this._entries.length; from++) {\n                var entry = this._entries[from];\n                if (entry._score > 0) {\n                    callback(entry);\n                }\n            }\n        };\n        LanguageFeatureRegistry.prototype._updateScores = function (model) {\n            var candidate = {\n                uri: model.uri.toString(),\n                language: model.getModeId()\n            };\n            if (this._lastCandidate\n                && this._lastCandidate.language === candidate.language\n                && this._lastCandidate.uri === candidate.uri) {\n                // nothing has changed\n                return;\n            }\n            this._lastCandidate = candidate;\n            for (var _i = 0, _a = this._entries; _i < _a.length; _i++) {\n                var entry = _a[_i];\n                entry._score = languageSelector_1.score(entry.selector, model.uri, model.getModeId());\n                if (entry.isBuiltin && entry._score > 0) {\n                    entry._score = .5;\n                    entry._time = -1;\n                }\n            }\n            // needs sorting\n            this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\n        };\n        LanguageFeatureRegistry._compareByScoreAndTime = function (a, b) {\n            if (a._score < b._score) {\n                return 1;\n            }\n            else if (a._score > b._score) {\n                return -1;\n            }\n            else if (a._time < b._time) {\n                return 1;\n            }\n            else if (a._time > b._time) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n        return LanguageFeatureRegistry;\n    }());\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = LanguageFeatureRegistry;\n});\n\ndefine(__m[21], __M([1,0,102]), function (require, exports, languageFeatureRegistry_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * A document highlight kind.\n     */\n    (function (DocumentHighlightKind) {\n        /**\n         * A textual occurrence.\n         */\n        DocumentHighlightKind[DocumentHighlightKind[\"Text\"] = 0] = \"Text\";\n        /**\n         * Read-access of a symbol, like reading a variable.\n         */\n        DocumentHighlightKind[DocumentHighlightKind[\"Read\"] = 1] = \"Read\";\n        /**\n         * Write-access of a symbol, like writing to a variable.\n         */\n        DocumentHighlightKind[DocumentHighlightKind[\"Write\"] = 2] = \"Write\";\n    })(exports.DocumentHighlightKind || (exports.DocumentHighlightKind = {}));\n    var DocumentHighlightKind = exports.DocumentHighlightKind;\n    /**\n     * A symbol kind.\n     */\n    (function (SymbolKind) {\n        SymbolKind[SymbolKind[\"File\"] = 0] = \"File\";\n        SymbolKind[SymbolKind[\"Module\"] = 1] = \"Module\";\n        SymbolKind[SymbolKind[\"Namespace\"] = 2] = \"Namespace\";\n        SymbolKind[SymbolKind[\"Package\"] = 3] = \"Package\";\n        SymbolKind[SymbolKind[\"Class\"] = 4] = \"Class\";\n        SymbolKind[SymbolKind[\"Method\"] = 5] = \"Method\";\n        SymbolKind[SymbolKind[\"Property\"] = 6] = \"Property\";\n        SymbolKind[SymbolKind[\"Field\"] = 7] = \"Field\";\n        SymbolKind[SymbolKind[\"Constructor\"] = 8] = \"Constructor\";\n        SymbolKind[SymbolKind[\"Enum\"] = 9] = \"Enum\";\n        SymbolKind[SymbolKind[\"Interface\"] = 10] = \"Interface\";\n        SymbolKind[SymbolKind[\"Function\"] = 11] = \"Function\";\n        SymbolKind[SymbolKind[\"Variable\"] = 12] = \"Variable\";\n        SymbolKind[SymbolKind[\"Constant\"] = 13] = \"Constant\";\n        SymbolKind[SymbolKind[\"String\"] = 14] = \"String\";\n        SymbolKind[SymbolKind[\"Number\"] = 15] = \"Number\";\n        SymbolKind[SymbolKind[\"Boolean\"] = 16] = \"Boolean\";\n        SymbolKind[SymbolKind[\"Array\"] = 17] = \"Array\";\n        SymbolKind[SymbolKind[\"Object\"] = 18] = \"Object\";\n        SymbolKind[SymbolKind[\"Key\"] = 19] = \"Key\";\n        SymbolKind[SymbolKind[\"Null\"] = 20] = \"Null\";\n    })(exports.SymbolKind || (exports.SymbolKind = {}));\n    var SymbolKind = exports.SymbolKind;\n    /**\n     * @internal\n     */\n    var SymbolKind;\n    (function (SymbolKind) {\n        /**\n         * @internal\n         */\n        function from(kind) {\n            switch (kind) {\n                case SymbolKind.Method:\n                    return 'method';\n                case SymbolKind.Function:\n                    return 'function';\n                case SymbolKind.Constructor:\n                    return 'constructor';\n                case SymbolKind.Variable:\n                    return 'variable';\n                case SymbolKind.Class:\n                    return 'class';\n                case SymbolKind.Interface:\n                    return 'interface';\n                case SymbolKind.Namespace:\n                    return 'namespace';\n                case SymbolKind.Package:\n                    return 'package';\n                case SymbolKind.Module:\n                    return 'module';\n                case SymbolKind.Property:\n                    return 'property';\n                case SymbolKind.Enum:\n                    return 'enum';\n                case SymbolKind.String:\n                    return 'string';\n                case SymbolKind.File:\n                    return 'file';\n                case SymbolKind.Array:\n                    return 'array';\n                case SymbolKind.Number:\n                    return 'number';\n                case SymbolKind.Boolean:\n                    return 'boolean';\n                case SymbolKind.Object:\n                    return 'object';\n                case SymbolKind.Key:\n                    return 'key';\n                case SymbolKind.Null:\n                    return 'null';\n            }\n            return 'property';\n        }\n        SymbolKind.from = from;\n        /**\n         * @internal\n         */\n        function to(type) {\n            switch (type) {\n                case 'method':\n                    return SymbolKind.Method;\n                case 'function':\n                    return SymbolKind.Function;\n                case 'constructor':\n                    return SymbolKind.Constructor;\n                case 'variable':\n                    return SymbolKind.Variable;\n                case 'class':\n                    return SymbolKind.Class;\n                case 'interface':\n                    return SymbolKind.Interface;\n                case 'namespace':\n                    return SymbolKind.Namespace;\n                case 'package':\n                    return SymbolKind.Package;\n                case 'module':\n                    return SymbolKind.Module;\n                case 'property':\n                    return SymbolKind.Property;\n                case 'enum':\n                    return SymbolKind.Enum;\n                case 'string':\n                    return SymbolKind.String;\n                case 'file':\n                    return SymbolKind.File;\n                case 'array':\n                    return SymbolKind.Array;\n                case 'number':\n                    return SymbolKind.Number;\n                case 'boolean':\n                    return SymbolKind.Boolean;\n                case 'object':\n                    return SymbolKind.Object;\n                case 'key':\n                    return SymbolKind.Key;\n                case 'null':\n                    return SymbolKind.Null;\n            }\n            return SymbolKind.Property;\n        }\n        SymbolKind.to = to;\n    })(SymbolKind = exports.SymbolKind || (exports.SymbolKind = {}));\n    /**\n     * Describes what to do with the indentation when pressing Enter.\n     */\n    (function (IndentAction) {\n        /**\n         * Insert new line and copy the previous line's indentation.\n         */\n        IndentAction[IndentAction[\"None\"] = 0] = \"None\";\n        /**\n         * Insert new line and indent once (relative to the previous line's indentation).\n         */\n        IndentAction[IndentAction[\"Indent\"] = 1] = \"Indent\";\n        /**\n         * Insert two new lines:\n         *  - the first one indented which will hold the cursor\n         *  - the second one at the same indentation level\n         */\n        IndentAction[IndentAction[\"IndentOutdent\"] = 2] = \"IndentOutdent\";\n        /**\n         * Insert new line and outdent once (relative to the previous line's indentation).\n         */\n        IndentAction[IndentAction[\"Outdent\"] = 3] = \"Outdent\";\n    })(exports.IndentAction || (exports.IndentAction = {}));\n    var IndentAction = exports.IndentAction;\n    // --- feature registries ------\n    /**\n     * @internal\n     */\n    exports.ReferenceProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.RenameProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.SuggestRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.SignatureHelpProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.HoverProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.DocumentSymbolProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.DocumentHighlightProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.DefinitionProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.CodeLensProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.CodeActionProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.DocumentFormattingEditProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.DocumentRangeFormattingEditProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.OnTypeFormattingEditProviderRegistry = new languageFeatureRegistry_1.default();\n    /**\n     * @internal\n     */\n    exports.LinkProviderRegistry = new languageFeatureRegistry_1.default();\n});\n\ndefine(__m[106], __M([1,0,2,3,21,14]), function (require, exports, errors_1, strings, modes_1, supports_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var OnEnterSupport = (function () {\n        function OnEnterSupport(registry, modeId, opts) {\n            this._registry = registry;\n            opts = opts || {};\n            opts.brackets = opts.brackets || [\n                ['(', ')'],\n                ['{', '}'],\n                ['[', ']']\n            ];\n            this._modeId = modeId;\n            this._brackets = opts.brackets.map(function (bracket) {\n                return {\n                    open: bracket[0],\n                    openRegExp: OnEnterSupport._createOpenBracketRegExp(bracket[0]),\n                    close: bracket[1],\n                    closeRegExp: OnEnterSupport._createCloseBracketRegExp(bracket[1]),\n                };\n            });\n            this._regExpRules = opts.regExpRules || [];\n            this._indentationRules = opts.indentationRules;\n        }\n        OnEnterSupport.prototype.onEnter = function (model, position) {\n            var _this = this;\n            var context = model.getLineContext(position.lineNumber);\n            return supports_1.handleEvent(context, position.column - 1, function (nestedModeId, context, offset) {\n                if (_this._modeId === nestedModeId) {\n                    return _this._onEnter(model, position);\n                }\n                var onEnterSupport = _this._registry.getOnEnterSupport(nestedModeId);\n                if (onEnterSupport) {\n                    return onEnterSupport.onEnter(model, position);\n                }\n                return null;\n            });\n        };\n        OnEnterSupport.prototype._onEnter = function (model, position) {\n            var lineText = model.getLineContent(position.lineNumber);\n            var beforeEnterText = lineText.substr(0, position.column - 1);\n            var afterEnterText = lineText.substr(position.column - 1);\n            var oneLineAboveText = position.lineNumber === 1 ? '' : model.getLineContent(position.lineNumber - 1);\n            return this._actualOnEnter(oneLineAboveText, beforeEnterText, afterEnterText);\n        };\n        OnEnterSupport.prototype._actualOnEnter = function (oneLineAboveText, beforeEnterText, afterEnterText) {\n            // (1): `regExpRules`\n            for (var i = 0, len = this._regExpRules.length; i < len; i++) {\n                var rule = this._regExpRules[i];\n                if (rule.beforeText.test(beforeEnterText)) {\n                    if (rule.afterText) {\n                        if (rule.afterText.test(afterEnterText)) {\n                            return rule.action;\n                        }\n                    }\n                    else {\n                        return rule.action;\n                    }\n                }\n            }\n            // (2): Special indent-outdent\n            if (beforeEnterText.length > 0 && afterEnterText.length > 0) {\n                for (var i = 0, len = this._brackets.length; i < len; i++) {\n                    var bracket = this._brackets[i];\n                    if (bracket.openRegExp.test(beforeEnterText) && bracket.closeRegExp.test(afterEnterText)) {\n                        return OnEnterSupport._INDENT_OUTDENT;\n                    }\n                }\n            }\n            // (3): Indentation Support\n            if (this._indentationRules) {\n                if (this._indentationRules.increaseIndentPattern && this._indentationRules.increaseIndentPattern.test(beforeEnterText)) {\n                    return OnEnterSupport._INDENT;\n                }\n                if (this._indentationRules.indentNextLinePattern && this._indentationRules.indentNextLinePattern.test(beforeEnterText)) {\n                    return OnEnterSupport._INDENT;\n                }\n                if (/^\\s/.test(beforeEnterText)) {\n                    // No reason to run regular expressions if there is nothing to outdent from\n                    if (this._indentationRules.decreaseIndentPattern && this._indentationRules.decreaseIndentPattern.test(afterEnterText)) {\n                        return OnEnterSupport._OUTDENT;\n                    }\n                    if (this._indentationRules.indentNextLinePattern && this._indentationRules.indentNextLinePattern.test(oneLineAboveText)) {\n                        return OnEnterSupport._OUTDENT;\n                    }\n                }\n            }\n            // (4): Open bracket based logic\n            if (beforeEnterText.length > 0) {\n                for (var i = 0, len = this._brackets.length; i < len; i++) {\n                    var bracket = this._brackets[i];\n                    if (bracket.openRegExp.test(beforeEnterText)) {\n                        return OnEnterSupport._INDENT;\n                    }\n                }\n            }\n            return null;\n        };\n        OnEnterSupport._createOpenBracketRegExp = function (bracket) {\n            var str = strings.escapeRegExpCharacters(bracket);\n            if (!/\\B/.test(str.charAt(0))) {\n                str = '\\\\b' + str;\n            }\n            str += '\\\\s*$';\n            return OnEnterSupport._safeRegExp(str);\n        };\n        OnEnterSupport._createCloseBracketRegExp = function (bracket) {\n            var str = strings.escapeRegExpCharacters(bracket);\n            if (!/\\B/.test(str.charAt(str.length - 1))) {\n                str = str + '\\\\b';\n            }\n            str = '^\\\\s*' + str;\n            return OnEnterSupport._safeRegExp(str);\n        };\n        OnEnterSupport._safeRegExp = function (def) {\n            try {\n                return new RegExp(def);\n            }\n            catch (err) {\n                errors_1.onUnexpectedError(err);\n                return null;\n            }\n        };\n        OnEnterSupport._INDENT = { indentAction: modes_1.IndentAction.Indent };\n        OnEnterSupport._INDENT_OUTDENT = { indentAction: modes_1.IndentAction.IndentOutdent };\n        OnEnterSupport._OUTDENT = { indentAction: modes_1.IndentAction.Outdent };\n        return OnEnterSupport;\n    }());\n    exports.OnEnterSupport = OnEnterSupport;\n});\n\ndefine(__m[31], __M([1,0,21,94,99,106,28,8,2,22,3,17]), function (require, exports, modes_1, characterPair_1, electricCharacter_1, onEnter_1, richEditBrackets_1, event_1, errors_1, position_1, strings, wordHelper_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var RichEditSupport = (function () {\n        function RichEditSupport(modeId, previous, rawConf) {\n            var prev = null;\n            if (previous) {\n                prev = previous._conf;\n            }\n            this._conf = RichEditSupport._mergeConf(prev, rawConf);\n            if (this._conf.brackets) {\n                this.brackets = new richEditBrackets_1.RichEditBrackets(modeId, this._conf.brackets);\n            }\n            this._handleOnEnter(modeId, this._conf);\n            this._handleComments(modeId, this._conf);\n            if (this._conf.autoClosingPairs) {\n                this.characterPair = new characterPair_1.CharacterPairSupport(exports.LanguageConfigurationRegistry, modeId, this._conf);\n            }\n            if (this._conf.__electricCharacterSupport || this._conf.brackets) {\n                this.electricCharacter = new electricCharacter_1.BracketElectricCharacterSupport(exports.LanguageConfigurationRegistry, modeId, this.brackets, this._conf.__electricCharacterSupport);\n            }\n            this.wordDefinition = this._conf.wordPattern || wordHelper_1.DEFAULT_WORD_REGEXP;\n        }\n        RichEditSupport._mergeConf = function (prev, current) {\n            return {\n                comments: (prev ? current.comments || prev.comments : current.comments),\n                brackets: (prev ? current.brackets || prev.brackets : current.brackets),\n                wordPattern: (prev ? current.wordPattern || prev.wordPattern : current.wordPattern),\n                indentationRules: (prev ? current.indentationRules || prev.indentationRules : current.indentationRules),\n                onEnterRules: (prev ? current.onEnterRules || prev.onEnterRules : current.onEnterRules),\n                autoClosingPairs: (prev ? current.autoClosingPairs || prev.autoClosingPairs : current.autoClosingPairs),\n                surroundingPairs: (prev ? current.surroundingPairs || prev.surroundingPairs : current.surroundingPairs),\n                __electricCharacterSupport: (prev ? current.__electricCharacterSupport || prev.__electricCharacterSupport : current.__electricCharacterSupport),\n            };\n        };\n        RichEditSupport.prototype._handleOnEnter = function (modeId, conf) {\n            // on enter\n            var onEnter = {};\n            var empty = true;\n            if (conf.brackets) {\n                empty = false;\n                onEnter.brackets = conf.brackets;\n            }\n            if (conf.indentationRules) {\n                empty = false;\n                onEnter.indentationRules = conf.indentationRules;\n            }\n            if (conf.onEnterRules) {\n                empty = false;\n                onEnter.regExpRules = conf.onEnterRules;\n            }\n            if (!empty) {\n                this.onEnter = new onEnter_1.OnEnterSupport(exports.LanguageConfigurationRegistry, modeId, onEnter);\n            }\n        };\n        RichEditSupport.prototype._handleComments = function (modeId, conf) {\n            var commentRule = conf.comments;\n            // comment configuration\n            if (commentRule) {\n                this.comments = {};\n                if (commentRule.lineComment) {\n                    this.comments.lineCommentToken = commentRule.lineComment;\n                }\n                if (commentRule.blockComment) {\n                    var _a = commentRule.blockComment, blockStart = _a[0], blockEnd = _a[1];\n                    this.comments.blockCommentStartToken = blockStart;\n                    this.comments.blockCommentEndToken = blockEnd;\n                }\n            }\n        };\n        return RichEditSupport;\n    }());\n    exports.RichEditSupport = RichEditSupport;\n    var LanguageConfigurationRegistryImpl = (function () {\n        function LanguageConfigurationRegistryImpl() {\n            this._onDidChange = new event_1.Emitter();\n            this.onDidChange = this._onDidChange.event;\n            this._entries = Object.create(null);\n        }\n        LanguageConfigurationRegistryImpl.prototype.register = function (languageId, configuration) {\n            var previous = this._entries[languageId] || null;\n            this._entries[languageId] = new RichEditSupport(languageId, previous, configuration);\n            this._onDidChange.fire(void 0);\n            return {\n                dispose: function () { }\n            };\n        };\n        LanguageConfigurationRegistryImpl.prototype._getRichEditSupport = function (modeId) {\n            return this._entries[modeId];\n        };\n        LanguageConfigurationRegistryImpl.prototype.getElectricCharacterSupport = function (modeId) {\n            var value = this._getRichEditSupport(modeId);\n            if (!value) {\n                return null;\n            }\n            return value.electricCharacter || null;\n        };\n        LanguageConfigurationRegistryImpl.prototype.getComments = function (modeId) {\n            var value = this._getRichEditSupport(modeId);\n            if (!value) {\n                return null;\n            }\n            return value.comments || null;\n        };\n        LanguageConfigurationRegistryImpl.prototype.getCharacterPairSupport = function (modeId) {\n            var value = this._getRichEditSupport(modeId);\n            if (!value) {\n                return null;\n            }\n            return value.characterPair || null;\n        };\n        LanguageConfigurationRegistryImpl.prototype.getWordDefinition = function (modeId) {\n            var value = this._getRichEditSupport(modeId);\n            if (!value) {\n                return null;\n            }\n            return value.wordDefinition || null;\n        };\n        LanguageConfigurationRegistryImpl.prototype.getOnEnterSupport = function (modeId) {\n            var value = this._getRichEditSupport(modeId);\n            if (!value) {\n                return null;\n            }\n            return value.onEnter || null;\n        };\n        LanguageConfigurationRegistryImpl.prototype.getRawEnterActionAtPosition = function (model, lineNumber, column) {\n            var result;\n            var onEnterSupport = this.getOnEnterSupport(model.getMode().getId());\n            if (onEnterSupport) {\n                try {\n                    result = onEnterSupport.onEnter(model, new position_1.Position(lineNumber, column));\n                }\n                catch (e) {\n                    errors_1.onUnexpectedError(e);\n                }\n            }\n            return result;\n        };\n        LanguageConfigurationRegistryImpl.prototype.getEnterActionAtPosition = function (model, lineNumber, column) {\n            var lineText = model.getLineContent(lineNumber);\n            var indentation = strings.getLeadingWhitespace(lineText);\n            if (indentation.length > column - 1) {\n                indentation = indentation.substring(0, column - 1);\n            }\n            var enterAction = this.getRawEnterActionAtPosition(model, lineNumber, column);\n            if (!enterAction) {\n                enterAction = {\n                    indentAction: modes_1.IndentAction.None,\n                    appendText: '',\n                };\n            }\n            else {\n                if (!enterAction.appendText) {\n                    if ((enterAction.indentAction === modes_1.IndentAction.Indent) ||\n                        (enterAction.indentAction === modes_1.IndentAction.IndentOutdent)) {\n                        enterAction.appendText = '\\t';\n                    }\n                    else {\n                        enterAction.appendText = '';\n                    }\n                }\n            }\n            if (enterAction.removeText) {\n                indentation = indentation.substring(0, indentation.length - 1);\n            }\n            return {\n                enterAction: enterAction,\n                indentation: indentation\n            };\n        };\n        LanguageConfigurationRegistryImpl.prototype.getBracketsSupport = function (modeId) {\n            var value = this._getRichEditSupport(modeId);\n            if (!value) {\n                return null;\n            }\n            return value.brackets || null;\n        };\n        return LanguageConfigurationRegistryImpl;\n    }());\n    exports.LanguageConfigurationRegistryImpl = LanguageConfigurationRegistryImpl;\n    exports.LanguageConfigurationRegistry = new LanguageConfigurationRegistryImpl();\n});\n\ndefine(__m[64], __M([1,0,18,31,17]), function (require, exports, modeTransition_1, languageConfigurationRegistry_1, wordHelper_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var WordHelper = (function () {\n        function WordHelper() {\n        }\n        WordHelper._safeGetWordDefinition = function (mode) {\n            return languageConfigurationRegistry_1.LanguageConfigurationRegistry.getWordDefinition(mode.getId());\n        };\n        WordHelper.massageWordDefinitionOf = function (mode) {\n            return wordHelper_1.ensureValidWordDefinition(WordHelper._safeGetWordDefinition(mode));\n        };\n        WordHelper._getWordAtColumn = function (txt, column, modeIndex, modeTransitions) {\n            var modeStartIndex = modeTransitions[modeIndex].startIndex, modeEndIndex = (modeIndex + 1 < modeTransitions.length ? modeTransitions[modeIndex + 1].startIndex : txt.length), mode = modeTransitions[modeIndex].mode;\n            return wordHelper_1.getWordAtText(column, WordHelper.massageWordDefinitionOf(mode), txt.substring(modeStartIndex, modeEndIndex), modeStartIndex);\n        };\n        WordHelper.getWordAtPosition = function (textSource, position) {\n            if (!textSource._lineIsTokenized(position.lineNumber)) {\n                return wordHelper_1.getWordAtText(position.column, WordHelper.massageWordDefinitionOf(textSource.getMode()), textSource.getLineContent(position.lineNumber), 0);\n            }\n            var result = null;\n            var txt = textSource.getLineContent(position.lineNumber), modeTransitions = textSource._getLineModeTransitions(position.lineNumber), columnIndex = position.column - 1, modeIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, columnIndex);\n            result = WordHelper._getWordAtColumn(txt, position.column, modeIndex, modeTransitions);\n            if (!result && modeIndex > 0 && modeTransitions[modeIndex].startIndex === columnIndex) {\n                // The position is right at the beginning of `modeIndex`, so try looking at `modeIndex` - 1 too\n                result = WordHelper._getWordAtColumn(txt, position.column, modeIndex - 1, modeTransitions);\n            }\n            return result;\n        };\n        return WordHelper;\n    }());\n    exports.WordHelper = WordHelper;\n});\n\ndefine(__m[65], __M([7,6]), function(nls, data) { return nls.create(\"vs/base/common/severity\", data); });\ndefine(__m[32], __M([1,0,65,3]), function (require, exports, nls, strings) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var Severity;\n    (function (Severity) {\n        Severity[Severity[\"Ignore\"] = 0] = \"Ignore\";\n        Severity[Severity[\"Info\"] = 1] = \"Info\";\n        Severity[Severity[\"Warning\"] = 2] = \"Warning\";\n        Severity[Severity[\"Error\"] = 3] = \"Error\";\n    })(Severity || (Severity = {}));\n    var Severity;\n    (function (Severity) {\n        var _error = 'error', _warning = 'warning', _warn = 'warn', _info = 'info';\n        var _displayStrings = Object.create(null);\n        _displayStrings[Severity.Error] = nls.localize(0, null);\n        _displayStrings[Severity.Warning] = nls.localize(1, null);\n        _displayStrings[Severity.Info] = nls.localize(2, null);\n        /**\n         * Parses 'error', 'warning', 'warn', 'info' in call casings\n         * and falls back to ignore.\n         */\n        function fromValue(value) {\n            if (!value) {\n                return Severity.Ignore;\n            }\n            if (strings.equalsIgnoreCase(_error, value)) {\n                return Severity.Error;\n            }\n            if (strings.equalsIgnoreCase(_warning, value) || strings.equalsIgnoreCase(_warn, value)) {\n                return Severity.Warning;\n            }\n            if (strings.equalsIgnoreCase(_info, value)) {\n                return Severity.Info;\n            }\n            return Severity.Ignore;\n        }\n        Severity.fromValue = fromValue;\n        function toString(value) {\n            return _displayStrings[value] || strings.empty;\n        }\n        Severity.toString = toString;\n        function compare(a, b) {\n            return b - a;\n        }\n        Severity.compare = compare;\n    })(Severity || (Severity = {}));\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = Severity;\n});\n\ndefine(__m[67], __M([7,6]), function(nls, data) { return nls.create(\"vs/editor/common/config/defaultConfig\", data); });\ndefine(__m[68], __M([1,0,67,10,17]), function (require, exports, nls, platform, wordHelper_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.DEFAULT_INDENTATION = {\n        tabSize: 4,\n        insertSpaces: true,\n        detectIndentation: true\n    };\n    exports.DEFAULT_TRIM_AUTO_WHITESPACE = true;\n    var DEFAULT_WINDOWS_FONT_FAMILY = 'Consolas, \\'Courier New\\', monospace';\n    var DEFAULT_MAC_FONT_FAMILY = 'Menlo, Monaco, \\'Courier New\\', monospace';\n    var DEFAULT_LINUX_FONT_FAMILY = '\\'Droid Sans Mono\\', \\'Courier New\\', monospace, \\'Droid Sans Fallback\\'';\n    /**\n     * Determined from empirical observations.\n     */\n    exports.GOLDEN_LINE_HEIGHT_RATIO = platform.isMacintosh ? 1.5 : 1.35;\n    var ConfigClass = (function () {\n        function ConfigClass() {\n            this.editor = {\n                experimentalScreenReader: true,\n                rulers: [],\n                wordSeparators: wordHelper_1.USUAL_WORD_SEPARATORS,\n                selectionClipboard: true,\n                ariaLabel: nls.localize(0, null),\n                lineNumbers: true,\n                selectOnLineNumbers: true,\n                lineNumbersMinChars: 5,\n                glyphMargin: false,\n                lineDecorationsWidth: 10,\n                revealHorizontalRightPadding: 30,\n                roundedSelection: true,\n                theme: 'vs',\n                readOnly: false,\n                scrollbar: {\n                    verticalScrollbarSize: 14,\n                    horizontal: 'auto',\n                    useShadows: true,\n                    verticalHasArrows: false,\n                    horizontalHasArrows: false\n                },\n                overviewRulerLanes: 2,\n                cursorBlinking: 'blink',\n                cursorStyle: 'line',\n                fontLigatures: false,\n                disableTranslate3d: false,\n                hideCursorInOverviewRuler: false,\n                scrollBeyondLastLine: true,\n                automaticLayout: false,\n                wrappingColumn: 300,\n                wrappingIndent: 'same',\n                wordWrapBreakBeforeCharacters: '([{+',\n                wordWrapBreakAfterCharacters: ' \\t})]?|&,;',\n                wordWrapBreakObtrusiveCharacters: '.',\n                tabFocusMode: false,\n                // Features\n                hover: true,\n                contextmenu: true,\n                mouseWheelScrollSensitivity: 1,\n                quickSuggestions: true,\n                quickSuggestionsDelay: 10,\n                parameterHints: true,\n                iconsInSuggestions: true,\n                autoClosingBrackets: true,\n                formatOnType: false,\n                suggestOnTriggerCharacters: true,\n                acceptSuggestionOnEnter: true,\n                selectionHighlight: true,\n                outlineMarkers: false,\n                referenceInfos: true,\n                folding: true,\n                renderWhitespace: false,\n                indentGuides: false,\n                useTabStops: true,\n                fontFamily: (platform.isMacintosh ? DEFAULT_MAC_FONT_FAMILY : (platform.isLinux ? DEFAULT_LINUX_FONT_FAMILY : DEFAULT_WINDOWS_FONT_FAMILY)),\n                fontSize: (platform.isMacintosh ? 12 : 14),\n                lineHeight: 0\n            };\n        }\n        return ConfigClass;\n    }());\n    exports.DefaultConfig = new ConfigClass();\n});\n\n\n\n\n\n\ndefine(__m[45], __M([1,0,15,3,22,29,19,57,95,68,108]), function (require, exports, eventEmitter_1, strings, position_1, range_1, editorCommon, modelLine_1, indentationGuesser_1, defaultConfig_1, prefixSumComputer_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var LIMIT_FIND_COUNT = 999;\n    exports.LONG_LINE_BOUNDARY = 1000;\n    var TextModel = (function (_super) {\n        __extends(TextModel, _super);\n        function TextModel(allowedEventTypes, rawText) {\n            allowedEventTypes.push(editorCommon.EventType.ModelRawContentChanged, editorCommon.EventType.ModelOptionsChanged);\n            _super.call(this, allowedEventTypes);\n            this._shouldSimplifyMode = (rawText.length > TextModel.MODEL_SYNC_LIMIT);\n            this._shouldDenyMode = (rawText.length > TextModel.MODEL_TOKENIZATION_LIMIT);\n            this._options = rawText.options;\n            this._constructLines(rawText);\n            this._setVersionId(1);\n            this._isDisposed = false;\n            this._isDisposing = false;\n        }\n        TextModel.prototype.isTooLargeForHavingAMode = function () {\n            return this._shouldDenyMode;\n        };\n        TextModel.prototype.isTooLargeForHavingARichMode = function () {\n            return this._shouldSimplifyMode;\n        };\n        TextModel.prototype.getOptions = function () {\n            return this._options;\n        };\n        TextModel.prototype.updateOptions = function (newOpts) {\n            var somethingChanged = false;\n            var changed = {\n                tabSize: false,\n                insertSpaces: false,\n                trimAutoWhitespace: false\n            };\n            if (typeof newOpts.insertSpaces !== 'undefined') {\n                if (this._options.insertSpaces !== newOpts.insertSpaces) {\n                    somethingChanged = true;\n                    changed.insertSpaces = true;\n                    this._options.insertSpaces = newOpts.insertSpaces;\n                }\n            }\n            if (typeof newOpts.tabSize !== 'undefined') {\n                if (this._options.tabSize !== newOpts.tabSize) {\n                    somethingChanged = true;\n                    changed.tabSize = true;\n                    this._options.tabSize = newOpts.tabSize;\n                }\n            }\n            if (typeof newOpts.trimAutoWhitespace !== 'undefined') {\n                if (this._options.trimAutoWhitespace !== newOpts.trimAutoWhitespace) {\n                    somethingChanged = true;\n                    changed.trimAutoWhitespace = true;\n                    this._options.trimAutoWhitespace = newOpts.trimAutoWhitespace;\n                }\n            }\n            if (somethingChanged) {\n                this.emit(editorCommon.EventType.ModelOptionsChanged, changed);\n            }\n        };\n        TextModel.prototype.detectIndentation = function (defaultInsertSpaces, defaultTabSize) {\n            var lines = this._lines.map(function (line) { return line.text; });\n            var guessedIndentation = indentationGuesser_1.guessIndentation(lines, defaultTabSize, defaultInsertSpaces);\n            this.updateOptions({\n                insertSpaces: guessedIndentation.insertSpaces,\n                tabSize: guessedIndentation.tabSize\n            });\n        };\n        TextModel.prototype._normalizeIndentationFromWhitespace = function (str) {\n            var tabSize = this._options.tabSize;\n            var insertSpaces = this._options.insertSpaces;\n            var spacesCnt = 0;\n            for (var i = 0; i < str.length; i++) {\n                if (str.charAt(i) === '\\t') {\n                    spacesCnt += tabSize;\n                }\n                else {\n                    spacesCnt++;\n                }\n            }\n            var result = '';\n            if (!insertSpaces) {\n                var tabsCnt = Math.floor(spacesCnt / tabSize);\n                spacesCnt = spacesCnt % tabSize;\n                for (var i = 0; i < tabsCnt; i++) {\n                    result += '\\t';\n                }\n            }\n            for (var i = 0; i < spacesCnt; i++) {\n                result += ' ';\n            }\n            return result;\n        };\n        TextModel.prototype.normalizeIndentation = function (str) {\n            var firstNonWhitespaceIndex = strings.firstNonWhitespaceIndex(str);\n            if (firstNonWhitespaceIndex === -1) {\n                firstNonWhitespaceIndex = str.length;\n            }\n            return this._normalizeIndentationFromWhitespace(str.substring(0, firstNonWhitespaceIndex)) + str.substring(firstNonWhitespaceIndex);\n        };\n        TextModel.prototype.getOneIndent = function () {\n            var tabSize = this._options.tabSize;\n            var insertSpaces = this._options.insertSpaces;\n            if (insertSpaces) {\n                var result = '';\n                for (var i = 0; i < tabSize; i++) {\n                    result += ' ';\n                }\n                return result;\n            }\n            else {\n                return '\\t';\n            }\n        };\n        TextModel.prototype.getVersionId = function () {\n            return this._versionId;\n        };\n        TextModel.prototype.getAlternativeVersionId = function () {\n            return this._alternativeVersionId;\n        };\n        TextModel.prototype._ensureLineStarts = function () {\n            if (!this._lineStarts) {\n                var lineStartValues = [];\n                var eolLength = this._EOL.length;\n                for (var i = 0, len = this._lines.length; i < len; i++) {\n                    lineStartValues.push(this._lines[i].text.length + eolLength);\n                }\n                this._lineStarts = new prefixSumComputer_1.PrefixSumComputer(lineStartValues);\n            }\n        };\n        TextModel.prototype.getOffsetAt = function (rawPosition) {\n            var position = this.validatePosition(rawPosition);\n            this._ensureLineStarts();\n            return this._lineStarts.getAccumulatedValue(position.lineNumber - 2) + position.column - 1;\n        };\n        TextModel.prototype.getPositionAt = function (offset) {\n            offset = Math.floor(offset);\n            offset = Math.max(0, offset);\n            this._ensureLineStarts();\n            var out = this._lineStarts.getIndexOf(offset);\n            var lineLength = this._lines[out.index].text.length;\n            // Ensure we return a valid position\n            return new position_1.Position(out.index + 1, Math.min(out.remainder + 1, lineLength + 1));\n        };\n        TextModel.prototype._increaseVersionId = function () {\n            this._setVersionId(this._versionId + 1);\n        };\n        TextModel.prototype._setVersionId = function (newVersionId) {\n            this._versionId = newVersionId;\n            this._alternativeVersionId = this._versionId;\n        };\n        TextModel.prototype._overwriteAlternativeVersionId = function (newAlternativeVersionId) {\n            this._alternativeVersionId = newAlternativeVersionId;\n        };\n        TextModel.prototype.isDisposed = function () {\n            return this._isDisposed;\n        };\n        TextModel.prototype.dispose = function () {\n            this._isDisposed = true;\n            // Null out members, such that any use of a disposed model will throw exceptions sooner rather than later\n            this._lines = null;\n            this._EOL = null;\n            this._BOM = null;\n            _super.prototype.dispose.call(this);\n        };\n        TextModel.prototype._createContentChangedFlushEvent = function () {\n            return {\n                changeType: editorCommon.EventType.ModelRawContentChangedFlush,\n                detail: null,\n                // TODO@Alex -> remove these fields from here\n                versionId: -1,\n                isUndoing: false,\n                isRedoing: false\n            };\n        };\n        TextModel.prototype._emitContentChanged2 = function (startLineNumber, startColumn, endLineNumber, endColumn, rangeLength, text, isUndoing, isRedoing) {\n            var e = {\n                range: new range_1.Range(startLineNumber, startColumn, endLineNumber, endColumn),\n                rangeLength: rangeLength,\n                text: text,\n                eol: this._EOL,\n                versionId: this.getVersionId(),\n                isUndoing: isUndoing,\n                isRedoing: isRedoing\n            };\n            if (!this._isDisposing) {\n                this.emit(editorCommon.EventType.ModelContentChanged2, e);\n            }\n        };\n        TextModel.prototype._resetValue = function (e, newValue) {\n            this._constructLines(newValue);\n            this._increaseVersionId();\n            e.detail = this.toRawText();\n            e.versionId = this._versionId;\n        };\n        TextModel.prototype.toRawText = function () {\n            return {\n                BOM: this._BOM,\n                EOL: this._EOL,\n                lines: this.getLinesContent(),\n                length: this.getValueLength(),\n                options: this._options\n            };\n        };\n        TextModel.prototype.equals = function (other) {\n            if (this._BOM !== other.BOM) {\n                return false;\n            }\n            if (this._EOL !== other.EOL) {\n                return false;\n            }\n            if (this._lines.length !== other.lines.length) {\n                return false;\n            }\n            for (var i = 0, len = this._lines.length; i < len; i++) {\n                if (this._lines[i].text !== other.lines[i]) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        TextModel.prototype.setValue = function (value) {\n            if (value === null) {\n                // There's nothing to do\n                return;\n            }\n            var rawText = null;\n            rawText = TextModel.toRawText(value, {\n                tabSize: this._options.tabSize,\n                insertSpaces: this._options.insertSpaces,\n                trimAutoWhitespace: this._options.trimAutoWhitespace,\n                detectIndentation: false,\n                defaultEOL: this._options.defaultEOL\n            });\n            this.setValueFromRawText(rawText);\n        };\n        TextModel.prototype.setValueFromRawText = function (newValue) {\n            if (newValue === null) {\n                // There's nothing to do\n                return;\n            }\n            var oldFullModelRange = this.getFullModelRange();\n            var oldModelValueLength = this.getValueLengthInRange(oldFullModelRange);\n            var endLineNumber = this.getLineCount();\n            var endColumn = this.getLineMaxColumn(endLineNumber);\n            var e = this._createContentChangedFlushEvent();\n            this._resetValue(e, newValue);\n            this._emitModelContentChangedFlushEvent(e);\n            this._emitContentChanged2(1, 1, endLineNumber, endColumn, oldModelValueLength, this.getValue(), false, false);\n        };\n        TextModel.prototype.getValue = function (eol, preserveBOM) {\n            if (preserveBOM === void 0) { preserveBOM = false; }\n            var fullModelRange = this.getFullModelRange();\n            var fullModelValue = this.getValueInRange(fullModelRange, eol);\n            if (preserveBOM) {\n                return this._BOM + fullModelValue;\n            }\n            return fullModelValue;\n        };\n        TextModel.prototype.getValueLength = function (eol, preserveBOM) {\n            if (preserveBOM === void 0) { preserveBOM = false; }\n            var fullModelRange = this.getFullModelRange();\n            var fullModelValue = this.getValueLengthInRange(fullModelRange, eol);\n            if (preserveBOM) {\n                return this._BOM.length + fullModelValue;\n            }\n            return fullModelValue;\n        };\n        TextModel.prototype.getEmptiedValueInRange = function (rawRange, fillCharacter, eol) {\n            if (fillCharacter === void 0) { fillCharacter = ''; }\n            if (eol === void 0) { eol = editorCommon.EndOfLinePreference.TextDefined; }\n            var range = this.validateRange(rawRange);\n            if (range.isEmpty()) {\n                return '';\n            }\n            if (range.startLineNumber === range.endLineNumber) {\n                return this._repeatCharacter(fillCharacter, range.endColumn - range.startColumn);\n            }\n            var lineEnding = this._getEndOfLine(eol), startLineIndex = range.startLineNumber - 1, endLineIndex = range.endLineNumber - 1, resultLines = [];\n            resultLines.push(this._repeatCharacter(fillCharacter, this._lines[startLineIndex].text.length - range.startColumn + 1));\n            for (var i = startLineIndex + 1; i < endLineIndex; i++) {\n                resultLines.push(this._repeatCharacter(fillCharacter, this._lines[i].text.length));\n            }\n            resultLines.push(this._repeatCharacter(fillCharacter, range.endColumn - 1));\n            return resultLines.join(lineEnding);\n        };\n        TextModel.prototype._repeatCharacter = function (fillCharacter, count) {\n            var r = '';\n            for (var i = 0; i < count; i++) {\n                r += fillCharacter;\n            }\n            return r;\n        };\n        TextModel.prototype.getValueInRange = function (rawRange, eol) {\n            if (eol === void 0) { eol = editorCommon.EndOfLinePreference.TextDefined; }\n            var range = this.validateRange(rawRange);\n            if (range.isEmpty()) {\n                return '';\n            }\n            if (range.startLineNumber === range.endLineNumber) {\n                return this._lines[range.startLineNumber - 1].text.substring(range.startColumn - 1, range.endColumn - 1);\n            }\n            var lineEnding = this._getEndOfLine(eol), startLineIndex = range.startLineNumber - 1, endLineIndex = range.endLineNumber - 1, resultLines = [];\n            resultLines.push(this._lines[startLineIndex].text.substring(range.startColumn - 1));\n            for (var i = startLineIndex + 1; i < endLineIndex; i++) {\n                resultLines.push(this._lines[i].text);\n            }\n            resultLines.push(this._lines[endLineIndex].text.substring(0, range.endColumn - 1));\n            return resultLines.join(lineEnding);\n        };\n        TextModel.prototype.getValueLengthInRange = function (rawRange, eol) {\n            if (eol === void 0) { eol = editorCommon.EndOfLinePreference.TextDefined; }\n            var range = this.validateRange(rawRange);\n            if (range.isEmpty()) {\n                return 0;\n            }\n            if (range.startLineNumber === range.endLineNumber) {\n                return (range.endColumn - range.startColumn);\n            }\n            var startOffset = this.getOffsetAt(new position_1.Position(range.startLineNumber, range.startColumn));\n            var endOffset = this.getOffsetAt(new position_1.Position(range.endLineNumber, range.endColumn));\n            return endOffset - startOffset;\n        };\n        TextModel.prototype.isDominatedByLongLines = function () {\n            var smallLineCharCount = 0, longLineCharCount = 0, i, len, lines = this._lines, lineLength;\n            for (i = 0, len = this._lines.length; i < len; i++) {\n                lineLength = lines[i].text.length;\n                if (lineLength >= exports.LONG_LINE_BOUNDARY) {\n                    longLineCharCount += lineLength;\n                }\n                else {\n                    smallLineCharCount += lineLength;\n                }\n            }\n            return (longLineCharCount > smallLineCharCount);\n        };\n        TextModel.prototype.getLineCount = function () {\n            return this._lines.length;\n        };\n        TextModel.prototype.getLineContent = function (lineNumber) {\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            return this._lines[lineNumber - 1].text;\n        };\n        TextModel.prototype.getLinesContent = function () {\n            var r = [];\n            for (var i = 0, len = this._lines.length; i < len; i++) {\n                r[i] = this._lines[i].text;\n            }\n            return r;\n        };\n        TextModel.prototype.getEOL = function () {\n            return this._EOL;\n        };\n        TextModel.prototype.setEOL = function (eol) {\n            var newEOL = (eol === editorCommon.EndOfLineSequence.CRLF ? '\\r\\n' : '\\n');\n            if (this._EOL === newEOL) {\n                // Nothing to do\n                return;\n            }\n            var oldFullModelRange = this.getFullModelRange();\n            var oldModelValueLength = this.getValueLengthInRange(oldFullModelRange);\n            var endLineNumber = this.getLineCount();\n            var endColumn = this.getLineMaxColumn(endLineNumber);\n            this._EOL = newEOL;\n            this._lineStarts = null;\n            this._increaseVersionId();\n            var e = this._createContentChangedFlushEvent();\n            e.detail = this.toRawText();\n            e.versionId = this._versionId;\n            this._emitModelContentChangedFlushEvent(e);\n            this._emitContentChanged2(1, 1, endLineNumber, endColumn, oldModelValueLength, this.getValue(), false, false);\n        };\n        TextModel.prototype.getLineMinColumn = function (lineNumber) {\n            return 1;\n        };\n        TextModel.prototype.getLineMaxColumn = function (lineNumber) {\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            return this._lines[lineNumber - 1].text.length + 1;\n        };\n        TextModel.prototype.getLineFirstNonWhitespaceColumn = function (lineNumber) {\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            var result = strings.firstNonWhitespaceIndex(this._lines[lineNumber - 1].text);\n            if (result === -1) {\n                return 0;\n            }\n            return result + 1;\n        };\n        TextModel.prototype.getLineLastNonWhitespaceColumn = function (lineNumber) {\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            var result = strings.lastNonWhitespaceIndex(this._lines[lineNumber - 1].text);\n            if (result === -1) {\n                return 0;\n            }\n            return result + 2;\n        };\n        TextModel.prototype.validateLineNumber = function (lineNumber) {\n            if (lineNumber < 1) {\n                lineNumber = 1;\n            }\n            if (lineNumber > this._lines.length) {\n                lineNumber = this._lines.length;\n            }\n            return lineNumber;\n        };\n        TextModel.prototype.validatePosition = function (position) {\n            var lineNumber = position.lineNumber ? position.lineNumber : 1;\n            var column = position.column ? position.column : 1;\n            if (lineNumber < 1) {\n                lineNumber = 1;\n                column = 1;\n            }\n            else if (lineNumber > this._lines.length) {\n                lineNumber = this._lines.length;\n                column = this.getLineMaxColumn(lineNumber);\n            }\n            else {\n                var maxColumn = this.getLineMaxColumn(lineNumber);\n                if (column < 1) {\n                    column = 1;\n                }\n                else if (column > maxColumn) {\n                    column = maxColumn;\n                }\n            }\n            return new position_1.Position(lineNumber, column);\n        };\n        TextModel.prototype.validateRange = function (range) {\n            var start = this.validatePosition(new position_1.Position(range.startLineNumber, range.startColumn));\n            var end = this.validatePosition(new position_1.Position(range.endLineNumber, range.endColumn));\n            return new range_1.Range(start.lineNumber, start.column, end.lineNumber, end.column);\n        };\n        TextModel.prototype.modifyPosition = function (rawPosition, offset) {\n            return this.getPositionAt(this.getOffsetAt(rawPosition) + offset);\n        };\n        TextModel.prototype.getFullModelRange = function () {\n            var lineCount = this.getLineCount();\n            return new range_1.Range(1, 1, lineCount, this.getLineMaxColumn(lineCount));\n        };\n        TextModel.prototype._emitModelContentChangedFlushEvent = function (e) {\n            if (!this._isDisposing) {\n                this.emit(editorCommon.EventType.ModelRawContentChanged, e);\n            }\n        };\n        TextModel.toRawText = function (rawText, opts) {\n            // Count the number of lines that end with \\r\\n\n            var carriageReturnCnt = 0, lastCarriageReturnIndex = -1;\n            while ((lastCarriageReturnIndex = rawText.indexOf('\\r', lastCarriageReturnIndex + 1)) !== -1) {\n                carriageReturnCnt++;\n            }\n            // Split the text into lines\n            var lines = rawText.split(/\\r\\n|\\r|\\n/);\n            // Remove the BOM (if present)\n            var BOM = '';\n            if (strings.startsWithUTF8BOM(lines[0])) {\n                BOM = strings.UTF8_BOM_CHARACTER;\n                lines[0] = lines[0].substr(1);\n            }\n            var lineFeedCnt = lines.length - 1;\n            var EOL = '';\n            if (lineFeedCnt === 0) {\n                // This is an empty file or a file with precisely one line\n                EOL = (opts.defaultEOL === editorCommon.DefaultEndOfLine.LF ? '\\n' : '\\r\\n');\n            }\n            else if (carriageReturnCnt > lineFeedCnt / 2) {\n                // More than half of the file contains \\r\\n ending lines\n                EOL = '\\r\\n';\n            }\n            else {\n                // At least one line more ends in \\n\n                EOL = '\\n';\n            }\n            var resolvedOpts;\n            if (opts.detectIndentation) {\n                var guessedIndentation = indentationGuesser_1.guessIndentation(lines, opts.tabSize, opts.insertSpaces);\n                resolvedOpts = {\n                    tabSize: guessedIndentation.tabSize,\n                    insertSpaces: guessedIndentation.insertSpaces,\n                    trimAutoWhitespace: opts.trimAutoWhitespace,\n                    defaultEOL: opts.defaultEOL\n                };\n            }\n            else {\n                resolvedOpts = {\n                    tabSize: opts.tabSize,\n                    insertSpaces: opts.insertSpaces,\n                    trimAutoWhitespace: opts.trimAutoWhitespace,\n                    defaultEOL: opts.defaultEOL\n                };\n            }\n            return {\n                BOM: BOM,\n                EOL: EOL,\n                lines: lines,\n                length: rawText.length,\n                options: resolvedOpts\n            };\n        };\n        TextModel.prototype._constructLines = function (rawText) {\n            var rawLines = rawText.lines, modelLines = [], i, len;\n            for (i = 0, len = rawLines.length; i < len; i++) {\n                modelLines.push(new modelLine_1.ModelLine(i + 1, rawLines[i]));\n            }\n            this._BOM = rawText.BOM;\n            this._EOL = rawText.EOL;\n            this._lines = modelLines;\n            this._lineStarts = null;\n        };\n        TextModel.prototype._getEndOfLine = function (eol) {\n            switch (eol) {\n                case editorCommon.EndOfLinePreference.LF:\n                    return '\\n';\n                case editorCommon.EndOfLinePreference.CRLF:\n                    return '\\r\\n';\n                case editorCommon.EndOfLinePreference.TextDefined:\n                    return this.getEOL();\n            }\n            throw new Error('Unknown EOL preference');\n        };\n        TextModel.prototype.findMatches = function (searchString, rawSearchScope, isRegex, matchCase, wholeWord, limitResultCount) {\n            if (limitResultCount === void 0) { limitResultCount = LIMIT_FIND_COUNT; }\n            var regex = strings.createSafeRegExp(searchString, isRegex, matchCase, wholeWord);\n            if (!regex) {\n                return [];\n            }\n            var searchRange;\n            if (range_1.Range.isIRange(rawSearchScope)) {\n                searchRange = rawSearchScope;\n            }\n            else {\n                searchRange = this.getFullModelRange();\n            }\n            return this._doFindMatches(searchRange, regex, limitResultCount);\n        };\n        TextModel.prototype.findNextMatch = function (searchString, rawSearchStart, isRegex, matchCase, wholeWord) {\n            var regex = strings.createSafeRegExp(searchString, isRegex, matchCase, wholeWord);\n            if (!regex) {\n                return null;\n            }\n            var searchStart = this.validatePosition(rawSearchStart), lineCount = this.getLineCount(), startLineNumber = searchStart.lineNumber, text, r;\n            // Look in first line\n            text = this._lines[startLineNumber - 1].text.substring(searchStart.column - 1);\n            r = this._findMatchInLine(regex, text, startLineNumber, searchStart.column - 1);\n            if (r) {\n                return r;\n            }\n            for (var i = 1; i <= lineCount; i++) {\n                var lineIndex = (startLineNumber + i - 1) % lineCount;\n                text = this._lines[lineIndex].text;\n                r = this._findMatchInLine(regex, text, lineIndex + 1, 0);\n                if (r) {\n                    return r;\n                }\n            }\n            return null;\n        };\n        TextModel.prototype.findPreviousMatch = function (searchString, rawSearchStart, isRegex, matchCase, wholeWord) {\n            var regex = strings.createSafeRegExp(searchString, isRegex, matchCase, wholeWord);\n            if (!regex) {\n                return null;\n            }\n            var searchStart = this.validatePosition(rawSearchStart), lineCount = this.getLineCount(), startLineNumber = searchStart.lineNumber, text, r;\n            // Look in first line\n            text = this._lines[startLineNumber - 1].text.substring(0, searchStart.column - 1);\n            r = this._findLastMatchInLine(regex, text, startLineNumber);\n            if (r) {\n                return r;\n            }\n            for (var i = 1; i <= lineCount; i++) {\n                var lineIndex = (lineCount + startLineNumber - i - 1) % lineCount;\n                text = this._lines[lineIndex].text;\n                r = this._findLastMatchInLine(regex, text, lineIndex + 1);\n                if (r) {\n                    return r;\n                }\n            }\n            return null;\n        };\n        TextModel.prototype._doFindMatches = function (searchRange, searchRegex, limitResultCount) {\n            var result = [], text, counter = 0;\n            // Early case for a search range that starts & stops on the same line number\n            if (searchRange.startLineNumber === searchRange.endLineNumber) {\n                text = this._lines[searchRange.startLineNumber - 1].text.substring(searchRange.startColumn - 1, searchRange.endColumn - 1);\n                counter = this._findMatchesInLine(searchRegex, text, searchRange.startLineNumber, searchRange.startColumn - 1, counter, result, limitResultCount);\n                return result;\n            }\n            // Collect results from first line\n            text = this._lines[searchRange.startLineNumber - 1].text.substring(searchRange.startColumn - 1);\n            counter = this._findMatchesInLine(searchRegex, text, searchRange.startLineNumber, searchRange.startColumn - 1, counter, result, limitResultCount);\n            // Collect results from middle lines\n            for (var lineNumber = searchRange.startLineNumber + 1; lineNumber < searchRange.endLineNumber && counter < limitResultCount; lineNumber++) {\n                counter = this._findMatchesInLine(searchRegex, this._lines[lineNumber - 1].text, lineNumber, 0, counter, result, limitResultCount);\n            }\n            // Collect results from last line\n            if (counter < limitResultCount) {\n                text = this._lines[searchRange.endLineNumber - 1].text.substring(0, searchRange.endColumn - 1);\n                counter = this._findMatchesInLine(searchRegex, text, searchRange.endLineNumber, 0, counter, result, limitResultCount);\n            }\n            return result;\n        };\n        TextModel.prototype._findMatchInLine = function (searchRegex, text, lineNumber, deltaOffset) {\n            var m = searchRegex.exec(text);\n            if (!m) {\n                return null;\n            }\n            return new range_1.Range(lineNumber, m.index + 1 + deltaOffset, lineNumber, m.index + 1 + m[0].length + deltaOffset);\n        };\n        TextModel.prototype._findLastMatchInLine = function (searchRegex, text, lineNumber) {\n            var bestResult = null;\n            var m;\n            while ((m = searchRegex.exec(text))) {\n                var result = new range_1.Range(lineNumber, m.index + 1, lineNumber, m.index + 1 + m[0].length);\n                if (result.equalsRange(bestResult)) {\n                    break;\n                }\n                bestResult = result;\n            }\n            return bestResult;\n        };\n        TextModel.prototype._findMatchesInLine = function (searchRegex, text, lineNumber, deltaOffset, counter, result, limitResultCount) {\n            var m;\n            // Reset regex to search from the beginning\n            searchRegex.lastIndex = 0;\n            do {\n                m = searchRegex.exec(text);\n                if (m) {\n                    var range = new range_1.Range(lineNumber, m.index + 1 + deltaOffset, lineNumber, m.index + 1 + m[0].length + deltaOffset);\n                    // Exit early if the regex matches the same range\n                    if (range.equalsRange(result[result.length - 1])) {\n                        return counter;\n                    }\n                    result.push(range);\n                    counter++;\n                    if (counter >= limitResultCount) {\n                        return counter;\n                    }\n                }\n            } while (m);\n            return counter;\n        };\n        TextModel.MODEL_SYNC_LIMIT = 5 * 1024 * 1024; // 5 MB\n        TextModel.MODEL_TOKENIZATION_LIMIT = 20 * 1024 * 1024; // 20 MB\n        TextModel.DEFAULT_CREATION_OPTIONS = {\n            tabSize: defaultConfig_1.DEFAULT_INDENTATION.tabSize,\n            insertSpaces: defaultConfig_1.DEFAULT_INDENTATION.insertSpaces,\n            detectIndentation: false,\n            defaultEOL: editorCommon.DefaultEndOfLine.LF,\n            trimAutoWhitespace: defaultConfig_1.DEFAULT_TRIM_AUTO_WHITESPACE,\n        };\n        return TextModel;\n    }(eventEmitter_1.OrderGuaranteeEventEmitter));\n    exports.TextModel = TextModel;\n    var RawText = (function () {\n        function RawText() {\n        }\n        RawText.fromString = function (rawText, opts) {\n            return TextModel.toRawText(rawText, opts);\n        };\n        RawText.fromStringWithModelOptions = function (rawText, model) {\n            var opts = model.getOptions();\n            return TextModel.toRawText(rawText, {\n                tabSize: opts.tabSize,\n                insertSpaces: opts.insertSpaces,\n                trimAutoWhitespace: opts.trimAutoWhitespace,\n                detectIndentation: false,\n                defaultEOL: opts.defaultEOL\n            });\n        };\n        return RawText;\n    }());\n    exports.RawText = RawText;\n});\n\ndefine(__m[70], __M([7,6]), function(nls, data) { return nls.create(\"vs/editor/common/model/textModelWithTokens\", data); });\n\n\n\n\n\ndefine(__m[71], __M([1,0,70,24,2,16,61,26,5,19,45,64,69,48,14,28,18,101,56,31]), function (require, exports, nls, async_1, errors_1, lifecycle_1, stopwatch_1, timer, winjs_base_1, editorCommon, textModel_1, textModelWithTokensHelpers_1, tokenIterator_1, nullMode_1, supports_1, richEditBrackets_1, modeTransition_1, lineToken_1, tokensBinaryEncoding_1, languageConfigurationRegistry_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var ModeToModelBinder = (function () {\n        function ModeToModelBinder(modePromise, model) {\n            var _this = this;\n            this._modePromise = modePromise;\n            // Create an external mode promise that fires after the mode is set to the model\n            this._externalModePromise = new winjs_base_1.TPromise(function (c, e, p) {\n                _this._externalModePromise_c = c;\n                _this._externalModePromise_e = e;\n            }, function () {\n                // this promise cannot be canceled\n            });\n            this._model = model;\n            this._isDisposed = false;\n            // Ensure asynchronicity\n            winjs_base_1.TPromise.timeout(0).then(function () {\n                return _this._modePromise;\n            }).then(function (mode) {\n                if (_this._isDisposed) {\n                    _this._externalModePromise_c(false);\n                    return;\n                }\n                var model = _this._model;\n                _this.dispose();\n                model.setMode(mode);\n                model._warmUpTokens();\n                _this._externalModePromise_c(true);\n            }).done(null, function (err) {\n                _this._externalModePromise_e(err);\n                errors_1.onUnexpectedError(err);\n            });\n        }\n        ModeToModelBinder.prototype.getModePromise = function () {\n            return this._externalModePromise;\n        };\n        ModeToModelBinder.prototype.dispose = function () {\n            this._modePromise = null;\n            this._model = null;\n            this._isDisposed = true;\n        };\n        return ModeToModelBinder;\n    }());\n    var FullModelRetokenizer = (function () {\n        function FullModelRetokenizer(retokenizePromise, model) {\n            var _this = this;\n            this._retokenizePromise = retokenizePromise;\n            this._model = model;\n            this._isDisposed = false;\n            this.isFulfilled = false;\n            // Ensure asynchronicity\n            winjs_base_1.TPromise.timeout(0).then(function () {\n                return _this._retokenizePromise;\n            }).then(function () {\n                if (_this._isDisposed) {\n                    return;\n                }\n                _this.isFulfilled = true;\n                _this._model.onRetokenizerFulfilled();\n            }).done(null, errors_1.onUnexpectedError);\n        }\n        FullModelRetokenizer.prototype.getRange = function () {\n            return null;\n        };\n        FullModelRetokenizer.prototype.dispose = function () {\n            this._retokenizePromise = null;\n            this._model = null;\n            this._isDisposed = true;\n        };\n        return FullModelRetokenizer;\n    }());\n    exports.FullModelRetokenizer = FullModelRetokenizer;\n    var LineContext = (function () {\n        function LineContext(topLevelMode, line) {\n            this.modeTransitions = line.getModeTransitions(topLevelMode);\n            this._text = line.text;\n            this._lineTokens = line.getTokens();\n        }\n        LineContext.prototype.getLineContent = function () {\n            return this._text;\n        };\n        LineContext.prototype.getTokenCount = function () {\n            return this._lineTokens.getTokenCount();\n        };\n        LineContext.prototype.getTokenStartIndex = function (tokenIndex) {\n            return this._lineTokens.getTokenStartIndex(tokenIndex);\n        };\n        LineContext.prototype.getTokenEndIndex = function (tokenIndex) {\n            return this._lineTokens.getTokenEndIndex(tokenIndex, this._text.length);\n        };\n        LineContext.prototype.getTokenType = function (tokenIndex) {\n            return this._lineTokens.getTokenType(tokenIndex);\n        };\n        LineContext.prototype.getTokenText = function (tokenIndex) {\n            var startIndex = this._lineTokens.getTokenStartIndex(tokenIndex);\n            var endIndex = this._lineTokens.getTokenEndIndex(tokenIndex, this._text.length);\n            return this._text.substring(startIndex, endIndex);\n        };\n        LineContext.prototype.findIndexOfOffset = function (offset) {\n            return this._lineTokens.findIndexOfOffset(offset);\n        };\n        return LineContext;\n    }());\n    var TextModelWithTokens = (function (_super) {\n        __extends(TextModelWithTokens, _super);\n        function TextModelWithTokens(allowedEventTypes, rawText, shouldAutoTokenize, modeOrPromise) {\n            var _this = this;\n            allowedEventTypes.push(editorCommon.EventType.ModelTokensChanged);\n            allowedEventTypes.push(editorCommon.EventType.ModelModeChanged);\n            allowedEventTypes.push(editorCommon.EventType.ModelModeSupportChanged);\n            _super.call(this, allowedEventTypes, rawText);\n            this._shouldAutoTokenize = shouldAutoTokenize;\n            this._mode = null;\n            this._modeListener = null;\n            this._modeToModelBinder = null;\n            this._tokensInflatorMap = null;\n            this._invalidLineStartIndex = 0;\n            this._lastState = null;\n            this._revalidateTokensTimeout = -1;\n            this._scheduleRetokenizeNow = null;\n            this._retokenizers = null;\n            if (!modeOrPromise) {\n                this._mode = new nullMode_1.NullMode();\n            }\n            else if (winjs_base_1.TPromise.is(modeOrPromise)) {\n                // TODO@Alex: To avoid mode id changes, we check if this promise is resolved\n                var promiseValue = modeOrPromise._value;\n                if (promiseValue && typeof promiseValue.getId === 'function') {\n                    // The promise is already resolved\n                    this._mode = this._massageMode(promiseValue);\n                    this._resetModeListener(this._mode);\n                }\n                else {\n                    var modePromise = modeOrPromise;\n                    this._modeToModelBinder = new ModeToModelBinder(modePromise, this);\n                    this._mode = new nullMode_1.NullMode();\n                }\n            }\n            else {\n                this._mode = this._massageMode(modeOrPromise);\n                this._resetModeListener(this._mode);\n            }\n            this._revalidateTokensTimeout = -1;\n            this._scheduleRetokenizeNow = new async_1.RunOnceScheduler(function () { return _this._retokenizeNow(); }, 200);\n            this._retokenizers = [];\n            this._resetTokenizationState();\n        }\n        TextModelWithTokens.prototype.dispose = function () {\n            if (this._modeToModelBinder) {\n                this._modeToModelBinder.dispose();\n                this._modeToModelBinder = null;\n            }\n            this._resetModeListener(null);\n            this._clearTimers();\n            this._mode = null;\n            this._lastState = null;\n            this._tokensInflatorMap = null;\n            this._retokenizers = lifecycle_1.dispose(this._retokenizers);\n            this._scheduleRetokenizeNow.dispose();\n            _super.prototype.dispose.call(this);\n        };\n        TextModelWithTokens.prototype._massageMode = function (mode) {\n            if (this.isTooLargeForHavingAMode()) {\n                return new nullMode_1.NullMode();\n            }\n            if (this.isTooLargeForHavingARichMode()) {\n                return mode.toSimplifiedMode();\n            }\n            return mode;\n        };\n        TextModelWithTokens.prototype.whenModeIsReady = function () {\n            var _this = this;\n            if (this._modeToModelBinder) {\n                // Still waiting for some mode to load\n                return this._modeToModelBinder.getModePromise().then(function () { return _this._mode; });\n            }\n            return winjs_base_1.TPromise.as(this._mode);\n        };\n        TextModelWithTokens.prototype.onRetokenizerFulfilled = function () {\n            this._scheduleRetokenizeNow.schedule();\n        };\n        TextModelWithTokens.prototype._retokenizeNow = function () {\n            var fulfilled = this._retokenizers.filter(function (r) { return r.isFulfilled; });\n            this._retokenizers = this._retokenizers.filter(function (r) { return !r.isFulfilled; });\n            var hasFullModel = false;\n            for (var i = 0; i < fulfilled.length; i++) {\n                if (!fulfilled[i].getRange()) {\n                    hasFullModel = true;\n                }\n            }\n            if (hasFullModel) {\n                // Just invalidate all the lines\n                for (var i = 0, len = this._lines.length; i < len; i++) {\n                    this._lines[i].isInvalid = true;\n                }\n                this._invalidLineStartIndex = 0;\n            }\n            else {\n                var minLineNumber = Number.MAX_VALUE;\n                for (var i = 0; i < fulfilled.length; i++) {\n                    var range = fulfilled[i].getRange();\n                    minLineNumber = Math.min(minLineNumber, range.startLineNumber);\n                    for (var lineNumber = range.startLineNumber; lineNumber <= range.endLineNumber; lineNumber++) {\n                        this._lines[lineNumber - 1].isInvalid = true;\n                    }\n                }\n                if (minLineNumber - 1 < this._invalidLineStartIndex) {\n                    if (this._invalidLineStartIndex < this._lines.length) {\n                        this._lines[this._invalidLineStartIndex].isInvalid = true;\n                    }\n                    this._invalidLineStartIndex = minLineNumber - 1;\n                }\n            }\n            this._beginBackgroundTokenization();\n            for (var i = 0; i < fulfilled.length; i++) {\n                fulfilled[i].dispose();\n            }\n        };\n        TextModelWithTokens.prototype._createRetokenizer = function (retokenizePromise, lineNumber) {\n            return new FullModelRetokenizer(retokenizePromise, this);\n        };\n        TextModelWithTokens.prototype._resetValue = function (e, newValue) {\n            _super.prototype._resetValue.call(this, e, newValue);\n            // Cancel tokenization, clear all tokens and begin tokenizing\n            this._resetTokenizationState();\n        };\n        TextModelWithTokens.prototype._resetMode = function (e, newMode) {\n            // Cancel tokenization, clear all tokens and begin tokenizing\n            this._mode = newMode;\n            this._resetModeListener(newMode);\n            this._resetTokenizationState();\n            this.emitModelTokensChangedEvent(1, this.getLineCount());\n        };\n        TextModelWithTokens.prototype._resetModeListener = function (newMode) {\n            var _this = this;\n            if (this._modeListener) {\n                this._modeListener.dispose();\n                this._modeListener = null;\n            }\n            if (newMode && typeof newMode.addSupportChangedListener === 'function') {\n                this._modeListener = newMode.addSupportChangedListener(function (e) { return _this._onModeSupportChanged(e); });\n            }\n        };\n        TextModelWithTokens.prototype._onModeSupportChanged = function (e) {\n            this._emitModelModeSupportChangedEvent(e);\n            if (e.tokenizationSupport) {\n                this._resetTokenizationState();\n                this.emitModelTokensChangedEvent(1, this.getLineCount());\n            }\n        };\n        TextModelWithTokens.prototype._resetTokenizationState = function () {\n            this._retokenizers = lifecycle_1.dispose(this._retokenizers);\n            this._scheduleRetokenizeNow.cancel();\n            this._clearTimers();\n            for (var i = 0; i < this._lines.length; i++) {\n                this._lines[i].setState(null);\n            }\n            this._initializeTokenizationState();\n        };\n        TextModelWithTokens.prototype._clearTimers = function () {\n            if (this._revalidateTokensTimeout !== -1) {\n                clearTimeout(this._revalidateTokensTimeout);\n                this._revalidateTokensTimeout = -1;\n            }\n        };\n        TextModelWithTokens.prototype._initializeTokenizationState = function () {\n            // Initialize tokenization states\n            var initialState = null;\n            if (this._mode.tokenizationSupport) {\n                try {\n                    initialState = this._mode.tokenizationSupport.getInitialState();\n                }\n                catch (e) {\n                    e.friendlyMessage = TextModelWithTokens.MODE_TOKENIZATION_FAILED_MSG;\n                    errors_1.onUnexpectedError(e);\n                    this._mode = new nullMode_1.NullMode();\n                }\n            }\n            if (!initialState) {\n                initialState = new nullMode_1.NullState(this._mode, null);\n            }\n            this._lines[0].setState(initialState);\n            this._lastState = null;\n            this._tokensInflatorMap = new tokensBinaryEncoding_1.TokensInflatorMap();\n            this._invalidLineStartIndex = 0;\n            this._beginBackgroundTokenization();\n        };\n        TextModelWithTokens.prototype.getLineTokens = function (lineNumber, inaccurateTokensAcceptable) {\n            if (inaccurateTokensAcceptable === void 0) { inaccurateTokensAcceptable = false; }\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            if (!inaccurateTokensAcceptable) {\n                this._updateTokensUntilLine(lineNumber, true);\n            }\n            return this._lines[lineNumber - 1].getTokens();\n        };\n        TextModelWithTokens.prototype.getLineContext = function (lineNumber) {\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            this._updateTokensUntilLine(lineNumber, true);\n            return new LineContext(this._mode, this._lines[lineNumber - 1]);\n        };\n        TextModelWithTokens.prototype._getInternalTokens = function (lineNumber) {\n            this._updateTokensUntilLine(lineNumber, true);\n            return this._lines[lineNumber - 1].getTokens();\n        };\n        TextModelWithTokens.prototype.getMode = function () {\n            return this._mode;\n        };\n        TextModelWithTokens.prototype.setMode = function (newModeOrPromise) {\n            if (!newModeOrPromise) {\n                // There's nothing to do\n                return;\n            }\n            if (this._modeToModelBinder) {\n                this._modeToModelBinder.dispose();\n                this._modeToModelBinder = null;\n            }\n            if (winjs_base_1.TPromise.is(newModeOrPromise)) {\n                this._modeToModelBinder = new ModeToModelBinder(newModeOrPromise, this);\n            }\n            else {\n                var actualNewMode = this._massageMode(newModeOrPromise);\n                if (this._mode !== actualNewMode) {\n                    var e2 = {\n                        oldMode: this._mode,\n                        newMode: actualNewMode\n                    };\n                    this._resetMode(e2, actualNewMode);\n                    this._emitModelModeChangedEvent(e2);\n                }\n            }\n        };\n        TextModelWithTokens.prototype.getModeIdAtPosition = function (_lineNumber, _column) {\n            var validPosition = this.validatePosition({\n                lineNumber: _lineNumber,\n                column: _column\n            });\n            var lineNumber = validPosition.lineNumber;\n            var column = validPosition.column;\n            if (column === 1) {\n                return this.getStateBeforeLine(lineNumber).getMode().getId();\n            }\n            else if (column === this.getLineMaxColumn(lineNumber)) {\n                return this.getStateAfterLine(lineNumber).getMode().getId();\n            }\n            else {\n                var modeTransitions = this._getLineModeTransitions(lineNumber);\n                var modeTransitionIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, column - 1);\n                return modeTransitions[modeTransitionIndex].modeId;\n            }\n        };\n        TextModelWithTokens.prototype._invalidateLine = function (lineIndex) {\n            this._lines[lineIndex].isInvalid = true;\n            if (lineIndex < this._invalidLineStartIndex) {\n                if (this._invalidLineStartIndex < this._lines.length) {\n                    this._lines[this._invalidLineStartIndex].isInvalid = true;\n                }\n                this._invalidLineStartIndex = lineIndex;\n                this._beginBackgroundTokenization();\n            }\n        };\n        TextModelWithTokens._toLineTokens = function (tokens) {\n            if (!tokens || tokens.length === 0) {\n                return [];\n            }\n            if (tokens[0] instanceof lineToken_1.LineToken) {\n                return tokens;\n            }\n            var result = [];\n            for (var i = 0, len = tokens.length; i < len; i++) {\n                result[i] = new lineToken_1.LineToken(tokens[i].startIndex, tokens[i].type);\n            }\n            return result;\n        };\n        TextModelWithTokens._toModeTransitions = function (modeTransitions) {\n            if (!modeTransitions || modeTransitions.length === 0) {\n                return [];\n            }\n            if (modeTransitions[0] instanceof modeTransition_1.ModeTransition) {\n                return modeTransitions;\n            }\n            var result = [];\n            for (var i = 0, len = modeTransitions.length; i < len; i++) {\n                result[i] = new modeTransition_1.ModeTransition(modeTransitions[i].startIndex, modeTransitions[i].mode);\n            }\n            return result;\n        };\n        TextModelWithTokens.prototype._updateLineTokens = function (lineIndex, map, topLevelMode, r) {\n            this._lines[lineIndex].setTokens(map, TextModelWithTokens._toLineTokens(r.tokens), topLevelMode, TextModelWithTokens._toModeTransitions(r.modeTransitions));\n        };\n        TextModelWithTokens.prototype._beginBackgroundTokenization = function () {\n            var _this = this;\n            if (this._shouldAutoTokenize && this._revalidateTokensTimeout === -1) {\n                this._revalidateTokensTimeout = setTimeout(function () {\n                    _this._revalidateTokensTimeout = -1;\n                    _this._revalidateTokensNow();\n                }, 0);\n            }\n        };\n        TextModelWithTokens.prototype._warmUpTokens = function () {\n            // Warm up first 100 lines (if it takes less than 50ms)\n            var maxLineNumber = Math.min(100, this.getLineCount());\n            var toLineNumber = maxLineNumber;\n            for (var lineNumber = 1; lineNumber <= maxLineNumber; lineNumber++) {\n                var text = this._lines[lineNumber - 1].text;\n                if (text.length >= 200) {\n                    // This line is over 200 chars long, so warm up without it\n                    toLineNumber = lineNumber - 1;\n                    break;\n                }\n            }\n            this._revalidateTokensNow(toLineNumber);\n        };\n        TextModelWithTokens.prototype._revalidateTokensNow = function (toLineNumber) {\n            if (toLineNumber === void 0) { toLineNumber = this._invalidLineStartIndex + 1000000; }\n            var t1 = timer.start(timer.Topic.EDITOR, 'backgroundTokenization');\n            toLineNumber = Math.min(this._lines.length, toLineNumber);\n            var MAX_ALLOWED_TIME = 20, fromLineNumber = this._invalidLineStartIndex + 1, tokenizedChars = 0, currentCharsToTokenize = 0, currentEstimatedTimeToTokenize = 0, sw = stopwatch_1.StopWatch.create(false), elapsedTime;\n            // Tokenize at most 1000 lines. Estimate the tokenization speed per character and stop when:\n            // - MAX_ALLOWED_TIME is reached\n            // - tokenizing the next line would go above MAX_ALLOWED_TIME\n            for (var lineNumber = fromLineNumber; lineNumber <= toLineNumber; lineNumber++) {\n                elapsedTime = sw.elapsed();\n                if (elapsedTime > MAX_ALLOWED_TIME) {\n                    // Stop if MAX_ALLOWED_TIME is reached\n                    toLineNumber = lineNumber - 1;\n                    break;\n                }\n                // Compute how many characters will be tokenized for this line\n                currentCharsToTokenize = this._lines[lineNumber - 1].text.length;\n                if (tokenizedChars > 0) {\n                    // If we have enough history, estimate how long tokenizing this line would take\n                    currentEstimatedTimeToTokenize = (elapsedTime / tokenizedChars) * currentCharsToTokenize;\n                    if (elapsedTime + currentEstimatedTimeToTokenize > MAX_ALLOWED_TIME) {\n                        // Tokenizing this line will go above MAX_ALLOWED_TIME\n                        toLineNumber = lineNumber - 1;\n                        break;\n                    }\n                }\n                this._updateTokensUntilLine(lineNumber, false);\n                tokenizedChars += currentCharsToTokenize;\n            }\n            elapsedTime = sw.elapsed();\n            if (fromLineNumber <= toLineNumber) {\n                this.emitModelTokensChangedEvent(fromLineNumber, toLineNumber);\n            }\n            if (this._invalidLineStartIndex < this._lines.length) {\n                this._beginBackgroundTokenization();\n            }\n            t1.stop();\n        };\n        TextModelWithTokens.prototype.getStateBeforeLine = function (lineNumber) {\n            this._updateTokensUntilLine(lineNumber - 1, true);\n            return this._lines[lineNumber - 1].getState();\n        };\n        TextModelWithTokens.prototype.getStateAfterLine = function (lineNumber) {\n            this._updateTokensUntilLine(lineNumber, true);\n            return lineNumber < this._lines.length ? this._lines[lineNumber].getState() : this._lastState;\n        };\n        TextModelWithTokens.prototype._getLineModeTransitions = function (lineNumber) {\n            if (lineNumber < 1 || lineNumber > this.getLineCount()) {\n                throw new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n            }\n            this._updateTokensUntilLine(lineNumber, true);\n            return this._lines[lineNumber - 1].getModeTransitions(this._mode);\n        };\n        TextModelWithTokens.prototype._updateTokensUntilLine = function (lineNumber, emitEvents) {\n            var linesLength = this._lines.length;\n            var endLineIndex = lineNumber - 1;\n            var stopLineTokenizationAfter = 1000000000; // 1 billion, if a line is so long, you have other trouble :).\n            var fromLineNumber = this._invalidLineStartIndex + 1, toLineNumber = lineNumber;\n            // Validate all states up to and including endLineIndex\n            for (var lineIndex = this._invalidLineStartIndex; lineIndex <= endLineIndex; lineIndex++) {\n                var endStateIndex = lineIndex + 1;\n                var r = null;\n                var text = this._lines[lineIndex].text;\n                if (this._mode.tokenizationSupport) {\n                    try {\n                        // Tokenize only the first X characters\n                        r = this._mode.tokenizationSupport.tokenize(this._lines[lineIndex].text, this._lines[lineIndex].getState(), 0, stopLineTokenizationAfter);\n                    }\n                    catch (e) {\n                        e.friendlyMessage = TextModelWithTokens.MODE_TOKENIZATION_FAILED_MSG;\n                        errors_1.onUnexpectedError(e);\n                    }\n                    if (r && r.retokenize) {\n                        this._retokenizers.push(this._createRetokenizer(r.retokenize, lineIndex + 1));\n                    }\n                    if (r && r.tokens && r.tokens.length > 0) {\n                        // Cannot have a stop offset before the last token\n                        r.actualStopOffset = Math.max(r.actualStopOffset, r.tokens[r.tokens.length - 1].startIndex + 1);\n                    }\n                    if (r && r.actualStopOffset < text.length) {\n                        // Treat the rest of the line (if above limit) as one default token\n                        r.tokens.push({\n                            startIndex: r.actualStopOffset,\n                            type: ''\n                        });\n                        // Use as end state the starting state\n                        r.endState = this._lines[lineIndex].getState();\n                    }\n                }\n                if (!r) {\n                    r = nullMode_1.nullTokenize(this._mode, text, this._lines[lineIndex].getState());\n                }\n                if (!r.modeTransitions) {\n                    r.modeTransitions = [];\n                }\n                if (r.modeTransitions.length === 0) {\n                    // Make sure there is at least the transition to the top-most mode\n                    r.modeTransitions.push({\n                        startIndex: 0,\n                        mode: this._mode\n                    });\n                }\n                this._updateLineTokens(lineIndex, this._tokensInflatorMap, this._mode, r);\n                if (this._lines[lineIndex].isInvalid) {\n                    this._lines[lineIndex].isInvalid = false;\n                }\n                if (endStateIndex < linesLength) {\n                    if (this._lines[endStateIndex].getState() !== null && r.endState.equals(this._lines[endStateIndex].getState())) {\n                        // The end state of this line remains the same\n                        var nextInvalidLineIndex = lineIndex + 1;\n                        while (nextInvalidLineIndex < linesLength) {\n                            if (this._lines[nextInvalidLineIndex].isInvalid) {\n                                break;\n                            }\n                            if (nextInvalidLineIndex + 1 < linesLength) {\n                                if (this._lines[nextInvalidLineIndex + 1].getState() === null) {\n                                    break;\n                                }\n                            }\n                            else {\n                                if (this._lastState === null) {\n                                    break;\n                                }\n                            }\n                            nextInvalidLineIndex++;\n                        }\n                        this._invalidLineStartIndex = Math.max(this._invalidLineStartIndex, nextInvalidLineIndex);\n                        lineIndex = nextInvalidLineIndex - 1; // -1 because the outer loop increments it\n                    }\n                    else {\n                        this._lines[endStateIndex].setState(r.endState);\n                    }\n                }\n                else {\n                    this._lastState = r.endState;\n                }\n            }\n            this._invalidLineStartIndex = Math.max(this._invalidLineStartIndex, endLineIndex + 1);\n            if (emitEvents && fromLineNumber <= toLineNumber) {\n                this.emitModelTokensChangedEvent(fromLineNumber, toLineNumber);\n            }\n        };\n        TextModelWithTokens.prototype.emitModelTokensChangedEvent = function (fromLineNumber, toLineNumber) {\n            var e = {\n                fromLineNumber: fromLineNumber,\n                toLineNumber: toLineNumber\n            };\n            if (!this._isDisposing) {\n                this.emit(editorCommon.EventType.ModelTokensChanged, e);\n            }\n        };\n        TextModelWithTokens.prototype._emitModelModeChangedEvent = function (e) {\n            if (!this._isDisposing) {\n                this.emit(editorCommon.EventType.ModelModeChanged, e);\n            }\n        };\n        TextModelWithTokens.prototype._emitModelModeSupportChangedEvent = function (e) {\n            if (!this._isDisposing) {\n                this.emit(editorCommon.EventType.ModelModeSupportChanged, e);\n            }\n        };\n        // Having tokens allows implementing additional helper methods\n        TextModelWithTokens.prototype._lineIsTokenized = function (lineNumber) {\n            return this._invalidLineStartIndex > lineNumber - 1;\n        };\n        TextModelWithTokens.prototype._getWordDefinition = function () {\n            return textModelWithTokensHelpers_1.WordHelper.massageWordDefinitionOf(this._mode);\n        };\n        TextModelWithTokens.prototype.getWordAtPosition = function (position) {\n            return textModelWithTokensHelpers_1.WordHelper.getWordAtPosition(this, this.validatePosition(position));\n        };\n        TextModelWithTokens.prototype.getWordUntilPosition = function (position) {\n            var wordAtPosition = this.getWordAtPosition(position);\n            if (!wordAtPosition) {\n                return {\n                    word: '',\n                    startColumn: position.column,\n                    endColumn: position.column\n                };\n            }\n            return {\n                word: wordAtPosition.word.substr(0, position.column - wordAtPosition.startColumn),\n                startColumn: wordAtPosition.startColumn,\n                endColumn: position.column\n            };\n        };\n        TextModelWithTokens.prototype.tokenIterator = function (position, callback) {\n            var iter = new tokenIterator_1.TokenIterator(this, this.validatePosition(position));\n            var result = callback(iter);\n            iter._invalidate();\n            return result;\n        };\n        TextModelWithTokens.prototype.findMatchingBracketUp = function (bracket, _position) {\n            var position = this.validatePosition(_position);\n            var modeTransitions = this._lines[position.lineNumber - 1].getModeTransitions(this._mode);\n            var currentModeIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n            var currentMode = modeTransitions[currentModeIndex];\n            var currentModeBrackets = languageConfigurationRegistry_1.LanguageConfigurationRegistry.getBracketsSupport(currentMode.modeId);\n            if (!currentModeBrackets) {\n                return null;\n            }\n            var data = currentModeBrackets.textIsBracket[bracket];\n            if (!data) {\n                return null;\n            }\n            return this._findMatchingBracketUp(data, position);\n        };\n        TextModelWithTokens.prototype.matchBracket = function (position) {\n            return this._matchBracket(this.validatePosition(position));\n        };\n        TextModelWithTokens.prototype._matchBracket = function (position) {\n            var lineNumber = position.lineNumber;\n            var lineText = this._lines[lineNumber - 1].text;\n            var lineTokens = this._lines[lineNumber - 1].getTokens();\n            var currentTokenIndex = lineTokens.findIndexOfOffset(position.column - 1);\n            var currentTokenStart = lineTokens.getTokenStartIndex(currentTokenIndex);\n            var modeTransitions = this._lines[lineNumber - 1].getModeTransitions(this._mode);\n            var currentModeIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n            var currentMode = modeTransitions[currentModeIndex];\n            var currentModeBrackets = languageConfigurationRegistry_1.LanguageConfigurationRegistry.getBracketsSupport(currentMode.modeId);\n            // If position is in between two tokens, try first looking in the previous token\n            if (currentTokenIndex > 0 && currentTokenStart === position.column - 1) {\n                var prevTokenIndex = currentTokenIndex - 1;\n                var prevTokenType = lineTokens.getTokenType(prevTokenIndex);\n                // check that previous token is not to be ignored\n                if (!supports_1.ignoreBracketsInToken(prevTokenType)) {\n                    var prevTokenStart = lineTokens.getTokenStartIndex(prevTokenIndex);\n                    var prevMode = currentMode;\n                    var prevModeBrackets = currentModeBrackets;\n                    // check if previous token is in a different mode\n                    if (currentModeIndex > 0 && currentMode.startIndex === position.column - 1) {\n                        prevMode = modeTransitions[currentModeIndex - 1];\n                        prevModeBrackets = languageConfigurationRegistry_1.LanguageConfigurationRegistry.getBracketsSupport(prevMode.modeId);\n                    }\n                    if (prevModeBrackets) {\n                        // limit search in case previous token is very large, there's no need to go beyond `maxBracketLength`\n                        prevTokenStart = Math.max(prevTokenStart, position.column - 1 - prevModeBrackets.maxBracketLength);\n                        var foundBracket = richEditBrackets_1.BracketsUtils.findPrevBracketInToken(prevModeBrackets.reversedRegex, lineNumber, lineText, prevTokenStart, currentTokenStart);\n                        // check that we didn't hit a bracket too far away from position\n                        if (foundBracket && foundBracket.startColumn <= position.column && position.column <= foundBracket.endColumn) {\n                            var foundBracketText = lineText.substring(foundBracket.startColumn - 1, foundBracket.endColumn - 1);\n                            var r = this._matchFoundBracket(foundBracket, prevModeBrackets.textIsBracket[foundBracketText], prevModeBrackets.textIsOpenBracket[foundBracketText]);\n                            // check that we can actually match this bracket\n                            if (r) {\n                                return r;\n                            }\n                        }\n                    }\n                }\n            }\n            // check that the token is not to be ignored\n            if (!supports_1.ignoreBracketsInToken(lineTokens.getTokenType(currentTokenIndex))) {\n                if (currentModeBrackets) {\n                    // limit search to not go before `maxBracketLength`\n                    currentTokenStart = Math.max(currentTokenStart, position.column - 1 - currentModeBrackets.maxBracketLength);\n                    // limit search to not go after `maxBracketLength`\n                    var currentTokenEnd = lineTokens.getTokenEndIndex(currentTokenIndex, lineText.length);\n                    currentTokenEnd = Math.min(currentTokenEnd, position.column - 1 + currentModeBrackets.maxBracketLength);\n                    // it might still be the case that [currentTokenStart -> currentTokenEnd] contains multiple brackets\n                    while (true) {\n                        var foundBracket = richEditBrackets_1.BracketsUtils.findNextBracketInText(currentModeBrackets.forwardRegex, lineNumber, lineText.substring(currentTokenStart, currentTokenEnd), currentTokenStart);\n                        if (!foundBracket) {\n                            // there are no brackets in this text\n                            break;\n                        }\n                        // check that we didn't hit a bracket too far away from position\n                        if (foundBracket.startColumn <= position.column && position.column <= foundBracket.endColumn) {\n                            var foundBracketText = lineText.substring(foundBracket.startColumn - 1, foundBracket.endColumn - 1);\n                            var r = this._matchFoundBracket(foundBracket, currentModeBrackets.textIsBracket[foundBracketText], currentModeBrackets.textIsOpenBracket[foundBracketText]);\n                            // check that we can actually match this bracket\n                            if (r) {\n                                return r;\n                            }\n                        }\n                        currentTokenStart = foundBracket.endColumn - 1;\n                    }\n                }\n            }\n            return null;\n        };\n        TextModelWithTokens.prototype._matchFoundBracket = function (foundBracket, data, isOpen) {\n            if (isOpen) {\n                var matched = this._findMatchingBracketDown(data, foundBracket.getEndPosition());\n                if (matched) {\n                    return [foundBracket, matched];\n                }\n            }\n            else {\n                var matched = this._findMatchingBracketUp(data, foundBracket.getStartPosition());\n                if (matched) {\n                    return [foundBracket, matched];\n                }\n            }\n            return null;\n        };\n        TextModelWithTokens.prototype._findMatchingBracketUp = function (bracket, position) {\n            // console.log('_findMatchingBracketUp: ', 'bracket: ', JSON.stringify(bracket), 'startPosition: ', String(position));\n            var modeId = bracket.modeId;\n            var reversedBracketRegex = bracket.reversedRegex;\n            var count = -1;\n            for (var lineNumber = position.lineNumber; lineNumber >= 1; lineNumber--) {\n                var lineTokens = this._lines[lineNumber - 1].getTokens();\n                var lineText = this._lines[lineNumber - 1].text;\n                var modeTransitions = this._lines[lineNumber - 1].getModeTransitions(this._mode);\n                var currentModeIndex = modeTransitions.length - 1;\n                var currentModeStart = modeTransitions[currentModeIndex].startIndex;\n                var currentModeId = modeTransitions[currentModeIndex].modeId;\n                var tokensLength = lineTokens.getTokenCount() - 1;\n                var currentTokenEnd = lineText.length;\n                if (lineNumber === position.lineNumber) {\n                    tokensLength = lineTokens.findIndexOfOffset(position.column - 1);\n                    currentTokenEnd = position.column - 1;\n                    currentModeIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n                    currentModeStart = modeTransitions[currentModeIndex].startIndex;\n                    currentModeId = modeTransitions[currentModeIndex].modeId;\n                }\n                for (var tokenIndex = tokensLength; tokenIndex >= 0; tokenIndex--) {\n                    var currentTokenType = lineTokens.getTokenType(tokenIndex);\n                    var currentTokenStart = lineTokens.getTokenStartIndex(tokenIndex);\n                    if (currentTokenStart < currentModeStart) {\n                        currentModeIndex--;\n                        currentModeStart = modeTransitions[currentModeIndex].startIndex;\n                        currentModeId = modeTransitions[currentModeIndex].modeId;\n                    }\n                    if (currentModeId === modeId && !supports_1.ignoreBracketsInToken(currentTokenType)) {\n                        while (true) {\n                            var r = richEditBrackets_1.BracketsUtils.findPrevBracketInToken(reversedBracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n                            if (!r) {\n                                break;\n                            }\n                            var hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1);\n                            if (hitText === bracket.open) {\n                                count++;\n                            }\n                            else if (hitText === bracket.close) {\n                                count--;\n                            }\n                            if (count === 0) {\n                                return r;\n                            }\n                            currentTokenEnd = r.startColumn - 1;\n                        }\n                    }\n                    currentTokenEnd = currentTokenStart;\n                }\n            }\n            return null;\n        };\n        TextModelWithTokens.prototype._findMatchingBracketDown = function (bracket, position) {\n            // console.log('_findMatchingBracketDown: ', 'bracket: ', JSON.stringify(bracket), 'startPosition: ', String(position));\n            var modeId = bracket.modeId;\n            var bracketRegex = bracket.forwardRegex;\n            var count = 1;\n            for (var lineNumber = position.lineNumber, lineCount = this.getLineCount(); lineNumber <= lineCount; lineNumber++) {\n                var lineTokens = this._lines[lineNumber - 1].getTokens();\n                var lineText = this._lines[lineNumber - 1].text;\n                var modeTransitions = this._lines[lineNumber - 1].getModeTransitions(this._mode);\n                var currentModeIndex = 0;\n                var nextModeStart = (currentModeIndex + 1 < modeTransitions.length ? modeTransitions[currentModeIndex + 1].startIndex : lineText.length + 1);\n                var currentModeId = modeTransitions[currentModeIndex].modeId;\n                var startTokenIndex = 0;\n                var currentTokenStart = lineTokens.getTokenStartIndex(startTokenIndex);\n                if (lineNumber === position.lineNumber) {\n                    startTokenIndex = lineTokens.findIndexOfOffset(position.column - 1);\n                    currentTokenStart = Math.max(currentTokenStart, position.column - 1);\n                    currentModeIndex = modeTransition_1.ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n                    nextModeStart = (currentModeIndex + 1 < modeTransitions.length ? modeTransitions[currentModeIndex + 1].startIndex : lineText.length + 1);\n                    currentModeId = modeTransitions[currentModeIndex].modeId;\n                }\n                for (var tokenIndex = startTokenIndex, tokensLength = lineTokens.getTokenCount(); tokenIndex < tokensLength; tokenIndex++) {\n                    var currentTokenType = lineTokens.getTokenType(tokenIndex);\n                    var currentTokenEnd = lineTokens.getTokenEndIndex(tokenIndex, lineText.length);\n                    if (currentTokenStart >= nextModeStart) {\n                        currentModeIndex++;\n                        nextModeStart = (currentModeIndex + 1 < modeTransitions.length ? modeTransitions[currentModeIndex + 1].startIndex : lineText.length + 1);\n                        currentModeId = modeTransitions[currentModeIndex].modeId;\n                    }\n                    if (currentModeId === modeId && !supports_1.ignoreBracketsInToken(currentTokenType)) {\n                        while (true) {\n                            var r = richEditBrackets_1.BracketsUtils.findNextBracketInToken(bracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n                            if (!r) {\n                                break;\n                            }\n                            var hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1);\n                            if (hitText === bracket.open) {\n                                count++;\n                            }\n                            else if (hitText === bracket.close) {\n                                count--;\n                            }\n                            if (count === 0) {\n                                return r;\n                            }\n                            currentTokenStart = r.endColumn - 1;\n                        }\n                    }\n                    currentTokenStart = currentTokenEnd;\n                }\n            }\n            return null;\n        };\n        TextModelWithTokens.prototype.findPrevBracket = function (_position) {\n            var position = this.validatePosition(_position);\n            var reversedBracketRegex = /[\\(\\)\\[\\]\\{\\}]/; // TODO@Alex: use mode's brackets\n            for (var lineNumber = position.lineNumber; lineNumber >= 1; lineNumber--) {\n                var lineTokens = this._lines[lineNumber - 1].getTokens();\n                var lineText = this._lines[lineNumber - 1].text;\n                var tokensLength = lineTokens.getTokenCount() - 1;\n                var currentTokenEnd = lineText.length;\n                if (lineNumber === position.lineNumber) {\n                    tokensLength = lineTokens.findIndexOfOffset(position.column - 1);\n                    currentTokenEnd = position.column - 1;\n                }\n                for (var tokenIndex = tokensLength; tokenIndex >= 0; tokenIndex--) {\n                    var currentTokenType = lineTokens.getTokenType(tokenIndex);\n                    var currentTokenStart = lineTokens.getTokenStartIndex(tokenIndex);\n                    if (!supports_1.ignoreBracketsInToken(currentTokenType)) {\n                        var r = richEditBrackets_1.BracketsUtils.findPrevBracketInToken(reversedBracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n                        if (r) {\n                            return this._toFoundBracket(r);\n                        }\n                    }\n                    currentTokenEnd = currentTokenStart;\n                }\n            }\n            return null;\n        };\n        TextModelWithTokens.prototype.findNextBracket = function (_position) {\n            var position = this.validatePosition(_position);\n            var bracketRegex = /[\\(\\)\\[\\]\\{\\}]/; // TODO@Alex: use mode's brackets\n            for (var lineNumber = position.lineNumber, lineCount = this.getLineCount(); lineNumber <= lineCount; lineNumber++) {\n                var lineTokens = this._lines[lineNumber - 1].getTokens();\n                var lineText = this._lines[lineNumber - 1].text;\n                var startTokenIndex = 0;\n                var currentTokenStart = lineTokens.getTokenStartIndex(startTokenIndex);\n                if (lineNumber === position.lineNumber) {\n                    startTokenIndex = lineTokens.findIndexOfOffset(position.column - 1);\n                    currentTokenStart = Math.max(currentTokenStart, position.column - 1);\n                }\n                for (var tokenIndex = startTokenIndex, tokensLength = lineTokens.getTokenCount(); tokenIndex < tokensLength; tokenIndex++) {\n                    var currentTokenType = lineTokens.getTokenType(tokenIndex);\n                    var currentTokenEnd = lineTokens.getTokenEndIndex(tokenIndex, lineText.length);\n                    if (!supports_1.ignoreBracketsInToken(currentTokenType)) {\n                        var r = richEditBrackets_1.BracketsUtils.findNextBracketInToken(bracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n                        if (r) {\n                            return this._toFoundBracket(r);\n                        }\n                    }\n                    currentTokenStart = currentTokenEnd;\n                }\n            }\n            return null;\n        };\n        TextModelWithTokens.prototype._toFoundBracket = function (r) {\n            if (!r) {\n                return null;\n            }\n            var text = this.getValueInRange(r);\n            // TODO@Alex: use mode's brackets\n            switch (text) {\n                case '(': return { range: r, open: '(', close: ')', isOpen: true };\n                case ')': return { range: r, open: '(', close: ')', isOpen: false };\n                case '[': return { range: r, open: '[', close: ']', isOpen: true };\n                case ']': return { range: r, open: '[', close: ']', isOpen: false };\n                case '{': return { range: r, open: '{', close: '}', isOpen: true };\n                case '}': return { range: r, open: '{', close: '}', isOpen: false };\n            }\n            return null;\n        };\n        TextModelWithTokens.MODE_TOKENIZATION_FAILED_MSG = nls.localize(0, null);\n        return TextModelWithTokens;\n    }(textModel_1.TextModel));\n    exports.TextModelWithTokens = TextModelWithTokens;\n});\n\n\n\n\n\n\ndefine(__m[72], __M([1,0,19,57,45,71,29,22]), function (require, exports, editorCommon, modelLine_1, textModel_1, textModelWithTokens_1, range_1, position_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var AbstractMirrorModel = (function (_super) {\n        __extends(AbstractMirrorModel, _super);\n        function AbstractMirrorModel(allowedEventTypes, versionId, value, mode, associatedResource) {\n            _super.call(this, allowedEventTypes.concat([editorCommon.EventType.ModelDispose]), value, false, mode);\n            this._setVersionId(versionId);\n            this._associatedResource = associatedResource;\n        }\n        AbstractMirrorModel.prototype.getModeId = function () {\n            return this.getMode().getId();\n        };\n        AbstractMirrorModel.prototype._constructLines = function (rawText) {\n            _super.prototype._constructLines.call(this, rawText);\n            // Force EOL to be \\n\n            this._EOL = '\\n';\n        };\n        AbstractMirrorModel.prototype.destroy = function () {\n            this.dispose();\n        };\n        AbstractMirrorModel.prototype.dispose = function () {\n            this.emit(editorCommon.EventType.ModelDispose);\n            _super.prototype.dispose.call(this);\n        };\n        Object.defineProperty(AbstractMirrorModel.prototype, \"uri\", {\n            get: function () {\n                return this._associatedResource;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        AbstractMirrorModel.prototype.getRangeFromOffsetAndLength = function (offset, length) {\n            var startPosition = this.getPositionAt(offset);\n            var endPosition = this.getPositionAt(offset + length);\n            return new range_1.Range(startPosition.lineNumber, startPosition.column, endPosition.lineNumber, endPosition.column);\n        };\n        AbstractMirrorModel.prototype.getOffsetAndLengthFromRange = function (range) {\n            var startOffset = this.getOffsetAt(new position_1.Position(range.startLineNumber, range.startColumn));\n            var endOffset = this.getOffsetAt(new position_1.Position(range.endLineNumber, range.endColumn));\n            return {\n                offset: startOffset,\n                length: endOffset - startOffset\n            };\n        };\n        AbstractMirrorModel.prototype.getPositionFromOffset = function (offset) {\n            return this.getPositionAt(offset);\n        };\n        AbstractMirrorModel.prototype.getOffsetFromPosition = function (position) {\n            return this.getOffsetAt(position);\n        };\n        AbstractMirrorModel.prototype.getLineStart = function (lineNumber) {\n            if (lineNumber < 1) {\n                lineNumber = 1;\n            }\n            if (lineNumber > this.getLineCount()) {\n                lineNumber = this.getLineCount();\n            }\n            return this.getOffsetAt(new position_1.Position(lineNumber, 1));\n        };\n        AbstractMirrorModel.prototype.getAllWordsWithRange = function () {\n            if (this._lines.length > 10000) {\n                // This is a very heavy method, unavailable for very heavy models\n                return [];\n            }\n            var result = [], i;\n            var toTextRange = function (info) {\n                var s = line.text.substring(info.start, info.end);\n                var r = { startLineNumber: i + 1, startColumn: info.start + 1, endLineNumber: i + 1, endColumn: info.end + 1 };\n                result.push({ text: s, range: r });\n            };\n            for (i = 0; i < this._lines.length; i++) {\n                var line = this._lines[i];\n                this.wordenize(line.text).forEach(toTextRange);\n            }\n            return result;\n        };\n        AbstractMirrorModel.prototype.getAllWords = function () {\n            var _this = this;\n            var result = [];\n            this._lines.forEach(function (line) {\n                _this.wordenize(line.text).forEach(function (info) {\n                    result.push(line.text.substring(info.start, info.end));\n                });\n            });\n            return result;\n        };\n        AbstractMirrorModel.prototype.getAllUniqueWords = function (skipWordOnce) {\n            var foundSkipWord = false;\n            var uniqueWords = {};\n            return this.getAllWords().filter(function (word) {\n                if (skipWordOnce && !foundSkipWord && skipWordOnce === word) {\n                    foundSkipWord = true;\n                    return false;\n                }\n                else if (uniqueWords[word]) {\n                    return false;\n                }\n                else {\n                    uniqueWords[word] = true;\n                    return true;\n                }\n            });\n        };\n        //\t// TODO@Joh, TODO@Alex - remove these and make sure the super-things work\n        AbstractMirrorModel.prototype.wordenize = function (content) {\n            var result = [];\n            var match;\n            var wordsRegexp = this._getWordDefinition();\n            while (match = wordsRegexp.exec(content)) {\n                result.push({ start: match.index, end: match.index + match[0].length });\n            }\n            return result;\n        };\n        return AbstractMirrorModel;\n    }(textModelWithTokens_1.TextModelWithTokens));\n    exports.AbstractMirrorModel = AbstractMirrorModel;\n    function createTestMirrorModelFromString(value, mode, associatedResource) {\n        if (mode === void 0) { mode = null; }\n        return new MirrorModel(0, textModel_1.TextModel.toRawText(value, textModel_1.TextModel.DEFAULT_CREATION_OPTIONS), mode, associatedResource);\n    }\n    exports.createTestMirrorModelFromString = createTestMirrorModelFromString;\n    var MirrorModel = (function (_super) {\n        __extends(MirrorModel, _super);\n        function MirrorModel(versionId, value, mode, associatedResource) {\n            _super.call(this, ['changed'], versionId, value, mode, associatedResource);\n        }\n        MirrorModel.prototype.onEvents = function (events) {\n            var changed = false;\n            for (var i = 0, len = events.contentChanged.length; i < len; i++) {\n                var contentChangedEvent = events.contentChanged[i];\n                this._setVersionId(contentChangedEvent.versionId);\n                switch (contentChangedEvent.changeType) {\n                    case editorCommon.EventType.ModelRawContentChangedFlush:\n                        this._onLinesFlushed(contentChangedEvent);\n                        changed = true;\n                        break;\n                    case editorCommon.EventType.ModelRawContentChangedLinesDeleted:\n                        this._onLinesDeleted(contentChangedEvent);\n                        changed = true;\n                        break;\n                    case editorCommon.EventType.ModelRawContentChangedLinesInserted:\n                        this._onLinesInserted(contentChangedEvent);\n                        changed = true;\n                        break;\n                    case editorCommon.EventType.ModelRawContentChangedLineChanged:\n                        this._onLineChanged(contentChangedEvent);\n                        changed = true;\n                        break;\n                }\n            }\n            if (changed) {\n                this.emit('changed', {});\n            }\n        };\n        MirrorModel.prototype._onLinesFlushed = function (e) {\n            // Flush my lines\n            this._constructLines(e.detail);\n            this._resetTokenizationState();\n        };\n        MirrorModel.prototype._onLineChanged = function (e) {\n            this._lines[e.lineNumber - 1].applyEdits({}, [{\n                    startColumn: 1,\n                    endColumn: Number.MAX_VALUE,\n                    text: e.detail,\n                    forceMoveMarkers: false\n                }]);\n            if (this._lineStarts) {\n                // update prefix sum\n                this._lineStarts.changeValue(e.lineNumber - 1, this._lines[e.lineNumber - 1].text.length + this._EOL.length);\n            }\n            this._invalidateLine(e.lineNumber - 1);\n        };\n        MirrorModel.prototype._onLinesDeleted = function (e) {\n            var fromLineIndex = e.fromLineNumber - 1, toLineIndex = e.toLineNumber - 1;\n            // Save first line's state\n            var firstLineState = this._lines[fromLineIndex].getState();\n            this._lines.splice(fromLineIndex, toLineIndex - fromLineIndex + 1);\n            if (this._lineStarts) {\n                // update prefix sum\n                this._lineStarts.removeValues(fromLineIndex, toLineIndex - fromLineIndex + 1);\n            }\n            if (fromLineIndex < this._lines.length) {\n                // This check is always true in real world, but the tests forced this\n                // Restore first line's state\n                this._lines[fromLineIndex].setState(firstLineState);\n                // Invalidate line\n                this._invalidateLine(fromLineIndex);\n            }\n        };\n        MirrorModel.prototype._onLinesInserted = function (e) {\n            var lineIndex, i, splitLines = e.detail.split('\\n');\n            var newLengths = [];\n            for (lineIndex = e.fromLineNumber - 1, i = 0; lineIndex < e.toLineNumber; lineIndex++, i++) {\n                this._lines.splice(lineIndex, 0, new modelLine_1.ModelLine(0, splitLines[i]));\n                newLengths.push(splitLines[i].length + this._EOL.length);\n            }\n            if (this._lineStarts) {\n                // update prefix sum\n                this._lineStarts.insertValues(e.fromLineNumber - 1, newLengths);\n            }\n            if (e.fromLineNumber >= 2) {\n                // This check is always true in real world, but the tests forced this\n                this._invalidateLine(e.fromLineNumber - 2);\n            }\n        };\n        return MirrorModel;\n    }(AbstractMirrorModel));\n    exports.MirrorModel = MirrorModel;\n});\n\ndefine(__m[73], __M([7,6]), function(nls, data) { return nls.create(\"vs/editor/common/modes/modesRegistry\", data); });\ndefine(__m[74], __M([7,6]), function(nls, data) { return nls.create(\"vs/editor/common/modes/supports/suggestSupport\", data); });\ndefine(__m[75], __M([7,6]), function(nls, data) { return nls.create(\"vs/editor/common/services/modeServiceImpl\", data); });\ndefine(__m[76], __M([7,6]), function(nls, data) { return nls.create(\"vs/platform/configuration/common/configurationRegistry\", data); });\ndefine(__m[77], __M([7,6]), function(nls, data) { return nls.create(\"vs/platform/extensions/common/abstractExtensionService\", data); });\ndefine(__m[78], __M([7,6]), function(nls, data) { return nls.create(\"vs/platform/extensions/common/extensionsRegistry\", data); });\ndefine(__m[79], __M([7,6]), function(nls, data) { return nls.create(\"vs/platform/jsonschemas/common/jsonContributionRegistry\", data); });\n\n\n\n\n\ndefine(__m[33], __M([1,0,2]), function (require, exports, errors_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var AbstractDescriptor = (function () {\n        function AbstractDescriptor(_staticArguments) {\n            this._staticArguments = _staticArguments;\n            // empty\n        }\n        AbstractDescriptor.prototype.appendStaticArguments = function (more) {\n            this._staticArguments.push.apply(this._staticArguments, more);\n        };\n        AbstractDescriptor.prototype.staticArguments = function (nth) {\n            if (isNaN(nth)) {\n                return this._staticArguments.slice(0);\n            }\n            else {\n                return this._staticArguments[nth];\n            }\n        };\n        AbstractDescriptor.prototype._validate = function (type) {\n            if (!type) {\n                throw errors_1.illegalArgument('can not be falsy');\n            }\n        };\n        return AbstractDescriptor;\n    }());\n    exports.AbstractDescriptor = AbstractDescriptor;\n    var SyncDescriptor = (function (_super) {\n        __extends(SyncDescriptor, _super);\n        function SyncDescriptor(_ctor) {\n            var staticArguments = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                staticArguments[_i - 1] = arguments[_i];\n            }\n            _super.call(this, staticArguments);\n            this._ctor = _ctor;\n        }\n        Object.defineProperty(SyncDescriptor.prototype, \"ctor\", {\n            get: function () {\n                return this._ctor;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        SyncDescriptor.prototype.bind = function () {\n            var moreStaticArguments = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                moreStaticArguments[_i - 0] = arguments[_i];\n            }\n            var allArgs = [];\n            allArgs = allArgs.concat(this.staticArguments());\n            allArgs = allArgs.concat(moreStaticArguments);\n            return new (SyncDescriptor.bind.apply(SyncDescriptor, [void 0].concat([this._ctor], allArgs)))();\n        };\n        return SyncDescriptor;\n    }(AbstractDescriptor));\n    exports.SyncDescriptor = SyncDescriptor;\n    exports.createSyncDescriptor = function (ctor) {\n        var staticArguments = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            staticArguments[_i - 1] = arguments[_i];\n        }\n        return new (SyncDescriptor.bind.apply(SyncDescriptor, [void 0].concat([ctor], staticArguments)))();\n    };\n    var AsyncDescriptor = (function (_super) {\n        __extends(AsyncDescriptor, _super);\n        function AsyncDescriptor(_moduleName, _ctorName) {\n            var staticArguments = [];\n            for (var _i = 2; _i < arguments.length; _i++) {\n                staticArguments[_i - 2] = arguments[_i];\n            }\n            _super.call(this, staticArguments);\n            this._moduleName = _moduleName;\n            this._ctorName = _ctorName;\n            if (typeof _moduleName !== 'string') {\n                throw new Error('Invalid AsyncDescriptor arguments, expected `moduleName` to be a string!');\n            }\n        }\n        AsyncDescriptor.create = function (moduleName, ctorName) {\n            return new AsyncDescriptor(moduleName, ctorName);\n        };\n        Object.defineProperty(AsyncDescriptor.prototype, \"moduleName\", {\n            get: function () {\n                return this._moduleName;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(AsyncDescriptor.prototype, \"ctorName\", {\n            get: function () {\n                return this._ctorName;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        AsyncDescriptor.prototype.bind = function () {\n            var moreStaticArguments = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                moreStaticArguments[_i - 0] = arguments[_i];\n            }\n            var allArgs = [];\n            allArgs = allArgs.concat(this.staticArguments());\n            allArgs = allArgs.concat(moreStaticArguments);\n            return new (AsyncDescriptor.bind.apply(AsyncDescriptor, [void 0].concat([this.moduleName, this.ctorName], allArgs)))();\n        };\n        return AsyncDescriptor;\n    }(AbstractDescriptor));\n    exports.AsyncDescriptor = AsyncDescriptor;\n    var _createAsyncDescriptor = function (moduleName, ctorName) {\n        var staticArguments = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            staticArguments[_i - 2] = arguments[_i];\n        }\n        return new (AsyncDescriptor.bind.apply(AsyncDescriptor, [void 0].concat([moduleName, ctorName], staticArguments)))();\n    };\n    exports.createAsyncDescriptor0 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor1 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor2 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor3 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor4 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor5 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor6 = _createAsyncDescriptor;\n    exports.createAsyncDescriptor7 = _createAsyncDescriptor;\n});\n\ndefine(__m[4], __M([1,0]), function (require, exports) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // ------ internal util\n    var _util;\n    (function (_util) {\n        _util.DI_TARGET = '$di$target';\n        _util.DI_DEPENDENCIES = '$di$dependencies';\n        function getServiceDependencies(ctor) {\n            return ctor[_util.DI_DEPENDENCIES] || [];\n        }\n        _util.getServiceDependencies = getServiceDependencies;\n    })(_util = exports._util || (exports._util = {}));\n    exports.IInstantiationService = createDecorator('instantiationService');\n    function storeServiceDependency(id, target, index, optional) {\n        if (target[_util.DI_TARGET] === target) {\n            target[_util.DI_DEPENDENCIES].push({ id: id, index: index, optional: optional });\n        }\n        else {\n            target[_util.DI_DEPENDENCIES] = [{ id: id, index: index, optional: optional }];\n            target[_util.DI_TARGET] = target;\n        }\n    }\n    /**\n     * A *only* valid way to create a {{ServiceIdentifier}}.\n     */\n    function createDecorator(serviceId) {\n        var id = function (target, key, index) {\n            if (arguments.length !== 3) {\n                throw new Error('@IServiceName-decorator can only be used to decorate a parameter');\n            }\n            storeServiceDependency(id, target, index, false);\n        };\n        id.toString = function () { return serviceId; };\n        return id;\n    }\n    exports.createDecorator = createDecorator;\n    /**\n     * Mark a service dependency as optional.\n     */\n    function optional(serviceIdentifier) {\n        return function (target, key, index) {\n            if (arguments.length !== 3) {\n                throw new Error('@optional-decorator can only be used to decorate a parameter');\n            }\n            storeServiceDependency(serviceIdentifier, target, index, true);\n        };\n    }\n    exports.optional = optional;\n});\n\ndefine(__m[35], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.ICompatWorkerService = instantiation_1.createDecorator('compatWorkerService');\n    function findMember(proto, target) {\n        for (var i in proto) {\n            if (proto[i] === target) {\n                return i;\n            }\n        }\n        throw new Error('Member not found in prototype');\n    }\n    function CompatWorkerAttr(type, target) {\n        var methodName = findMember(type.prototype, target);\n        type.prototype[methodName] = function () {\n            var param = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                param[_i - 0] = arguments[_i];\n            }\n            var obj = this;\n            return obj.compatWorkerService.CompatWorker(obj, methodName, target, param);\n        };\n    }\n    exports.CompatWorkerAttr = CompatWorkerAttr;\n});\n\ndefine(__m[83], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.ID_EDITOR_WORKER_SERVICE = 'editorWorkerService';\n    exports.IEditorWorkerService = instantiation_1.createDecorator(exports.ID_EDITOR_WORKER_SERVICE);\n});\n\ndefine(__m[23], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.IModeService = instantiation_1.createDecorator('modeService');\n});\n\ndefine(__m[85], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.IModelService = instantiation_1.createDecorator('modelService');\n});\n\ndefine(__m[37], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // Resource Service\n    exports.ResourceEvents = {\n        ADDED: 'resource.added',\n        REMOVED: 'resource.removed',\n        CHANGED: 'resource.changed'\n    };\n    exports.IResourceService = instantiation_1.createDecorator('resourceService');\n});\n\n\n\n\n\n\ndefine(__m[87], __M([1,0,15,16,37]), function (require, exports, eventEmitter_1, lifecycle_1, resourceService_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var ResourceService = (function (_super) {\n        __extends(ResourceService, _super);\n        function ResourceService() {\n            _super.call(this);\n            this.serviceId = resourceService_1.IResourceService;\n            this.data = {};\n            this.unbinds = {};\n        }\n        ResourceService.prototype.addListener2_ = function (eventType, listener) {\n            return _super.prototype.addListener2.call(this, eventType, listener);\n        };\n        ResourceService.prototype._anonymousModelId = function (input) {\n            var r = '';\n            for (var i = 0; i < input.length; i++) {\n                var ch = input[i];\n                if (ch >= '0' && ch <= '9') {\n                    r += '0';\n                    continue;\n                }\n                if (ch >= 'a' && ch <= 'z') {\n                    r += 'a';\n                    continue;\n                }\n                if (ch >= 'A' && ch <= 'Z') {\n                    r += 'A';\n                    continue;\n                }\n                r += ch;\n            }\n            return r;\n        };\n        ResourceService.prototype.insert = function (url, element) {\n            var _this = this;\n            // console.log('INSERT: ' + url.toString());\n            if (this.contains(url)) {\n                // There already exists a model with this id => this is a programmer error\n                throw new Error('ResourceService: Cannot add model ' + this._anonymousModelId(url.toString()) + ' because it already exists!');\n            }\n            // add resource\n            var key = url.toString();\n            this.data[key] = element;\n            this.unbinds[key] = [];\n            this.unbinds[key].push(element.addBulkListener2(function (value) {\n                _this.emit(resourceService_1.ResourceEvents.CHANGED, { url: url, originalEvents: value });\n            }));\n            // event\n            this.emit(resourceService_1.ResourceEvents.ADDED, { url: url, addedElement: element });\n        };\n        ResourceService.prototype.get = function (url) {\n            if (!this.data[url.toString()]) {\n                return null;\n            }\n            return this.data[url.toString()];\n        };\n        ResourceService.prototype.all = function () {\n            var _this = this;\n            return Object.keys(this.data).map(function (key) {\n                return _this.data[key];\n            });\n        };\n        ResourceService.prototype.contains = function (url) {\n            return !!this.data[url.toString()];\n        };\n        ResourceService.prototype.remove = function (url) {\n            // console.log('REMOVE: ' + url.toString());\n            if (!this.contains(url)) {\n                return;\n            }\n            var key = url.toString(), element = this.data[key];\n            // stop listen\n            this.unbinds[key] = lifecycle_1.dispose(this.unbinds[key]);\n            // removal\n            delete this.unbinds[key];\n            delete this.data[key];\n            // event\n            this.emit(resourceService_1.ResourceEvents.REMOVED, { url: url, removedElement: element });\n        };\n        return ResourceService;\n    }(eventEmitter_1.EventEmitter));\n    exports.ResourceService = ResourceService;\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[51], __M([1,0,4]), function (require, exports, instantiation_1) {\n    \"use strict\";\n    exports.IConfigurationService = instantiation_1.createDecorator('configurationService');\n    function getConfigurationValue(config, settingPath, defaultValue) {\n        function accessSetting(config, path) {\n            var current = config;\n            for (var i = 0; i < path.length; i++) {\n                current = current[path[i]];\n                if (!current) {\n                    return undefined;\n                }\n            }\n            return current;\n        }\n        var path = settingPath.split('.');\n        var result = accessSetting(config, path);\n        return typeof result === 'undefined'\n            ? defaultValue\n            : result;\n    }\n    exports.getConfigurationValue = getConfigurationValue;\n});\n\ndefine(__m[52], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.IEventService = instantiation_1.createDecorator('eventService');\n});\n\n\n\n\n\n\ndefine(__m[90], __M([1,0,15,52]), function (require, exports, eventEmitter_1, event_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // --- implementation ------------------------------------------\n    var EventService = (function (_super) {\n        __extends(EventService, _super);\n        function EventService() {\n            _super.call(this);\n            this.serviceId = event_1.IEventService;\n        }\n        return EventService;\n    }(eventEmitter_1.EventEmitter));\n    exports.EventService = EventService;\n});\n\ndefine(__m[38], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.IExtensionService = instantiation_1.createDecorator('extensionService');\n});\n\ndefine(__m[54], __M([1,0,58]), function (require, exports, arrays_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var ServiceCollection = (function () {\n        function ServiceCollection() {\n            var entries = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                entries[_i - 0] = arguments[_i];\n            }\n            this._entries = [];\n            for (var _c = 0, entries_1 = entries; _c < entries_1.length; _c++) {\n                var entry = entries_1[_c];\n                this.set(entry[0], entry[1]);\n            }\n        }\n        ServiceCollection.prototype.set = function (id, instanceOrDescriptor) {\n            var entry = [id, instanceOrDescriptor];\n            var idx = arrays_1.binarySearch(this._entries, entry, ServiceCollection._entryCompare);\n            if (idx < 0) {\n                // new element\n                this._entries.splice(~idx, 0, entry);\n            }\n            else {\n                var old = this._entries[idx];\n                this._entries[idx] = entry;\n                return old[1];\n            }\n        };\n        ServiceCollection.prototype.forEach = function (callback) {\n            for (var _i = 0, _c = this._entries; _i < _c.length; _i++) {\n                var entry = _c[_i];\n                var id = entry[0], instanceOrDescriptor = entry[1];\n                callback(id, instanceOrDescriptor);\n            }\n        };\n        ServiceCollection.prototype.has = function (id) {\n            return arrays_1.binarySearch(this._entries, ServiceCollection._searchEntry(id), ServiceCollection._entryCompare) >= 0;\n        };\n        ServiceCollection.prototype.get = function (id) {\n            var idx = arrays_1.binarySearch(this._entries, ServiceCollection._searchEntry(id), ServiceCollection._entryCompare);\n            if (idx >= 0) {\n                return this._entries[idx][1];\n            }\n        };\n        ServiceCollection._searchEntry = function (id) {\n            ServiceCollection._dummy[0] = id;\n            return ServiceCollection._dummy;\n        };\n        ServiceCollection._entryCompare = function (a, b) {\n            var _a = a[0].toString();\n            var _b = b[0].toString();\n            if (_a < _b) {\n                return -1;\n            }\n            else if (_a > _b) {\n                return 1;\n            }\n            else {\n                return 0;\n            }\n        };\n        ServiceCollection._dummy = [undefined, undefined];\n        return ServiceCollection;\n    }());\n    exports.ServiceCollection = ServiceCollection;\n});\n\ndefine(__m[93], __M([1,0,5,2,9,34,86,33,4,54]), function (require, exports, winjs_base_1, errors_1, types_1, assert, graph_1, descriptors_1, instantiation_1, serviceCollection_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var InstantiationService = (function () {\n        function InstantiationService(services, strict) {\n            if (services === void 0) { services = new serviceCollection_1.ServiceCollection(); }\n            if (strict === void 0) { strict = false; }\n            this._services = services;\n            this._strict = strict;\n            this._services.set(instantiation_1.IInstantiationService, this);\n        }\n        InstantiationService.prototype.createChild = function (services) {\n            var _this = this;\n            this._services.forEach(function (id, thing) {\n                if (services.has(id)) {\n                    return;\n                }\n                // If we copy descriptors we might end up with\n                // multiple instances of the same service\n                if (thing instanceof descriptors_1.SyncDescriptor) {\n                    thing = _this._createAndCacheServiceInstance(id, thing);\n                }\n                services.set(id, thing);\n            });\n            return new InstantiationService(services, this._strict);\n        };\n        InstantiationService.prototype.invokeFunction = function (signature) {\n            var _this = this;\n            var args = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                args[_i - 1] = arguments[_i];\n            }\n            var accessor;\n            try {\n                accessor = {\n                    get: function (id, isOptional) {\n                        var result = _this._getOrCreateServiceInstance(id);\n                        if (!result && isOptional !== instantiation_1.optional) {\n                            throw new Error(\"[invokeFunction] unkown service '\" + id + \"'\");\n                        }\n                        return result;\n                    }\n                };\n                return signature.apply(undefined, [accessor].concat(args));\n            }\n            finally {\n                accessor.get = function () {\n                    throw errors_1.illegalState('service accessor is only valid during the invocation of its target method');\n                };\n            }\n        };\n        InstantiationService.prototype.createInstance = function (param) {\n            var rest = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                rest[_i - 1] = arguments[_i];\n            }\n            if (param instanceof descriptors_1.AsyncDescriptor) {\n                // async\n                return this._createInstanceAsync(param, rest);\n            }\n            else if (param instanceof descriptors_1.SyncDescriptor) {\n                // sync\n                return this._createInstance(param, rest);\n            }\n            else {\n                // sync, just ctor\n                return this._createInstance(new descriptors_1.SyncDescriptor(param), rest);\n            }\n        };\n        InstantiationService.prototype._createInstanceAsync = function (descriptor, args) {\n            var _this = this;\n            var canceledError;\n            return new winjs_base_1.TPromise(function (c, e, p) {\n                require([descriptor.moduleName], function (_module) {\n                    if (canceledError) {\n                        e(canceledError);\n                    }\n                    if (!_module) {\n                        return e(errors_1.illegalArgument('module not found: ' + descriptor.moduleName));\n                    }\n                    var ctor;\n                    if (!descriptor.ctorName) {\n                        ctor = _module;\n                    }\n                    else {\n                        ctor = _module[descriptor.ctorName];\n                    }\n                    if (typeof ctor !== 'function') {\n                        return e(errors_1.illegalArgument('not a function: ' + descriptor.ctorName || descriptor.moduleName));\n                    }\n                    try {\n                        args.unshift.apply(args, descriptor.staticArguments()); // instead of spread in ctor call\n                        c(_this._createInstance(new descriptors_1.SyncDescriptor(ctor), args));\n                    }\n                    catch (error) {\n                        return e(error);\n                    }\n                }, e);\n            }, function () {\n                canceledError = errors_1.canceled();\n            });\n        };\n        InstantiationService.prototype._createInstance = function (desc, args) {\n            var _this = this;\n            // arguments given by createInstance-call and/or the descriptor\n            var staticArgs = desc.staticArguments().concat(args);\n            // arguments defined by service decorators\n            var serviceDependencies = instantiation_1._util.getServiceDependencies(desc.ctor).sort(function (a, b) { return a.index - b.index; });\n            var serviceArgs = serviceDependencies.map(function (dependency) {\n                var service = _this._getOrCreateServiceInstance(dependency.id);\n                if (!service && _this._strict && !dependency.optional) {\n                    throw new Error(\"[createInstance] \" + desc.ctor.name + \" depends on UNKNOWN service \" + dependency.id + \".\");\n                }\n                return service;\n            });\n            var firstServiceArgPos = serviceDependencies.length > 0 ? serviceDependencies[0].index : staticArgs.length;\n            // check for argument mismatches, adjust static args if needed\n            if (staticArgs.length !== firstServiceArgPos) {\n                console.warn(\"[createInstance] First service dependency of \" + desc.ctor.name + \" at position \" + (firstServiceArgPos + 1) + \" conflicts with \" + staticArgs.length + \" static arguments\");\n                var delta = firstServiceArgPos - staticArgs.length;\n                if (delta > 0) {\n                    staticArgs = staticArgs.concat(new Array(delta));\n                }\n                else {\n                    staticArgs = staticArgs.slice(0, firstServiceArgPos);\n                }\n            }\n            // // check for missing args\n            // for (let i = 0; i < serviceArgs.length; i++) {\n            // \tif (!serviceArgs[i]) {\n            // \t\tconsole.warn(`${desc.ctor.name} MISSES service dependency ${serviceDependencies[i].id}`, new Error().stack);\n            // \t}\n            // }\n            // now create the instance\n            var argArray = [desc.ctor];\n            argArray.push.apply(argArray, staticArgs);\n            argArray.push.apply(argArray, serviceArgs);\n            var instance = types_1.create.apply(null, argArray);\n            desc._validate(instance);\n            return instance;\n        };\n        InstantiationService.prototype._getOrCreateServiceInstance = function (id) {\n            var thing = this._services.get(id);\n            if (thing instanceof descriptors_1.SyncDescriptor) {\n                return this._createAndCacheServiceInstance(id, thing);\n            }\n            else {\n                return thing;\n            }\n        };\n        InstantiationService.prototype._createAndCacheServiceInstance = function (id, desc) {\n            assert.ok(this._services.get(id) instanceof descriptors_1.SyncDescriptor);\n            var graph = new graph_1.Graph(function (data) { return data.id.toString(); });\n            function throwCycleError() {\n                var err = new Error('[createInstance] cyclic dependency between services');\n                err.message = graph.toString();\n                throw err;\n            }\n            var count = 0;\n            var stack = [{ id: id, desc: desc }];\n            while (stack.length) {\n                var item = stack.pop();\n                graph.lookupOrInsertNode(item);\n                // TODO@joh use the graph to find a cycle\n                // a weak heuristic for cycle checks\n                if (count++ > 100) {\n                    throwCycleError();\n                }\n                // check all dependencies for existence and if the need to be created first\n                var dependencies = instantiation_1._util.getServiceDependencies(item.desc.ctor);\n                for (var _i = 0, dependencies_1 = dependencies; _i < dependencies_1.length; _i++) {\n                    var dependency = dependencies_1[_i];\n                    var instanceOrDesc = this._services.get(dependency.id);\n                    if (!instanceOrDesc) {\n                        console.warn(\"[createInstance] \" + id + \" depends on \" + dependency.id + \" which is NOT registered.\");\n                    }\n                    if (instanceOrDesc instanceof descriptors_1.SyncDescriptor) {\n                        var d = { id: dependency.id, desc: instanceOrDesc };\n                        graph.insertEdge(item, d);\n                        stack.push(d);\n                    }\n                }\n            }\n            while (true) {\n                var roots = graph.roots();\n                // if there is no more roots but still\n                // nodes in the graph we have a cycle\n                if (roots.length === 0) {\n                    if (graph.length !== 0) {\n                        throwCycleError();\n                    }\n                    break;\n                }\n                for (var _a = 0, roots_1 = roots; _a < roots_1.length; _a++) {\n                    var root = roots_1[_a];\n                    // create instance and overwrite the service collections\n                    var instance = this._createInstance(root.data.desc, []);\n                    this._services.set(root.data.id, instance);\n                    graph.removeNode(root.data);\n                }\n            }\n            return this._services.get(id);\n        };\n        return InstantiationService;\n    }());\n    exports.InstantiationService = InstantiationService;\n});\n\ndefine(__m[11], __M([1,0,9,34]), function (require, exports, Types, Assert) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var RegistryImpl = (function () {\n        function RegistryImpl() {\n            this.data = {};\n        }\n        RegistryImpl.prototype.add = function (id, data) {\n            Assert.ok(Types.isString(id));\n            Assert.ok(Types.isObject(data));\n            Assert.ok(!this.data.hasOwnProperty(id), 'There is already an extension with this id');\n            this.data[id] = data;\n        };\n        RegistryImpl.prototype.knows = function (id) {\n            return this.data.hasOwnProperty(id);\n        };\n        RegistryImpl.prototype.as = function (id) {\n            return this.data[id] || null;\n        };\n        return RegistryImpl;\n    }());\n    exports.Registry = new RegistryImpl();\n    /**\n     * A base class for registries that leverage the instantiation service to create instances.\n     */\n    var BaseRegistry = (function () {\n        function BaseRegistry() {\n            this.toBeInstantiated = [];\n            this.instances = [];\n        }\n        BaseRegistry.prototype.setInstantiationService = function (service) {\n            this.instantiationService = service;\n            while (this.toBeInstantiated.length > 0) {\n                var entry = this.toBeInstantiated.shift();\n                this.instantiate(entry);\n            }\n        };\n        BaseRegistry.prototype.instantiate = function (ctor) {\n            var instance = this.instantiationService.createInstance(ctor);\n            this.instances.push(instance);\n        };\n        BaseRegistry.prototype._register = function (ctor) {\n            if (this.instantiationService) {\n                this.instantiate(ctor);\n            }\n            else {\n                this.toBeInstantiated.push(ctor);\n            }\n        };\n        BaseRegistry.prototype._getInstances = function () {\n            return this.instances.slice(0);\n        };\n        BaseRegistry.prototype._setInstances = function (instances) {\n            this.instances = instances;\n        };\n        return BaseRegistry;\n    }());\n    exports.BaseRegistry = BaseRegistry;\n});\n\ndefine(__m[40], __M([1,0,73,8,11]), function (require, exports, nls, event_1, platform_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    // Define extension point ids\n    exports.Extensions = {\n        ModesRegistry: 'editor.modesRegistry'\n    };\n    var EditorModesRegistry = (function () {\n        function EditorModesRegistry() {\n            this._onDidAddCompatModes = new event_1.Emitter();\n            this.onDidAddCompatModes = this._onDidAddCompatModes.event;\n            this._onDidAddLanguages = new event_1.Emitter();\n            this.onDidAddLanguages = this._onDidAddLanguages.event;\n            this._compatModes = [];\n            this._languages = [];\n        }\n        // --- compat modes\n        EditorModesRegistry.prototype.registerCompatModes = function (def) {\n            this._compatModes = this._compatModes.concat(def);\n            this._onDidAddCompatModes.fire(def);\n        };\n        EditorModesRegistry.prototype.registerCompatMode = function (def) {\n            this._compatModes.push(def);\n            this._onDidAddCompatModes.fire([def]);\n        };\n        EditorModesRegistry.prototype.getCompatModes = function () {\n            return this._compatModes.slice(0);\n        };\n        // --- languages\n        EditorModesRegistry.prototype.registerLanguage = function (def) {\n            this._languages.push(def);\n            this._onDidAddLanguages.fire([def]);\n        };\n        EditorModesRegistry.prototype.registerLanguages = function (def) {\n            this._languages = this._languages.concat(def);\n            this._onDidAddLanguages.fire(def);\n        };\n        EditorModesRegistry.prototype.getLanguages = function () {\n            return this._languages.slice(0);\n        };\n        return EditorModesRegistry;\n    }());\n    exports.EditorModesRegistry = EditorModesRegistry;\n    exports.ModesRegistry = new EditorModesRegistry();\n    platform_1.Registry.add(exports.Extensions.ModesRegistry, exports.ModesRegistry);\n    exports.ModesRegistry.registerLanguage({\n        id: 'plaintext',\n        extensions: ['.txt', '.gitignore'],\n        aliases: [nls.localize(0, null), 'text'],\n        mimetypes: ['text/plain']\n    });\n});\n\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\ndefine(__m[96], __M([1,0,5,35,37,23,72,2,40]), function (require, exports, winjs_base_1, compatWorkerService_1, resourceService_1, modeService_1, mirrorModel_1, errors_1, modesRegistry_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var CompatWorkerServiceWorker = (function () {\n        function CompatWorkerServiceWorker(resourceService, modeService, modesRegistryData) {\n            this.resourceService = resourceService;\n            this.modeService = modeService;\n            this.serviceId = compatWorkerService_1.ICompatWorkerService;\n            this.isInMainThread = false;\n            modesRegistry_1.ModesRegistry.registerCompatModes(modesRegistryData.compatModes);\n            modesRegistry_1.ModesRegistry.registerLanguages(modesRegistryData.languages);\n            this._compatModes = Object.create(null);\n        }\n        CompatWorkerServiceWorker.prototype.registerCompatMode = function (compatMode) {\n            this._compatModes[compatMode.getId()] = compatMode;\n        };\n        CompatWorkerServiceWorker.prototype.handleMainRequest = function (rpcId, methodName, args) {\n            if (rpcId === '$') {\n                switch (methodName) {\n                    case 'acceptNewModel':\n                        return this._acceptNewModel(args[0]);\n                    case 'acceptDidDisposeModel':\n                        return this._acceptDidDisposeModel(args[0]);\n                    case 'acceptModelEvents':\n                        return this._acceptModelEvents(args[0], args[1]);\n                    case 'acceptCompatModes':\n                        return this._acceptCompatModes(args[0]);\n                    case 'acceptLanguages':\n                        return this._acceptLanguages(args[0]);\n                    case 'instantiateCompatMode':\n                        return this._instantiateCompatMode(args[0]);\n                }\n            }\n            var obj = this._compatModes[rpcId];\n            return winjs_base_1.TPromise.as(obj[methodName].apply(obj, args));\n        };\n        CompatWorkerServiceWorker.prototype.CompatWorker = function (obj, methodName, target, param) {\n            return target.apply(obj, param);\n        };\n        CompatWorkerServiceWorker.prototype._acceptNewModel = function (data) {\n            var _this = this;\n            // Create & insert the mirror model eagerly in the resource service\n            var mirrorModel = new mirrorModel_1.MirrorModel(data.versionId, data.value, null, data.url);\n            this.resourceService.insert(mirrorModel.uri, mirrorModel);\n            // Block worker execution until the mode is instantiated\n            return this.modeService.getOrCreateMode(data.modeId).then(function (mode) {\n                // Changing mode should trigger a remove & an add, therefore:\n                // (1) Remove from resource service\n                _this.resourceService.remove(mirrorModel.uri);\n                // (2) Change mode\n                mirrorModel.setMode(mode);\n                // (3) Insert again to resource service (it will have the new mode)\n                _this.resourceService.insert(mirrorModel.uri, mirrorModel);\n            });\n        };\n        CompatWorkerServiceWorker.prototype._acceptDidDisposeModel = function (uri) {\n            var model = this.resourceService.get(uri);\n            this.resourceService.remove(uri);\n            model.dispose();\n        };\n        CompatWorkerServiceWorker.prototype._acceptModelEvents = function (uri, events) {\n            var model = this.resourceService.get(uri);\n            try {\n                model.onEvents(events);\n            }\n            catch (err) {\n                errors_1.onUnexpectedError(err);\n            }\n        };\n        CompatWorkerServiceWorker.prototype._acceptCompatModes = function (modes) {\n            modesRegistry_1.ModesRegistry.registerCompatModes(modes);\n        };\n        CompatWorkerServiceWorker.prototype._acceptLanguages = function (languages) {\n            modesRegistry_1.ModesRegistry.registerLanguages(languages);\n        };\n        CompatWorkerServiceWorker.prototype._instantiateCompatMode = function (modeId) {\n            return this.modeService.getOrCreateMode(modeId).then(function (_) { return void 0; });\n        };\n        CompatWorkerServiceWorker = __decorate([\n            __param(0, resourceService_1.IResourceService),\n            __param(1, modeService_1.IModeService)\n        ], CompatWorkerServiceWorker);\n        return CompatWorkerServiceWorker;\n    }());\n    exports.CompatWorkerServiceWorker = CompatWorkerServiceWorker;\n});\n\ndefine(__m[97], __M([1,0,2,8,46,3,40]), function (require, exports, errors_1, event_1, mime, strings, modesRegistry_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var hasOwnProperty = Object.prototype.hasOwnProperty;\n    var LanguagesRegistry = (function () {\n        function LanguagesRegistry(useModesRegistry) {\n            var _this = this;\n            if (useModesRegistry === void 0) { useModesRegistry = true; }\n            this._onDidAddModes = new event_1.Emitter();\n            this.onDidAddModes = this._onDidAddModes.event;\n            this.knownModeIds = {};\n            this.mime2LanguageId = {};\n            this.name2LanguageId = {};\n            this.id2Name = {};\n            this.id2Extensions = {};\n            this.compatModes = {};\n            this.lowerName2Id = {};\n            this.id2ConfigurationFiles = {};\n            if (useModesRegistry) {\n                this._registerCompatModes(modesRegistry_1.ModesRegistry.getCompatModes());\n                modesRegistry_1.ModesRegistry.onDidAddCompatModes(function (m) { return _this._registerCompatModes(m); });\n                this._registerLanguages(modesRegistry_1.ModesRegistry.getLanguages());\n                modesRegistry_1.ModesRegistry.onDidAddLanguages(function (m) { return _this._registerLanguages(m); });\n            }\n        }\n        LanguagesRegistry.prototype._registerCompatModes = function (defs) {\n            var addedModes = [];\n            for (var i = 0; i < defs.length; i++) {\n                var def = defs[i];\n                this._registerLanguage({\n                    id: def.id,\n                    extensions: def.extensions,\n                    filenames: def.filenames,\n                    firstLine: def.firstLine,\n                    aliases: def.aliases,\n                    mimetypes: def.mimetypes\n                });\n                this.compatModes[def.id] = {\n                    moduleId: def.moduleId,\n                    ctorName: def.ctorName,\n                    deps: def.deps\n                };\n                addedModes.push(def.id);\n            }\n            this._onDidAddModes.fire(addedModes);\n        };\n        LanguagesRegistry.prototype._registerLanguages = function (desc) {\n            var addedModes = [];\n            for (var i = 0; i < desc.length; i++) {\n                this._registerLanguage(desc[i]);\n                addedModes.push(desc[i].id);\n            }\n            this._onDidAddModes.fire(addedModes);\n        };\n        LanguagesRegistry.prototype._setLanguageName = function (languageId, languageName, force) {\n            var prevName = this.id2Name[languageId];\n            if (prevName) {\n                if (!force) {\n                    return;\n                }\n                delete this.name2LanguageId[prevName];\n            }\n            this.name2LanguageId[languageName] = languageId;\n            this.id2Name[languageId] = languageName;\n        };\n        LanguagesRegistry.prototype._registerLanguage = function (lang) {\n            this.knownModeIds[lang.id] = true;\n            var primaryMime = null;\n            if (typeof lang.mimetypes !== 'undefined' && Array.isArray(lang.mimetypes)) {\n                for (var i = 0; i < lang.mimetypes.length; i++) {\n                    if (!primaryMime) {\n                        primaryMime = lang.mimetypes[i];\n                    }\n                    this.mime2LanguageId[lang.mimetypes[i]] = lang.id;\n                }\n            }\n            if (!primaryMime) {\n                primaryMime = 'text/x-' + lang.id;\n                this.mime2LanguageId[primaryMime] = lang.id;\n            }\n            if (Array.isArray(lang.extensions)) {\n                this.id2Extensions[lang.id] = this.id2Extensions[lang.id] || [];\n                for (var _i = 0, _a = lang.extensions; _i < _a.length; _i++) {\n                    var extension = _a[_i];\n                    mime.registerTextMime({ mime: primaryMime, extension: extension });\n                    this.id2Extensions[lang.id].push(extension);\n                }\n            }\n            if (Array.isArray(lang.filenames)) {\n                for (var _b = 0, _c = lang.filenames; _b < _c.length; _b++) {\n                    var filename = _c[_b];\n                    mime.registerTextMime({ mime: primaryMime, filename: filename });\n                }\n            }\n            if (Array.isArray(lang.filenamePatterns)) {\n                for (var _d = 0, _e = lang.filenamePatterns; _d < _e.length; _d++) {\n                    var filenamePattern = _e[_d];\n                    mime.registerTextMime({ mime: primaryMime, filepattern: filenamePattern });\n                }\n            }\n            if (typeof lang.firstLine === 'string' && lang.firstLine.length > 0) {\n                var firstLineRegexStr = lang.firstLine;\n                if (firstLineRegexStr.charAt(0) !== '^') {\n                    firstLineRegexStr = '^' + firstLineRegexStr;\n                }\n                try {\n                    var firstLineRegex = new RegExp(firstLineRegexStr);\n                    if (!strings.regExpLeadsToEndlessLoop(firstLineRegex)) {\n                        mime.registerTextMime({ mime: primaryMime, firstline: firstLineRegex });\n                    }\n                }\n                catch (err) {\n                    // Most likely, the regex was bad\n                    errors_1.onUnexpectedError(err);\n                }\n            }\n            this.lowerName2Id[lang.id.toLowerCase()] = lang.id;\n            if (typeof lang.aliases !== 'undefined' && Array.isArray(lang.aliases)) {\n                for (var i = 0; i < lang.aliases.length; i++) {\n                    if (!lang.aliases[i] || lang.aliases[i].length === 0) {\n                        continue;\n                    }\n                    this.lowerName2Id[lang.aliases[i].toLowerCase()] = lang.id;\n                }\n            }\n            var containsAliases = (typeof lang.aliases !== 'undefined' && Array.isArray(lang.aliases) && lang.aliases.length > 0);\n            if (containsAliases && lang.aliases[0] === null) {\n            }\n            else {\n                var bestName = (containsAliases ? lang.aliases[0] : null) || lang.id;\n                this._setLanguageName(lang.id, bestName, containsAliases);\n            }\n            if (typeof lang.configuration === 'string') {\n                this.id2ConfigurationFiles[lang.id] = this.id2ConfigurationFiles[lang.id] || [];\n                this.id2ConfigurationFiles[lang.id].push(lang.configuration);\n            }\n        };\n        LanguagesRegistry.prototype.isRegisteredMode = function (mimetypeOrModeId) {\n            // Is this a known mime type ?\n            if (hasOwnProperty.call(this.mime2LanguageId, mimetypeOrModeId)) {\n                return true;\n            }\n            // Is this a known mode id ?\n            return hasOwnProperty.call(this.knownModeIds, mimetypeOrModeId);\n        };\n        LanguagesRegistry.prototype.getRegisteredModes = function () {\n            return Object.keys(this.knownModeIds);\n        };\n        LanguagesRegistry.prototype.getRegisteredLanguageNames = function () {\n            return Object.keys(this.name2LanguageId);\n        };\n        LanguagesRegistry.prototype.getLanguageName = function (modeId) {\n            return this.id2Name[modeId] || null;\n        };\n        LanguagesRegistry.prototype.getModeIdForLanguageNameLowercase = function (languageNameLower) {\n            return this.lowerName2Id[languageNameLower] || null;\n        };\n        LanguagesRegistry.prototype.getConfigurationFiles = function (modeId) {\n            return this.id2ConfigurationFiles[modeId] || [];\n        };\n        LanguagesRegistry.prototype.getMimeForMode = function (theModeId) {\n            var keys = Object.keys(this.mime2LanguageId);\n            for (var i = 0, len = keys.length; i < len; i++) {\n                var _mime = keys[i];\n                var modeId = this.mime2LanguageId[_mime];\n                if (modeId === theModeId) {\n                    return _mime;\n                }\n            }\n            return null;\n        };\n        LanguagesRegistry.prototype.extractModeIds = function (commaSeparatedMimetypesOrCommaSeparatedIdsOrName) {\n            var _this = this;\n            if (!commaSeparatedMimetypesOrCommaSeparatedIdsOrName) {\n                return [];\n            }\n            return (commaSeparatedMimetypesOrCommaSeparatedIdsOrName.\n                split(',').\n                map(function (mimeTypeOrIdOrName) { return mimeTypeOrIdOrName.trim(); }).\n                map(function (mimeTypeOrIdOrName) {\n                return _this.mime2LanguageId[mimeTypeOrIdOrName] || mimeTypeOrIdOrName;\n            }).\n                filter(function (modeId) {\n                return _this.knownModeIds[modeId];\n            }));\n        };\n        LanguagesRegistry.prototype.getModeIdsFromLanguageName = function (languageName) {\n            if (!languageName) {\n                return [];\n            }\n            if (hasOwnProperty.call(this.name2LanguageId, languageName)) {\n                return [this.name2LanguageId[languageName]];\n            }\n            return [];\n        };\n        LanguagesRegistry.prototype.getModeIdsFromFilenameOrFirstLine = function (filename, firstLine) {\n            if (!filename && !firstLine) {\n                return [];\n            }\n            var mimeTypes = mime.guessMimeTypes(filename, firstLine);\n            return this.extractModeIds(mimeTypes.join(','));\n        };\n        LanguagesRegistry.prototype.getCompatMode = function (modeId) {\n            return this.compatModes[modeId] || null;\n        };\n        LanguagesRegistry.prototype.getExtensions = function (languageName) {\n            var languageId = this.name2LanguageId[languageName];\n            if (!languageId) {\n                return [];\n            }\n            return this.id2Extensions[languageId];\n        };\n        return LanguagesRegistry;\n    }());\n    exports.LanguagesRegistry = LanguagesRegistry;\n});\n\ndefine(__m[41], __M([1,0,79,11,15]), function (require, exports, nls, platform, eventEmitter_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.Extensions = {\n        JSONContribution: 'base.contributions.json'\n    };\n    function normalizeId(id) {\n        if (id.length > 0 && id.charAt(id.length - 1) === '#') {\n            return id.substring(0, id.length - 1);\n        }\n        return id;\n    }\n    var JSONContributionRegistry = (function () {\n        function JSONContributionRegistry() {\n            this.schemasById = {};\n            this.eventEmitter = new eventEmitter_1.EventEmitter();\n        }\n        JSONContributionRegistry.prototype.addRegistryChangedListener = function (callback) {\n            return this.eventEmitter.addListener2('registryChanged', callback);\n        };\n        JSONContributionRegistry.prototype.registerSchema = function (uri, unresolvedSchemaContent) {\n            this.schemasById[normalizeId(uri)] = unresolvedSchemaContent;\n            this.eventEmitter.emit('registryChanged', {});\n        };\n        JSONContributionRegistry.prototype.getSchemaContributions = function () {\n            return {\n                schemas: this.schemasById,\n            };\n        };\n        return JSONContributionRegistry;\n    }());\n    var jsonContributionRegistry = new JSONContributionRegistry();\n    platform.Registry.add(exports.Extensions.JSONContribution, jsonContributionRegistry);\n    // preload the schema-schema with a version that contains descriptions.\n    jsonContributionRegistry.registerSchema('http://json-schema.org/draft-04/schema#', {\n        'id': 'http://json-schema.org/draft-04/schema#',\n        'title': nls.localize(0, null),\n        '$schema': 'http://json-schema.org/draft-04/schema#',\n        'definitions': {\n            'schemaArray': {\n                'type': 'array',\n                'minItems': 1,\n                'items': { '$ref': '#' }\n            },\n            'positiveInteger': {\n                'type': 'integer',\n                'minimum': 0\n            },\n            'positiveIntegerDefault0': {\n                'allOf': [{ '$ref': '#/definitions/positiveInteger' }, { 'default': 0 }]\n            },\n            'simpleTypes': {\n                'type': 'string',\n                'enum': ['array', 'boolean', 'integer', 'null', 'number', 'object', 'string']\n            },\n            'stringArray': {\n                'type': 'array',\n                'items': { 'type': 'string' },\n                'minItems': 1,\n                'uniqueItems': true\n            }\n        },\n        'type': 'object',\n        'properties': {\n            'id': {\n                'type': 'string',\n                'format': 'uri',\n                'description': nls.localize(1, null)\n            },\n            '$schema': {\n                'type': 'string',\n                'format': 'uri',\n                'description': nls.localize(2, null)\n            },\n            'title': {\n                'type': 'string',\n                'description': nls.localize(3, null)\n            },\n            'description': {\n                'type': 'string',\n                'description': nls.localize(4, null)\n            },\n            'default': {\n                'description': nls.localize(5, null)\n            },\n            'multipleOf': {\n                'type': 'number',\n                'minimum': 0,\n                'exclusiveMinimum': true,\n                'description': nls.localize(6, null)\n            },\n            'maximum': {\n                'type': 'number',\n                'description': nls.localize(7, null)\n            },\n            'exclusiveMaximum': {\n                'type': 'boolean',\n                'default': false,\n                'description': nls.localize(8, null)\n            },\n            'minimum': {\n                'type': 'number',\n                'description': nls.localize(9, null)\n            },\n            'exclusiveMinimum': {\n                'type': 'boolean',\n                'default': false,\n                'description': nls.localize(10, null)\n            },\n            'maxLength': {\n                'allOf': [\n                    { '$ref': '#/definitions/positiveInteger' }\n                ],\n                'description': nls.localize(11, null)\n            },\n            'minLength': {\n                'allOf': [\n                    { '$ref': '#/definitions/positiveIntegerDefault0' }\n                ],\n                'description': nls.localize(12, null)\n            },\n            'pattern': {\n                'type': 'string',\n                'format': 'regex',\n                'description': nls.localize(13, null)\n            },\n            'additionalItems': {\n                'anyOf': [\n                    { 'type': 'boolean' },\n                    { '$ref': '#' }\n                ],\n                'default': {},\n                'description': nls.localize(14, null)\n            },\n            'items': {\n                'anyOf': [\n                    { '$ref': '#' },\n                    { '$ref': '#/definitions/schemaArray' }\n                ],\n                'default': {},\n                'description': nls.localize(15, null)\n            },\n            'maxItems': {\n                'allOf': [\n                    { '$ref': '#/definitions/positiveInteger' }\n                ],\n                'description': nls.localize(16, null)\n            },\n            'minItems': {\n                'allOf': [\n                    { '$ref': '#/definitions/positiveIntegerDefault0' }\n                ],\n                'description': nls.localize(17, null)\n            },\n            'uniqueItems': {\n                'type': 'boolean',\n                'default': false,\n                'description': nls.localize(18, null)\n            },\n            'maxProperties': {\n                'allOf': [\n                    { '$ref': '#/definitions/positiveInteger' }\n                ],\n                'description': nls.localize(19, null)\n            },\n            'minProperties': {\n                'allOf': [\n                    { '$ref': '#/definitions/positiveIntegerDefault0' },\n                ],\n                'description': nls.localize(20, null)\n            },\n            'required': {\n                'allOf': [\n                    { '$ref': '#/definitions/stringArray' }\n                ],\n                'description': nls.localize(21, null)\n            },\n            'additionalProperties': {\n                'anyOf': [\n                    { 'type': 'boolean' },\n                    { '$ref': '#' }\n                ],\n                'default': {},\n                'description': nls.localize(22, null)\n            },\n            'definitions': {\n                'type': 'object',\n                'additionalProperties': { '$ref': '#' },\n                'default': {},\n                'description': nls.localize(23, null)\n            },\n            'properties': {\n                'type': 'object',\n                'additionalProperties': { '$ref': '#' },\n                'default': {},\n                'description': nls.localize(24, null)\n            },\n            'patternProperties': {\n                'type': 'object',\n                'additionalProperties': { '$ref': '#' },\n                'default': {},\n                'description': nls.localize(25, null)\n            },\n            'dependencies': {\n                'type': 'object',\n                'additionalProperties': {\n                    'anyOf': [\n                        { '$ref': '#' },\n                        { '$ref': '#/definitions/stringArray' }\n                    ]\n                },\n                'description': nls.localize(26, null)\n            },\n            'enum': {\n                'type': 'array',\n                'minItems': 1,\n                'uniqueItems': true,\n                'description': nls.localize(27, null)\n            },\n            'type': {\n                'anyOf': [\n                    { '$ref': '#/definitions/simpleTypes' },\n                    {\n                        'type': 'array',\n                        'items': { '$ref': '#/definitions/simpleTypes' },\n                        'minItems': 1,\n                        'uniqueItems': true\n                    }\n                ],\n                'description': nls.localize(28, null)\n            },\n            'format': {\n                'anyOf': [\n                    {\n                        'type': 'string',\n                        'description': nls.localize(29, null),\n                        'enum': ['date-time', 'uri', 'email', 'hostname', 'ipv4', 'ipv6', 'regex']\n                    }, {\n                        'type': 'string'\n                    }\n                ]\n            },\n            'allOf': {\n                'allOf': [\n                    { '$ref': '#/definitions/schemaArray' }\n                ],\n                'description': nls.localize(30, null)\n            },\n            'anyOf': {\n                'allOf': [\n                    { '$ref': '#/definitions/schemaArray' }\n                ],\n                'description': nls.localize(31, null)\n            },\n            'oneOf': {\n                'allOf': [\n                    { '$ref': '#/definitions/schemaArray' }\n                ],\n                'description': nls.localize(32, null)\n            },\n            'not': {\n                'allOf': [\n                    { '$ref': '#' }\n                ],\n                'description': nls.localize(33, null)\n            }\n        },\n        'dependencies': {\n            'exclusiveMaximum': ['maximum'],\n            'exclusiveMinimum': ['minimum']\n        },\n        'default': {}\n    });\n});\n\ndefine(__m[42], __M([1,0,78,2,13,32,41,11]), function (require, exports, nls, errors_1, paths, severity_1, jsonContributionRegistry_1, platform_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var ExtensionMessageCollector = (function () {\n        function ExtensionMessageCollector(messageHandler, source) {\n            this._messageHandler = messageHandler;\n            this._source = source;\n        }\n        ExtensionMessageCollector.prototype._msg = function (type, message) {\n            this._messageHandler({\n                type: type,\n                message: message,\n                source: this._source\n            });\n        };\n        ExtensionMessageCollector.prototype.error = function (message) {\n            this._msg(severity_1.default.Error, message);\n        };\n        ExtensionMessageCollector.prototype.warn = function (message) {\n            this._msg(severity_1.default.Warning, message);\n        };\n        ExtensionMessageCollector.prototype.info = function (message) {\n            this._msg(severity_1.default.Info, message);\n        };\n        return ExtensionMessageCollector;\n    }());\n    function isValidExtensionDescription(extensionFolderPath, extensionDescription, notices) {\n        if (!extensionDescription) {\n            notices.push(nls.localize(0, null));\n            return false;\n        }\n        if (typeof extensionDescription.publisher !== 'string') {\n            notices.push(nls.localize(1, null, 'publisher'));\n            return false;\n        }\n        if (typeof extensionDescription.name !== 'string') {\n            notices.push(nls.localize(2, null, 'name'));\n            return false;\n        }\n        if (typeof extensionDescription.version !== 'string') {\n            notices.push(nls.localize(3, null, 'version'));\n            return false;\n        }\n        if (!extensionDescription.engines) {\n            notices.push(nls.localize(4, null, 'engines'));\n            return false;\n        }\n        if (typeof extensionDescription.engines.vscode !== 'string') {\n            notices.push(nls.localize(5, null, 'engines.vscode'));\n            return false;\n        }\n        if (typeof extensionDescription.extensionDependencies !== 'undefined') {\n            if (!_isStringArray(extensionDescription.extensionDependencies)) {\n                notices.push(nls.localize(6, null, 'extensionDependencies'));\n                return false;\n            }\n        }\n        if (typeof extensionDescription.activationEvents !== 'undefined') {\n            if (!_isStringArray(extensionDescription.activationEvents)) {\n                notices.push(nls.localize(7, null, 'activationEvents'));\n                return false;\n            }\n            if (typeof extensionDescription.main === 'undefined') {\n                notices.push(nls.localize(8, null, 'activationEvents', 'main'));\n                return false;\n            }\n        }\n        if (typeof extensionDescription.main !== 'undefined') {\n            if (typeof extensionDescription.main !== 'string') {\n                notices.push(nls.localize(9, null, 'main'));\n                return false;\n            }\n            else {\n                var normalizedAbsolutePath = paths.normalize(paths.join(extensionFolderPath, extensionDescription.main));\n                if (normalizedAbsolutePath.indexOf(extensionFolderPath)) {\n                    notices.push(nls.localize(10, null, normalizedAbsolutePath, extensionFolderPath));\n                }\n            }\n            if (typeof extensionDescription.activationEvents === 'undefined') {\n                notices.push(nls.localize(11, null, 'activationEvents', 'main'));\n                return false;\n            }\n        }\n        return true;\n    }\n    exports.isValidExtensionDescription = isValidExtensionDescription;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var schemaRegistry = platform_1.Registry.as(jsonContributionRegistry_1.Extensions.JSONContribution);\n    var ExtensionPoint = (function () {\n        function ExtensionPoint(name, registry) {\n            this.name = name;\n            this._registry = registry;\n            this._handler = null;\n            this._messageHandler = null;\n        }\n        ExtensionPoint.prototype.setHandler = function (handler) {\n            if (this._handler) {\n                throw new Error('Handler already set!');\n            }\n            this._handler = handler;\n            this._handle();\n        };\n        ExtensionPoint.prototype.handle = function (messageHandler) {\n            this._messageHandler = messageHandler;\n            this._handle();\n        };\n        ExtensionPoint.prototype._handle = function () {\n            var _this = this;\n            if (!this._handler || !this._messageHandler) {\n                return;\n            }\n            this._registry.registerPointListener(this.name, function (descriptions) {\n                var users = descriptions.map(function (desc) {\n                    return {\n                        description: desc,\n                        value: desc.contributes[_this.name],\n                        collector: new ExtensionMessageCollector(_this._messageHandler, desc.extensionFolderPath)\n                    };\n                });\n                _this._handler(users);\n            });\n        };\n        return ExtensionPoint;\n    }());\n    var schemaId = 'vscode://schemas/vscode-extensions';\n    var schema = {\n        default: {\n            'name': '{{name}}',\n            'description': '{{description}}',\n            'author': '{{author}}',\n            'version': '{{1.0.0}}',\n            'main': '{{pathToMain}}',\n            'dependencies': {}\n        },\n        properties: {\n            // engines: {\n            // \trequired: [ 'vscode' ],\n            // \tproperties: {\n            // \t\t'vscode': {\n            // \t\t\ttype: 'string',\n            // \t\t\tdescription: nls.localize('vscode.extension.engines.vscode', 'Specifies that this package only runs inside VSCode of the given version.'),\n            // \t\t}\n            // \t}\n            // },\n            displayName: {\n                description: nls.localize(12, null),\n                type: 'string'\n            },\n            categories: {\n                description: nls.localize(13, null),\n                type: 'array',\n                items: {\n                    type: 'string',\n                    enum: ['Languages', 'Snippets', 'Linters', 'Themes', 'Debuggers', 'Productivity', 'Other']\n                }\n            },\n            galleryBanner: {\n                type: 'object',\n                description: nls.localize(14, null),\n                properties: {\n                    color: {\n                        description: nls.localize(15, null),\n                        type: 'string'\n                    },\n                    theme: {\n                        description: nls.localize(16, null),\n                        type: 'string',\n                        enum: ['dark', 'light']\n                    }\n                }\n            },\n            publisher: {\n                description: nls.localize(17, null),\n                type: 'string'\n            },\n            activationEvents: {\n                description: nls.localize(18, null),\n                type: 'array',\n                items: {\n                    type: 'string'\n                }\n            },\n            extensionDependencies: {\n                description: nls.localize(19, null),\n                type: 'array',\n                items: {\n                    type: 'string'\n                }\n            },\n            scripts: {\n                type: 'object',\n                properties: {\n                    'vscode:prepublish': {\n                        description: nls.localize(20, null),\n                        type: 'string'\n                    }\n                }\n            },\n            contributes: {\n                description: nls.localize(21, null),\n                type: 'object',\n                properties: {},\n                default: {}\n            }\n        }\n    };\n    var ExtensionsRegistryImpl = (function () {\n        function ExtensionsRegistryImpl() {\n            this._extensionsMap = {};\n            this._extensionsArr = [];\n            this._activationMap = {};\n            this._pointListeners = [];\n            this._extensionPoints = {};\n            this._oneTimeActivationEventListeners = {};\n        }\n        ExtensionsRegistryImpl.prototype.registerPointListener = function (point, handler) {\n            var entry = {\n                extensionPoint: point,\n                listener: handler\n            };\n            this._pointListeners.push(entry);\n            this._triggerPointListener(entry, ExtensionsRegistryImpl._filterWithExtPoint(this.getAllExtensionDescriptions(), point));\n        };\n        ExtensionsRegistryImpl.prototype.registerExtensionPoint = function (extensionPoint, jsonSchema) {\n            if (hasOwnProperty.call(this._extensionPoints, extensionPoint)) {\n                throw new Error('Duplicate extension point: ' + extensionPoint);\n            }\n            var result = new ExtensionPoint(extensionPoint, this);\n            this._extensionPoints[extensionPoint] = result;\n            schema.properties['contributes'].properties[extensionPoint] = jsonSchema;\n            schemaRegistry.registerSchema(schemaId, schema);\n            return result;\n        };\n        ExtensionsRegistryImpl.prototype.handleExtensionPoints = function (messageHandler) {\n            var _this = this;\n            Object.keys(this._extensionPoints).forEach(function (extensionPointName) {\n                _this._extensionPoints[extensionPointName].handle(messageHandler);\n            });\n        };\n        ExtensionsRegistryImpl.prototype._triggerPointListener = function (handler, desc) {\n            // console.log('_triggerPointListeners: ' + desc.length + ' OF ' + handler.extensionPoint);\n            if (!desc || desc.length === 0) {\n                return;\n            }\n            try {\n                handler.listener(desc);\n            }\n            catch (e) {\n                errors_1.onUnexpectedError(e);\n            }\n        };\n        ExtensionsRegistryImpl.prototype.registerExtensions = function (extensionDescriptions) {\n            for (var i = 0, len = extensionDescriptions.length; i < len; i++) {\n                var extensionDescription = extensionDescriptions[i];\n                if (hasOwnProperty.call(this._extensionsMap, extensionDescription.id)) {\n                    // No overwriting allowed!\n                    console.error('Extension `' + extensionDescription.id + '` is already registered');\n                    continue;\n                }\n                this._extensionsMap[extensionDescription.id] = extensionDescription;\n                this._extensionsArr.push(extensionDescription);\n                if (Array.isArray(extensionDescription.activationEvents)) {\n                    for (var j = 0, lenJ = extensionDescription.activationEvents.length; j < lenJ; j++) {\n                        var activationEvent = extensionDescription.activationEvents[j];\n                        this._activationMap[activationEvent] = this._activationMap[activationEvent] || [];\n                        this._activationMap[activationEvent].push(extensionDescription);\n                    }\n                }\n            }\n            for (var i = 0, len = this._pointListeners.length; i < len; i++) {\n                var listenerEntry = this._pointListeners[i];\n                var descriptions = ExtensionsRegistryImpl._filterWithExtPoint(extensionDescriptions, listenerEntry.extensionPoint);\n                this._triggerPointListener(listenerEntry, descriptions);\n            }\n        };\n        ExtensionsRegistryImpl._filterWithExtPoint = function (input, point) {\n            return input.filter(function (desc) {\n                return (desc.contributes && hasOwnProperty.call(desc.contributes, point));\n            });\n        };\n        ExtensionsRegistryImpl.prototype.getExtensionDescriptionsForActivationEvent = function (activationEvent) {\n            if (!hasOwnProperty.call(this._activationMap, activationEvent)) {\n                return [];\n            }\n            return this._activationMap[activationEvent].slice(0);\n        };\n        ExtensionsRegistryImpl.prototype.getAllExtensionDescriptions = function () {\n            return this._extensionsArr.slice(0);\n        };\n        ExtensionsRegistryImpl.prototype.getExtensionDescription = function (extensionId) {\n            if (!hasOwnProperty.call(this._extensionsMap, extensionId)) {\n                return null;\n            }\n            return this._extensionsMap[extensionId];\n        };\n        ExtensionsRegistryImpl.prototype.registerOneTimeActivationEventListener = function (activationEvent, listener) {\n            if (!hasOwnProperty.call(this._oneTimeActivationEventListeners, activationEvent)) {\n                this._oneTimeActivationEventListeners[activationEvent] = [];\n            }\n            this._oneTimeActivationEventListeners[activationEvent].push(listener);\n        };\n        ExtensionsRegistryImpl.prototype.triggerActivationEventListeners = function (activationEvent) {\n            if (hasOwnProperty.call(this._oneTimeActivationEventListeners, activationEvent)) {\n                var listeners = this._oneTimeActivationEventListeners[activationEvent];\n                delete this._oneTimeActivationEventListeners[activationEvent];\n                for (var i = 0, len = listeners.length; i < len; i++) {\n                    var listener = listeners[i];\n                    try {\n                        listener();\n                    }\n                    catch (e) {\n                        errors_1.onUnexpectedError(e);\n                    }\n                }\n            }\n        };\n        return ExtensionsRegistryImpl;\n    }());\n    function _isStringArray(arr) {\n        if (!Array.isArray(arr)) {\n            return false;\n        }\n        for (var i = 0, len = arr.length; i < len; i++) {\n            if (typeof arr[i] !== 'string') {\n                return false;\n            }\n        }\n        return true;\n    }\n    var PRExtensions = {\n        ExtensionsRegistry: 'ExtensionsRegistry'\n    };\n    platform_1.Registry.add(PRExtensions.ExtensionsRegistry, new ExtensionsRegistryImpl());\n    exports.ExtensionsRegistry = platform_1.Registry.as(PRExtensions.ExtensionsRegistry);\n    schemaRegistry.registerSchema(schemaId, schema);\n});\n\ndefine(__m[100], __M([1,0,76,8,11,12,42,41]), function (require, exports, nls, event_1, platform, objects, extensionsRegistry_1, JSONContributionRegistry) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.Extensions = {\n        Configuration: 'base.contributions.configuration'\n    };\n    var schemaId = 'vscode://schemas/settings';\n    var contributionRegistry = platform.Registry.as(JSONContributionRegistry.Extensions.JSONContribution);\n    var ConfigurationRegistry = (function () {\n        function ConfigurationRegistry() {\n            this.configurationContributors = [];\n            this.configurationSchema = { allOf: [] };\n            this._onDidRegisterConfiguration = new event_1.Emitter();\n            contributionRegistry.registerSchema(schemaId, this.configurationSchema);\n        }\n        Object.defineProperty(ConfigurationRegistry.prototype, \"onDidRegisterConfiguration\", {\n            get: function () {\n                return this._onDidRegisterConfiguration.event;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        ConfigurationRegistry.prototype.registerConfiguration = function (configuration) {\n            this.configurationContributors.push(configuration);\n            this.registerJSONConfiguration(configuration);\n            this._onDidRegisterConfiguration.fire(this);\n        };\n        ConfigurationRegistry.prototype.getConfigurations = function () {\n            return this.configurationContributors.slice(0);\n        };\n        ConfigurationRegistry.prototype.registerJSONConfiguration = function (configuration) {\n            var schema = objects.clone(configuration);\n            this.configurationSchema.allOf.push(schema);\n            contributionRegistry.registerSchema(schemaId, this.configurationSchema);\n        };\n        return ConfigurationRegistry;\n    }());\n    var configurationRegistry = new ConfigurationRegistry();\n    platform.Registry.add(exports.Extensions.Configuration, configurationRegistry);\n    var configurationExtPoint = extensionsRegistry_1.ExtensionsRegistry.registerExtensionPoint('configuration', {\n        description: nls.localize(0, null),\n        type: 'object',\n        defaultSnippets: [{ body: { title: '', properties: {} } }],\n        properties: {\n            title: {\n                description: nls.localize(1, null),\n                type: 'string'\n            },\n            properties: {\n                description: nls.localize(2, null),\n                type: 'object',\n                additionalProperties: {\n                    $ref: 'http://json-schema.org/draft-04/schema#'\n                }\n            }\n        }\n    });\n    configurationExtPoint.setHandler(function (extensions) {\n        for (var i = 0; i < extensions.length; i++) {\n            var configuration = extensions[i].value;\n            var collector = extensions[i].collector;\n            if (configuration.type && configuration.type !== 'object') {\n                collector.warn(nls.localize(3, null));\n            }\n            else {\n                configuration.type = 'object';\n            }\n            if (configuration.title && (typeof configuration.title !== 'string')) {\n                collector.error(nls.localize(4, null));\n            }\n            if (configuration.properties && (typeof configuration.properties !== 'object')) {\n                collector.error(nls.localize(5, null));\n                return;\n            }\n            var clonedConfiguration = objects.clone(configuration);\n            clonedConfiguration.id = extensions[i].description.id;\n            configurationRegistry.registerConfiguration(clonedConfiguration);\n        }\n    });\n});\n\ndefine(__m[59], __M([1,0,80,100,11,74,24]), function (require, exports, filters_1, configurationRegistry_1, platform_1, nls_1, async_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var TextualSuggestSupport = (function () {\n        function TextualSuggestSupport(editorWorkerService, configurationService) {\n            this._editorWorkerService = editorWorkerService;\n            this._configurationService = configurationService;\n        }\n        Object.defineProperty(TextualSuggestSupport.prototype, \"triggerCharacters\", {\n            /* tslint:enable */\n            get: function () {\n                return [];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TextualSuggestSupport.prototype, \"shouldAutotriggerSuggest\", {\n            get: function () {\n                return true;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        Object.defineProperty(TextualSuggestSupport.prototype, \"filter\", {\n            get: function () {\n                return filters_1.matchesStrictPrefix;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        TextualSuggestSupport.prototype.provideCompletionItems = function (model, position, token) {\n            var config = this._configurationService.getConfiguration('editor');\n            if (!config || config.wordBasedSuggestions) {\n                return async_1.wireCancellationToken(token, this._editorWorkerService.textualSuggest(model.uri, position));\n            }\n            return [];\n        };\n        /* tslint:disable */\n        TextualSuggestSupport._c = platform_1.Registry.as(configurationRegistry_1.Extensions.Configuration).registerConfiguration({\n            type: 'object',\n            order: 5.1,\n            properties: {\n                'editor.wordBasedSuggestions': {\n                    'type': 'boolean',\n                    'description': nls_1.localize(0, null),\n                    'default': true\n                }\n            }\n        });\n        return TextualSuggestSupport;\n    }());\n    exports.TextualSuggestSupport = TextualSuggestSupport;\n    function filterSuggestions(value) {\n        if (!value) {\n            return;\n        }\n        // filter suggestions\n        var accept = filters_1.fuzzyContiguousFilter, result = [];\n        result.push({\n            currentWord: value.currentWord,\n            suggestions: value.suggestions.filter(function (element) { return !!accept(value.currentWord, element.label); }),\n            incomplete: value.incomplete\n        });\n        return result;\n    }\n    exports.filterSuggestions = filterSuggestions;\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndefine(__m[60], __M([1,0,15,5,33,4,51,21,59,83,17]), function (require, exports, eventEmitter_1, winjs_base_1, descriptors_1, instantiation_1, configuration_1, modes, suggestSupport_1, editorWorkerService_1, wordHelper) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    function createWordRegExp(allowInWords) {\n        if (allowInWords === void 0) { allowInWords = ''; }\n        return wordHelper.createWordRegExp(allowInWords);\n    }\n    exports.createWordRegExp = createWordRegExp;\n    var ModeWorkerManager = (function () {\n        function ModeWorkerManager(descriptor, workerModuleId, workerClassName, superWorkerModuleId, instantiationService) {\n            this._descriptor = descriptor;\n            this._workerDescriptor = descriptors_1.createAsyncDescriptor1(workerModuleId, workerClassName);\n            this._superWorkerModuleId = superWorkerModuleId;\n            this._instantiationService = instantiationService;\n            this._workerPiecePromise = null;\n        }\n        ModeWorkerManager.prototype.worker = function (runner) {\n            return this._getOrCreateWorker().then(runner);\n        };\n        ModeWorkerManager.prototype._getOrCreateWorker = function () {\n            var _this = this;\n            if (!this._workerPiecePromise) {\n                // TODO@Alex: workaround for missing `bundles` config\n                // First, load the code of the worker super class\n                var superWorkerCodePromise = (this._superWorkerModuleId ? ModeWorkerManager._loadModule(this._superWorkerModuleId) : winjs_base_1.TPromise.as(null));\n                this._workerPiecePromise = superWorkerCodePromise.then(function () {\n                    // Second, load the code of the worker (without instantiating it)\n                    return ModeWorkerManager._loadModule(_this._workerDescriptor.moduleName);\n                }).then(function () {\n                    // Finally, create the mode worker instance\n                    return _this._instantiationService.createInstance(_this._workerDescriptor, _this._descriptor.id);\n                });\n            }\n            return this._workerPiecePromise;\n        };\n        ModeWorkerManager._loadModule = function (moduleName) {\n            return new winjs_base_1.TPromise(function (c, e, p) {\n                // Use the global require to be sure to get the global config\n                self.require([moduleName], c, e);\n            }, function () {\n                // Cannot cancel loading code\n            });\n        };\n        return ModeWorkerManager;\n    }());\n    exports.ModeWorkerManager = ModeWorkerManager;\n    var AbstractMode = (function () {\n        function AbstractMode(modeId) {\n            this._modeId = modeId;\n            this._eventEmitter = new eventEmitter_1.EventEmitter();\n            this._simplifiedMode = null;\n        }\n        AbstractMode.prototype.getId = function () {\n            return this._modeId;\n        };\n        AbstractMode.prototype.toSimplifiedMode = function () {\n            if (!this._simplifiedMode) {\n                this._simplifiedMode = new SimplifiedMode(this);\n            }\n            return this._simplifiedMode;\n        };\n        AbstractMode.prototype.addSupportChangedListener = function (callback) {\n            return this._eventEmitter.addListener2('modeSupportChanged', callback);\n        };\n        AbstractMode.prototype.setTokenizationSupport = function (callback) {\n            var _this = this;\n            var supportImpl = callback(this);\n            this['tokenizationSupport'] = supportImpl;\n            this._eventEmitter.emit('modeSupportChanged', _createModeSupportChangedEvent());\n            return {\n                dispose: function () {\n                    if (_this['tokenizationSupport'] === supportImpl) {\n                        delete _this['tokenizationSupport'];\n                        _this._eventEmitter.emit('modeSupportChanged', _createModeSupportChangedEvent());\n                    }\n                }\n            };\n        };\n        return AbstractMode;\n    }());\n    exports.AbstractMode = AbstractMode;\n    var CompatMode = (function (_super) {\n        __extends(CompatMode, _super);\n        function CompatMode(modeId, compatWorkerService) {\n            _super.call(this, modeId);\n            this.compatWorkerService = compatWorkerService;\n            if (this.compatWorkerService) {\n                this.compatWorkerService.registerCompatMode(this);\n            }\n        }\n        return CompatMode;\n    }(AbstractMode));\n    exports.CompatMode = CompatMode;\n    var SimplifiedMode = (function () {\n        function SimplifiedMode(sourceMode) {\n            var _this = this;\n            this._sourceMode = sourceMode;\n            this._eventEmitter = new eventEmitter_1.EventEmitter();\n            this._id = 'vs.editor.modes.simplifiedMode:' + sourceMode.getId();\n            this._assignSupports();\n            if (this._sourceMode.addSupportChangedListener) {\n                this._sourceMode.addSupportChangedListener(function (e) {\n                    _this._assignSupports();\n                    _this._eventEmitter.emit('modeSupportChanged', e);\n                });\n            }\n        }\n        SimplifiedMode.prototype.getId = function () {\n            return this._id;\n        };\n        SimplifiedMode.prototype.toSimplifiedMode = function () {\n            return this;\n        };\n        SimplifiedMode.prototype._assignSupports = function () {\n            this.tokenizationSupport = this._sourceMode.tokenizationSupport;\n        };\n        return SimplifiedMode;\n    }());\n    exports.isDigit = (function () {\n        var _0 = '0'.charCodeAt(0), _1 = '1'.charCodeAt(0), _2 = '2'.charCodeAt(0), _3 = '3'.charCodeAt(0), _4 = '4'.charCodeAt(0), _5 = '5'.charCodeAt(0), _6 = '6'.charCodeAt(0), _7 = '7'.charCodeAt(0), _8 = '8'.charCodeAt(0), _9 = '9'.charCodeAt(0), _a = 'a'.charCodeAt(0), _b = 'b'.charCodeAt(0), _c = 'c'.charCodeAt(0), _d = 'd'.charCodeAt(0), _e = 'e'.charCodeAt(0), _f = 'f'.charCodeAt(0), _A = 'A'.charCodeAt(0), _B = 'B'.charCodeAt(0), _C = 'C'.charCodeAt(0), _D = 'D'.charCodeAt(0), _E = 'E'.charCodeAt(0), _F = 'F'.charCodeAt(0);\n        return function isDigit(character, base) {\n            var c = character.charCodeAt(0);\n            switch (base) {\n                case 1:\n                    return c === _0;\n                case 2:\n                    return c >= _0 && c <= _1;\n                case 3:\n                    return c >= _0 && c <= _2;\n                case 4:\n                    return c >= _0 && c <= _3;\n                case 5:\n                    return c >= _0 && c <= _4;\n                case 6:\n                    return c >= _0 && c <= _5;\n                case 7:\n                    return c >= _0 && c <= _6;\n                case 8:\n                    return c >= _0 && c <= _7;\n                case 9:\n                    return c >= _0 && c <= _8;\n                case 10:\n                    return c >= _0 && c <= _9;\n                case 11:\n                    return (c >= _0 && c <= _9) || (c === _a) || (c === _A);\n                case 12:\n                    return (c >= _0 && c <= _9) || (c >= _a && c <= _b) || (c >= _A && c <= _B);\n                case 13:\n                    return (c >= _0 && c <= _9) || (c >= _a && c <= _c) || (c >= _A && c <= _C);\n                case 14:\n                    return (c >= _0 && c <= _9) || (c >= _a && c <= _d) || (c >= _A && c <= _D);\n                case 15:\n                    return (c >= _0 && c <= _9) || (c >= _a && c <= _e) || (c >= _A && c <= _E);\n                default:\n                    return (c >= _0 && c <= _9) || (c >= _a && c <= _f) || (c >= _A && c <= _F);\n            }\n        };\n    })();\n    var FrankensteinMode = (function (_super) {\n        __extends(FrankensteinMode, _super);\n        function FrankensteinMode(descriptor, configurationService, editorWorkerService) {\n            _super.call(this, descriptor.id);\n            if (editorWorkerService) {\n                modes.SuggestRegistry.register(this.getId(), new suggestSupport_1.TextualSuggestSupport(editorWorkerService, configurationService), true);\n            }\n        }\n        FrankensteinMode = __decorate([\n            __param(1, configuration_1.IConfigurationService),\n            __param(2, instantiation_1.optional(editorWorkerService_1.IEditorWorkerService))\n        ], FrankensteinMode);\n        return FrankensteinMode;\n    }(AbstractMode));\n    exports.FrankensteinMode = FrankensteinMode;\n    function _createModeSupportChangedEvent() {\n        return {\n            tokenizationSupport: true\n        };\n    }\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndefine(__m[103], __M([1,0,75,2,8,16,12,13,5,46,33,38,42,4,60,40,97,23,51,39,14]), function (require, exports, nls, errors_1, event_1, lifecycle_1, objects, paths, winjs_base_1, mime, descriptors_1, extensions_1, extensionsRegistry_1, instantiation_1, abstractMode_1, modesRegistry_1, languagesRegistry_1, modeService_1, configuration_1, abstractState_1, supports_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var languagesExtPoint = extensionsRegistry_1.ExtensionsRegistry.registerExtensionPoint('languages', {\n        description: nls.localize(0, null),\n        type: 'array',\n        defaultSnippets: [{ body: [{ id: '', aliases: [], extensions: [] }] }],\n        items: {\n            type: 'object',\n            defaultSnippets: [{ body: { id: '', extensions: [] } }],\n            properties: {\n                id: {\n                    description: nls.localize(1, null),\n                    type: 'string'\n                },\n                aliases: {\n                    description: nls.localize(2, null),\n                    type: 'array',\n                    items: {\n                        type: 'string'\n                    }\n                },\n                extensions: {\n                    description: nls.localize(3, null),\n                    default: ['.foo'],\n                    type: 'array',\n                    items: {\n                        type: 'string'\n                    }\n                },\n                filenames: {\n                    description: nls.localize(4, null),\n                    type: 'array',\n                    items: {\n                        type: 'string'\n                    }\n                },\n                filenamePatterns: {\n                    description: nls.localize(5, null),\n                    type: 'array',\n                    items: {\n                        type: 'string'\n                    }\n                },\n                mimetypes: {\n                    description: nls.localize(6, null),\n                    type: 'array',\n                    items: {\n                        type: 'string'\n                    }\n                },\n                firstLine: {\n                    description: nls.localize(7, null),\n                    type: 'string'\n                },\n                configuration: {\n                    description: nls.localize(8, null),\n                    type: 'string'\n                }\n            }\n        }\n    });\n    function isUndefinedOrStringArray(value) {\n        if (typeof value === 'undefined') {\n            return true;\n        }\n        if (!Array.isArray(value)) {\n            return false;\n        }\n        return value.every(function (item) { return typeof item === 'string'; });\n    }\n    function isValidLanguageExtensionPoint(value, collector) {\n        if (!value) {\n            collector.error(nls.localize(9, null, languagesExtPoint.name));\n            return false;\n        }\n        if (typeof value.id !== 'string') {\n            collector.error(nls.localize(10, null, 'id'));\n            return false;\n        }\n        if (!isUndefinedOrStringArray(value.extensions)) {\n            collector.error(nls.localize(11, null, 'extensions'));\n            return false;\n        }\n        if (!isUndefinedOrStringArray(value.filenames)) {\n            collector.error(nls.localize(12, null, 'filenames'));\n            return false;\n        }\n        if (typeof value.firstLine !== 'undefined' && typeof value.firstLine !== 'string') {\n            collector.error(nls.localize(13, null, 'firstLine'));\n            return false;\n        }\n        if (typeof value.configuration !== 'undefined' && typeof value.configuration !== 'string') {\n            collector.error(nls.localize(14, null, 'configuration'));\n            return false;\n        }\n        if (!isUndefinedOrStringArray(value.aliases)) {\n            collector.error(nls.localize(15, null, 'aliases'));\n            return false;\n        }\n        if (!isUndefinedOrStringArray(value.mimetypes)) {\n            collector.error(nls.localize(16, null, 'mimetypes'));\n            return false;\n        }\n        return true;\n    }\n    var ModeServiceImpl = (function () {\n        function ModeServiceImpl(instantiationService, extensionService) {\n            var _this = this;\n            this.serviceId = modeService_1.IModeService;\n            this._onDidAddModes = new event_1.Emitter();\n            this.onDidAddModes = this._onDidAddModes.event;\n            this._onDidCreateMode = new event_1.Emitter();\n            this.onDidCreateMode = this._onDidCreateMode.event;\n            this._instantiationService = instantiationService;\n            this._extensionService = extensionService;\n            this._activationPromises = {};\n            this._instantiatedModes = {};\n            this._config = {};\n            this._registry = new languagesRegistry_1.LanguagesRegistry();\n            this._registry.onDidAddModes(function (modes) { return _this._onDidAddModes.fire(modes); });\n        }\n        ModeServiceImpl.prototype.getConfigurationForMode = function (modeId) {\n            return this._config[modeId] || {};\n        };\n        ModeServiceImpl.prototype.configureMode = function (mimetype, options) {\n            var modeId = this.getModeId(mimetype);\n            if (modeId) {\n                this.configureModeById(modeId, options);\n            }\n        };\n        ModeServiceImpl.prototype.configureModeById = function (modeId, options) {\n            var previousOptions = this._config[modeId] || {};\n            var newOptions = objects.mixin(objects.clone(previousOptions), options);\n            if (objects.equals(previousOptions, newOptions)) {\n                // This configure call is a no-op\n                return;\n            }\n            this._config[modeId] = newOptions;\n            var mode = this.getMode(modeId);\n            if (mode && mode.configSupport) {\n                mode.configSupport.configure(this.getConfigurationForMode(modeId));\n            }\n        };\n        ModeServiceImpl.prototype.configureAllModes = function (config) {\n            var _this = this;\n            if (!config) {\n                return;\n            }\n            var modes = this._registry.getRegisteredModes();\n            modes.forEach(function (modeIdentifier) {\n                var configuration = config[modeIdentifier];\n                _this.configureModeById(modeIdentifier, configuration);\n            });\n        };\n        ModeServiceImpl.prototype.isRegisteredMode = function (mimetypeOrModeId) {\n            return this._registry.isRegisteredMode(mimetypeOrModeId);\n        };\n        ModeServiceImpl.prototype.isCompatMode = function (modeId) {\n            var compatModeData = this._registry.getCompatMode(modeId);\n            return (compatModeData ? true : false);\n        };\n        ModeServiceImpl.prototype.getRegisteredModes = function () {\n            return this._registry.getRegisteredModes();\n        };\n        ModeServiceImpl.prototype.getRegisteredLanguageNames = function () {\n            return this._registry.getRegisteredLanguageNames();\n        };\n        ModeServiceImpl.prototype.getExtensions = function (alias) {\n            return this._registry.getExtensions(alias);\n        };\n        ModeServiceImpl.prototype.getMimeForMode = function (modeId) {\n            return this._registry.getMimeForMode(modeId);\n        };\n        ModeServiceImpl.prototype.getLanguageName = function (modeId) {\n            return this._registry.getLanguageName(modeId);\n        };\n        ModeServiceImpl.prototype.getModeIdForLanguageName = function (alias) {\n            return this._registry.getModeIdForLanguageNameLowercase(alias);\n        };\n        ModeServiceImpl.prototype.getModeId = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\n            var modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\n            if (modeIds.length > 0) {\n                return modeIds[0];\n            }\n            return null;\n        };\n        ModeServiceImpl.prototype.getConfigurationFiles = function (modeId) {\n            return this._registry.getConfigurationFiles(modeId);\n        };\n        // --- instantiation\n        ModeServiceImpl.prototype.lookup = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\n            var r = [];\n            var modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\n            for (var i = 0; i < modeIds.length; i++) {\n                var modeId = modeIds[i];\n                r.push({\n                    modeId: modeId,\n                    isInstantiated: this._instantiatedModes.hasOwnProperty(modeId)\n                });\n            }\n            return r;\n        };\n        ModeServiceImpl.prototype.getMode = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\n            var modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\n            var isPlainText = false;\n            for (var i = 0; i < modeIds.length; i++) {\n                if (this._instantiatedModes.hasOwnProperty(modeIds[i])) {\n                    return this._instantiatedModes[modeIds[i]];\n                }\n                isPlainText = isPlainText || (modeIds[i] === 'plaintext');\n            }\n            if (isPlainText) {\n                // Try to do it synchronously\n                var r = null;\n                this.getOrCreateMode(commaSeparatedMimetypesOrCommaSeparatedIds).then(function (mode) {\n                    r = mode;\n                }).done(null, errors_1.onUnexpectedError);\n                return r;\n            }\n        };\n        ModeServiceImpl.prototype.getModeIdByLanguageName = function (languageName) {\n            var modeIds = this._registry.getModeIdsFromLanguageName(languageName);\n            if (modeIds.length > 0) {\n                return modeIds[0];\n            }\n            return null;\n        };\n        ModeServiceImpl.prototype.getModeIdByFilenameOrFirstLine = function (filename, firstLine) {\n            var modeIds = this._registry.getModeIdsFromFilenameOrFirstLine(filename, firstLine);\n            if (modeIds.length > 0) {\n                return modeIds[0];\n            }\n            return null;\n        };\n        ModeServiceImpl.prototype.onReady = function () {\n            return this._extensionService.onReady();\n        };\n        ModeServiceImpl.prototype.getOrCreateMode = function (commaSeparatedMimetypesOrCommaSeparatedIds) {\n            var _this = this;\n            return this.onReady().then(function () {\n                var modeId = _this.getModeId(commaSeparatedMimetypesOrCommaSeparatedIds);\n                // Fall back to plain text if no mode was found\n                return _this._getOrCreateMode(modeId || 'plaintext');\n            });\n        };\n        ModeServiceImpl.prototype.getOrCreateModeByLanguageName = function (languageName) {\n            var _this = this;\n            return this.onReady().then(function () {\n                var modeId = _this.getModeIdByLanguageName(languageName);\n                // Fall back to plain text if no mode was found\n                return _this._getOrCreateMode(modeId || 'plaintext');\n            });\n        };\n        ModeServiceImpl.prototype.getOrCreateModeByFilenameOrFirstLine = function (filename, firstLine) {\n            var _this = this;\n            return this.onReady().then(function () {\n                var modeId = _this.getModeIdByFilenameOrFirstLine(filename, firstLine);\n                // Fall back to plain text if no mode was found\n                return _this._getOrCreateMode(modeId || 'plaintext');\n            });\n        };\n        ModeServiceImpl.prototype._getOrCreateMode = function (modeId) {\n            var _this = this;\n            if (this._instantiatedModes.hasOwnProperty(modeId)) {\n                return winjs_base_1.TPromise.as(this._instantiatedModes[modeId]);\n            }\n            if (this._activationPromises.hasOwnProperty(modeId)) {\n                return this._activationPromises[modeId];\n            }\n            var c, e;\n            var promise = new winjs_base_1.TPromise(function (cc, ee, pp) { c = cc; e = ee; });\n            this._activationPromises[modeId] = promise;\n            this._createMode(modeId).then(function (mode) {\n                _this._instantiatedModes[modeId] = mode;\n                delete _this._activationPromises[modeId];\n                _this._onDidCreateMode.fire(mode);\n                _this._extensionService.activateByEvent(\"onLanguage:\" + modeId).done(null, errors_1.onUnexpectedError);\n                return _this._instantiatedModes[modeId];\n            }).then(c, e);\n            return promise;\n        };\n        ModeServiceImpl.prototype._createMode = function (modeId) {\n            var _this = this;\n            var modeDescriptor = this._createModeDescriptor(modeId);\n            var compatModeData = this._registry.getCompatMode(modeId);\n            if (compatModeData) {\n                // This is a compatibility mode\n                var resolvedDeps = null;\n                if (Array.isArray(compatModeData.deps)) {\n                    resolvedDeps = winjs_base_1.TPromise.join(compatModeData.deps.map(function (dep) { return _this.getOrCreateMode(dep); }));\n                }\n                else {\n                    resolvedDeps = winjs_base_1.TPromise.as(null);\n                }\n                return resolvedDeps.then(function (_) {\n                    var compatModeAsyncDescriptor = descriptors_1.createAsyncDescriptor1(compatModeData.moduleId, compatModeData.ctorName);\n                    return _this._instantiationService.createInstance(compatModeAsyncDescriptor, modeDescriptor).then(function (compatMode) {\n                        if (compatMode.configSupport) {\n                            compatMode.configSupport.configure(_this.getConfigurationForMode(modeId));\n                        }\n                        return compatMode;\n                    });\n                });\n            }\n            return winjs_base_1.TPromise.as(this._instantiationService.createInstance(abstractMode_1.FrankensteinMode, modeDescriptor));\n        };\n        ModeServiceImpl.prototype._createModeDescriptor = function (modeId) {\n            return {\n                id: modeId\n            };\n        };\n        ModeServiceImpl.prototype._registerTokenizationSupport = function (mode, callback) {\n            if (mode.setTokenizationSupport) {\n                return mode.setTokenizationSupport(callback);\n            }\n            else {\n                console.warn('Cannot register tokenizationSupport on mode ' + mode.getId() + ' because it does not support it.');\n                return lifecycle_1.empty;\n            }\n        };\n        ModeServiceImpl.prototype.registerModeSupport = function (modeId, callback) {\n            var _this = this;\n            if (this._instantiatedModes.hasOwnProperty(modeId)) {\n                return this._registerTokenizationSupport(this._instantiatedModes[modeId], callback);\n            }\n            var cc;\n            var promise = new winjs_base_1.TPromise(function (c, e) { cc = c; });\n            var disposable = this.onDidCreateMode(function (mode) {\n                if (mode.getId() !== modeId) {\n                    return;\n                }\n                cc(_this._registerTokenizationSupport(mode, callback));\n                disposable.dispose();\n            });\n            return {\n                dispose: function () {\n                    promise.done(function (disposable) { return disposable.dispose(); }, null);\n                }\n            };\n        };\n        ModeServiceImpl.prototype.registerTokenizationSupport = function (modeId, callback) {\n            return this.registerModeSupport(modeId, callback);\n        };\n        ModeServiceImpl.prototype.registerTokenizationSupport2 = function (modeId, support) {\n            return this.registerModeSupport(modeId, function (mode) {\n                return new TokenizationSupport2Adapter(mode, support);\n            });\n        };\n        return ModeServiceImpl;\n    }());\n    exports.ModeServiceImpl = ModeServiceImpl;\n    var TokenizationState2Adapter = (function () {\n        function TokenizationState2Adapter(mode, actual, stateData) {\n            this._mode = mode;\n            this._actual = actual;\n            this._stateData = stateData;\n        }\n        Object.defineProperty(TokenizationState2Adapter.prototype, \"actual\", {\n            get: function () { return this._actual; },\n            enumerable: true,\n            configurable: true\n        });\n        TokenizationState2Adapter.prototype.clone = function () {\n            return new TokenizationState2Adapter(this._mode, this._actual.clone(), abstractState_1.AbstractState.safeClone(this._stateData));\n        };\n        TokenizationState2Adapter.prototype.equals = function (other) {\n            if (other instanceof TokenizationState2Adapter) {\n                if (!this._actual.equals(other._actual)) {\n                    return false;\n                }\n                return abstractState_1.AbstractState.safeEquals(this._stateData, other._stateData);\n            }\n            return false;\n        };\n        TokenizationState2Adapter.prototype.getMode = function () {\n            return this._mode;\n        };\n        TokenizationState2Adapter.prototype.tokenize = function (stream) {\n            throw new Error('Unexpected tokenize call!');\n        };\n        TokenizationState2Adapter.prototype.getStateData = function () {\n            return this._stateData;\n        };\n        TokenizationState2Adapter.prototype.setStateData = function (stateData) {\n            this._stateData = stateData;\n        };\n        return TokenizationState2Adapter;\n    }());\n    exports.TokenizationState2Adapter = TokenizationState2Adapter;\n    var TokenizationSupport2Adapter = (function () {\n        function TokenizationSupport2Adapter(mode, actual) {\n            this._mode = mode;\n            this._actual = actual;\n        }\n        TokenizationSupport2Adapter.prototype.getInitialState = function () {\n            return new TokenizationState2Adapter(this._mode, this._actual.getInitialState(), null);\n        };\n        TokenizationSupport2Adapter.prototype.tokenize = function (line, state, offsetDelta, stopAtOffset) {\n            if (offsetDelta === void 0) { offsetDelta = 0; }\n            if (state instanceof TokenizationState2Adapter) {\n                var actualResult = this._actual.tokenize(line, state.actual);\n                var tokens_1 = [];\n                actualResult.tokens.forEach(function (t) {\n                    if (typeof t.scopes === 'string') {\n                        tokens_1.push(new supports_1.Token(t.startIndex + offsetDelta, t.scopes));\n                    }\n                    else if (Array.isArray(t.scopes) && t.scopes.length === 1) {\n                        tokens_1.push(new supports_1.Token(t.startIndex + offsetDelta, t.scopes[0]));\n                    }\n                    else {\n                        throw new Error('Only token scopes as strings or of precisely 1 length are supported at this time!');\n                    }\n                });\n                return {\n                    tokens: tokens_1,\n                    actualStopOffset: offsetDelta + line.length,\n                    endState: new TokenizationState2Adapter(state.getMode(), actualResult.endState, state.getStateData()),\n                    modeTransitions: [{ startIndex: offsetDelta, mode: state.getMode() }],\n                };\n            }\n            throw new Error('Unexpected state to tokenize with!');\n        };\n        return TokenizationSupport2Adapter;\n    }());\n    exports.TokenizationSupport2Adapter = TokenizationSupport2Adapter;\n    var MainThreadModeServiceImpl = (function (_super) {\n        __extends(MainThreadModeServiceImpl, _super);\n        function MainThreadModeServiceImpl(instantiationService, extensionService, configurationService) {\n            var _this = this;\n            _super.call(this, instantiationService, extensionService);\n            this._configurationService = configurationService;\n            languagesExtPoint.setHandler(function (extensions) {\n                var allValidLanguages = [];\n                for (var i = 0, len = extensions.length; i < len; i++) {\n                    var extension = extensions[i];\n                    if (!Array.isArray(extension.value)) {\n                        extension.collector.error(nls.localize(17, null, languagesExtPoint.name));\n                        continue;\n                    }\n                    for (var j = 0, lenJ = extension.value.length; j < lenJ; j++) {\n                        var ext = extension.value[j];\n                        if (isValidLanguageExtensionPoint(ext, extension.collector)) {\n                            var configuration = (ext.configuration ? paths.join(extension.description.extensionFolderPath, ext.configuration) : ext.configuration);\n                            allValidLanguages.push({\n                                id: ext.id,\n                                extensions: ext.extensions,\n                                filenames: ext.filenames,\n                                filenamePatterns: ext.filenamePatterns,\n                                firstLine: ext.firstLine,\n                                aliases: ext.aliases,\n                                mimetypes: ext.mimetypes,\n                                configuration: configuration\n                            });\n                        }\n                    }\n                }\n                modesRegistry_1.ModesRegistry.registerLanguages(allValidLanguages);\n            });\n            this._configurationService.onDidUpdateConfiguration(function (e) { return _this.onConfigurationChange(e.config); });\n        }\n        MainThreadModeServiceImpl.prototype.onReady = function () {\n            var _this = this;\n            if (!this._onReadyPromise) {\n                var configuration_2 = this._configurationService.getConfiguration();\n                this._onReadyPromise = this._extensionService.onReady().then(function () {\n                    _this.onConfigurationChange(configuration_2);\n                    return true;\n                });\n            }\n            return this._onReadyPromise;\n        };\n        MainThreadModeServiceImpl.prototype.onConfigurationChange = function (configuration) {\n            var _this = this;\n            // Clear user configured mime associations\n            mime.clearTextMimes(true /* user configured */);\n            // Register based on settings\n            if (configuration.files && configuration.files.associations) {\n                Object.keys(configuration.files.associations).forEach(function (pattern) {\n                    mime.registerTextMime({ mime: _this.getMimeForMode(configuration.files.associations[pattern]), filepattern: pattern, userConfigured: true });\n                });\n            }\n        };\n        MainThreadModeServiceImpl = __decorate([\n            __param(0, instantiation_1.IInstantiationService),\n            __param(1, extensions_1.IExtensionService),\n            __param(2, configuration_1.IConfigurationService)\n        ], MainThreadModeServiceImpl);\n        return MainThreadModeServiceImpl;\n    }(ModeServiceImpl));\n    exports.MainThreadModeServiceImpl = MainThreadModeServiceImpl;\n});\n\ndefine(__m[104], __M([1,0,77,32,5,38,42]), function (require, exports, nls, severity_1, winjs_base_1, extensions_1, extensionsRegistry_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    var hasOwnProperty = Object.hasOwnProperty;\n    var ActivatedExtension = (function () {\n        function ActivatedExtension(activationFailed) {\n            this.activationFailed = activationFailed;\n        }\n        return ActivatedExtension;\n    }());\n    exports.ActivatedExtension = ActivatedExtension;\n    var AbstractExtensionService = (function () {\n        function AbstractExtensionService(isReadyByDefault) {\n            var _this = this;\n            this.serviceId = extensions_1.IExtensionService;\n            if (isReadyByDefault) {\n                this._onReady = winjs_base_1.TPromise.as(true);\n                this._onReadyC = function (v) { };\n            }\n            else {\n                this._onReady = new winjs_base_1.TPromise(function (c, e, p) {\n                    _this._onReadyC = c;\n                }, function () {\n                    console.warn('You should really not try to cancel this ready promise!');\n                });\n            }\n            this._activatingExtensions = {};\n            this._activatedExtensions = {};\n        }\n        AbstractExtensionService.prototype._triggerOnReady = function () {\n            this._onReadyC(true);\n        };\n        AbstractExtensionService.prototype.onReady = function () {\n            return this._onReady;\n        };\n        AbstractExtensionService.prototype.getExtensionsStatus = function () {\n            return null;\n        };\n        AbstractExtensionService.prototype.isActivated = function (extensionId) {\n            return hasOwnProperty.call(this._activatedExtensions, extensionId);\n        };\n        AbstractExtensionService.prototype.activateByEvent = function (activationEvent) {\n            var _this = this;\n            return this._onReady.then(function () {\n                extensionsRegistry_1.ExtensionsRegistry.triggerActivationEventListeners(activationEvent);\n                var activateExtensions = extensionsRegistry_1.ExtensionsRegistry.getExtensionDescriptionsForActivationEvent(activationEvent);\n                return _this._activateExtensions(activateExtensions, 0);\n            });\n        };\n        AbstractExtensionService.prototype.activateById = function (extensionId) {\n            var _this = this;\n            return this._onReady.then(function () {\n                var desc = extensionsRegistry_1.ExtensionsRegistry.getExtensionDescription(extensionId);\n                if (!desc) {\n                    throw new Error('Extension `' + extensionId + '` is not known');\n                }\n                return _this._activateExtensions([desc], 0);\n            });\n        };\n        /**\n         * Handle semantics related to dependencies for `currentExtension`.\n         * semantics: `redExtensions` must wait for `greenExtensions`.\n         */\n        AbstractExtensionService.prototype._handleActivateRequest = function (currentExtension, greenExtensions, redExtensions) {\n            var depIds = (typeof currentExtension.extensionDependencies === 'undefined' ? [] : currentExtension.extensionDependencies);\n            var currentExtensionGetsGreenLight = true;\n            for (var j = 0, lenJ = depIds.length; j < lenJ; j++) {\n                var depId = depIds[j];\n                var depDesc = extensionsRegistry_1.ExtensionsRegistry.getExtensionDescription(depId);\n                if (!depDesc) {\n                    // Error condition 1: unknown dependency\n                    this._showMessage(severity_1.default.Error, nls.localize(0, null, depId, currentExtension.id));\n                    this._activatedExtensions[currentExtension.id] = this._createFailedExtension();\n                    return;\n                }\n                if (hasOwnProperty.call(this._activatedExtensions, depId)) {\n                    var dep = this._activatedExtensions[depId];\n                    if (dep.activationFailed) {\n                        // Error condition 2: a dependency has already failed activation\n                        this._showMessage(severity_1.default.Error, nls.localize(1, null, depId, currentExtension.id));\n                        this._activatedExtensions[currentExtension.id] = this._createFailedExtension();\n                        return;\n                    }\n                }\n                else {\n                    // must first wait for the dependency to activate\n                    currentExtensionGetsGreenLight = false;\n                    greenExtensions[depId] = depDesc;\n                }\n            }\n            if (currentExtensionGetsGreenLight) {\n                greenExtensions[currentExtension.id] = currentExtension;\n            }\n            else {\n                redExtensions.push(currentExtension);\n            }\n        };\n        AbstractExtensionService.prototype._activateExtensions = function (extensionDescriptions, recursionLevel) {\n            var _this = this;\n            // console.log(recursionLevel, '_activateExtensions: ', extensionDescriptions.map(p => p.id));\n            if (extensionDescriptions.length === 0) {\n                return winjs_base_1.TPromise.as(void 0);\n            }\n            extensionDescriptions = extensionDescriptions.filter(function (p) { return !hasOwnProperty.call(_this._activatedExtensions, p.id); });\n            if (extensionDescriptions.length === 0) {\n                return winjs_base_1.TPromise.as(void 0);\n            }\n            if (recursionLevel > 10) {\n                // More than 10 dependencies deep => most likely a dependency loop\n                for (var i = 0, len = extensionDescriptions.length; i < len; i++) {\n                    // Error condition 3: dependency loop\n                    this._showMessage(severity_1.default.Error, nls.localize(2, null, extensionDescriptions[i].id));\n                    this._activatedExtensions[extensionDescriptions[i].id] = this._createFailedExtension();\n                }\n                return winjs_base_1.TPromise.as(void 0);\n            }\n            var greenMap = Object.create(null), red = [];\n            for (var i = 0, len = extensionDescriptions.length; i < len; i++) {\n                this._handleActivateRequest(extensionDescriptions[i], greenMap, red);\n            }\n            // Make sure no red is also green\n            for (var i = 0, len = red.length; i < len; i++) {\n                if (greenMap[red[i].id]) {\n                    delete greenMap[red[i].id];\n                }\n            }\n            var green = Object.keys(greenMap).map(function (id) { return greenMap[id]; });\n            // console.log('greenExtensions: ', green.map(p => p.id));\n            // console.log('redExtensions: ', red.map(p => p.id));\n            if (red.length === 0) {\n                // Finally reached only leafs!\n                return winjs_base_1.TPromise.join(green.map(function (p) { return _this._activateExtension(p); })).then(function (_) { return void 0; });\n            }\n            return this._activateExtensions(green, recursionLevel + 1).then(function (_) {\n                return _this._activateExtensions(red, recursionLevel + 1);\n            });\n        };\n        AbstractExtensionService.prototype._activateExtension = function (extensionDescription) {\n            var _this = this;\n            if (hasOwnProperty.call(this._activatedExtensions, extensionDescription.id)) {\n                return winjs_base_1.TPromise.as(void 0);\n            }\n            if (hasOwnProperty.call(this._activatingExtensions, extensionDescription.id)) {\n                return this._activatingExtensions[extensionDescription.id];\n            }\n            this._activatingExtensions[extensionDescription.id] = this._actualActivateExtension(extensionDescription).then(null, function (err) {\n                _this._showMessage(severity_1.default.Error, nls.localize(3, null, extensionDescription.id, err.message));\n                console.error('Activating extension `' + extensionDescription.id + '` failed: ', err.message);\n                console.log('Here is the error stack: ', err.stack);\n                // Treat the extension as being empty\n                return _this._createFailedExtension();\n            }).then(function (x) {\n                _this._activatedExtensions[extensionDescription.id] = x;\n                delete _this._activatingExtensions[extensionDescription.id];\n            });\n            return this._activatingExtensions[extensionDescription.id];\n        };\n        return AbstractExtensionService;\n    }());\n    exports.AbstractExtensionService = AbstractExtensionService;\n});\n\ndefine(__m[43], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.IRequestService = instantiation_1.createDecorator('requestService');\n});\n\ndefine(__m[44], __M([1,0,5,26,4]), function (require, exports, winjs_base_1, timer_1, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.ITelemetryService = instantiation_1.createDecorator('telemetryService');\n    exports.NullTelemetryService = {\n        serviceId: undefined,\n        timedPublicLog: function (name, data) { return timer_1.nullEvent; },\n        publicLog: function (eventName, data) { return winjs_base_1.TPromise.as(null); },\n        isOptedIn: true,\n        getTelemetryInfo: function () {\n            return winjs_base_1.TPromise.as({\n                instanceId: 'someValue.instanceId',\n                sessionId: 'someValue.sessionId',\n                machineId: 'someValue.machineId'\n            });\n        }\n    };\n    function combinedAppender() {\n        var appenders = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            appenders[_i - 0] = arguments[_i];\n        }\n        return { log: function (e, d) { return appenders.forEach(function (a) { return a.log(e, d); }); } };\n    }\n    exports.combinedAppender = combinedAppender;\n    exports.NullAppender = { log: function () { return null; } };\n    // --- util\n    function anonymize(input) {\n        if (!input) {\n            return input;\n        }\n        var r = '';\n        for (var i = 0; i < input.length; i++) {\n            var ch = input[i];\n            if (ch >= '0' && ch <= '9') {\n                r += '0';\n                continue;\n            }\n            if (ch >= 'a' && ch <= 'z') {\n                r += 'a';\n                continue;\n            }\n            if (ch >= 'A' && ch <= 'Z') {\n                r += 'A';\n                continue;\n            }\n            r += ch;\n        }\n        return r;\n    }\n    exports.anonymize = anonymize;\n});\n\ndefine(__m[107], __M([1,0,20,5,84,3,26,24,12,43,44]), function (require, exports, uri_1, winjs_base_1, network_1, strings, Timer, Async, objects, request_1, telemetry_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * Simple IRequestService implementation to allow sharing of this service implementation\n     * between different layers of the platform.\n     */\n    var BaseRequestService = (function () {\n        function BaseRequestService(contextService, telemetryService) {\n            if (telemetryService === void 0) { telemetryService = telemetry_1.NullTelemetryService; }\n            this.serviceId = request_1.IRequestService;\n            var workspaceUri = null;\n            var workspace = contextService.getWorkspace();\n            this._serviceMap = workspace || Object.create(null);\n            this._telemetryService = telemetryService;\n            if (workspace) {\n                workspaceUri = strings.rtrim(workspace.resource.toString(), '/') + '/';\n            }\n            this.computeOrigin(workspaceUri);\n        }\n        BaseRequestService.prototype.computeOrigin = function (workspaceUri) {\n            if (workspaceUri) {\n                // Find root server URL from configuration\n                this._origin = workspaceUri;\n                var urlPath = uri_1.default.parse(this._origin).path;\n                if (urlPath && urlPath.length > 0) {\n                    this._origin = this._origin.substring(0, this._origin.length - urlPath.length + 1);\n                }\n                if (!strings.endsWith(this._origin, '/')) {\n                    this._origin += '/';\n                }\n            }\n            else {\n                this._origin = '/'; // Configuration not provided, fallback to default\n            }\n        };\n        BaseRequestService.prototype.makeCrossOriginRequest = function (options) {\n            return null;\n        };\n        BaseRequestService.prototype.makeRequest = function (options) {\n            var timer = Timer.nullEvent;\n            var isXhrRequestCORS = false;\n            var url = options.url;\n            if (!url) {\n                throw new Error('IRequestService.makeRequest: Url is required');\n            }\n            if ((strings.startsWith(url, 'http://') || strings.startsWith(url, 'https://')) && this._origin && !strings.startsWith(url, this._origin)) {\n                var coPromise = this.makeCrossOriginRequest(options);\n                if (coPromise) {\n                    return coPromise;\n                }\n                isXhrRequestCORS = true;\n            }\n            var xhrOptions = options;\n            var xhrOptionsPromise = winjs_base_1.TPromise.as(undefined);\n            if (!isXhrRequestCORS) {\n                xhrOptions = this._telemetryService.getTelemetryInfo().then(function (info) {\n                    var additionalHeaders = {};\n                    additionalHeaders['X-TelemetrySession'] = info.sessionId;\n                    additionalHeaders['X-Requested-With'] = 'XMLHttpRequest';\n                    xhrOptions.headers = objects.mixin(xhrOptions.headers, additionalHeaders);\n                });\n            }\n            if (options.timeout) {\n                xhrOptions.customRequestInitializer = function (xhrRequest) {\n                    xhrRequest.timeout = options.timeout;\n                };\n            }\n            return xhrOptionsPromise.then(function () {\n                return Async.always(network_1.xhr(xhrOptions), (function (xhr) {\n                    if (timer.data) {\n                        timer.data.status = xhr.status;\n                    }\n                    timer.stop();\n                }));\n            });\n        };\n        return BaseRequestService;\n    }());\n    exports.BaseRequestService = BaseRequestService;\n});\n\ndefine(__m[27], __M([1,0,4]), function (require, exports, instantiation_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    exports.IWorkspaceContextService = instantiation_1.createDecorator('contextService');\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\ndefine(__m[98], __M([1,0,34,24,63,47,49,8,81,16,13,20,11,41,43,27,44,19,21,60,39,25,105,88,31,59,53,85,23,35]), function (require, exports) {\n    'use strict';\n});\n\ndefine(__m[92], __M([1,0,20,13,27]), function (require, exports, uri_1, paths, workspace_1) {\n    /*---------------------------------------------------------------------------------------------\n     *  Copyright (c) Microsoft Corporation. All rights reserved.\n     *  Licensed under the MIT License. See License.txt in the project root for license information.\n     *--------------------------------------------------------------------------------------------*/\n    'use strict';\n    /**\n     * Simple IWorkspaceContextService implementation to allow sharing of this service implementation\n     * between different layers of the platform.\n     */\n    var BaseWorkspaceContextService = (function () {\n        function BaseWorkspaceContextService(workspace, configuration, options) {\n            if (options === void 0) { options = {}; }\n            this.serviceId = workspace_1.IWorkspaceContextService;\n            this.workspace = workspace;\n            this.configuration = configuration;\n            this.options = options;\n        }\n        BaseWorkspaceContextService.prototype.getWorkspace = function () {\n            return this.workspace;\n        };\n        BaseWorkspaceContextService.prototype.getConfiguration = function () {\n            return this.configuration;\n        };\n        BaseWorkspaceContextService.prototype.getOptions = function () {\n            return this.options;\n        };\n        BaseWorkspaceContextService.prototype.isInsideWorkspace = function (resource) {\n            if (resource && this.workspace) {\n                return paths.isEqualOrParent(resource.fsPath, this.workspace.resource.fsPath);\n            }\n            return false;\n        };\n        BaseWorkspaceContextService.prototype.toWorkspaceRelativePath = function (resource) {\n            if (this.isInsideWorkspace(resource)) {\n                return paths.normalize(paths.relative(this.workspace.resource.fsPath, resource.fsPath));\n            }\n            return null;\n        };\n        BaseWorkspaceContextService.prototype.toResource = function (workspaceRelativePath) {\n            if (typeof workspaceRelativePath === 'string' && this.workspace) {\n                return uri_1.default.file(paths.join(this.workspace.resource.fsPath, workspaceRelativePath));\n            }\n            return null;\n        };\n        return BaseWorkspaceContextService;\n    }());\n    exports.BaseWorkspaceContextService = BaseWorkspaceContextService;\n});\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\n\n\n\ndefine(__m[111], __M([1,0,32,5,90,52,104,38,54,93,107,43,44,92,27,103,23,87,37,96,35,98]), function (require, exports, severity_1, winjs_base_1, eventService_1, event_1, abstractExtensionService_1, extensions_1, serviceCollection_1, instantiationService_1, baseRequestService_1, request_1, telemetry_1, baseWorkspaceContextService_1, workspace_1, modeServiceImpl_1, modeService_1, resourceServiceImpl_1, resourceService_1, compatWorkerServiceWorker_1, compatWorkerService_1) {\n    'use strict';\n    var WorkerExtensionService = (function (_super) {\n        __extends(WorkerExtensionService, _super);\n        function WorkerExtensionService() {\n            _super.call(this, true);\n        }\n        WorkerExtensionService.prototype._showMessage = function (severity, msg) {\n            switch (severity) {\n                case severity_1.default.Error:\n                    console.error(msg);\n                    break;\n                case severity_1.default.Warning:\n                    console.warn(msg);\n                    break;\n                case severity_1.default.Info:\n                    console.info(msg);\n                    break;\n                default:\n                    console.log(msg);\n            }\n        };\n        WorkerExtensionService.prototype._createFailedExtension = function () {\n            throw new Error('unexpected');\n        };\n        WorkerExtensionService.prototype._actualActivateExtension = function (extensionDescription) {\n            throw new Error('unexpected');\n        };\n        return WorkerExtensionService;\n    }(abstractExtensionService_1.AbstractExtensionService));\n    var EditorWorkerServer = (function () {\n        function EditorWorkerServer() {\n        }\n        EditorWorkerServer.prototype.initialize = function (mainThread, complete, error, progress, initData) {\n            var services = new serviceCollection_1.ServiceCollection();\n            var instantiationService = new instantiationService_1.InstantiationService(services);\n            var extensionService = new WorkerExtensionService();\n            services.set(extensions_1.IExtensionService, extensionService);\n            var contextService = new baseWorkspaceContextService_1.BaseWorkspaceContextService(initData.contextService.workspace, initData.contextService.configuration, initData.contextService.options);\n            services.set(workspace_1.IWorkspaceContextService, contextService);\n            var resourceService = new resourceServiceImpl_1.ResourceService();\n            services.set(resourceService_1.IResourceService, resourceService);\n            var requestService = new baseRequestService_1.BaseRequestService(contextService, telemetry_1.NullTelemetryService);\n            services.set(request_1.IRequestService, requestService);\n            services.set(event_1.IEventService, new eventService_1.EventService());\n            var modeService = new modeServiceImpl_1.ModeServiceImpl(instantiationService, extensionService);\n            services.set(modeService_1.IModeService, modeService);\n            this.compatWorkerService = new compatWorkerServiceWorker_1.CompatWorkerServiceWorker(resourceService, modeService, initData.modesRegistryData);\n            services.set(compatWorkerService_1.ICompatWorkerService, this.compatWorkerService);\n            complete(undefined);\n        };\n        EditorWorkerServer.prototype.request = function (mainThread, complete, error, progress, data) {\n            try {\n                winjs_base_1.TPromise.as(this.compatWorkerService.handleMainRequest(data.target, data.methodName, data.args)).then(complete, error);\n            }\n            catch (err) {\n                error(err);\n            }\n        };\n        return EditorWorkerServer;\n    }());\n    exports.EditorWorkerServer = EditorWorkerServer;\n    exports.value = new EditorWorkerServer();\n});\n\n}).call(this);\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n/**\n * Returns the last element of an array.\n * @param array The array.\n * @param n Which element from the end (default ist zero).\n */\nexport function tail<T>(array: T[], n: number = 0): T {\n\treturn array[array.length - (1 + n)];\n}\n\n/**\n * Iterates the provided array and allows to remove\n * elements while iterating.\n */\nexport function forEach<T>(array: T[], callback: (element: T, remove: Function) => void): void {\n\tfor (var i = 0, len = array.length; i < len; i++) {\n\t\tcallback(array[i], function() {\n\t\t\tarray.splice(i, 1);\n\t\t\ti--; len--;\n\t\t});\n\t}\n}\n\nexport function equals<T>(one: T[], other: T[], itemEquals: (a: T, b: T) => boolean = (a, b) => a === b): boolean {\n\tif (one.length !== other.length) {\n\t\treturn false;\n\t}\n\n\tfor (var i = 0, len = one.length; i < len; i++) {\n\t\tif (!itemEquals(one[i], other[i])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function binarySearch<T>(array: T[], key: T, comparator: (op1: T, op2: T) => number): number {\n\tlet low = 0,\n\t\thigh = array.length - 1;\n\n\twhile (low <= high) {\n\t\tlet mid = ((low + high) / 2) | 0;\n\t\tlet comp = comparator(array[mid], key);\n\t\tif (comp < 0) {\n\t\t\tlow = mid + 1;\n\t\t} else if (comp > 0) {\n\t\t\thigh = mid - 1;\n\t\t} else {\n\t\t\treturn mid;\n\t\t}\n\t}\n\treturn -(low + 1);\n}\n\n/**\n * Takes a sorted array and a function p. The array is sorted in such a way that all elements where p(x) is false\n * are located before all elements where p(x) is true.\n * @returns the least x for which p(x) is true or array.length if no element fullfills the given function.\n */\nexport function findFirst<T>(array: T[], p: (x: T) => boolean): number {\n\tlet low = 0, high = array.length;\n\tif (high === 0) {\n\t\treturn 0; // no children\n\t}\n\twhile (low < high) {\n\t\tlet mid = Math.floor((low + high) / 2);\n\t\tif (p(array[mid])) {\n\t\t\thigh = mid;\n\t\t} else {\n\t\t\tlow = mid + 1;\n\t\t}\n\t}\n\treturn low;\n}\n\nexport function merge<T>(arrays: T[][], hashFn?: (element: T) => string): T[] {\n\tconst result = new Array<T>();\n\tif (!hashFn) {\n\t\tfor (let i = 0, len = arrays.length; i < len; i++) {\n\t\t\tresult.push.apply(result, arrays[i]);\n\t\t}\n\t} else {\n\t\tconst map: { [k: string]: boolean } = {};\n\t\tfor (let i = 0; i < arrays.length; i++) {\n\t\t\tfor (let j = 0; j < arrays[i].length; j++) {\n\t\t\t\tlet element = arrays[i][j],\n\t\t\t\t\thash = hashFn(element);\n\n\t\t\t\tif (!map.hasOwnProperty(hash)) {\n\t\t\t\t\tmap[hash] = true;\n\t\t\t\t\tresult.push(element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * @returns a new array with all undefined or null values removed. The original array is not modified at all.\n */\nexport function coalesce<T>(array: T[]): T[] {\n\tif (!array) {\n\t\treturn array;\n\t}\n\n\treturn array.filter(e => !!e);\n}\n\n/**\n * @returns true if the given item is contained in the array.\n */\nexport function contains<T>(array: T[], item: T): boolean {\n\treturn array.indexOf(item) >= 0;\n}\n\n/**\n * Swaps the elements in the array for the provided positions.\n */\nexport function swap(array: any[], pos1: number, pos2: number): void {\n\tconst element1 = array[pos1];\n\tconst element2 = array[pos2];\n\n\tarray[pos1] = element2;\n\tarray[pos2] = element1;\n}\n\n/**\n * Moves the element in the array for the provided positions.\n */\nexport function move(array: any[], from: number, to: number): void {\n\tarray.splice(to, 0, array.splice(from, 1)[0]);\n}\n\n/**\n * @returns {{false}} if the provided object is an array\n * \tand not empty.\n */\nexport function isFalsyOrEmpty(obj: any): boolean {\n\treturn !Array.isArray(obj) || (<Array<any>>obj).length === 0;\n}\n\n/**\n * Removes duplicates from the given array. The optional keyFn allows to specify\n * how elements are checked for equalness by returning a unique string for each.\n */\nexport function distinct<T>(array: T[], keyFn?: (t: T) => string): T[] {\n\tif (!keyFn) {\n\t\treturn array.filter((element, position) => {\n\t\t\treturn array.indexOf(element) === position;\n\t\t});\n\t}\n\n\tconst seen: { [key: string]: boolean; } = Object.create(null);\n\treturn array.filter((elem) => {\n\t\tconst key = keyFn(elem);\n\t\tif (seen[key]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tseen[key] = true;\n\n\t\treturn true;\n\t});\n}\n\nexport function uniqueFilter<T>(keyFn: (t: T) => string): (t: T) => boolean {\n\tconst seen: { [key: string]: boolean; } = Object.create(null);\n\n\treturn element => {\n\t\tconst key = keyFn(element);\n\n\t\tif (seen[key]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tseen[key] = true;\n\t\treturn true;\n\t};\n}\n\nexport function firstIndex<T>(array: T[], fn: (item: T) => boolean): number {\n\tfor (let i = 0; i < array.length; i++) {\n\t\tconst element = array[i];\n\n\t\tif (fn(element)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn -1;\n}\n\nexport function first<T>(array: T[], fn: (item: T) => boolean, notFoundValue: T = null): T {\n\tconst index = firstIndex(array, fn);\n\treturn index < 0 ? notFoundValue : array[index];\n}\n\nexport function commonPrefixLength<T>(one: T[], other: T[], equals: (a: T, b: T) => boolean = (a, b) => a === b): number {\n\tlet result = 0;\n\n\tfor (var i = 0, len = Math.min(one.length, other.length); i < len && equals(one[i], other[i]); i++) {\n\t\tresult++;\n\t}\n\n\treturn result;\n}\n\nexport function flatten<T>(arr: T[][]): T[] {\n\treturn arr.reduce((r, v) => r.concat(v), []);\n}\n\nexport function range(to: number, from = 0): number[] {\n\tconst result = [];\n\n\tfor (let i = from; i < to; i++) {\n\t\tresult.push(i);\n\t}\n\n\treturn result;\n}\n\nexport function fill<T>(num: number, valueFn: () => T, arr: T[] = []): T[] {\n\tfor (let i = 0; i < num; i++) {\n\t\tarr[i] = valueFn();\n\t}\n\n\treturn arr;\n}\n\nexport function index<T>(array: T[], indexer: (t: T) => string): { [key: string]: T; } {\n\tconst result = Object.create(null);\n\tarray.forEach(t => result[indexer(t)] = t);\n\treturn result;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n/**\n * Throws an error with the provided message if the provided value does not evaluate to a true Javascript value.\n */\nexport function ok(value?: any, message?: string) {\n\tif (!value || value === null) {\n\t\tthrow new Error(message ? 'Assertion failed (' + message + ')' : 'Assertion Failed');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n\n/**\n * An interface for a JavaScript object that\n * acts a dictionary. The keys are strings.\n */\nexport interface IStringDictionary<V> {\n\t[name: string]: V;\n}\n\n/**\n * An interface for a JavaScript object that\n * acts a dictionary. The keys are numbers.\n */\nexport interface INumberDictionary<V> {\n\t[idx: number]: V;\n}\n\nexport function createStringDictionary<V>(): IStringDictionary<V> {\n\treturn Object.create(null);\n}\n\nexport function createNumberDictionary<V>(): INumberDictionary<V> {\n\treturn Object.create(null);\n}\n\n/**\n * Looks up and returns a property that is owned\n * by the provided map object.\n * @param what The key.\n * @param from A native JavaScript object that stores items.\n * @param alternate A default value this is return in case an item with\n * \tthe key isn't found.\n */\nexport function lookup<T>(from: IStringDictionary<T>, what: string, alternate?: T): T;\nexport function lookup<T>(from: INumberDictionary<T>, what: number, alternate?: T): T;\nexport function lookup<T>(from: any, what: any, alternate: T = null): T {\n\tconst key = String(what);\n\tif (contains(from, key)) {\n\t\treturn from[key];\n\t}\n\treturn alternate;\n}\n\n\n/**\n * Looks up a value from the set. If the set doesn't contain the\n * value it inserts and returns the given alternate value.\n */\nexport function lookupOrInsert<T>(from: IStringDictionary<T>, key: string, alternate: T): T;\nexport function lookupOrInsert<T>(from: IStringDictionary<T>, key: string, alternateFn: () => T): T;\nexport function lookupOrInsert<T>(from: INumberDictionary<T>, key: number, alternate: T): T;\nexport function lookupOrInsert<T>(from: INumberDictionary<T>, key: number, alternateFn: () => T): T;\nexport function lookupOrInsert<T>(from: any, stringOrNumber: any, alternate: any): T {\n\tconst key = String(stringOrNumber);\n\tif (contains(from, key)) {\n\t\treturn from[key];\n\t} else {\n\t\tif (typeof alternate === 'function') {\n\t\t\talternate = alternate();\n\t\t}\n\t\tfrom[key] = alternate;\n\t\treturn alternate;\n\t}\n}\n\n/**\n * Inserts\n */\nexport function insert<T>(into: IStringDictionary<T>, data: T, hashFn: (data: T) => string): void;\nexport function insert<T>(into: INumberDictionary<T>, data: T, hashFn: (data: T) => string): void;\nexport function insert<T>(into: any, data: T, hashFn: (data: T) => string): void {\n\tinto[hashFn(data)] = data;\n}\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Returns {{true}} iff the provided object contains a property\n * with the given name.\n */\nexport function contains<T>(from: IStringDictionary<T>, what: string): boolean;\nexport function contains<T>(from: INumberDictionary<T>, what: number): boolean;\nexport function contains<T>(from: any, what: any): boolean {\n\treturn hasOwnProperty.call(from, what);\n}\n\n/**\n * Returns an array which contains all values that reside\n * in the given set.\n */\nexport function values<T>(from: IStringDictionary<T>): T[];\nexport function values<T>(from: INumberDictionary<T>): T[];\nexport function values<T>(from: any): any[] {\n\tconst result: T[] = [];\n\tfor (var key in from) {\n\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\tresult.push(from[key]);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Iterates over each entry in the provided set. The iterator allows\n * to remove elements and will stop when the callback returns {{false}}.\n */\nexport function forEach<T>(from: IStringDictionary<T>, callback: (entry: { key: string; value: T; }, remove: Function) => any): void;\nexport function forEach<T>(from: INumberDictionary<T>, callback: (entry: { key: number; value: T; }, remove: Function) => any): void;\nexport function forEach<T>(from: any, callback: (entry: { key: any; value: T; }, remove: Function) => any): void {\n\tfor (var key in from) {\n\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\tconst result = callback({ key: key, value: from[key] }, function() {\n\t\t\t\tdelete from[key];\n\t\t\t});\n\t\t\tif (result === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Removes an element from the dictionary. Returns {{false}} if the property\n * does not exists.\n */\nexport function remove<T>(from: IStringDictionary<T>, key: string): boolean;\nexport function remove<T>(from: INumberDictionary<T>, key: string): boolean;\nexport function remove<T>(from: any, key: string): boolean {\n\tif (!hasOwnProperty.call(from, key)) {\n\t\treturn false;\n\t}\n\tdelete from[key];\n\treturn true;\n}\n\n/**\n * Groups the collection into a dictionary based on the provided\n * group function.\n */\nexport function groupBy<T>(data: T[], groupFn: (element: T) => string): IStringDictionary<T[]> {\n\tconst result = createStringDictionary<T[]>();\n\tdata.forEach(element => lookupOrInsert(result, groupFn(element), []).push(element));\n\treturn result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nexport class Event {\n\tpublic time: number;\n\tpublic originalEvent: Event;\n\tpublic source: any;\n\n\tconstructor(originalEvent?: Event) {\n\t\tthis.time = (new Date()).getTime();\n\t\tthis.originalEvent = originalEvent;\n\t\tthis.source = null;\n\t}\n}\n\nexport class PropertyChangeEvent extends Event {\n\tpublic key: string;\n\tpublic oldValue: any;\n\tpublic newValue: any;\n\n\tconstructor(key?: string, oldValue?: any, newValue?: any, originalEvent?: Event) {\n\t\tsuper(originalEvent);\n\n\t\tthis.key = key;\n\t\tthis.oldValue = oldValue;\n\t\tthis.newValue = newValue;\n\t}\n}\n\nexport class ViewerEvent extends Event {\n\tpublic element: any;\n\n\tconstructor(element: any, originalEvent?: Event) {\n\t\tsuper(originalEvent);\n\n\t\tthis.element = element;\n\t}\n}\n\nexport interface ISelectionEvent {\n\tselection: any[];\n\tpayload?: any;\n\tsource: any;\n}\n\nexport interface IFocusEvent {\n\tfocus: any;\n\tpayload?: any;\n\tsource: any;\n}\n\nexport interface IHighlightEvent {\n\thighlight: any;\n\tpayload?: any;\n\tsource: any;\n}\n\nexport const EventType = {\n\tPROPERTY_CHANGED: 'propertyChanged',\n\tSELECTION: 'selection',\n\tFOCUS: 'focus',\n\tBLUR: 'blur',\n\tHIGHLIGHT: 'highlight',\n\tEXPAND: 'expand',\n\tCOLLAPSE: 'collapse',\n\tTOGGLE: 'toggle',\n\tCONTENTS_CHANGED: 'contentsChanged',\n\tBEFORE_RUN: 'beforeRun',\n\tRUN: 'run',\n\tEDIT: 'edit',\n\tSAVE: 'save',\n\tCANCEL: 'cancel',\n\tCHANGE: 'change',\n\tDISPOSE: 'dispose',\n};\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nexport interface Key {\n\ttoString():string;\n}\n\nexport interface Entry<K, T> {\n\tnext?: Entry<K, T>;\n\tprev?: Entry<K, T>;\n\tkey: K;\n\tvalue: T;\n}\n\n/**\n * A simple map to store value by a key object. Key can be any object that has toString() function to get\n * string value of the key.\n */\nexport class SimpleMap<K extends Key, T> {\n\n\tprotected map: { [key: string]: Entry<K, T> };\n\tprotected _size: number;\n\n\tconstructor() {\n\t\tthis.map = Object.create(null);\n\t\tthis._size = 0;\n\t}\n\n\tpublic get size(): number {\n\t\treturn this._size;\n\t}\n\n\tpublic get(k: K): T {\n\t\tconst value = this.peek(k);\n\n\t\treturn value ? value : null;\n\t}\n\n\tpublic keys(): K[] {\n\t\tvar keys: K[] = [];\n\t\tfor (let key in this.map) {\n\t\t\tkeys.push(this.map[key].key);\n\t\t}\n\t\treturn keys;\n\t}\n\n\tpublic entries(): Entry<K, T>[] {\n\t\tvar entries: Entry<K, T>[] = [];\n\t\tfor (let key in this.map) {\n\t\t\tentries.push(this.map[key]);\n\t\t}\n\t\treturn entries;\n\t}\n\n\tpublic set(k: K, t: T): boolean {\n\t\tif (this.get(k)) {\n\t\t\treturn false; // already present!\n\t\t}\n\n\t\tthis.push(k, t);\n\n\t\treturn true;\n\t}\n\n\tpublic delete(k: K): T {\n\t\tlet value:T= this.get(k);\n\t\tif (value) {\n\t\t\tthis.pop(k);\n\t\t\treturn value;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic has(k: K): boolean {\n\t\treturn !!this.get(k);\n\t}\n\n\tpublic clear(): void {\n\t\tthis.map = Object.create(null);\n\t\tthis._size = 0;\n\t}\n\n\tprotected push(key: K, value: T): void {\n\t\tconst entry: Entry<K, T> = { key, value };\n\t\tthis.map[key.toString()] = entry;\n\t\tthis._size++;\n\t}\n\n\tprotected pop(k: K): void {\n\t\tdelete this.map[k.toString()];\n\t\tthis._size--;\n\t}\n\n\tprotected peek(k: K): T {\n\t\tconst entry= this.map[k.toString()];\n\t\treturn entry ? entry.value : null;\n\t}\n}\n\n/**\n * A simple Map<T> that optionally allows to set a limit of entries to store. Once the limit is hit,\n * the cache will remove the entry that was last recently added. Or, if a ratio is provided below 1,\n * all elements will be removed until the ratio is full filled (e.g. 0.75 to remove 25% of old elements).\n */\nexport class LinkedMap<T> {\n\tprotected map: { [key: string]: Entry<string, T> };\n\tprivate head: Entry<string, T>;\n\tprivate tail: Entry<string, T>;\n\tprivate _size: number;\n\tprivate ratio: number;\n\n\tconstructor(private limit = Number.MAX_VALUE, ratio = 1) {\n\t\tthis.map = Object.create(null);\n\t\tthis._size = 0;\n\t\tthis.ratio = limit * ratio;\n\t}\n\n\tpublic get size(): number {\n\t\treturn this._size;\n\t}\n\n\tpublic set(key: string, value: T): boolean {\n\t\tif (this.map[key]) {\n\t\t\treturn false; // already present!\n\t\t}\n\n\t\tconst entry: Entry<string, T> = { key, value };\n\t\tthis.push(entry);\n\n\t\tif (this._size > this.limit) {\n\t\t\tthis.trim();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic get(key: string): T {\n\t\tconst entry = this.map[key];\n\n\t\treturn entry ? entry.value : null;\n\t}\n\n\tpublic delete(key: string): T {\n\t\tconst entry = this.map[key];\n\n\t\tif (entry) {\n\t\t\tthis.map[key] = void 0;\n\t\t\tthis._size--;\n\n\t\t\tif (entry.next) {\n\t\t\t\tentry.next.prev = entry.prev; // [A]<-[x]<-[C] = [A]<-[C]\n\t\t\t} else {\n\t\t\t\tthis.head = entry.prev; // [A]-[x] = [A]\n\t\t\t}\n\n\t\t\tif (entry.prev) {\n\t\t\t\tentry.prev.next = entry.next; // [A]->[x]->[C] = [A]->[C]\n\t\t\t} else {\n\t\t\t\tthis.tail = entry.next; // [x]-[A] = [A]\n\t\t\t}\n\n\t\t\treturn entry.value;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic has(key: string): boolean {\n\t\treturn !!this.map[key];\n\t}\n\n\tpublic clear(): void {\n\t\tthis.map = Object.create(null);\n\t\tthis._size = 0;\n\t\tthis.head = null;\n\t\tthis.tail = null;\n\t}\n\n\tprotected push(entry: Entry<string, T>): void {\n\t\tif (this.head) {\n\t\t\t// [A]-[B] = [A]-[B]->[X]\n\t\t\tentry.prev = this.head;\n\t\t\tthis.head.next = entry;\n\t\t}\n\n\t\tif (!this.tail) {\n\t\t\tthis.tail = entry;\n\t\t}\n\n\t\tthis.head = entry;\n\n\t\tthis.map[entry.key] = entry;\n\t\tthis._size++;\n\t}\n\n\tprivate trim(): void {\n\t\tif (this.tail) {\n\n\t\t\t// Remove all elements until ratio is reached\n\t\t\tif (this.ratio < this.limit) {\n\t\t\t\tlet index = 0;\n\t\t\t\tlet current = this.tail;\n\t\t\t\twhile (current.next) {\n\n\t\t\t\t\t// Remove the entry\n\t\t\t\t\tthis.map[current.key] = void 0;\n\t\t\t\t\tthis._size--;\n\n\t\t\t\t\t// if we reached the element that overflows our ratio condition\n\t\t\t\t\t// make its next element the new tail of the Map and adjust the size\n\t\t\t\t\tif (index === this.ratio) {\n\t\t\t\t\t\tthis.tail = current.next;\n\t\t\t\t\t\tthis.tail.prev = null;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move on\n\t\t\t\t\tcurrent = current.next;\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Just remove the tail element\n\t\t\telse {\n\t\t\t\tthis.map[this.tail.key] = void 0;\n\t\t\t\tthis._size--;\n\n\t\t\t\t// [x]-[B] = [B]\n\t\t\t\tthis.tail = this.tail.next;\n\t\t\t\tthis.tail.prev = null;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * A subclass of Map<T> that makes an entry the MRU entry as soon\n * as it is being accessed. In combination with the limit for the\n * maximum number of elements in the cache, it helps to remove those\n * entries from the cache that are LRU.\n */\nexport class LRUCache<T> extends LinkedMap<T> {\n\n\tconstructor(limit: number) {\n\t\tsuper(limit);\n\t}\n\n\tpublic get(key: string): T {\n\n\t\t// Upon access of an entry, make it the head of\n\t\t// the linked map so that it is the MRU element\n\t\tconst entry = this.map[key];\n\t\tif (entry) {\n\t\t\tthis.delete(key);\n\t\t\tthis.push(entry);\n\n\t\t\treturn entry.value;\n\t\t}\n\n\n\t\treturn null;\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n// --- THIS FILE IS TEMPORARY UNTIL ENV.TS IS CLEANED UP. IT CAN SAFELY BE USED IN ALL TARGET EXECUTION ENVIRONMENTS (node & dom) ---\n\nlet _isWindows = false;\nlet _isMacintosh = false;\nlet _isLinux = false;\nlet _isRootUser = false;\nlet _isNative = false;\nlet _isWeb = false;\nlet _isQunit = false;\nlet _locale = undefined;\nlet _language = undefined;\n\ninterface NLSConfig {\n\tlocale: string;\n\tavailableLanguages: { [key: string]: string; };\n}\n\ninterface INodeProcess {\n\tplatform: string;\n\tenv: { [key: string]: string; };\n\tgetuid(): number;\n}\ndeclare let process: INodeProcess;\ndeclare let global: any;\n\ninterface INavigator {\n\tuserAgent: string;\n\tlanguage: string;\n}\ndeclare let navigator: INavigator;\ndeclare let self: any;\n\nexport const LANGUAGE_DEFAULT = 'en';\n\n// OS detection\nif (typeof process === 'object') {\n\t_isWindows = (process.platform === 'win32');\n\t_isMacintosh = (process.platform === 'darwin');\n\t_isLinux = (process.platform === 'linux');\n\t_isRootUser = !_isWindows && (process.getuid() === 0);\n\tlet vscode_nls_config = process.env['VSCODE_NLS_CONFIG'];\n\tif (vscode_nls_config) {\n\t\ttry {\n\t\t\tlet nlsConfig:NLSConfig = JSON.parse(vscode_nls_config);\n\t\t\tlet resolved = nlsConfig.availableLanguages['*'];\n\t\t\t_locale = nlsConfig.locale;\n\t\t\t// VSCode's default language is 'en'\n\t\t\t_language = resolved ? resolved : LANGUAGE_DEFAULT;\n\t\t} catch (e) {\n\t\t}\n\t}\n\t_isNative = true;\n} else if (typeof navigator === 'object') {\n\tlet userAgent = navigator.userAgent;\n\t_isWindows = userAgent.indexOf('Windows') >= 0;\n\t_isMacintosh = userAgent.indexOf('Macintosh') >= 0;\n\t_isLinux = userAgent.indexOf('Linux') >= 0;\n\t_isWeb = true;\n\t_locale = navigator.language;\n\t_language = _locale;\n\t_isQunit = !!(<any>self).QUnit;\n}\n\nexport enum Platform {\n\tWeb,\n\tMac,\n\tLinux,\n\tWindows\n}\n\nexport let _platform:Platform = Platform.Web;\nif (_isNative) {\n\tif (_isMacintosh) {\n\t\t_platform = Platform.Mac;\n\t} else if (_isWindows) {\n\t\t_platform = Platform.Windows;\n\t} else if (_isLinux) {\n\t\t_platform = Platform.Linux;\n\t}\n}\n\nexport const isWindows = _isWindows;\nexport const isMacintosh = _isMacintosh;\nexport const isLinux = _isLinux;\nexport const isRootUser = _isRootUser;\nexport const isNative = _isNative;\nexport const isWeb = _isWeb;\nexport const isQunit = _isQunit;\nexport const platform = _platform;\n\n/**\n * The language used for the user interface. The format of\n * the string is all lower case (e.g. zh-tw for Traditional\n * Chinese)\n */\nexport const language = _language;\n\n/**\n * The OS locale or the locale specified by --locale. The format of\n * the string is all lower case (e.g. zh-tw for Traditional\n * Chinese). The UI is not necessarily shown in the provided locale.\n */\nexport const locale = _locale;\n\nexport interface TimeoutToken {\n}\n\nexport interface IntervalToken {\n}\n\ninterface IGlobals {\n\tWorker?: any;\n\tsetTimeout(callback: (...args: any[]) => void, delay: number, ...args: any[]): TimeoutToken;\n\tclearTimeout(token: TimeoutToken): void;\n\n\tsetInterval(callback: (...args: any[]) => void, delay: number, ...args: any[]): IntervalToken;\n\tclearInterval(token: IntervalToken);\n}\n\nconst _globals = <IGlobals> (typeof self === 'object' ? self : global);\nexport const globals: any = _globals;\n\nexport function hasWebWorkerSupport(): boolean {\n\treturn typeof _globals.Worker !== 'undefined';\n}\nexport const setTimeout = _globals.setTimeout.bind(_globals);\nexport const clearTimeout = _globals.clearTimeout.bind(_globals);\n\nexport const setInterval = _globals.setInterval.bind(_globals);\nexport const clearInterval = _globals.clearInterval.bind(_globals);","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {isLinux, isWindows} from 'vs/base/common/platform';\n\n/**\n * The forward slash path separator.\n */\nexport var sep = '/';\n\n/**\n * The native path separator depending on the OS.\n */\nexport var nativeSep = isWindows ? '\\\\' : '/';\n\nexport function relative(from: string, to: string): string {\n\n\tfrom = normalize(from);\n\tto = normalize(to);\n\n\tvar fromParts = from.split(sep),\n\t\ttoParts = to.split(sep);\n\n\twhile (fromParts.length > 0 && toParts.length > 0) {\n\t\tif (fromParts[0] === toParts[0]) {\n\t\t\tfromParts.shift();\n\t\t\ttoParts.shift();\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (var i = 0, len = fromParts.length; i < len; i++) {\n\t\ttoParts.unshift('..');\n\t}\n\n\treturn toParts.join(sep);\n}\n\n/**\n * @returns the directory name of a path.\n */\nexport function dirname(path: string): string {\n\tvar idx = ~path.lastIndexOf('/') || ~path.lastIndexOf('\\\\');\n\tif (idx === 0) {\n\t\treturn '.';\n\t} else if (~idx === 0) {\n\t\treturn path[0];\n\t} else {\n\t\treturn path.substring(0, ~idx);\n\t}\n}\n\n/**\n * @returns the base name of a path.\n */\nexport function basename(path: string): string {\n\tvar idx = ~path.lastIndexOf('/') || ~path.lastIndexOf('\\\\');\n\tif (idx === 0) {\n\t\treturn path;\n\t} else if (~idx === path.length - 1) {\n\t\treturn basename(path.substring(0, path.length - 1));\n\t} else {\n\t\treturn path.substr(~idx + 1);\n\t}\n}\n\n/**\n * @returns {{.far}} from boo.far or the empty string.\n */\nexport function extname(path: string): string {\n\tpath = basename(path);\n\tvar idx = ~path.lastIndexOf('.');\n\treturn idx ? path.substring(~idx) : '';\n}\n\nconst _posixBadPath = /(\\/\\.\\.?\\/)|(\\/\\.\\.?)$|^(\\.\\.?\\/)|(\\/\\/+)|(\\\\)/;\nconst _winBadPath = /(\\\\\\.\\.?\\\\)|(\\\\\\.\\.?)$|^(\\.\\.?\\\\)|(\\\\\\\\+)|(\\/)/;\n\nfunction _isNormal(path: string, win: boolean): boolean {\n\treturn win\n\t\t? !_winBadPath.test(path)\n\t\t: !_posixBadPath.test(path);\n}\n\nexport function normalize(path: string, toOSPath?: boolean): string {\n\n\tif (path === null || path === void 0) {\n\t\treturn path;\n\t}\n\n\tconst len = path.length;\n\tif (len === 0) {\n\t\treturn '.';\n\t}\n\n\tconst wantsBackslash = isWindows && toOSPath;\n\tif (_isNormal(path, wantsBackslash)) {\n\t\treturn path;\n\t}\n\n\tconst sep = wantsBackslash ? '\\\\' : '/';\n\tconst root = getRoot(path, sep);\n\n\t// skip the root-portion of the path\n\tlet start = root.length;\n\tlet skip = false;\n\tlet res = '';\n\n\tfor (let end = root.length; end <= len; end++) {\n\n\t\t// either at the end or at a path-separator character\n\t\tif (end === len || path.charCodeAt(end) === _slash || path.charCodeAt(end) === _backslash) {\n\n\t\t\tif (streql(path, start, end, '..')) {\n\t\t\t\t// skip current and remove parent (if there is already something)\n\t\t\t\tlet prev_start = res.lastIndexOf(sep);\n\t\t\t\tlet prev_part = res.slice(prev_start + 1);\n\t\t\t\tif ((root || prev_part.length > 0) && prev_part !== '..') {\n\t\t\t\t\tres = prev_start === -1 ? '' : res.slice(0, prev_start);\n\t\t\t\t\tskip = true;\n\t\t\t\t}\n\t\t\t} else if (streql(path, start, end, '.') && (root || res || end < len - 1)) {\n\t\t\t\t// skip current (if there is already something or if there is more to come)\n\t\t\t\tskip = true;\n\t\t\t}\n\n\t\t\tif (!skip) {\n\t\t\t\tlet part = path.slice(start, end);\n\t\t\t\tif (res !== '' && res[res.length - 1] !== sep) {\n\t\t\t\t\tres += sep;\n\t\t\t\t}\n\t\t\t\tres += part;\n\t\t\t}\n\t\t\tstart = end + 1;\n\t\t\tskip = false;\n\t\t}\n\t}\n\n\treturn root + res;\n}\n\nfunction streql(value: string, start: number, end: number, other: string): boolean {\n\treturn start + other.length === end &&  value.indexOf(other, start) === start;\n}\n\n/**\n * Computes the _root_ this path, like `getRoot('c:\\files') === c:\\`,\n * `getRoot('files:///files/path') === files:///`,\n * or `getRoot('\\\\server\\shares\\path') === \\\\server\\shares\\`\n */\nexport function getRoot(path: string, sep: string = '/'): string {\n\n\tif (!path) {\n\t\treturn '';\n\t}\n\n\tlet len = path.length;\n\tlet code = path.charCodeAt(0);\n\tif (code === _slash || code === _backslash) {\n\n\t\tcode = path.charCodeAt(1);\n\t\tif (code === _slash || code === _backslash) {\n\t\t\t// UNC candidate \\\\localhost\\shares\\ddd\n\t\t\t//               ^^^^^^^^^^^^^^^^^^^\n\t\t\tcode = path.charCodeAt(2);\n\t\t\tif (code !== _slash && code !== _backslash) {\n\t\t\t\tlet pos = 3;\n\t\t\t\tlet start = pos;\n\t\t\t\tfor (; pos < len; pos++) {\n\t\t\t\t\tcode = path.charCodeAt(pos);\n\t\t\t\t\tif (code === _slash || code === _backslash) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcode = path.charCodeAt(pos + 1);\n\t\t\t\tif (start !== pos && code !== _slash && code !== _backslash) {\n\t\t\t\t\tpos += 1;\n\t\t\t\t\tfor (; pos < len; pos++) {\n\t\t\t\t\t\tcode = path.charCodeAt(pos);\n\t\t\t\t\t\tif (code === _slash || code === _backslash) {\n\t\t\t\t\t\t\treturn path.slice(0, pos + 1) // consume this separator\n\t\t\t\t\t\t\t\t.replace(/[\\\\/]/g, sep);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// /user/far\n\t\t// ^\n\t\treturn sep;\n\n\t} else if ((code >= _A && code <= _Z) || (code >= _a && code <= _z)) {\n\t\t// check for windows drive letter c:\\ or c:\n\n\t\tif (path.charCodeAt(1) === _colon) {\n\t\t\tcode = path.charCodeAt(2);\n\t\t\tif (code === _slash || code === _backslash) {\n\t\t\t\t// C:\\fff\n\t\t\t\t// ^^^\n\t\t\t\treturn path.slice(0, 2) + sep;\n\t\t\t} else {\n\t\t\t\t// C:\n\t\t\t\t// ^^\n\t\t\t\treturn path.slice(0, 2);\n\t\t\t}\n\t\t}\n\t}\n\n\t// check for URI\n\t// scheme://authority/path\n\t// ^^^^^^^^^^^^^^^^^^^\n\tlet pos = path.indexOf('://');\n\tif (pos !== -1) {\n\t\tpos += 3; // 3 -> \"://\".length\n\t\tfor (; pos < len; pos++) {\n\t\t\tcode = path.charCodeAt(pos);\n\t\t\tif (code === _slash || code === _backslash) {\n\t\t\t\treturn path.slice(0, pos + 1); // consume this separator\n\t\t\t}\n\t\t}\n\t}\n\n\treturn '';\n}\n\nexport const join: (...parts: string[]) => string = function () {\n\n\tlet value = '';\n\tfor (let i = 0; i < arguments.length; i++) {\n\t\tlet part = arguments[i];\n\t\tif (i > 0) {\n\t\t\t// add the separater between two parts unless\n\t\t\t// there already is one\n\t\t\tlet last = value.charCodeAt(value.length - 1);\n\t\t\tif (last !== _slash && last !== _backslash) {\n\t\t\t\tlet next = part.charCodeAt(0);\n\t\t\t\tif (next !== _slash && next !== _backslash) {\n\n\t\t\t\t\tvalue += sep;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvalue += part;\n\t}\n\n\treturn normalize(value);\n};\n\n\n/**\n * Check if the path follows this pattern: `\\\\hostname\\sharename`.\n *\n * @see https://msdn.microsoft.com/en-us/library/gg465305.aspx\n * @return A boolean indication if the path is a UNC path, on none-windows\n * always false.\n */\nexport function isUNC(path: string): boolean {\n\tif (!isWindows) {\n\t\t// UNC is a windows concept\n\t\treturn false;\n\t}\n\n\tif (!path || path.length < 5) {\n\t\t// at least \\\\a\\b\n\t\treturn false;\n\t}\n\n\tlet code = path.charCodeAt(0);\n\tif (code !== _backslash) {\n\t\treturn false;\n\t}\n\tcode = path.charCodeAt(1);\n\tif (code !== _backslash) {\n\t\treturn false;\n\t}\n\tlet pos = 2;\n\tlet start = pos;\n\tfor (; pos < path.length; pos++) {\n\t\tcode = path.charCodeAt(pos);\n\t\tif (code === _backslash) {\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (start === pos) {\n\t\treturn false;\n\t}\n\tcode = path.charCodeAt(pos + 1);\n\tif (isNaN(code) || code === _backslash) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nfunction isPosixAbsolute(path: string): boolean {\n\treturn path && path[0] === '/';\n}\n\nexport function makePosixAbsolute(path: string): string {\n\treturn isPosixAbsolute(normalize(path)) ? path : sep + path;\n}\n\n\nconst _slash = '/'.charCodeAt(0);\nconst _backslash = '\\\\'.charCodeAt(0);\nconst _colon = ':'.charCodeAt(0);\nconst _a = 'a'.charCodeAt(0);\nconst _A = 'A'.charCodeAt(0);\nconst _z = 'z'.charCodeAt(0);\nconst _Z = 'Z'.charCodeAt(0);\n\nexport function isEqualOrParent(path: string, candidate: string): boolean {\n\n\tif (path === candidate) {\n\t\treturn true;\n\t}\n\n\tpath = normalize(path);\n\tcandidate = normalize(candidate);\n\n\tlet candidateLen = candidate.length;\n\tlet lastCandidateChar = candidate.charCodeAt(candidateLen - 1);\n\tif (lastCandidateChar === _slash) {\n\t\tcandidate = candidate.substring(0, candidateLen - 1);\n\t\tcandidateLen -= 1;\n\t}\n\n\tif (path === candidate) {\n\t\treturn true;\n\t}\n\n\tif (!isLinux) {\n\t\t// case insensitive\n\t\tpath = path.toLowerCase();\n\t\tcandidate = candidate.toLowerCase();\n\t}\n\n\tif (path === candidate) {\n\t\treturn true;\n\t}\n\n\tif (path.indexOf(candidate) !== 0) {\n\t\treturn false;\n\t}\n\n\tlet char = path.charCodeAt(candidateLen);\n\treturn char === _slash;\n}\n\n// Reference: https://en.wikipedia.org/wiki/Filename\nconst INVALID_FILE_CHARS = isWindows ? /[\\\\/:\\*\\?\"<>\\|]/g : /[\\\\/]/g;\nconst WINDOWS_FORBIDDEN_NAMES = /^(con|prn|aux|clock\\$|nul|lpt[0-9]|com[0-9])$/i;\nexport function isValidBasename(name: string): boolean {\n\tif (!name || name.length === 0 || /^\\s+$/.test(name)) {\n\t\treturn false; // require a name that is not just whitespace\n\t}\n\n\tINVALID_FILE_CHARS.lastIndex = 0; // the holy grail of software development\n\tif (INVALID_FILE_CHARS.test(name)) {\n\t\treturn false; // check for certain invalid file characters\n\t}\n\n\tif (isWindows && WINDOWS_FORBIDDEN_NAMES.test(name)) {\n\t\treturn false; // check for certain invalid file names\n\t}\n\n\tif (name === '.' || name === '..') {\n\t\treturn false; // check for reserved values\n\t}\n\n\tif (isWindows && name[name.length - 1] === '.') {\n\t\treturn false; // Windows: file cannot end with a \".\"\n\t}\n\n\tif (isWindows && name.length !== name.trim().length) {\n\t\treturn false; // Windows: file cannot end with a whitespace\n\t}\n\n\treturn true;\n}\n\nexport const isAbsoluteRegex = /^((\\/|[a-zA-Z]:\\\\)[^\\(\\)<>\\\\'\\\"\\[\\]]+)/;\n\n/**\n * If you have access to node, it is recommended to use node's path.isAbsolute().\n * This is a simple regex based approach.\n */\nexport function isAbsolute(path: string): boolean {\n\treturn isAbsoluteRegex.test(path);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport { globals } from 'vs/base/common/platform';\n\nvar hasPerformanceNow = (globals.performance && typeof globals.performance.now === 'function');\n\nexport class StopWatch {\n\n\tprivate _highResolution: boolean;\n\tprivate _startTime: number;\n\tprivate _stopTime: number;\n\n\tpublic static create(highResolution:boolean = true): StopWatch {\n\t\treturn new StopWatch(highResolution);\n\t}\n\n\tconstructor(highResolution: boolean) {\n\t\tthis._highResolution = hasPerformanceNow && highResolution;\n\t\tthis._startTime = this._now();\n\t\tthis._stopTime = -1;\n\t}\n\n\tpublic stop(): void {\n\t\tthis._stopTime = this._now();\n\t}\n\n\tpublic elapsed(): number {\n\t\tif (this._stopTime !== -1) {\n\t\t\treturn this._stopTime - this._startTime;\n\t\t}\n\t\treturn this._now() - this._startTime;\n\t}\n\n\tprivate _now(): number {\n\t\treturn this._highResolution ? globals.performance.now() : new Date().getTime();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {LinkedMap} from 'vs/base/common/map';\n\n/**\n * The empty string.\n */\nexport const empty = '';\n\n/**\n * @returns the provided number with the given number of preceding zeros.\n */\nexport function pad(n: number, l: number, char: string = '0'): string {\n\tlet str = '' + n;\n\tlet r = [str];\n\n\tfor (let i = str.length; i < l; i++) {\n\t\tr.push(char);\n\t}\n\n\treturn r.reverse().join('');\n}\n\nconst _formatRegexp = /{(\\d+)}/g;\n\n/**\n * Helper to produce a string with a variable number of arguments. Insert variable segments\n * into the string using the {n} notation where N is the index of the argument following the string.\n * @param value string to which formatting is applied\n * @param args replacements for {n}-entries\n */\nexport function format(value: string, ...args: any[]): string {\n\tif (args.length === 0) {\n\t\treturn value;\n\t}\n\treturn value.replace(_formatRegexp, function(match, group) {\n\t\tlet idx = parseInt(group, 10);\n\t\treturn isNaN(idx) || idx < 0 || idx >= args.length ?\n\t\t\tmatch :\n\t\t\targs[idx];\n\t});\n}\n\n/**\n * Converts HTML characters inside the string to use entities instead. Makes the string safe from\n * being used e.g. in HTMLElement.innerHTML.\n */\nexport function escape(html: string): string {\n\treturn html.replace(/[<|>|&]/g, function(match) {\n\t\tswitch (match) {\n\t\t\tcase '<': return '&lt;';\n\t\t\tcase '>': return '&gt;';\n\t\t\tcase '&': return '&amp;';\n\t\t\tdefault: return match;\n\t\t}\n\t});\n}\n\n/**\n * Escapes regular expression characters in a given string\n */\nexport function escapeRegExpCharacters(value: string): string {\n\treturn value.replace(/[\\-\\\\\\{\\}\\*\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&');\n}\n\n/**\n * Removes all occurrences of needle from the beginning and end of haystack.\n * @param haystack string to trim\n * @param needle the thing to trim (default is a blank)\n */\nexport function trim(haystack: string, needle: string = ' '): string {\n\tlet trimmed = ltrim(haystack, needle);\n\treturn rtrim(trimmed, needle);\n}\n\n/**\n * Removes all occurrences of needle from the beginning of haystack.\n * @param haystack string to trim\n * @param needle the thing to trim\n */\nexport function ltrim(haystack?: string, needle?: string): string {\n\tif (!haystack || !needle) {\n\t\treturn haystack;\n\t}\n\n\tlet needleLen = needle.length;\n\tif (needleLen === 0 || haystack.length === 0) {\n\t\treturn haystack;\n\t}\n\n\tlet offset = 0,\n\t\tidx = -1;\n\n\twhile ((idx = haystack.indexOf(needle, offset)) === offset) {\n\t\toffset = offset + needleLen;\n\t}\n\treturn haystack.substring(offset);\n}\n\n/**\n * Removes all occurrences of needle from the end of haystack.\n * @param haystack string to trim\n * @param needle the thing to trim\n */\nexport function rtrim(haystack?: string, needle?: string): string {\n\tif (!haystack || !needle) {\n\t\treturn haystack;\n\t}\n\n\tlet needleLen = needle.length,\n\t\thaystackLen = haystack.length;\n\n\tif (needleLen === 0 || haystackLen === 0) {\n\t\treturn haystack;\n\t}\n\n\tlet offset = haystackLen,\n\t\tidx = -1;\n\n\twhile (true) {\n\t\tidx = haystack.lastIndexOf(needle, offset - 1);\n\t\tif (idx === -1 || idx + needleLen !== offset) {\n\t\t\tbreak;\n\t\t}\n\t\tif (idx === 0) {\n\t\t\treturn '';\n\t\t}\n\t\toffset = idx;\n\t}\n\n\treturn haystack.substring(0, offset);\n}\n\nexport function convertSimple2RegExpPattern(pattern: string): string {\n\treturn pattern.replace(/[\\-\\\\\\{\\}\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&').replace(/[\\*]/g, '.*');\n}\n\nexport function stripWildcards(pattern: string): string {\n\treturn pattern.replace(/\\*/g, '');\n}\n\n/**\n * Determines if haystack starts with needle.\n */\nexport function startsWith(haystack: string, needle: string): boolean {\n\tif (haystack.length < needle.length) {\n\t\treturn false;\n\t}\n\n\tfor (let i = 0; i < needle.length; i++) {\n\t\tif (haystack[i] !== needle[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * Determines if haystack ends with needle.\n */\nexport function endsWith(haystack: string, needle: string): boolean {\n\tlet diff = haystack.length - needle.length;\n\tif (diff > 0) {\n\t\treturn haystack.lastIndexOf(needle) === diff;\n\t} else if (diff === 0) {\n\t\treturn haystack === needle;\n\t} else {\n\t\treturn false;\n\t}\n}\n\nexport function createRegExp(searchString: string, isRegex: boolean, matchCase: boolean, wholeWord: boolean, global:boolean): RegExp {\n\tif (searchString === '') {\n\t\tthrow new Error('Cannot create regex from empty string');\n\t}\n\tif (!isRegex) {\n\t\tsearchString = searchString.replace(/[\\-\\\\\\{\\}\\*\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&');\n\t}\n\tif (wholeWord) {\n\t\tif (!/\\B/.test(searchString.charAt(0))) {\n\t\t\tsearchString = '\\\\b' + searchString;\n\t\t}\n\t\tif (!/\\B/.test(searchString.charAt(searchString.length - 1))) {\n\t\t\tsearchString = searchString + '\\\\b';\n\t\t}\n\t}\n\tlet modifiers = '';\n\tif (global) {\n\t\tmodifiers += 'g';\n\t}\n\tif (!matchCase) {\n\t\tmodifiers += 'i';\n\t}\n\n\treturn new RegExp(searchString, modifiers);\n}\n\n/**\n * Create a regular expression only if it is valid and it doesn't lead to endless loop.\n */\nexport function createSafeRegExp(searchString:string, isRegex:boolean, matchCase:boolean, wholeWord:boolean): RegExp {\n\t\tif (searchString === '') {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Try to create a RegExp out of the params\n\t\tvar regex:RegExp = null;\n\t\ttry {\n\t\t\tregex = createRegExp(searchString, isRegex, matchCase, wholeWord, true);\n\t\t} catch (err) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Guard against endless loop RegExps & wrap around try-catch as very long regexes produce an exception when executed the first time\n\t\ttry {\n\t\t\tif (regExpLeadsToEndlessLoop(regex)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn regex;\n\t}\n\nexport function regExpLeadsToEndlessLoop(regexp: RegExp): boolean {\n\t// Exit early if it's one of these special cases which are meant to match\n\t// against an empty string\n\tif (regexp.source === '^' || regexp.source === '^$' || regexp.source === '$') {\n\t\treturn false;\n\t}\n\n\t// We check against an empty string. If the regular expression doesn't advance\n\t// (e.g. ends in an endless loop) it will match an empty string.\n\tlet match = regexp.exec('');\n\treturn (match && <any>regexp.lastIndex === 0);\n}\n\n/**\n * The normalize() method returns the Unicode Normalization Form of a given string. The form will be\n * the Normalization Form Canonical Composition.\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize}\n */\nexport let canNormalize = typeof ((<any>'').normalize) === 'function';\nconst nonAsciiCharactersPattern = /[^\\u0000-\\u0080]/;\nconst normalizedCache = new LinkedMap<string>(10000); // bounded to 10000 elements\nexport function normalizeNFC(str: string): string {\n\tif (!canNormalize || !str) {\n\t\treturn str;\n\t}\n\n\tconst cached = normalizedCache.get(str);\n\tif (cached) {\n\t\treturn cached;\n\t}\n\n\tlet res: string;\n\tif (nonAsciiCharactersPattern.test(str)) {\n\t\tres = (<any>str).normalize('NFC');\n\t} else {\n\t\tres = str;\n\t}\n\n\t// Use the cache for fast lookup\n\tnormalizedCache.set(str, res);\n\n\treturn res;\n}\n\n/**\n * Returns first index of the string that is not whitespace.\n * If string is empty or contains only whitespaces, returns -1\n */\nexport function firstNonWhitespaceIndex(str: string): number {\n\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\tif (str.charAt(i) !== ' ' && str.charAt(i) !== '\\t') {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\n/**\n * Returns the leading whitespace of the string.\n * If the string contains only whitespaces, returns entire string\n */\nexport function getLeadingWhitespace(str: string): string {\n\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\tif (str.charAt(i) !== ' ' && str.charAt(i) !== '\\t') {\n\t\t\treturn str.substring(0, i);\n\t\t}\n\t}\n\treturn str;\n}\n\n/**\n * Returns last index of the string that is not whitespace.\n * If string is empty or contains only whitespaces, returns -1\n */\nexport function lastNonWhitespaceIndex(str: string, startIndex: number = str.length - 1): number {\n\tfor (let i = startIndex; i >= 0; i--) {\n\t\tif (str.charAt(i) !== ' ' && str.charAt(i) !== '\\t') {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\nexport function localeCompare(strA: string, strB: string): number {\n\treturn strA.localeCompare(strB);\n}\n\nfunction isAsciiChar(code: number): boolean {\n\treturn (code >= 97 && code <= 122) || (code >= 65 && code <= 90);\n}\n\nexport function equalsIgnoreCase(a: string, b: string): boolean {\n\n\tlet len1 = a.length,\n\t\tlen2 = b.length;\n\n\tif (len1 !== len2) {\n\t\treturn false;\n\t}\n\n\tfor (let i = 0; i < len1; i++) {\n\n\t\tlet codeA = a.charCodeAt(i),\n\t\t\tcodeB = b.charCodeAt(i);\n\n\t\tif (codeA === codeB) {\n\t\t\tcontinue;\n\n\t\t} else if (isAsciiChar(codeA) && isAsciiChar(codeB)) {\n\t\t\tlet diff = Math.abs(codeA - codeB);\n\t\t\tif (diff !== 0 && diff !== 32) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (String.fromCharCode(codeA).toLocaleLowerCase() !== String.fromCharCode(codeB).toLocaleLowerCase()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * @returns the length of the common prefix of the two strings.\n */\nexport function commonPrefixLength(a: string, b: string): number {\n\n\tlet i: number,\n\t\tlen = Math.min(a.length, b.length);\n\n\tfor (i = 0; i < len; i++) {\n\t\tif (a.charCodeAt(i) !== b.charCodeAt(i)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn len;\n}\n\n/**\n * @returns the length of the common suffix of the two strings.\n */\nexport function commonSuffixLength(a: string, b: string): number {\n\n\tlet i: number,\n\t\tlen = Math.min(a.length, b.length);\n\n\tlet aLastIndex = a.length - 1;\n\tlet bLastIndex = b.length - 1;\n\n\tfor (i = 0; i < len; i++) {\n\t\tif (a.charCodeAt(aLastIndex - i) !== b.charCodeAt(bLastIndex - i)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn len;\n}\n\n// --- unicode\n// http://en.wikipedia.org/wiki/Surrogate_pair\n// Returns the code point starting at a specified index in a string\n// Code points U+0000 to U+D7FF and U+E000 to U+FFFF are represented on a single character\n// Code points U+10000 to U+10FFFF are represented on two consecutive characters\n//export function getUnicodePoint(str:string, index:number, len:number):number {\n//\tlet chrCode = str.charCodeAt(index);\n//\tif (0xD800 <= chrCode && chrCode <= 0xDBFF && index + 1 < len) {\n//\t\tlet nextChrCode = str.charCodeAt(index + 1);\n//\t\tif (0xDC00 <= nextChrCode && nextChrCode <= 0xDFFF) {\n//\t\t\treturn (chrCode - 0xD800) << 10 + (nextChrCode - 0xDC00) + 0x10000;\n//\t\t}\n//\t}\n//\treturn chrCode;\n//}\n//export function isLeadSurrogate(chr:string) {\n//\tlet chrCode = chr.charCodeAt(0);\n//\treturn ;\n//}\n//\n//export function isTrailSurrogate(chr:string) {\n//\tlet chrCode = chr.charCodeAt(0);\n//\treturn 0xDC00 <= chrCode && chrCode <= 0xDFFF;\n//}\n\nexport function isFullWidthCharacter(charCode:number): boolean {\n\t// Do a cheap trick to better support wrapping of wide characters, treat them as 2 columns\n\t// http://jrgraphix.net/research/unicode_blocks.php\n\t//          2E80  2EFF   CJK Radicals Supplement\n\t//          2F00  2FDF   Kangxi Radicals\n\t//          2FF0  2FFF   Ideographic Description Characters\n\t//          3000  303F   CJK Symbols and Punctuation\n\t//          3040  309F   Hiragana\n\t//          30A0  30FF   Katakana\n\t//          3100  312F   Bopomofo\n\t//          3130  318F   Hangul Compatibility Jamo\n\t//          3190  319F   Kanbun\n\t//          31A0  31BF   Bopomofo Extended\n\t//          31F0  31FF   Katakana Phonetic Extensions\n\t//          3200  32FF   Enclosed CJK Letters and Months\n\t//          3300  33FF   CJK Compatibility\n\t//          3400  4DBF   CJK Unified Ideographs Extension A\n\t//          4DC0  4DFF   Yijing Hexagram Symbols\n\t//          4E00  9FFF   CJK Unified Ideographs\n\t//          A000  A48F   Yi Syllables\n\t//          A490  A4CF   Yi Radicals\n\t//          AC00  D7AF   Hangul Syllables\n\t// [IGNORE] D800  DB7F   High Surrogates\n\t// [IGNORE] DB80  DBFF   High Private Use Surrogates\n\t// [IGNORE] DC00  DFFF   Low Surrogates\n\t// [IGNORE] E000  F8FF   Private Use Area\n\t//          F900  FAFF   CJK Compatibility Ideographs\n\t// [IGNORE] FB00  FB4F   Alphabetic Presentation Forms\n\t// [IGNORE] FB50  FDFF   Arabic Presentation Forms-A\n\t// [IGNORE] FE00  FE0F   Variation Selectors\n\t// [IGNORE] FE20  FE2F   Combining Half Marks\n\t// [IGNORE] FE30  FE4F   CJK Compatibility Forms\n\t// [IGNORE] FE50  FE6F   Small Form Variants\n\t// [IGNORE] FE70  FEFF   Arabic Presentation Forms-B\n\t//          FF00  FFEF   Halfwidth and Fullwidth Forms\n\t//               [https://en.wikipedia.org/wiki/Halfwidth_and_fullwidth_forms]\n\t//               of which FF01 - FF5E fullwidth ASCII of 21 to 7E\n\t// [IGNORE]    and FF65 - FFDC halfwidth of Katakana and Hangul\n\t// [IGNORE] FFF0  FFFF   Specials\n\tcharCode = +charCode; // @perf\n\treturn (\n\t\t(charCode >= 0x2E80 && charCode <= 0xD7AF)\n\t\t|| (charCode >= 0xF900 && charCode <= 0xFAFF)\n\t\t|| (charCode >= 0xFF01 && charCode <= 0xFF5E)\n\t);\n}\n\n/**\n * Computes the difference score for two strings. More similar strings have a higher score.\n * We use largest common subsequence dynamic programming approach but penalize in the end for length differences.\n * Strings that have a large length difference will get a bad default score 0.\n * Complexity - both time and space O(first.length * second.length)\n * Dynamic programming LCS computation http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n *\n * @param first a string\n * @param second a string\n */\nexport function difference(first: string, second: string, maxLenDelta: number = 4): number {\n\tlet lengthDifference = Math.abs(first.length - second.length);\n\t// We only compute score if length of the currentWord and length of entry.name are similar.\n\tif (lengthDifference > maxLenDelta) {\n\t\treturn 0;\n\t}\n\t// Initialize LCS (largest common subsequence) matrix.\n\tlet LCS: number[][] = [];\n\tlet zeroArray: number[] = [];\n\tlet i: number, j: number;\n\tfor (i = 0; i < second.length + 1; ++i) {\n\t\tzeroArray.push(0);\n\t}\n\tfor (i = 0; i < first.length + 1; ++i) {\n\t\tLCS.push(zeroArray);\n\t}\n\tfor (i = 1; i < first.length + 1; ++i) {\n\t\tfor (j = 1; j < second.length + 1; ++j) {\n\t\t\tif (first[i - 1] === second[j - 1]) {\n\t\t\t\tLCS[i][j] = LCS[i - 1][j - 1] + 1;\n\t\t\t} else {\n\t\t\t\tLCS[i][j] = Math.max(LCS[i - 1][j], LCS[i][j - 1]);\n\t\t\t}\n\t\t}\n\t}\n\treturn LCS[first.length][second.length] - Math.sqrt(lengthDifference);\n}\n\n/**\n * Returns an array in which every entry is the offset of a\n * line. There is always one entry which is zero.\n */\nexport function computeLineStarts(text: string): number[] {\n\tlet regexp = /\\r\\n|\\r|\\n/g,\n\t\tret: number[] = [0],\n\t\tmatch: RegExpExecArray;\n\twhile ((match = regexp.exec(text))) {\n\t\tret.push(regexp.lastIndex);\n\t}\n\treturn ret;\n}\n\n/**\n * Given a string and a max length returns a shorted version. Shorting\n * happens at favorable positions - such as whitespace or punctuation characters.\n */\nexport function lcut(text: string, n: number): string {\n\n\tif (text.length < n) {\n\t\treturn text;\n\t}\n\n\tlet segments = text.split(/\\b/),\n\t\tcount = 0;\n\n\tfor (let i = segments.length - 1; i >= 0; i--) {\n\t\tcount += segments[i].length;\n\n\t\tif (count > n) {\n\t\t\tsegments.splice(0, i);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn segments.join(empty).replace(/^\\s/, empty);\n}\n\n// Escape codes\n// http://en.wikipedia.org/wiki/ANSI_escape_code\nconst EL = /\\x1B\\x5B[12]?K/g; // Erase in line\nconst LF = /\\xA/g; // line feed\nconst COLOR_START = /\\x1b\\[\\d+m/g; // Color\nconst COLOR_END = /\\x1b\\[0?m/g; // Color\n\nexport function removeAnsiEscapeCodes(str: string): string {\n\tif (str) {\n\t\tstr = str.replace(EL, '');\n\t\tstr = str.replace(LF, '\\n');\n\t\tstr = str.replace(COLOR_START, '');\n\t\tstr = str.replace(COLOR_END, '');\n\t}\n\n\treturn str;\n}\n\n// -- UTF-8 BOM\n\nconst __utf8_bom = 65279;\n\nexport const UTF8_BOM_CHARACTER = String.fromCharCode(__utf8_bom);\n\nexport function startsWithUTF8BOM(str: string): boolean {\n\treturn (str && str.length > 0 && str.charCodeAt(0) === __utf8_bom);\n}\n\n/**\n * Appends two strings. If the appended result is longer than maxLength,\n * trims the start of the result and replaces it with '...'.\n */\nexport function appendWithLimit(first: string, second: string, maxLength: number): string {\n\tconst newLength = first.length + second.length;\n\tif (newLength > maxLength) {\n\t\tfirst = '...' + first.substr(newLength - maxLength);\n\t}\n\tif (second.length > maxLength) {\n\t\tfirst += second.substr(second.length - maxLength);\n\t} else {\n\t\tfirst += second;\n\t}\n\n\treturn first;\n}\n\n\nexport function safeBtoa(str: string): string {\n\treturn btoa(encodeURIComponent(str)); // we use encodeURIComponent because btoa fails for non Latin 1 values\n}\n\nexport function repeat(s:string, count: number): string {\n\tvar result = '';\n\tfor (var i = 0; i < count; i++) {\n\t\tresult += s;\n\t}\n\treturn result;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport strings = require('vs/base/common/strings');\nimport {LinkedMap} from 'vs/base/common/map';\n\nexport interface IFilter {\n\t// Returns null if word doesn't match.\n\t(word: string, wordToMatchAgainst: string): IMatch[];\n}\n\nexport interface IMatch {\n\tstart: number;\n\tend: number;\n}\n\n// Combined filters\n\n/**\n * @returns A filter which combines the provided set\n * of filters with an or. The *first* filters that\n * matches defined the return value of the returned\n * filter.\n */\nexport function or(...filter: IFilter[]): IFilter {\n\treturn function (word: string, wordToMatchAgainst: string): IMatch[] {\n\t\tfor (let i = 0, len = filter.length; i < len; i++) {\n\t\t\tlet match = filter[i](word, wordToMatchAgainst);\n\t\t\tif (match) {\n\t\t\t\treturn match;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n}\n\n/**\n * @returns A filter which combines the provided set\n * of filters with an and. The combines matches are\n * returned if *all* filters match.\n */\nexport function and(...filter: IFilter[]): IFilter {\n\treturn function (word: string, wordToMatchAgainst: string): IMatch[] {\n\t\tlet result: IMatch[] = [];\n\t\tfor (let i = 0, len = filter.length; i < len; i++) {\n\t\t\tlet match = filter[i](word, wordToMatchAgainst);\n\t\t\tif (!match) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tresult = result.concat(match);\n\t\t}\n\t\treturn result;\n\t};\n}\n\n// Prefix\n\nexport let matchesStrictPrefix: IFilter = (word: string, wordToMatchAgainst: string): IMatch[] => { return _matchesPrefix(false, word, wordToMatchAgainst); };\nexport let matchesPrefix: IFilter = (word: string, wordToMatchAgainst: string): IMatch[] => { return _matchesPrefix(true, word, wordToMatchAgainst); };\n\nfunction _matchesPrefix(ignoreCase: boolean, word: string, wordToMatchAgainst: string): IMatch[] {\n\tif (!wordToMatchAgainst || wordToMatchAgainst.length === 0 || wordToMatchAgainst.length < word.length) {\n\t\treturn null;\n\t}\n\tif (ignoreCase) {\n\t\tword = word.toLowerCase();\n\t\twordToMatchAgainst = wordToMatchAgainst.toLowerCase();\n\t}\n\tfor (let i = 0; i < word.length; i++) {\n\t\tif (word[i] !== wordToMatchAgainst[i]) {\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn word.length > 0 ? [{ start: 0, end: word.length }] : [];\n}\n\n// Contiguous Substring\n\nexport function matchesContiguousSubString(word: string, wordToMatchAgainst: string): IMatch[] {\n\tlet index = wordToMatchAgainst.toLowerCase().indexOf(word.toLowerCase());\n\tif (index === -1) {\n\t\treturn null;\n\t}\n\n\treturn [{ start: index, end: index + word.length }];\n}\n\n// Substring\n\nexport function matchesSubString(word: string, wordToMatchAgainst: string): IMatch[] {\n\treturn _matchesSubString(word.toLowerCase(), wordToMatchAgainst.toLowerCase(), 0, 0);\n}\n\nfunction _matchesSubString(word: string, wordToMatchAgainst: string, i: number, j: number): IMatch[] {\n\tif (i === word.length) {\n\t\treturn [];\n\t} else if (j === wordToMatchAgainst.length) {\n\t\treturn null;\n\t} else {\n\t\tif (word[i] === wordToMatchAgainst[j]) {\n\t\t\tlet result: IMatch[] = null;\n\t\t\tif (result = _matchesSubString(word, wordToMatchAgainst, i + 1, j + 1)) {\n\t\t\t\treturn join({ start: j, end: j + 1 }, result);\n\t\t\t}\n\t\t}\n\n\t\treturn _matchesSubString(word, wordToMatchAgainst, i, j + 1);\n\t}\n}\n\n// CamelCase\n\nfunction isLower(code: number): boolean {\n\treturn 97 <= code && code <= 122;\n}\n\nfunction isUpper(code: number): boolean {\n\treturn 65 <= code && code <= 90;\n}\n\nfunction isNumber(code: number): boolean {\n\treturn 48 <= code && code <= 57;\n}\n\nfunction isWhitespace(code: number): boolean {\n\treturn [32, 9, 10, 13].indexOf(code) > -1;\n}\n\nfunction isAlphanumeric(code: number): boolean {\n\treturn isLower(code) || isUpper(code) || isNumber(code);\n}\n\nfunction join(head: IMatch, tail: IMatch[]): IMatch[] {\n\tif (tail.length === 0) {\n\t\ttail = [head];\n\t} else if (head.end === tail[0].start) {\n\t\ttail[0].start = head.start;\n\t} else {\n\t\ttail.unshift(head);\n\t}\n\treturn tail;\n}\n\nfunction nextAnchor(camelCaseWord: string, start: number): number {\n\tfor (let i = start; i < camelCaseWord.length; i++) {\n\t\tlet c = camelCaseWord.charCodeAt(i);\n\t\tif (isUpper(c) || isNumber(c) || (i > 0 && !isAlphanumeric(camelCaseWord.charCodeAt(i - 1)))) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn camelCaseWord.length;\n}\n\nfunction _matchesCamelCase(word: string, camelCaseWord: string, i: number, j: number): IMatch[] {\n\tif (i === word.length) {\n\t\treturn [];\n\t} else if (j === camelCaseWord.length) {\n\t\treturn null;\n\t} else if (word[i] !== camelCaseWord[j].toLowerCase()) {\n\t\treturn null;\n\t} else {\n\t\tlet result = null;\n\t\tlet nextUpperIndex = j + 1;\n\t\tresult = _matchesCamelCase(word, camelCaseWord, i + 1, j + 1);\n\t\twhile (!result && (nextUpperIndex = nextAnchor(camelCaseWord, nextUpperIndex)) < camelCaseWord.length) {\n\t\t\tresult = _matchesCamelCase(word, camelCaseWord, i + 1, nextUpperIndex);\n\t\t\tnextUpperIndex++;\n\t\t}\n\t\treturn result === null ? null : join({ start: j, end: j + 1 }, result);\n\t}\n}\n\n// Heuristic to avoid computing camel case matcher for words that don't\n// look like camelCaseWords.\nfunction isCamelCaseWord(word: string): boolean {\n\tif (word.length > 60) {\n\t\treturn false;\n\t}\n\n\tlet upper = 0, lower = 0, alpha = 0, numeric = 0, code = 0;\n\n\tfor (let i = 0; i < word.length; i++) {\n\t\tcode = word.charCodeAt(i);\n\n\t\tif (isUpper(code)) { upper++; }\n\t\tif (isLower(code)) { lower++; }\n\t\tif (isAlphanumeric(code)) { alpha++; }\n\t\tif (isNumber(code)) { numeric++; }\n\t}\n\n\tlet upperPercent = upper / word.length;\n\tlet lowerPercent = lower / word.length;\n\tlet alphaPercent = alpha / word.length;\n\tlet numericPercent = numeric / word.length;\n\n\treturn lowerPercent > 0.2 && upperPercent < 0.8 && alphaPercent > 0.6 && numericPercent < 0.2;\n}\n\n// Heuristic to avoid computing camel case matcher for words that don't\n// look like camel case patterns.\nfunction isCamelCasePattern(word: string): boolean {\n\tlet upper = 0, lower = 0, code = 0, whitespace = 0;\n\n\tfor (let i = 0; i < word.length; i++) {\n\t\tcode = word.charCodeAt(i);\n\n\t\tif (isUpper(code)) { upper++; }\n\t\tif (isLower(code)) { lower++; }\n\t\tif (isWhitespace(code)) { whitespace++; }\n\t}\n\n\tif ((upper === 0 || lower === 0) && whitespace === 0) {\n\t\treturn word.length <= 30;\n\t} else {\n\t\treturn upper <= 5;\n\t}\n}\n\nexport function matchesCamelCase(word: string, camelCaseWord: string): IMatch[] {\n\tif (!camelCaseWord || camelCaseWord.length === 0) {\n\t\treturn null;\n\t}\n\n\tif (!isCamelCasePattern(word)) {\n\t\treturn null;\n\t}\n\n\tif (!isCamelCaseWord(camelCaseWord)) {\n\t\treturn null;\n\t}\n\n\tlet result: IMatch[] = null;\n\tlet i = 0;\n\n\twhile (i < camelCaseWord.length && (result = _matchesCamelCase(word.toLowerCase(), camelCaseWord, 0, i)) === null) {\n\t\ti = nextAnchor(camelCaseWord, i + 1);\n\t}\n\n\treturn result;\n}\n\n// Matches beginning of words supporting non-ASCII languages\n// E.g. \"gp\" or \"g p\" will match \"Git: Pull\"\n// Useful in cases where the target is words (e.g. command labels)\n\nexport function matchesWords(word: string, target: string): IMatch[] {\n\tif (!target || target.length === 0) {\n\t\treturn null;\n\t}\n\n\tlet result: IMatch[] = null;\n\tlet i = 0;\n\n\twhile (i < target.length && (result = _matchesWords(word.toLowerCase(), target, 0, i)) === null) {\n\t\ti = nextWord(target, i + 1);\n\t}\n\n\treturn result;\n}\n\nfunction _matchesWords(word: string, target: string, i: number, j: number): IMatch[] {\n\tif (i === word.length) {\n\t\treturn [];\n\t} else if (j === target.length) {\n\t\treturn null;\n\t} else if (word[i] !== target[j].toLowerCase()) {\n\t\treturn null;\n\t} else {\n\t\tlet result = null;\n\t\tlet nextWordIndex = j + 1;\n\t\tresult = _matchesWords(word, target, i + 1, j + 1);\n\t\twhile (!result && (nextWordIndex = nextWord(target, nextWordIndex)) < target.length) {\n\t\t\tresult = _matchesWords(word, target, i + 1, nextWordIndex);\n\t\t\tnextWordIndex++;\n\t\t}\n\t\treturn result === null ? null : join({ start: j, end: j + 1 }, result);\n\t}\n}\n\nfunction nextWord(word: string, start: number): number {\n\tfor (let i = start; i < word.length; i++) {\n\t\tlet c = word.charCodeAt(i);\n\t\tif (isWhitespace(c) || (i > 0 && isWhitespace(word.charCodeAt(i - 1)))) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn word.length;\n}\n\n// Fuzzy\n\nexport enum SubstringMatching {\n\tContiguous,\n\tSeparate\n}\n\nexport const fuzzyContiguousFilter = or(matchesPrefix, matchesCamelCase, matchesContiguousSubString);\nconst fuzzySeparateFilter = or(matchesPrefix, matchesCamelCase, matchesSubString);\nconst fuzzyRegExpCache = new LinkedMap<RegExp>(10000); // bounded to 10000 elements\n\nexport function matchesFuzzy(word: string, wordToMatchAgainst: string, enableSeparateSubstringMatching = false): IMatch[] {\n\tif (typeof word !== 'string' || typeof wordToMatchAgainst !== 'string') {\n\t\treturn null; // return early for invalid input\n\t}\n\n\t// Form RegExp for wildcard matches\n\tlet regexp = fuzzyRegExpCache.get(word);\n\tif (!regexp) {\n\t\tregexp = new RegExp(strings.convertSimple2RegExpPattern(word), 'i');\n\t\tfuzzyRegExpCache.set(word, regexp);\n\t}\n\n\t// RegExp Filter\n\tlet match: RegExpExecArray = regexp.exec(wordToMatchAgainst);\n\tif (match) {\n\t\treturn [{ start: match.index, end: match.index + match[0].length }];\n\t}\n\n\t// Default Filter\n\treturn enableSeparateSubstringMatching ? fuzzySeparateFilter(word, wordToMatchAgainst) : fuzzyContiguousFilter(word, wordToMatchAgainst);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport strings = require('vs/base/common/strings');\nimport paths = require('vs/base/common/paths');\nimport {LinkedMap} from 'vs/base/common/map';\n\nexport interface IExpression {\n\t[pattern: string]: boolean | SiblingClause | any;\n}\n\nexport interface SiblingClause {\n\twhen: string;\n}\n\nconst PATH_REGEX = '[/\\\\\\\\]';\t\t// any slash or backslash\nconst NO_PATH_REGEX = '[^/\\\\\\\\]';\t// any non-slash and non-backslash\n\nfunction starsToRegExp(starCount: number): string {\n\tswitch (starCount) {\n\t\tcase 0:\n\t\t\treturn '';\n\t\tcase 1:\n\t\t\treturn `${NO_PATH_REGEX}*?`; // 1 star matches any number of characters except path separator (/ and \\) - non greedy (?)\n\t\tdefault:\n\t\t\t// Matches:  (Path Sep OR Path Val followed by Path Sep OR Path Sep followed by Path Val) 0-many times\n\t\t\t// Group is non capturing because we don't need to capture at all (?:...)\n\t\t\t// Overall we use non-greedy matching because it could be that we match too much\n\t\t\treturn `(?:${PATH_REGEX}|${NO_PATH_REGEX}+${PATH_REGEX}|${PATH_REGEX}${NO_PATH_REGEX}+)*?`;\n\t}\n}\n\nexport function splitGlobAware(pattern: string, splitChar: string): string[] {\n\tif (!pattern) {\n\t\treturn [];\n\t}\n\n\tlet segments: string[] = [];\n\n\tlet inBraces = false;\n\tlet inBrackets = false;\n\n\tlet char: string;\n\tlet curVal = '';\n\tfor (let i = 0; i < pattern.length; i++) {\n\t\tchar = pattern[i];\n\n\t\tswitch (char) {\n\t\t\tcase splitChar:\n\t\t\t\tif (!inBraces && !inBrackets) {\n\t\t\t\t\tsegments.push(curVal);\n\t\t\t\t\tcurVal = '';\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '{':\n\t\t\t\tinBraces = true;\n\t\t\t\tbreak;\n\t\t\tcase '}':\n\t\t\t\tinBraces = false;\n\t\t\t\tbreak;\n\t\t\tcase '[':\n\t\t\t\tinBrackets = true;\n\t\t\t\tbreak;\n\t\t\tcase ']':\n\t\t\t\tinBrackets = false;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tcurVal += char;\n\t}\n\n\t// Tail\n\tif (curVal) {\n\t\tsegments.push(curVal);\n\t}\n\n\treturn segments;\n}\n\nfunction parseRegExp(pattern: string): string {\n\tif (!pattern) {\n\t\treturn '';\n\t}\n\n\tlet regEx = '';\n\n\t// Split up into segments for each slash found\n\tlet segments = splitGlobAware(pattern, '/');\n\n\t// Special case where we only have globstars\n\tif (segments.every(s => s === '**')) {\n\t\tregEx = '.*';\n\t}\n\n\t// Build regex over segments\n\telse {\n\t\tlet previousSegmentWasGlobStar = false;\n\t\tsegments.forEach((segment, index) => {\n\n\t\t\t// Globstar is special\n\t\t\tif (segment === '**') {\n\n\t\t\t\t// if we have more than one globstar after another, just ignore it\n\t\t\t\tif (!previousSegmentWasGlobStar) {\n\t\t\t\t\tregEx += starsToRegExp(2);\n\t\t\t\t\tpreviousSegmentWasGlobStar = true;\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// States\n\t\t\tlet inBraces = false;\n\t\t\tlet braceVal = '';\n\n\t\t\tlet inBrackets = false;\n\t\t\tlet bracketVal = '';\n\n\t\t\tlet char: string;\n\t\t\tfor (let i = 0; i < segment.length; i++) {\n\t\t\t\tchar = segment[i];\n\n\t\t\t\t// Support brace expansion\n\t\t\t\tif (char !== '}' && inBraces) {\n\t\t\t\t\tbraceVal += char;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Support brackets\n\t\t\t\tif (char !== ']' && inBrackets) {\n\t\t\t\t\tlet res: string;\n\t\t\t\t\tswitch (char) {\n\t\t\t\t\t\tcase '-':\t\t// allow the range operator\n\t\t\t\t\t\t\tres = char;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '^':\t\t// allow the negate operator\n\t\t\t\t\t\t\tres = char;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tres = strings.escapeRegExpCharacters(char);\n\t\t\t\t\t}\n\n\t\t\t\t\tbracketVal += res;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tswitch (char) {\n\t\t\t\t\tcase '{':\n\t\t\t\t\t\tinBraces = true;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase '[':\n\t\t\t\t\t\tinBrackets = true;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase '}':\n\t\t\t\t\t\tlet choices = splitGlobAware(braceVal, ',');\n\n\t\t\t\t\t\t// Converts {foo,bar} => [foo|bar]\n\t\t\t\t\t\tlet braceRegExp = `(?:${choices.map(c => parseRegExp(c)).join('|')})`;\n\n\t\t\t\t\t\tregEx += braceRegExp;\n\n\t\t\t\t\t\tinBraces = false;\n\t\t\t\t\t\tbraceVal = '';\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase ']':\n\t\t\t\t\t\tregEx += ('[' + bracketVal + ']');\n\n\t\t\t\t\t\tinBrackets = false;\n\t\t\t\t\t\tbracketVal = '';\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\tcase '?':\n\t\t\t\t\t\tregEx += NO_PATH_REGEX; // 1 ? matches any single character except path separator (/ and \\)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase '*':\n\t\t\t\t\t\tregEx += starsToRegExp(1);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tregEx += strings.escapeRegExpCharacters(char);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Tail: Add the slash we had split on if there is more to come and the next one is not a globstar\n\t\t\tif (index < segments.length - 1 && segments[index + 1] !== '**') {\n\t\t\t\tregEx += PATH_REGEX;\n\t\t\t}\n\n\t\t\t// reset state\n\t\t\tpreviousSegmentWasGlobStar = false;\n\t\t});\n\t}\n\n\treturn regEx;\n}\n\n// regexes to check for trival glob patterns that just check for String#endsWith\nconst T1 = /^\\*\\*\\/\\*\\.[\\w\\.-]+$/; \t\t\t\t\t\t   // **/*.something\nconst T2 = /^\\*\\*\\/[\\w\\.-]+$/; \t\t\t\t\t\t\t   // **/something\nconst T3 = /^{\\*\\*\\/\\*\\.[\\w\\.-]+(,\\*\\*\\/\\*\\.[\\w\\.-]+)*}$/; // {**/*.something,**/*.else}\n\nenum Trivia {\n\tT1, // **/*.something\n\tT2, // **/something\n\tT3  // {**/*.something,**/*.else}\n}\n\ninterface IParsedPattern {\n\tregexp?: RegExp;\n\ttrivia?: Trivia;\n}\n\nconst CACHE = new LinkedMap<IParsedPattern>(10000); // bounded to 10000 elements\n\nfunction parsePattern(pattern: string): IParsedPattern {\n\tif (!pattern) {\n\t\treturn null;\n\t}\n\n\t// Whitespace trimming\n\tpattern = pattern.trim();\n\n\t// Check cache\n\tlet parsedPattern = CACHE.get(pattern);\n\tif (parsedPattern) {\n\t\tif (parsedPattern.regexp) {\n\t\t\tparsedPattern.regexp.lastIndex = 0; // reset RegExp to its initial state to reuse it!\n\t\t}\n\n\t\treturn parsedPattern;\n\t}\n\n\tparsedPattern = Object.create(null);\n\n\t// Check for Trivias\n\tif (T1.test(pattern)) {\n\t\tparsedPattern.trivia = Trivia.T1;\n\t} else if (T2.test(pattern)) {\n\t\tparsedPattern.trivia = Trivia.T2;\n\t} else if (T3.test(pattern)) {\n\t\tparsedPattern.trivia = Trivia.T3;\n\t}\n\n\t// Otherwise convert to pattern\n\telse {\n\t\tparsedPattern.regexp = toRegExp(`^${parseRegExp(pattern)}$`);\n\t}\n\n\t// Cache\n\tCACHE.set(pattern, parsedPattern);\n\n\treturn parsedPattern;\n}\n\nfunction toRegExp(regEx: string): RegExp {\n\ttry {\n\t\treturn new RegExp(regEx);\n\t} catch (error) {\n\t\treturn /.^/; // create a regex that matches nothing if we cannot parse the pattern\n\t}\n}\n\n/**\n * Simplified glob matching. Supports a subset of glob patterns:\n * - * matches anything inside a path segment\n * - ? matches 1 character inside a path segment\n * - ** matches anything including an empty path segment\n * - simple brace expansion ({js,ts} => js or ts)\n * - character ranges (using [...])\n */\nexport function match(pattern: string, path: string): boolean;\nexport function match(expression: IExpression, path: string, siblings?: string[]): string /* the matching pattern */;\nexport function match(arg1: string | IExpression, path: string, siblings?: string[]): any {\n\tif (!arg1 || !path) {\n\t\treturn false;\n\t}\n\n\t// Glob with String\n\tif (typeof arg1 === 'string') {\n\t\tconst parsedPattern = parsePattern(arg1);\n\t\tif (!parsedPattern) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// common pattern: **/*.txt just need endsWith check\n\t\tif (parsedPattern.trivia === Trivia.T1) {\n\t\t\treturn strings.endsWith(path, arg1.substr(4)); // '**/*'.length === 4\n\t\t}\n\n\t\t// common pattern: **/some.txt just need basename check\n\t\tif (parsedPattern.trivia === Trivia.T2) {\n\t\t\tconst base = arg1.substr(3); // '**/'.length === 3\n\n\t\t\treturn path === base || strings.endsWith(path, `/${base}`) || strings.endsWith(path, `\\\\${base}`);\n\t\t}\n\n\t\t// repetition of common patterns (see above) {**/*.txt,**/*.png}\n\t\tif (parsedPattern.trivia === Trivia.T3) {\n\t\t\treturn arg1.slice(1, -1).split(',').some(pattern => match(pattern, path));\n\t\t}\n\n\t\treturn parsedPattern.regexp.test(path);\n\t}\n\n\t// Glob with Expression\n\treturn matchExpression(<IExpression>arg1, path, siblings);\n}\n\nfunction matchExpression(expression: IExpression, path: string, siblings?: string[]): string /* the matching pattern */ {\n\tlet patterns = Object.getOwnPropertyNames(expression);\n\tlet basename: string;\n\tfor (let i = 0; i < patterns.length; i++) {\n\t\tlet pattern = patterns[i];\n\n\t\tlet value = expression[pattern];\n\t\tif (value === false) {\n\t\t\tcontinue; // pattern is disabled\n\t\t}\n\n\t\t// Pattern matches path\n\t\tif (match(pattern, path)) {\n\n\t\t\t// Expression Pattern is <boolean>\n\t\t\tif (typeof value === 'boolean') {\n\t\t\t\treturn pattern;\n\t\t\t}\n\n\t\t\t// Expression Pattern is <SiblingClause>\n\t\t\tif (value && typeof (<SiblingClause>value).when === 'string') {\n\t\t\t\tif (!siblings || !siblings.length) {\n\t\t\t\t\tcontinue; // pattern is malformed or we don't have siblings\n\t\t\t\t}\n\n\t\t\t\tif (!basename) {\n\t\t\t\t\tbasename = strings.rtrim(paths.basename(path), paths.extname(path));\n\t\t\t\t}\n\n\t\t\t\tlet clause = <SiblingClause>value;\n\t\t\t\tlet clausePattern = clause.when.replace('$(basename)', basename);\n\t\t\t\tif (siblings.some((sibling) => sibling === clausePattern)) {\n\t\t\t\t\treturn pattern;\n\t\t\t\t} else {\n\t\t\t\t\tcontinue; // pattern does not match in the end because the when clause is not satisfied\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expression is Anything\n\t\t\treturn pattern;\n\t\t}\n\t}\n\n\treturn null;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\n\nconst _typeof = {\n\tnumber: 'number',\n\tstring: 'string',\n\tundefined: 'undefined',\n\tobject: 'object',\n\tfunction: 'function'\n};\n\n/**\n * @returns whether the provided parameter is a JavaScript Array or not.\n */\nexport function isArray(array: any): array is any[] {\n\tif (Array.isArray) {\n\t\treturn Array.isArray(array);\n\t}\n\n\tif (array && typeof (array.length) === _typeof.number && array.constructor === Array) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript String or not.\n */\nexport function isString(str: any): str is string {\n\tif (typeof (str) === _typeof.string|| str instanceof String) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript Array and each element in the array is a string.\n */\nexport function isStringArray(value: any): value is string[] {\n\treturn isArray(value) && (<any[]>value).every(elem => isString(elem));\n}\n\n/**\n *\n * @returns whether the provided parameter is of type `object` but **not**\n *\t`null`, an `array`, a `regexp`, nor a `date`.\n */\nexport function isObject(obj: any): obj is any {\n\treturn typeof obj === _typeof.object\n\t\t&& obj !== null\n\t\t&& !Array.isArray(obj)\n\t\t&& !(obj instanceof RegExp)\n\t\t&& !(obj instanceof Date);\n}\n\n/**\n * In **contrast** to just checking `typeof` this will return `false` for `NaN`.\n * @returns whether the provided parameter is a JavaScript Number or not.\n */\nexport function isNumber(obj: any): obj is number {\n\tif ((typeof (obj) === _typeof.number || obj instanceof Number) && !isNaN(obj)) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript Boolean or not.\n */\nexport function isBoolean(obj: any): obj is boolean {\n\treturn obj === true || obj === false;\n}\n\n/**\n * @returns whether the provided parameter is undefined.\n */\nexport function isUndefined(obj: any): boolean {\n\treturn typeof (obj) === _typeof.undefined;\n}\n\n/**\n * @returns whether the provided parameter is undefined or null.\n */\nexport function isUndefinedOrNull(obj: any): boolean {\n\treturn isUndefined(obj) || obj === null;\n}\n\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * @returns whether the provided parameter is an empty JavaScript Object or not.\n */\nexport function isEmptyObject(obj: any): obj is any {\n\tif (!isObject(obj)) {\n\t\treturn false;\n\t}\n\n\tfor (let key in obj) {\n\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript Function or not.\n */\nexport function isFunction(obj: any): obj is Function {\n\treturn typeof obj === _typeof.function;\n}\n\n/**\n * @returns whether the provided parameters is are JavaScript Function or not.\n */\nexport function areFunctions(...objects: any[]): boolean {\n\treturn objects && objects.length > 0 && objects.every(isFunction);\n}\n\nexport type TypeConstraint = string | Function;\n\nexport function validateConstraints(args: any[], constraints: TypeConstraint[]): void {\n\tconst len = Math.min(args.length, constraints.length);\n\tfor (let i = 0; i < len; i++) {\n\t\tvalidateConstraint(args[i], constraints[i]);\n\t}\n}\n\nexport function validateConstraint(arg: any, constraint: TypeConstraint): void {\n\n\tif (isString(constraint)) {\n\t\tif (typeof arg !== constraint) {\n\t\t\tthrow new Error(`argument does not match constraint: typeof ${constraint}`);\n\t\t}\n\t} else if (isFunction(constraint)) {\n\t\tif (arg instanceof constraint) {\n\t\t\treturn;\n\t\t}\n\t\tif (arg && arg.constructor === constraint) {\n\t\t\treturn;\n\t\t}\n\t\tif (constraint.length === 1 && constraint.call(undefined, arg) === true) {\n\t\t\treturn;\n\t\t}\n\t\tthrow new Error(`argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true`);\n\t}\n}\n\n/**\n * Creates a new object of the provided class and will call the constructor with\n * any additional argument supplied.\n */\nexport function create(ctor: Function, ...args: any[]): any {\n\tlet obj = Object.create(ctor.prototype);\n\tctor.apply(obj, args);\n\n\treturn obj;\n}\n\nexport interface IFunction0<T> {\n\t(): T;\n}\nexport interface IFunction1<A1, T> {\n\t(a1: A1): T;\n}\nexport interface IFunction2<A1, A2, T> {\n\t(a1: A1, a2: A2): T;\n}\nexport interface IFunction3<A1, A2, A3, T> {\n\t(a1: A1, a2: A2, a3: A3): T;\n}\nexport interface IFunction4<A1, A2, A3, A4, T> {\n\t(a1: A1, a2: A2, a3: A3, a4: A4): T;\n}\nexport interface IFunction5<A1, A2, A3, A4, A5, T> {\n\t(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): T;\n}\nexport interface IFunction6<A1, A2, A3, A4, A5, A6, T> {\n\t(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): T;\n}\nexport interface IFunction7<A1, A2, A3, A4, A5, A6, A7, T> {\n\t(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): T;\n}\nexport interface IFunction8<A1, A2, A3, A4, A5, A6, A7, A8, T> {\n\t(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): T;\n}\n\nexport interface IAction0 extends IFunction0<void> { }\nexport interface IAction1<A1> extends IFunction1<A1, void> { }\nexport interface IAction2<A1, A2> extends IFunction2<A1, A2, void> { }\nexport interface IAction3<A1, A2, A3> extends IFunction3<A1, A2, A3, void> { }\nexport interface IAction4<A1, A2, A3, A4> extends IFunction4<A1, A2, A3, A4, void> { }\nexport interface IAction5<A1, A2, A3, A4, A5> extends IFunction5<A1, A2, A3, A4, A5, void> { }\nexport interface IAction6<A1, A2, A3, A4, A5, A6> extends IFunction6<A1, A2, A3, A4, A5, A6, void> { }\nexport interface IAction7<A1, A2, A3, A4, A5, A6, A7> extends IFunction7<A1, A2, A3, A4, A5, A6, A7, void> { }\nexport interface IAction8<A1, A2, A3, A4, A5, A6, A7, A8> extends IFunction8<A1, A2, A3, A4, A5, A6, A7, A8, void> { }\n\nexport interface IAsyncFunction0<T> extends IFunction0<TPromise<T>> { }\nexport interface IAsyncFunction1<A1, T> extends IFunction1<A1, TPromise<T>> { }\nexport interface IAsyncFunction2<A1, A2, T> extends IFunction2<A1, A2, TPromise<T>> { }\nexport interface IAsyncFunction3<A1, A2, A3, T> extends IFunction3<A1, A2, A3, TPromise<T>> { }\nexport interface IAsyncFunction4<A1, A2, A3, A4, T> extends IFunction4<A1, A2, A3, A4, TPromise<T>> { }\nexport interface IAsyncFunction5<A1, A2, A3, A4, A5, T> extends IFunction5<A1, A2, A3, A4, A5, TPromise<T>> { }\nexport interface IAsyncFunction6<A1, A2, A3, A4, A5, A6, T> extends IFunction6<A1, A2, A3, A4, A5, A6, TPromise<T>> { }\nexport interface IAsyncFunction7<A1, A2, A3, A4, A5, A6, A7, T> extends IFunction7<A1, A2, A3, A4, A5, A6, A7, TPromise<T>> { }\nexport interface IAsyncFunction8<A1, A2, A3, A4, A5, A6, A7, A8, T> extends IFunction8<A1, A2, A3, A4, A5, A6, A7, A8, TPromise<T>> { }\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {isEmptyObject} from 'vs/base/common/types';\nimport {forEach, contains, lookup} from 'vs/base/common/collections';\n\nexport interface Node<T> {\n\tdata: T;\n\tincoming: { [key: string]: Node<T> };\n\toutgoing: { [key: string]: Node<T> };\n}\n\nfunction newNode<T>(data: T): Node<T> {\n\treturn {\n\t\tdata: data,\n\t\tincoming: Object.create(null),\n\t\toutgoing: Object.create(null)\n\t};\n}\n\nexport class Graph<T> {\n\n\tprivate _nodes: { [key: string]: Node<T> } = Object.create(null);\n\n\tconstructor(private _hashFn: (element: T) => string) {\n\t\t// empty\n\t}\n\n\troots(): Node<T>[] {\n\t\tvar ret: Node<T>[] = [];\n\t\tforEach(this._nodes, entry => {\n\t\t\tif (isEmptyObject(entry.value.outgoing)) {\n\t\t\t\tret.push(entry.value);\n\t\t\t}\n\t\t});\n\t\treturn ret;\n\t}\n\n\ttraverse(start: T, inwards: boolean, callback: (data: T) => void): void {\n\t\tvar startNode = this.lookup(start);\n\t\tif (!startNode) {\n\t\t\treturn;\n\t\t}\n\t\tthis._traverse(startNode, inwards, Object.create(null), callback);\n\t}\n\n\tprivate _traverse(node: Node<T>, inwards: boolean, seen: { [key: string]: boolean }, callback: (data: T) => void): void {\n\t\tvar key = this._hashFn(node.data);\n\t\tif (contains(seen, key)) {\n\t\t\treturn;\n\t\t}\n\t\tseen[key] = true;\n\t\tcallback(node.data);\n\t\tvar nodes = inwards ? node.outgoing : node.incoming;\n\t\tforEach(nodes, (entry) => this._traverse(entry.value, inwards, seen, callback));\n\t}\n\n\tinsertEdge(from: T, to: T): void {\n\t\tvar fromNode = this.lookupOrInsertNode(from),\n\t\t\ttoNode = this.lookupOrInsertNode(to);\n\n\t\tfromNode.outgoing[this._hashFn(to)] = toNode;\n\t\ttoNode.incoming[this._hashFn(from)] = fromNode;\n\t}\n\n\tremoveNode(data: T): void {\n\t\tvar key = this._hashFn(data);\n\t\tdelete this._nodes[key];\n\t\tforEach(this._nodes, (entry) => {\n\t\t\tdelete entry.value.outgoing[key];\n\t\t\tdelete entry.value.incoming[key];\n\t\t});\n\t}\n\n\tlookupOrInsertNode(data: T): Node<T> {\n\t\tvar key = this._hashFn(data),\n\t\t\tnode = lookup(this._nodes, key);\n\n\t\tif (!node) {\n\t\t\tnode = newNode(data);\n\t\t\tthis._nodes[key] = node;\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tlookup(data: T): Node<T> {\n\t\treturn lookup(this._nodes, this._hashFn(data));\n\t}\n\n\tget length(): number {\n\t\treturn Object.keys(this._nodes).length;\n\t}\n\n\ttoString(): string {\n\t\tlet data: string[] = [];\n\t\tforEach(this._nodes, entry => {\n\t\t\tdata.push(`${entry.key}, (incoming)[${Object.keys(entry.value.incoming).join(', ')}], (outgoing)[${Object.keys(entry.value.outgoing).join(',')}]`);\n\t\t});\n\t\treturn data.join('\\n');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport { isArray } from './types';\n\nexport const empty: IDisposable = Object.freeze({\n\tdispose() { }\n});\n\nexport interface IDisposable {\n\tdispose(): void;\n}\n\nexport function dispose<T extends IDisposable>(...disposables: T[]): T;\nexport function dispose<T extends IDisposable>(disposables: T[]): T[];\nexport function dispose<T extends IDisposable>(...disposables: T[]): T[] {\n\tconst first = disposables[0];\n\n\tif (isArray(first)) {\n\t\tdisposables = first as any as T[];\n\t}\n\n\tdisposables.forEach(d => d && d.dispose());\n\treturn [];\n}\n\nexport function combinedDisposable(disposables: IDisposable[]): IDisposable;\nexport function combinedDisposable(...disposables: IDisposable[]): IDisposable;\nexport function combinedDisposable(disposables: any): IDisposable {\n\treturn { dispose: () => dispose(disposables) };\n}\n\nexport function toDisposable(...fns: (() => void)[]): IDisposable {\n\treturn combinedDisposable(fns.map(fn => ({ dispose: fn })));\n}\n\nexport abstract class Disposable implements IDisposable {\n\n\tprivate _toDispose: IDisposable[];\n\n\tconstructor() {\n\t\tthis._toDispose = [];\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._toDispose = dispose(this._toDispose);\n\t}\n\n\tprotected _register<T extends IDisposable>(t:T): T {\n\t\tthis._toDispose.push(t);\n\t\treturn t;\n\t}\n}\n\nexport class Disposables extends Disposable {\n\n\tpublic add<T extends IDisposable>(e: T): T;\n\tpublic add(...elements: IDisposable[]): void;\n\tpublic add<T extends IDisposable>(arg: T | T[]): T {\n\t\tif (!Array.isArray(arg)) {\n\t\t\treturn this._register(arg);\n\t\t} else {\n\t\t\tfor (let element of arg) {\n\t\t\t\treturn this._register(element);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport paths = require('vs/base/common/paths');\nimport types = require('vs/base/common/types');\nimport strings = require('vs/base/common/strings');\nimport {match} from 'vs/base/common/glob';\n\nexport let MIME_TEXT = 'text/plain';\nexport let MIME_BINARY = 'application/octet-stream';\nexport let MIME_UNKNOWN = 'application/unknown';\n\nexport interface ITextMimeAssociation {\n\tmime: string;\n\tfilename?: string;\n\textension?: string;\n\tfilepattern?: string;\n\tfirstline?: RegExp;\n\tuserConfigured?: boolean;\n}\n\nlet registeredAssociations: ITextMimeAssociation[] = [];\n\n/**\n * Associate a text mime to the registry.\n */\nexport function registerTextMime(association: ITextMimeAssociation): void {\n\n\t// Register\n\tregisteredAssociations.push(association);\n\n\t// Check for conflicts unless this is a user configured association\n\tif (!association.userConfigured) {\n\t\tregisteredAssociations.forEach(a => {\n\t\t\tif (a.mime === association.mime || a.userConfigured) {\n\t\t\t\treturn; // same mime or userConfigured is ok\n\t\t\t}\n\n\t\t\tif (association.extension && a.extension === association.extension) {\n\t\t\t\tconsole.warn(`Overwriting extension <<${association.extension}>> to now point to mime <<${association.mime}>>`);\n\t\t\t}\n\n\t\t\tif (association.filename && a.filename === association.filename) {\n\t\t\t\tconsole.warn(`Overwriting filename <<${association.filename}>> to now point to mime <<${association.mime}>>`);\n\t\t\t}\n\n\t\t\tif (association.filepattern && a.filepattern === association.filepattern) {\n\t\t\t\tconsole.warn(`Overwriting filepattern <<${association.filepattern}>> to now point to mime <<${association.mime}>>`);\n\t\t\t}\n\n\t\t\tif (association.firstline && a.firstline === association.firstline) {\n\t\t\t\tconsole.warn(`Overwriting firstline <<${association.firstline}>> to now point to mime <<${association.mime}>>`);\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * Clear text mimes from the registry.\n */\nexport function clearTextMimes(onlyUserConfigured?: boolean): void {\n\tif (!onlyUserConfigured) {\n\t\tregisteredAssociations = [];\n\t} else {\n\t\tregisteredAssociations = registeredAssociations.filter(a => !a.userConfigured);\n\t}\n}\n\n/**\n * Given a file, return the best matching mime type for it\n */\nexport function guessMimeTypes(path: string, firstLine?: string): string[] {\n\tif (!path) {\n\t\treturn [MIME_UNKNOWN];\n\t}\n\n\tpath = path.toLowerCase();\n\n\t// 1.) User configured mappings have highest priority\n\tlet configuredMime = guessMimeTypeByPath(path, registeredAssociations.filter(a => a.userConfigured));\n\tif (configuredMime) {\n\t\treturn [configuredMime, MIME_TEXT];\n\t}\n\n\t// 2.) Registered mappings have middle priority\n\tlet registeredMime = guessMimeTypeByPath(path, registeredAssociations.filter(a => !a.userConfigured));\n\tif (registeredMime) {\n\t\treturn [registeredMime, MIME_TEXT];\n\t}\n\n\t// 3.) Firstline has lowest priority\n\tif (firstLine) {\n\t\tlet firstlineMime = guessMimeTypeByFirstline(firstLine);\n\t\tif (firstlineMime) {\n\t\t\treturn [firstlineMime, MIME_TEXT];\n\t\t}\n\t}\n\n\treturn [MIME_UNKNOWN];\n}\n\nfunction guessMimeTypeByPath(path: string, associations: ITextMimeAssociation[]): string {\n\tlet filename = paths.basename(path);\n\n\tlet filenameMatch: ITextMimeAssociation;\n\tlet patternMatch: ITextMimeAssociation;\n\tlet extensionMatch: ITextMimeAssociation;\n\n\tfor (var i = 0; i < associations.length; i++) {\n\t\tlet association = associations[i];\n\n\t\t// First exact name match\n\t\tif (association.filename && filename === association.filename.toLowerCase()) {\n\t\t\tfilenameMatch = association;\n\t\t\tbreak; // take it!\n\t\t}\n\n\t\t// Longest pattern match\n\t\tif (association.filepattern) {\n\t\t\tlet target = association.filepattern.indexOf(paths.sep) >= 0 ? path : filename; // match on full path if pattern contains path separator\n\t\t\tif (match(association.filepattern.toLowerCase(), target)) {\n\t\t\t\tif (!patternMatch || association.filepattern.length > patternMatch.filepattern.length) {\n\t\t\t\t\tpatternMatch = association;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Longest extension match\n\t\tif (association.extension) {\n\t\t\tif (strings.endsWith(filename, association.extension.toLowerCase())) {\n\t\t\t\tif (!extensionMatch || association.extension.length > extensionMatch.extension.length) {\n\t\t\t\t\textensionMatch = association;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// 1.) Exact name match has second highest prio\n\tif (filenameMatch) {\n\t\treturn filenameMatch.mime;\n\t}\n\n\t// 2.) Match on pattern\n\tif (patternMatch) {\n\t\treturn patternMatch.mime;\n\t}\n\n\t// 3.) Match on extension comes next\n\tif (extensionMatch) {\n\t\treturn extensionMatch.mime;\n\t}\n\n\treturn null;\n}\n\nfunction guessMimeTypeByFirstline(firstLine: string): string {\n\tif (strings.startsWithUTF8BOM(firstLine)) {\n\t\tfirstLine = firstLine.substr(1);\n\t}\n\n\tif (firstLine.length > 0) {\n\t\tfor (let i = 0; i < registeredAssociations.length; ++i) {\n\t\t\tlet association = registeredAssociations[i];\n\t\t\tif (!association.firstline) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Make sure the entire line matches, not just a subpart.\n\t\t\tlet matches = firstLine.match(association.firstline);\n\t\t\tif (matches && matches.length > 0 && matches[0].length === firstLine.length) {\n\t\t\t\treturn association.mime;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport function isBinaryMime(mimes: string): boolean;\nexport function isBinaryMime(mimes: string[]): boolean;\nexport function isBinaryMime(mimes: any): boolean {\n\tif (!mimes) {\n\t\treturn false;\n\t}\n\n\tlet mimeVals: string[];\n\tif (types.isArray(mimes)) {\n\t\tmimeVals = (<string[]>mimes);\n\t} else {\n\t\tmimeVals = (<string>mimes).split(',').map((mime) => mime.trim());\n\t}\n\n\treturn mimeVals.indexOf(MIME_BINARY) >= 0;\n}\n\nexport function isUnspecific(mime: string[] | string): boolean {\n\tif (!mime) {\n\t\treturn true;\n\t}\n\n\tif (typeof mime === 'string') {\n\t\treturn mime === MIME_BINARY || mime === MIME_TEXT || mime === MIME_UNKNOWN;\n\t}\n\n\treturn mime.length === 1 && isUnspecific(mime[0]);\n}\n\nexport function suggestFilename(theMime: string, prefix: string): string {\n\tfor (var i = 0; i < registeredAssociations.length; i++) {\n\t\tlet association = registeredAssociations[i];\n\t\tif (association.userConfigured) {\n\t\t\tcontinue; // only support registered ones\n\t\t}\n\n\t\tif (association.mime === theMime && association.extension) {\n\t\t\treturn prefix + association.extension;\n\t\t}\n\t}\n\n\treturn null;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as Types from 'vs/base/common/types';\n\nexport function clone<T>(obj: T): T {\n\tif (!obj || typeof obj !== 'object') {\n\t\treturn obj;\n\t}\n\tif (obj instanceof RegExp) {\n\t\treturn obj;\n\t}\n\tvar result = (Array.isArray(obj)) ? <any>[] : <any>{};\n\tObject.keys(obj).forEach((key) => {\n\t\tif (obj[key] && typeof obj[key] === 'object') {\n\t\t\tresult[key] = clone(obj[key]);\n\t\t} else {\n\t\t\tresult[key] = obj[key];\n\t\t}\n\t});\n\treturn result;\n}\n\nexport function deepClone<T>(obj: T): T {\n\tif (!obj || typeof obj !== 'object') {\n\t\treturn obj;\n\t}\n\tvar result = (Array.isArray(obj)) ? <any>[] : <any>{};\n\tObject.getOwnPropertyNames(obj).forEach((key) => {\n\t\tif (obj[key] && typeof obj[key] === 'object') {\n\t\t\tresult[key] = deepClone(obj[key]);\n\t\t} else {\n\t\t\tresult[key] = obj[key];\n\t\t}\n\t});\n\treturn result;\n}\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport function cloneAndChange(obj: any, changer: (orig: any) => any): any {\n\treturn _cloneAndChange(obj, changer, []);\n}\n\nfunction _cloneAndChange(obj: any, changer: (orig: any) => any, encounteredObjects: any[]): any {\n\tif (Types.isUndefinedOrNull(obj)) {\n\t\treturn obj;\n\t}\n\n\tvar changed = changer(obj);\n\tif (typeof changed !== 'undefined') {\n\t\treturn changed;\n\t}\n\n\tif (Types.isArray(obj)) {\n\t\tvar r1: any[] = [];\n\t\tfor (var i1 = 0; i1 < obj.length; i1++) {\n\t\t\tr1.push(_cloneAndChange(obj[i1], changer, encounteredObjects));\n\t\t}\n\t\treturn r1;\n\t}\n\n\tif (Types.isObject(obj)) {\n\t\tif (encounteredObjects.indexOf(obj) >= 0) {\n\t\t\tthrow new Error('Cannot clone recursive data-structure');\n\t\t}\n\t\tencounteredObjects.push(obj);\n\t\tvar r2 = {};\n\t\tfor (var i2 in obj) {\n\t\t\tif (hasOwnProperty.call(obj, i2)) {\n\t\t\t\tr2[i2] = _cloneAndChange(obj[i2], changer, encounteredObjects);\n\t\t\t}\n\t\t}\n\t\tencounteredObjects.pop();\n\t\treturn r2;\n\t}\n\n\treturn obj;\n}\n\n// DON'T USE THESE FUNCTION UNLESS YOU KNOW HOW CHROME\n// WORKS... WE HAVE SEEN VERY WEIRD BEHAVIOUR WITH CHROME >= 37\n\n///**\n// * Recursively call Object.freeze on object and any properties that are objects.\n// */\n//export function deepFreeze(obj:any):void {\n//\tObject.freeze(obj);\n//\tObject.keys(obj).forEach((key) => {\n//\t\tif(!(typeof obj[key] === 'object') || Object.isFrozen(obj[key])) {\n//\t\t\treturn;\n//\t\t}\n//\n//\t\tdeepFreeze(obj[key]);\n//\t});\n//\tif(!Object.isFrozen(obj)) {\n//\t\tconsole.log('too warm');\n//\t}\n//}\n//\n//export function deepSeal(obj:any):void {\n//\tObject.seal(obj);\n//\tObject.keys(obj).forEach((key) => {\n//\t\tif(!(typeof obj[key] === 'object') || Object.isSealed(obj[key])) {\n//\t\t\treturn;\n//\t\t}\n//\n//\t\tdeepSeal(obj[key]);\n//\t});\n//\tif(!Object.isSealed(obj)) {\n//\t\tconsole.log('NOT sealed');\n//\t}\n//}\n\n/**\n * Copies all properties of source into destination. The optional parameter \"overwrite\" allows to control\n * if existing properties on the destination should be overwritten or not. Defaults to true (overwrite).\n */\nexport function mixin(destination: any, source: any, overwrite: boolean = true): any {\n\tif (!Types.isObject(destination)) {\n\t\treturn source;\n\t}\n\n\tif (Types.isObject(source)) {\n\t\tObject.keys(source).forEach((key) => {\n\t\t\tif (key in destination) {\n\t\t\t\tif (overwrite) {\n\t\t\t\t\tif (Types.isObject(destination[key]) && Types.isObject(source[key])) {\n\t\t\t\t\t\tmixin(destination[key], source[key], overwrite);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdestination[key] = source[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdestination[key] = source[key];\n\t\t\t}\n\t\t});\n\t}\n\treturn destination;\n}\n\nexport function assign(destination: any, ...sources: any[]): any {\n\tsources.forEach(source => Object.keys(source).forEach((key) => destination[key] = source[key]));\n\treturn destination;\n}\n\nexport function toObject<T,R>(arr: T[], keyMap: (T) => string, valueMap: (T) => R = x => x): { [key: string]: R } {\n\treturn arr.reduce((o, d) => assign(o, { [keyMap(d)]: valueMap(d) }), Object.create(null));\n}\n\nexport function equals(one: any, other: any): boolean {\n\tif (one === other) {\n\t\treturn true;\n\t}\n\tif (one === null || one === undefined || other === null || other === undefined) {\n\t\treturn false;\n\t}\n\tif (typeof one !== typeof other) {\n\t\treturn false;\n\t}\n\tif (typeof one !== 'object') {\n\t\treturn false;\n\t}\n\tif ((Array.isArray(one)) !== (Array.isArray(other))) {\n\t\treturn false;\n\t}\n\n\tvar i: number,\n\t\tkey: string;\n\n\tif (Array.isArray(one)) {\n\t\tif (one.length !== other.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (i = 0; i < one.length; i++) {\n\t\t\tif (!equals(one[i], other[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tvar oneKeys:string[] = [];\n\n\t\tfor (key in one) {\n\t\t\toneKeys.push(key);\n\t\t}\n\t\toneKeys.sort();\n\t\tvar otherKeys:string[] = [];\n\t\tfor (key in other) {\n\t\t\totherKeys.push(key);\n\t\t}\n\t\totherKeys.sort();\n\t\tif (!equals(oneKeys, otherKeys)) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (i = 0; i < oneKeys.length; i++) {\n\t\t\tif (!equals(one[oneKeys[i]], other[oneKeys[i]])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn true;\n}\n\nexport function ensureProperty(obj: any, property: string, defaultValue: any) {\n\tif (typeof obj[property] === 'undefined') {\n\t\tobj[property] = defaultValue;\n\t}\n}\n\nexport function arrayToHash(array: any[]) {\n\tvar result: any = {};\n\tfor (var i = 0; i < array.length; ++i) {\n\t\tresult[array[i]] = true;\n\t}\n\treturn result;\n}\n\n/**\n * Given an array of strings, returns a function which, given a string\n * returns true or false whether the string is in that array.\n */\nexport function createKeywordMatcher(arr: string[], caseInsensitive: boolean = false): (str: string) => boolean {\n\tif (caseInsensitive) {\n\t\tarr = arr.map(function (x) { return x.toLowerCase(); });\n\t}\n\tvar hash = arrayToHash(arr);\n\tif (caseInsensitive) {\n\t\treturn function (word) {\n\t\t\treturn hash[word.toLowerCase()] !== undefined && hash.hasOwnProperty(word.toLowerCase());\n\t\t};\n\t} else {\n\t\treturn function (word) {\n\t\t\treturn hash[word] !== undefined && hash.hasOwnProperty(word);\n\t\t};\n\t}\n}\n\n/**\n * Started from TypeScript's __extends function to make a type a subclass of a specific class.\n * Modified to work with properties already defined on the derivedClass, since we can't get TS\n * to call this method before the constructor definition.\n */\nexport function derive(baseClass: any, derivedClass: any): void {\n\n\tfor (var prop in baseClass) {\n\t\tif (baseClass.hasOwnProperty(prop)) {\n\t\t\tderivedClass[prop] = baseClass[prop];\n\t\t}\n\t}\n\n\tderivedClass = derivedClass || function () { };\n\tvar basePrototype = baseClass.prototype;\n\tvar derivedPrototype = derivedClass.prototype;\n\tderivedClass.prototype = Object.create(basePrototype);\n\n\tfor (var prop in derivedPrototype) {\n\t\tif (derivedPrototype.hasOwnProperty(prop)) {\n\t\t\t// handle getters and setters properly\n\t\t\tObject.defineProperty(derivedClass.prototype, prop, Object.getOwnPropertyDescriptor(derivedPrototype, prop));\n\t\t}\n\t}\n\n\t// Cast to any due to Bug 16188:PropertyDescriptor set and get function should be optional.\n\tObject.defineProperty(derivedClass.prototype, 'constructor', <any>{ value: derivedClass, writable: true, configurable: true, enumerable: true });\n}\n\n/**\n * Calls JSON.Stringify with a replacer to break apart any circular references.\n * This prevents JSON.stringify from throwing the exception\n *  \"Uncaught TypeError: Converting circular structure to JSON\"\n */\nexport function safeStringify(obj: any): string {\n\tvar seen: any[] = [];\n\treturn JSON.stringify(obj, (key, value) => {\n\n\t\tif (Types.isObject(value) || Array.isArray(value)) {\n\t\t\tif (seen.indexOf(value) !== -1) {\n\t\t\t\treturn '[Circular]';\n\t\t\t} else {\n\t\t\t\tseen.push(value);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t});\n}\n\nexport function getOrDefault<T,R>(obj: T, fn: (obj: T) => R, defaultValue: R = null): R {\n\tconst result = fn(obj);\n\treturn typeof result === 'undefined' ? defaultValue : result;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport platform = require('vs/base/common/platform');\n\n\nfunction _encode(ch: string): string {\n\treturn '%' + ch.charCodeAt(0).toString(16).toUpperCase();\n}\n\n// see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\nfunction encodeURIComponent2(str: string): string {\n\treturn encodeURIComponent(str).replace(/[!'()*]/g, _encode);\n}\n\nfunction encodeNoop(str: string): string {\n\treturn str;\n}\n\n\n/**\n * Uniform Resource Identifier (URI) http://tools.ietf.org/html/rfc3986.\n * This class is a simple parser which creates the basic component paths\n * (http://tools.ietf.org/html/rfc3986#section-3) with minimal validation\n * and encoding.\n *\n *       foo://example.com:8042/over/there?name=ferret#nose\n *       \\_/   \\______________/\\_________/ \\_________/ \\__/\n *        |           |            |            |        |\n *     scheme     authority       path        query   fragment\n *        |   _____________________|__\n *       / \\ /                        \\\n *       urn:example:animal:ferret:nose\n *\n *\n */\nexport default class URI {\n\n\tprivate static _empty = '';\n\tprivate static _slash = '/';\n\tprivate static _regexp = /^(([^:/?#]+?):)?(\\/\\/([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?/;\n\tprivate static _driveLetterPath = /^\\/[a-zA-z]:/;\n\tprivate static _upperCaseDrive = /^(\\/)?([A-Z]:)/;\n\n\tprivate _scheme: string;\n\tprivate _authority: string;\n\tprivate _path: string;\n\tprivate _query: string;\n\tprivate _fragment: string;\n\tprivate _formatted: string;\n\tprivate _fsPath: string;\n\n\tconstructor() {\n\t\tthis._scheme = URI._empty;\n\t\tthis._authority = URI._empty;\n\t\tthis._path = URI._empty;\n\t\tthis._query = URI._empty;\n\t\tthis._fragment = URI._empty;\n\n\t\tthis._formatted = null;\n\t\tthis._fsPath = null;\n\t}\n\n\t/**\n\t * scheme is the 'http' part of 'http://www.msft.com/some/path?query#fragment'.\n\t * The part before the first colon.\n\t */\n\tget scheme() {\n\t\treturn this._scheme;\n\t}\n\n\t/**\n\t * authority is the 'www.msft.com' part of 'http://www.msft.com/some/path?query#fragment'.\n\t * The part between the first double slashes and the next slash.\n\t */\n\tget authority() {\n\t\treturn this._authority;\n\t}\n\n\t/**\n\t * path is the '/some/path' part of 'http://www.msft.com/some/path?query#fragment'.\n\t */\n\tget path() {\n\t\treturn this._path;\n\t}\n\n\t/**\n\t * query is the 'query' part of 'http://www.msft.com/some/path?query#fragment'.\n\t */\n\tget query() {\n\t\treturn this._query;\n\t}\n\n\t/**\n\t * fragment is the 'fragment' part of 'http://www.msft.com/some/path?query#fragment'.\n\t */\n\tget fragment() {\n\t\treturn this._fragment;\n\t}\n\n\t// ---- filesystem path -----------------------\n\n\t/**\n\t * Returns a string representing the corresponding file system path of this URI.\n\t * Will handle UNC paths and normalize windows drive letters to lower-case. Also\n\t * uses the platform specific path separator. Will *not* validate the path for\n\t * invalid characters and semantics. Will *not* look at the scheme of this URI.\n\t */\n\tget fsPath() {\n\t\tif (!this._fsPath) {\n\t\t\tvar value: string;\n\t\t\tif (this._authority && this.scheme === 'file') {\n\t\t\t\t// unc path: file://shares/c$/far/boo\n\t\t\t\tvalue = `//${this._authority}${this._path}`;\n\t\t\t} else if (URI._driveLetterPath.test(this._path)) {\n\t\t\t\t// windows drive letter: file:///c:/far/boo\n\t\t\t\tvalue = this._path[1].toLowerCase() + this._path.substr(2);\n\t\t\t} else {\n\t\t\t\t// other path\n\t\t\t\tvalue = this._path;\n\t\t\t}\n\t\t\tif (platform.isWindows) {\n\t\t\t\tvalue = value.replace(/\\//g, '\\\\');\n\t\t\t}\n\t\t\tthis._fsPath = value;\n\t\t}\n\t\treturn this._fsPath;\n\t}\n\n\t// ---- modify to new -------------------------\n\n\tpublic with(change: { scheme?: string; authority?: string; path?: string; query?: string; fragment?: string }): URI {\n\n\t\tif (!change) {\n\t\t\treturn this;\n\t\t}\n\n\t\tlet scheme = change.scheme || this.scheme;\n\t\tlet authority = change.authority || this.authority;\n\t\tlet path = change.path || this.path;\n\t\tlet query = change.query || this.query;\n\t\tlet fragment = change.fragment || this.fragment;\n\n\t\tif (scheme === this.scheme\n\t\t\t&& authority === this.authority\n\t\t\t&& path === this.path\n\t\t\t&& query === this.query\n\t\t\t&& fragment === this.fragment) {\n\n\t\t\treturn this;\n\t\t}\n\n\t\tconst ret = new URI();\n\t\tret._scheme = scheme;\n\t\tret._authority = authority;\n\t\tret._path = path;\n\t\tret._query = query;\n\t\tret._fragment = fragment;\n\t\tURI._validate(ret);\n\t\treturn ret;\n\t}\n\n\t// ---- parse & validate ------------------------\n\n\tpublic static parse(value: string): URI {\n\t\tconst ret = new URI();\n\t\tconst data = URI._parseComponents(value);\n\t\tret._scheme = data.scheme;\n\t\tret._authority = decodeURIComponent(data.authority);\n\t\tret._path = decodeURIComponent(data.path);\n\t\tret._query = decodeURIComponent(data.query);\n\t\tret._fragment = decodeURIComponent(data.fragment);\n\t\tURI._validate(ret);\n\t\treturn ret;\n\t}\n\n\tpublic static file(path: string): URI {\n\n\t\tconst ret = new URI();\n\t\tret._scheme = 'file';\n\n\t\t// normalize to fwd-slashes\n\t\tpath = path.replace(/\\\\/g, URI._slash);\n\n\t\t// check for authority as used in UNC shares\n\t\t// or use the path as given\n\t\tif (path[0] === URI._slash && path[0] === path[1]) {\n\t\t\tlet idx = path.indexOf(URI._slash, 2);\n\t\t\tif (idx === -1) {\n\t\t\t\tret._authority = path.substring(2);\n\t\t\t} else {\n\t\t\t\tret._authority = path.substring(2, idx);\n\t\t\t\tret._path = path.substring(idx);\n\t\t\t}\n\t\t} else {\n\t\t\tret._path = path;\n\t\t}\n\n\t\t// Ensure that path starts with a slash\n\t\t// or that it is at least a slash\n\t\tif (ret._path[0] !== URI._slash) {\n\t\t\tret._path = URI._slash + ret._path;\n\t\t}\n\n\t\tURI._validate(ret);\n\n\t\treturn ret;\n\t}\n\n\tprivate static _parseComponents(value: string): UriComponents {\n\n\t\tconst ret: UriComponents = {\n\t\t\tscheme: URI._empty,\n\t\t\tauthority: URI._empty,\n\t\t\tpath: URI._empty,\n\t\t\tquery: URI._empty,\n\t\t\tfragment: URI._empty,\n\t\t};\n\n\t\tconst match = URI._regexp.exec(value);\n\t\tif (match) {\n\t\t\tret.scheme = match[2] || ret.scheme;\n\t\t\tret.authority = match[4] || ret.authority;\n\t\t\tret.path = match[5] || ret.path;\n\t\t\tret.query = match[7] || ret.query;\n\t\t\tret.fragment = match[9] || ret.fragment;\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic static from(components: { scheme?: string; authority?: string; path?: string; query?: string; fragment?: string }): URI {\n\t\treturn new URI().with(components);\n\t}\n\n\tprivate static _validate(ret: URI): void {\n\n\t\t// validation\n\t\t// path, http://tools.ietf.org/html/rfc3986#section-3.3\n\t\t// If a URI contains an authority component, then the path component\n\t\t// must either be empty or begin with a slash (\"/\") character.  If a URI\n\t\t// does not contain an authority component, then the path cannot begin\n\t\t// with two slash characters (\"//\").\n\t\tif (ret.authority && ret.path && ret.path[0] !== '/') {\n\t\t\tthrow new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash (\"/\") character');\n\t\t}\n\t\tif (!ret.authority && ret.path.indexOf('//') === 0) {\n\t\t\tthrow new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters (\"//\")');\n\t\t}\n\t}\n\n\t// ---- printing/externalize ---------------------------\n\n\t/**\n\t *\n\t * @param skipEncoding Do not encode the result, default is `false`\n\t */\n\tpublic toString(skipEncoding: boolean = false): string {\n\t\tif (!skipEncoding) {\n\t\t\tif (!this._formatted) {\n\t\t\t\tthis._formatted = URI._asFormatted(this, false);\n\t\t\t}\n\t\t\treturn this._formatted;\n\t\t} else {\n\t\t\t// we don't cache that\n\t\t\treturn URI._asFormatted(this, true);\n\t\t}\n\t}\n\n\tprivate static _asFormatted(uri: URI, skipEncoding: boolean): string {\n\n\t\tconst encoder = !skipEncoding\n\t\t\t? encodeURIComponent2\n\t\t\t: encodeNoop;\n\n\t\tconst parts: string[] = [];\n\n\t\tlet {scheme, authority, path, query, fragment} = uri;\n\t\tif (scheme) {\n\t\t\tparts.push(scheme, ':');\n\t\t}\n\t\tif (authority || scheme === 'file') {\n\t\t\tparts.push('//');\n\t\t}\n\t\tif (authority) {\n\t\t\tauthority = authority.toLowerCase();\n\t\t\tlet idx = authority.indexOf(':');\n\t\t\tif (idx === -1) {\n\t\t\t\tparts.push(encoder(authority));\n\t\t\t} else {\n\t\t\t\tparts.push(encoder(authority.substr(0, idx)), authority.substr(idx));\n\t\t\t}\n\t\t}\n\t\tif (path) {\n\t\t\t// lower-case windown drive letters in /C:/fff\n\t\t\tconst m = URI._upperCaseDrive.exec(path);\n\t\t\tif (m) {\n\t\t\t\tpath = m[1] + m[2].toLowerCase() + path.substr(m[1].length + m[2].length);\n\t\t\t}\n\n\t\t\t// encode every segement but not slashes\n\t\t\t// make sure that # and ? are always encoded\n\t\t\t// when occurring in paths - otherwise the result\n\t\t\t// cannot be parsed back again\n\t\t\tlet lastIdx = 0;\n\t\t\twhile(true) {\n\t\t\t\tlet idx = path.indexOf(URI._slash, lastIdx);\n\t\t\t\tif (idx === -1) {\n\t\t\t\t\tparts.push(encoder(path.substring(lastIdx)).replace(/[#?]/, _encode));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tparts.push(encoder(path.substring(lastIdx, idx)).replace(/[#?]/, _encode), URI._slash);\n\t\t\t\tlastIdx = idx + 1;\n\t\t\t};\n\t\t}\n\t\tif (query) {\n\t\t\tparts.push('?', encoder(query));\n\t\t}\n\t\tif (fragment) {\n\t\t\tparts.push('#', encoder(fragment));\n\t\t}\n\n\t\treturn parts.join(URI._empty);\n\t}\n\n\tpublic toJSON(): any {\n\t\treturn <UriState> {\n\t\t\tscheme: this.scheme,\n\t\t\tauthority: this.authority,\n\t\t\tpath: this.path,\n\t\t\tfsPath: this.fsPath,\n\t\t\tquery: this.query,\n\t\t\tfragment: this.fragment,\n\t\t\texternal: this.toString(),\n\t\t\t$mid: 1\n\t\t};\n\t}\n\n\tstatic revive(data: any): URI {\n\t\tlet result = new URI();\n\t\tresult._scheme = (<UriState> data).scheme;\n\t\tresult._authority = (<UriState> data).authority;\n\t\tresult._path = (<UriState> data).path;\n\t\tresult._query = (<UriState> data).query;\n\t\tresult._fragment = (<UriState> data).fragment;\n\t\tresult._fsPath = (<UriState> data).fsPath;\n\t\tresult._formatted = (<UriState>data).external;\n\t\tURI._validate(result);\n\t\treturn result;\n\t}\n}\n\ninterface UriComponents {\n\tscheme: string;\n\tauthority: string;\n\tpath: string;\n\tquery: string;\n\tfragment: string;\n}\n\ninterface UriState extends UriComponents {\n\t$mid: number;\n\tfsPath: string;\n\texternal: string;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\n\nexport function stringify(obj: any): string {\n\treturn JSON.stringify(obj, replacer);\n}\n\nexport function parse(text: string): any {\n\treturn JSON.parse(text, reviver);\n}\n\ninterface MarshalledObject {\n\t$mid: number;\n}\n\nfunction replacer(key: string, value: any): any {\n\t// URI is done via toJSON-member\n\tif (value instanceof RegExp) {\n\t\treturn {\n\t\t\t$mid: 2,\n\t\t\tsource: (<RegExp>value).source,\n\t\t\tflags: ((<RegExp>value).global ? 'g' : '') + ((<RegExp>value).ignoreCase ? 'i' : '') + ((<RegExp>value).multiline ? 'm' : ''),\n\t\t};\n\t}\n\treturn value;\n}\n\n\nfunction reviver(key: string, value: any): any {\n\tlet marshallingConst: number;\n\tif (value !== void 0 && value !== null) {\n\t\tmarshallingConst = (<MarshalledObject>value).$mid;\n\t}\n\tif (marshallingConst === 1) {\n\t\treturn URI.revive(value);\n\t} else if (marshallingConst === 2) {\n\t\treturn new RegExp(value.source, value.flags);\n\t} else {\n\t\treturn value;\n\t}\n}\n","/**\n * Extracted from https://github.com/winjs/winjs\n * Version: 4.4.0(ec3258a9f3a36805a187848984e3bb938044178d)\n * Copyright (c) Microsoft Corporation.\n * All Rights Reserved.\n * Licensed under the MIT License.\n */\n(function() {\n\nvar _modules = {};\n_modules[\"WinJS/Core/_WinJS\"] = {};\n\nvar _winjs = function(moduleId, deps, factory) {\n    var exports = {};\n    var exportsPassedIn = false;\n\n    var depsValues = deps.map(function(dep) {\n        if (dep === 'exports') {\n            exportsPassedIn = true;\n            return exports;\n        }\n        return _modules[dep];\n    });\n\n    var result = factory.apply({}, depsValues);\n\n    _modules[moduleId] = exportsPassedIn ? exports : result;\n};\n\n\n_winjs(\"WinJS/Core/_Global\", [], function () {\n    \"use strict\";\n\n    // Appease jshint\n    /* global window, self, global */\n\n    var globalObject =\n        typeof window !== 'undefined' ? window :\n        typeof self !== 'undefined' ? self :\n        typeof global !== 'undefined' ? global :\n        {};\n    return globalObject;\n});\n\n_winjs(\"WinJS/Core/_BaseCoreUtils\", [\"WinJS/Core/_Global\"], function baseCoreUtilsInit(_Global) {\n    \"use strict\";\n\n    var hasWinRT = !!_Global.Windows;\n\n    function markSupportedForProcessing(func) {\n        /// <signature helpKeyword=\"WinJS.Utilities.markSupportedForProcessing\">\n        /// <summary locid=\"WinJS.Utilities.markSupportedForProcessing\">\n        /// Marks a function as being compatible with declarative processing, such as WinJS.UI.processAll\n        /// or WinJS.Binding.processAll.\n        /// </summary>\n        /// <param name=\"func\" type=\"Function\" locid=\"WinJS.Utilities.markSupportedForProcessing_p:func\">\n        /// The function to be marked as compatible with declarative processing.\n        /// </param>\n        /// <returns type=\"Function\" locid=\"WinJS.Utilities.markSupportedForProcessing_returnValue\">\n        /// The input function.\n        /// </returns>\n        /// </signature>\n        func.supportedForProcessing = true;\n        return func;\n    }\n\n    return {\n        hasWinRT: hasWinRT,\n        markSupportedForProcessing: markSupportedForProcessing,\n        _setImmediate: _Global.setImmediate ? _Global.setImmediate.bind(_Global) : function (handler) {\n            _Global.setTimeout(handler, 0);\n        }\n    };\n});\n_winjs(\"WinJS/Core/_WriteProfilerMark\", [\"WinJS/Core/_Global\"], function profilerInit(_Global) {\n    \"use strict\";\n\n    return _Global.msWriteProfilerMark || function () { };\n});\n_winjs(\"WinJS/Core/_Base\", [\"WinJS/Core/_WinJS\",\"WinJS/Core/_Global\",\"WinJS/Core/_BaseCoreUtils\",\"WinJS/Core/_WriteProfilerMark\"], function baseInit(_WinJS, _Global, _BaseCoreUtils, _WriteProfilerMark) {\n    \"use strict\";\n\n    function initializeProperties(target, members, prefix) {\n        var keys = Object.keys(members);\n        var isArray = Array.isArray(target);\n        var properties;\n        var i, len;\n        for (i = 0, len = keys.length; i < len; i++) {\n            var key = keys[i];\n            var enumerable = key.charCodeAt(0) !== /*_*/95;\n            var member = members[key];\n            if (member && typeof member === 'object') {\n                if (member.value !== undefined || typeof member.get === 'function' || typeof member.set === 'function') {\n                    if (member.enumerable === undefined) {\n                        member.enumerable = enumerable;\n                    }\n                    if (prefix && member.setName && typeof member.setName === 'function') {\n                        member.setName(prefix + \".\" + key);\n                    }\n                    properties = properties || {};\n                    properties[key] = member;\n                    continue;\n                }\n            }\n            if (!enumerable) {\n                properties = properties || {};\n                properties[key] = { value: member, enumerable: enumerable, configurable: true, writable: true };\n                continue;\n            }\n            if (isArray) {\n                target.forEach(function (target) {\n                    target[key] = member;\n                });\n            } else {\n                target[key] = member;\n            }\n        }\n        if (properties) {\n            if (isArray) {\n                target.forEach(function (target) {\n                    Object.defineProperties(target, properties);\n                });\n            } else {\n                Object.defineProperties(target, properties);\n            }\n        }\n    }\n\n    (function () {\n\n        var _rootNamespace = _WinJS;\n        if (!_rootNamespace.Namespace) {\n            _rootNamespace.Namespace = Object.create(Object.prototype);\n        }\n\n        function createNamespace(parentNamespace, name) {\n            var currentNamespace = parentNamespace || {};\n            if (name) {\n                var namespaceFragments = name.split(\".\");\n                if (currentNamespace === _Global && namespaceFragments[0] === \"WinJS\") {\n                    currentNamespace = _WinJS;\n                    namespaceFragments.splice(0, 1);\n                }\n                for (var i = 0, len = namespaceFragments.length; i < len; i++) {\n                    var namespaceName = namespaceFragments[i];\n                    if (!currentNamespace[namespaceName]) {\n                        Object.defineProperty(currentNamespace, namespaceName,\n                            { value: {}, writable: false, enumerable: true, configurable: true }\n                        );\n                    }\n                    currentNamespace = currentNamespace[namespaceName];\n                }\n            }\n            return currentNamespace;\n        }\n\n        function defineWithParent(parentNamespace, name, members) {\n            /// <signature helpKeyword=\"WinJS.Namespace.defineWithParent\">\n            /// <summary locid=\"WinJS.Namespace.defineWithParent\">\n            /// Defines a new namespace with the specified name under the specified parent namespace.\n            /// </summary>\n            /// <param name=\"parentNamespace\" type=\"Object\" locid=\"WinJS.Namespace.defineWithParent_p:parentNamespace\">\n            /// The parent namespace.\n            /// </param>\n            /// <param name=\"name\" type=\"String\" locid=\"WinJS.Namespace.defineWithParent_p:name\">\n            /// The name of the new namespace.\n            /// </param>\n            /// <param name=\"members\" type=\"Object\" locid=\"WinJS.Namespace.defineWithParent_p:members\">\n            /// The members of the new namespace.\n            /// </param>\n            /// <returns type=\"Object\" locid=\"WinJS.Namespace.defineWithParent_returnValue\">\n            /// The newly-defined namespace.\n            /// </returns>\n            /// </signature>\n            var currentNamespace = createNamespace(parentNamespace, name);\n\n            if (members) {\n                initializeProperties(currentNamespace, members, name || \"<ANONYMOUS>\");\n            }\n\n            return currentNamespace;\n        }\n\n        function define(name, members) {\n            /// <signature helpKeyword=\"WinJS.Namespace.define\">\n            /// <summary locid=\"WinJS.Namespace.define\">\n            /// Defines a new namespace with the specified name.\n            /// </summary>\n            /// <param name=\"name\" type=\"String\" locid=\"WinJS.Namespace.define_p:name\">\n            /// The name of the namespace. This could be a dot-separated name for nested namespaces.\n            /// </param>\n            /// <param name=\"members\" type=\"Object\" locid=\"WinJS.Namespace.define_p:members\">\n            /// The members of the new namespace.\n            /// </param>\n            /// <returns type=\"Object\" locid=\"WinJS.Namespace.define_returnValue\">\n            /// The newly-defined namespace.\n            /// </returns>\n            /// </signature>\n            return defineWithParent(_Global, name, members);\n        }\n\n        var LazyStates = {\n            uninitialized: 1,\n            working: 2,\n            initialized: 3,\n        };\n\n        function lazy(f) {\n            var name;\n            var state = LazyStates.uninitialized;\n            var result;\n            return {\n                setName: function (value) {\n                    name = value;\n                },\n                get: function () {\n                    switch (state) {\n                        case LazyStates.initialized:\n                            return result;\n\n                        case LazyStates.uninitialized:\n                            state = LazyStates.working;\n                            try {\n                                _WriteProfilerMark(\"WinJS.Namespace._lazy:\" + name + \",StartTM\");\n                                result = f();\n                            } finally {\n                                _WriteProfilerMark(\"WinJS.Namespace._lazy:\" + name + \",StopTM\");\n                                state = LazyStates.uninitialized;\n                            }\n                            f = null;\n                            state = LazyStates.initialized;\n                            return result;\n\n                        case LazyStates.working:\n                            throw \"Illegal: reentrancy on initialization\";\n\n                        default:\n                            throw \"Illegal\";\n                    }\n                },\n                set: function (value) {\n                    switch (state) {\n                        case LazyStates.working:\n                            throw \"Illegal: reentrancy on initialization\";\n\n                        default:\n                            state = LazyStates.initialized;\n                            result = value;\n                            break;\n                    }\n                },\n                enumerable: true,\n                configurable: true,\n            };\n        }\n\n        // helper for defining AMD module members\n        function moduleDefine(exports, name, members) {\n            var target = [exports];\n            var publicNS = null;\n            if (name) {\n                publicNS = createNamespace(_Global, name);\n                target.push(publicNS);\n            }\n            initializeProperties(target, members, name || \"<ANONYMOUS>\");\n            return publicNS;\n        }\n\n        // Establish members of the \"WinJS.Namespace\" namespace\n        Object.defineProperties(_rootNamespace.Namespace, {\n\n            defineWithParent: { value: defineWithParent, writable: true, enumerable: true, configurable: true },\n\n            define: { value: define, writable: true, enumerable: true, configurable: true },\n\n            _lazy: { value: lazy, writable: true, enumerable: true, configurable: true },\n\n            _moduleDefine: { value: moduleDefine, writable: true, enumerable: true, configurable: true }\n\n        });\n\n    })();\n\n    (function () {\n\n        function define(constructor, instanceMembers, staticMembers) {\n            /// <signature helpKeyword=\"WinJS.Class.define\">\n            /// <summary locid=\"WinJS.Class.define\">\n            /// Defines a class using the given constructor and the specified instance members.\n            /// </summary>\n            /// <param name=\"constructor\" type=\"Function\" locid=\"WinJS.Class.define_p:constructor\">\n            /// A constructor function that is used to instantiate this class.\n            /// </param>\n            /// <param name=\"instanceMembers\" type=\"Object\" locid=\"WinJS.Class.define_p:instanceMembers\">\n            /// The set of instance fields, properties, and methods made available on the class.\n            /// </param>\n            /// <param name=\"staticMembers\" type=\"Object\" locid=\"WinJS.Class.define_p:staticMembers\">\n            /// The set of static fields, properties, and methods made available on the class.\n            /// </param>\n            /// <returns type=\"Function\" locid=\"WinJS.Class.define_returnValue\">\n            /// The newly-defined class.\n            /// </returns>\n            /// </signature>\n            constructor = constructor || function () { };\n            _BaseCoreUtils.markSupportedForProcessing(constructor);\n            if (instanceMembers) {\n                initializeProperties(constructor.prototype, instanceMembers);\n            }\n            if (staticMembers) {\n                initializeProperties(constructor, staticMembers);\n            }\n            return constructor;\n        }\n\n        function derive(baseClass, constructor, instanceMembers, staticMembers) {\n            /// <signature helpKeyword=\"WinJS.Class.derive\">\n            /// <summary locid=\"WinJS.Class.derive\">\n            /// Creates a sub-class based on the supplied baseClass parameter, using prototypal inheritance.\n            /// </summary>\n            /// <param name=\"baseClass\" type=\"Function\" locid=\"WinJS.Class.derive_p:baseClass\">\n            /// The class to inherit from.\n            /// </param>\n            /// <param name=\"constructor\" type=\"Function\" locid=\"WinJS.Class.derive_p:constructor\">\n            /// A constructor function that is used to instantiate this class.\n            /// </param>\n            /// <param name=\"instanceMembers\" type=\"Object\" locid=\"WinJS.Class.derive_p:instanceMembers\">\n            /// The set of instance fields, properties, and methods to be made available on the class.\n            /// </param>\n            /// <param name=\"staticMembers\" type=\"Object\" locid=\"WinJS.Class.derive_p:staticMembers\">\n            /// The set of static fields, properties, and methods to be made available on the class.\n            /// </param>\n            /// <returns type=\"Function\" locid=\"WinJS.Class.derive_returnValue\">\n            /// The newly-defined class.\n            /// </returns>\n            /// </signature>\n            if (baseClass) {\n                constructor = constructor || function () { };\n                var basePrototype = baseClass.prototype;\n                constructor.prototype = Object.create(basePrototype);\n                _BaseCoreUtils.markSupportedForProcessing(constructor);\n                Object.defineProperty(constructor.prototype, \"constructor\", { value: constructor, writable: true, configurable: true, enumerable: true });\n                if (instanceMembers) {\n                    initializeProperties(constructor.prototype, instanceMembers);\n                }\n                if (staticMembers) {\n                    initializeProperties(constructor, staticMembers);\n                }\n                return constructor;\n            } else {\n                return define(constructor, instanceMembers, staticMembers);\n            }\n        }\n\n        function mix(constructor) {\n            /// <signature helpKeyword=\"WinJS.Class.mix\">\n            /// <summary locid=\"WinJS.Class.mix\">\n            /// Defines a class using the given constructor and the union of the set of instance members\n            /// specified by all the mixin objects. The mixin parameter list is of variable length.\n            /// </summary>\n            /// <param name=\"constructor\" locid=\"WinJS.Class.mix_p:constructor\">\n            /// A constructor function that is used to instantiate this class.\n            /// </param>\n            /// <returns type=\"Function\" locid=\"WinJS.Class.mix_returnValue\">\n            /// The newly-defined class.\n            /// </returns>\n            /// </signature>\n            constructor = constructor || function () { };\n            var i, len;\n            for (i = 1, len = arguments.length; i < len; i++) {\n                initializeProperties(constructor.prototype, arguments[i]);\n            }\n            return constructor;\n        }\n\n        // Establish members of \"WinJS.Class\" namespace\n        _WinJS.Namespace.define(\"WinJS.Class\", {\n            define: define,\n            derive: derive,\n            mix: mix\n        });\n\n    })();\n\n    return {\n        Namespace: _WinJS.Namespace,\n        Class: _WinJS.Class\n    };\n\n});\n_winjs(\"WinJS/Core/_ErrorFromName\", [\"WinJS/Core/_Base\"], function errorsInit(_Base) {\n    \"use strict\";\n\n    var ErrorFromName = _Base.Class.derive(Error, function (name, message) {\n        /// <signature helpKeyword=\"WinJS.ErrorFromName\">\n        /// <summary locid=\"WinJS.ErrorFromName\">\n        /// Creates an Error object with the specified name and message properties.\n        /// </summary>\n        /// <param name=\"name\" type=\"String\" locid=\"WinJS.ErrorFromName_p:name\">The name of this error. The name is meant to be consumed programmatically and should not be localized.</param>\n        /// <param name=\"message\" type=\"String\" optional=\"true\" locid=\"WinJS.ErrorFromName_p:message\">The message for this error. The message is meant to be consumed by humans and should be localized.</param>\n        /// <returns type=\"Error\" locid=\"WinJS.ErrorFromName_returnValue\">Error instance with .name and .message properties populated</returns>\n        /// </signature>\n        this.name = name;\n        this.message = message || name;\n    }, {\n        /* empty */\n    }, {\n        supportedForProcessing: false,\n    });\n\n    _Base.Namespace.define(\"WinJS\", {\n        // ErrorFromName establishes a simple pattern for returning error codes.\n        //\n        ErrorFromName: ErrorFromName\n    });\n\n    return ErrorFromName;\n\n});\n\n\n_winjs(\"WinJS/Core/_Events\", [\"exports\",\"WinJS/Core/_Base\"], function eventsInit(exports, _Base) {\n    \"use strict\";\n\n\n    function createEventProperty(name) {\n        var eventPropStateName = \"_on\" + name + \"state\";\n\n        return {\n            get: function () {\n                var state = this[eventPropStateName];\n                return state && state.userHandler;\n            },\n            set: function (handler) {\n                var state = this[eventPropStateName];\n                if (handler) {\n                    if (!state) {\n                        state = { wrapper: function (evt) { return state.userHandler(evt); }, userHandler: handler };\n                        Object.defineProperty(this, eventPropStateName, { value: state, enumerable: false, writable:true, configurable: true });\n                        this.addEventListener(name, state.wrapper, false);\n                    }\n                    state.userHandler = handler;\n                } else if (state) {\n                    this.removeEventListener(name, state.wrapper, false);\n                    this[eventPropStateName] = null;\n                }\n            },\n            enumerable: true\n        };\n    }\n\n    function createEventProperties() {\n        /// <signature helpKeyword=\"WinJS.Utilities.createEventProperties\">\n        /// <summary locid=\"WinJS.Utilities.createEventProperties\">\n        /// Creates an object that has one property for each name passed to the function.\n        /// </summary>\n        /// <param name=\"events\" locid=\"WinJS.Utilities.createEventProperties_p:events\">\n        /// A variable list of property names.\n        /// </param>\n        /// <returns type=\"Object\" locid=\"WinJS.Utilities.createEventProperties_returnValue\">\n        /// The object with the specified properties. The names of the properties are prefixed with 'on'.\n        /// </returns>\n        /// </signature>\n        var props = {};\n        for (var i = 0, len = arguments.length; i < len; i++) {\n            var name = arguments[i];\n            props[\"on\" + name] = createEventProperty(name);\n        }\n        return props;\n    }\n\n    var EventMixinEvent = _Base.Class.define(\n        function EventMixinEvent_ctor(type, detail, target) {\n            this.detail = detail;\n            this.target = target;\n            this.timeStamp = Date.now();\n            this.type = type;\n        },\n        {\n            bubbles: { value: false, writable: false },\n            cancelable: { value: false, writable: false },\n            currentTarget: {\n                get: function () { return this.target; }\n            },\n            defaultPrevented: {\n                get: function () { return this._preventDefaultCalled; }\n            },\n            trusted: { value: false, writable: false },\n            eventPhase: { value: 0, writable: false },\n            target: null,\n            timeStamp: null,\n            type: null,\n\n            preventDefault: function () {\n                this._preventDefaultCalled = true;\n            },\n            stopImmediatePropagation: function () {\n                this._stopImmediatePropagationCalled = true;\n            },\n            stopPropagation: function () {\n            }\n        }, {\n            supportedForProcessing: false,\n        }\n    );\n\n    var eventMixin = {\n        _listeners: null,\n\n        addEventListener: function (type, listener, useCapture) {\n            /// <signature helpKeyword=\"WinJS.Utilities.eventMixin.addEventListener\">\n            /// <summary locid=\"WinJS.Utilities.eventMixin.addEventListener\">\n            /// Adds an event listener to the control.\n            /// </summary>\n            /// <param name=\"type\" locid=\"WinJS.Utilities.eventMixin.addEventListener_p:type\">\n            /// The type (name) of the event.\n            /// </param>\n            /// <param name=\"listener\" locid=\"WinJS.Utilities.eventMixin.addEventListener_p:listener\">\n            /// The listener to invoke when the event is raised.\n            /// </param>\n            /// <param name=\"useCapture\" locid=\"WinJS.Utilities.eventMixin.addEventListener_p:useCapture\">\n            /// if true initiates capture, otherwise false.\n            /// </param>\n            /// </signature>\n            useCapture = useCapture || false;\n            this._listeners = this._listeners || {};\n            var eventListeners = (this._listeners[type] = this._listeners[type] || []);\n            for (var i = 0, len = eventListeners.length; i < len; i++) {\n                var l = eventListeners[i];\n                if (l.useCapture === useCapture && l.listener === listener) {\n                    return;\n                }\n            }\n            eventListeners.push({ listener: listener, useCapture: useCapture });\n        },\n        dispatchEvent: function (type, details) {\n            /// <signature helpKeyword=\"WinJS.Utilities.eventMixin.dispatchEvent\">\n            /// <summary locid=\"WinJS.Utilities.eventMixin.dispatchEvent\">\n            /// Raises an event of the specified type and with the specified additional properties.\n            /// </summary>\n            /// <param name=\"type\" locid=\"WinJS.Utilities.eventMixin.dispatchEvent_p:type\">\n            /// The type (name) of the event.\n            /// </param>\n            /// <param name=\"details\" locid=\"WinJS.Utilities.eventMixin.dispatchEvent_p:details\">\n            /// The set of additional properties to be attached to the event object when the event is raised.\n            /// </param>\n            /// <returns type=\"Boolean\" locid=\"WinJS.Utilities.eventMixin.dispatchEvent_returnValue\">\n            /// true if preventDefault was called on the event.\n            /// </returns>\n            /// </signature>\n            var listeners = this._listeners && this._listeners[type];\n            if (listeners) {\n                var eventValue = new EventMixinEvent(type, details, this);\n                // Need to copy the array to protect against people unregistering while we are dispatching\n                listeners = listeners.slice(0, listeners.length);\n                for (var i = 0, len = listeners.length; i < len && !eventValue._stopImmediatePropagationCalled; i++) {\n                    listeners[i].listener(eventValue);\n                }\n                return eventValue.defaultPrevented || false;\n            }\n            return false;\n        },\n        removeEventListener: function (type, listener, useCapture) {\n            /// <signature helpKeyword=\"WinJS.Utilities.eventMixin.removeEventListener\">\n            /// <summary locid=\"WinJS.Utilities.eventMixin.removeEventListener\">\n            /// Removes an event listener from the control.\n            /// </summary>\n            /// <param name=\"type\" locid=\"WinJS.Utilities.eventMixin.removeEventListener_p:type\">\n            /// The type (name) of the event.\n            /// </param>\n            /// <param name=\"listener\" locid=\"WinJS.Utilities.eventMixin.removeEventListener_p:listener\">\n            /// The listener to remove.\n            /// </param>\n            /// <param name=\"useCapture\" locid=\"WinJS.Utilities.eventMixin.removeEventListener_p:useCapture\">\n            /// Specifies whether to initiate capture.\n            /// </param>\n            /// </signature>\n            useCapture = useCapture || false;\n            var listeners = this._listeners && this._listeners[type];\n            if (listeners) {\n                for (var i = 0, len = listeners.length; i < len; i++) {\n                    var l = listeners[i];\n                    if (l.listener === listener && l.useCapture === useCapture) {\n                        listeners.splice(i, 1);\n                        if (listeners.length === 0) {\n                            delete this._listeners[type];\n                        }\n                        // Only want to remove one element for each call to removeEventListener\n                        break;\n                    }\n                }\n            }\n        }\n    };\n\n    _Base.Namespace._moduleDefine(exports, \"WinJS.Utilities\", {\n        _createEventProperty: createEventProperty,\n        createEventProperties: createEventProperties,\n        eventMixin: eventMixin\n    });\n\n});\n\n\n_winjs(\"WinJS/Core/_Trace\", [\"WinJS/Core/_Global\"], function traceInit(_Global) {\n    \"use strict\";\n\n    function nop(v) {\n        return v;\n    }\n\n    return {\n        _traceAsyncOperationStarting: (_Global.Debug && _Global.Debug.msTraceAsyncOperationStarting && _Global.Debug.msTraceAsyncOperationStarting.bind(_Global.Debug)) || nop,\n        _traceAsyncOperationCompleted: (_Global.Debug && _Global.Debug.msTraceAsyncOperationCompleted && _Global.Debug.msTraceAsyncOperationCompleted.bind(_Global.Debug)) || nop,\n        _traceAsyncCallbackStarting: (_Global.Debug && _Global.Debug.msTraceAsyncCallbackStarting && _Global.Debug.msTraceAsyncCallbackStarting.bind(_Global.Debug)) || nop,\n        _traceAsyncCallbackCompleted: (_Global.Debug && _Global.Debug.msTraceAsyncCallbackCompleted && _Global.Debug.msTraceAsyncCallbackCompleted.bind(_Global.Debug)) || nop\n    };\n});\n_winjs(\"WinJS/Promise/_StateMachine\", [\"WinJS/Core/_Global\",\"WinJS/Core/_BaseCoreUtils\",\"WinJS/Core/_Base\",\"WinJS/Core/_ErrorFromName\",\"WinJS/Core/_Events\",\"WinJS/Core/_Trace\"], function promiseStateMachineInit(_Global, _BaseCoreUtils, _Base, _ErrorFromName, _Events, _Trace) {\n    \"use strict\";\n\n    _Global.Debug && (_Global.Debug.setNonUserCodeExceptions = true);\n\n    var ListenerType = _Base.Class.mix(_Base.Class.define(null, { /*empty*/ }, { supportedForProcessing: false }), _Events.eventMixin);\n    var promiseEventListeners = new ListenerType();\n    // make sure there is a listeners collection so that we can do a more trivial check below\n    promiseEventListeners._listeners = {};\n    var errorET = \"error\";\n    var canceledName = \"Canceled\";\n    var tagWithStack = false;\n    var tag = {\n        promise: 0x01,\n        thenPromise: 0x02,\n        errorPromise: 0x04,\n        exceptionPromise: 0x08,\n        completePromise: 0x10,\n    };\n    tag.all = tag.promise | tag.thenPromise | tag.errorPromise | tag.exceptionPromise | tag.completePromise;\n\n    //\n    // Global error counter, for each error which enters the system we increment this once and then\n    // the error number travels with the error as it traverses the tree of potential handlers.\n    //\n    // When someone has registered to be told about errors (WinJS.Promise.callonerror) promises\n    // which are in error will get tagged with a ._errorId field. This tagged field is the\n    // contract by which nested promises with errors will be identified as chaining for the\n    // purposes of the callonerror semantics. If a nested promise in error is encountered without\n    // a ._errorId it will be assumed to be foreign and treated as an interop boundary and\n    // a new error id will be minted.\n    //\n    var error_number = 1;\n\n    //\n    // The state machine has a interesting hiccup in it with regards to notification, in order\n    // to flatten out notification and avoid recursion for synchronous completion we have an\n    // explicit set of *_notify states which are responsible for notifying their entire tree\n    // of children. They can do this because they know that immediate children are always\n    // ThenPromise instances and we can therefore reach into their state to access the\n    // _listeners collection.\n    //\n    // So, what happens is that a Promise will be fulfilled through the _completed or _error\n    // messages at which point it will enter a *_notify state and be responsible for to move\n    // its children into an (as appropriate) success or error state and also notify that child's\n    // listeners of the state transition, until leaf notes are reached.\n    //\n\n    var state_created,              // -> working\n        state_working,              // -> error | error_notify | success | success_notify | canceled | waiting\n        state_waiting,              // -> error | error_notify | success | success_notify | waiting_canceled\n        state_waiting_canceled,     // -> error | error_notify | success | success_notify | canceling\n        state_canceled,             // -> error | error_notify | success | success_notify | canceling\n        state_canceling,            // -> error_notify\n        state_success_notify,       // -> success\n        state_success,              // -> .\n        state_error_notify,         // -> error\n        state_error;                // -> .\n\n    // Noop function, used in the various states to indicate that they don't support a given\n    // message. Named with the somewhat cute name '_' because it reads really well in the states.\n\n    function _() { }\n\n    // Initial state\n    //\n    state_created = {\n        name: \"created\",\n        enter: function (promise) {\n            promise._setState(state_working);\n        },\n        cancel: _,\n        done: _,\n        then: _,\n        _completed: _,\n        _error: _,\n        _notify: _,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Ready state, waiting for a message (completed/error/progress), able to be canceled\n    //\n    state_working = {\n        name: \"working\",\n        enter: _,\n        cancel: function (promise) {\n            promise._setState(state_canceled);\n        },\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Waiting state, if a promise is completed with a value which is itself a promise\n    // (has a then() method) it signs up to be informed when that child promise is\n    // fulfilled at which point it will be fulfilled with that value.\n    //\n    state_waiting = {\n        name: \"waiting\",\n        enter: function (promise) {\n            var waitedUpon = promise._value;\n            // We can special case our own intermediate promises which are not in a\n            //  terminal state by just pushing this promise as a listener without\n            //  having to create new indirection functions\n            if (waitedUpon instanceof ThenPromise &&\n                waitedUpon._state !== state_error &&\n                waitedUpon._state !== state_success) {\n                pushListener(waitedUpon, { promise: promise });\n            } else {\n                var error = function (value) {\n                    if (waitedUpon._errorId) {\n                        promise._chainedError(value, waitedUpon);\n                    } else {\n                        // Because this is an interop boundary we want to indicate that this\n                        //  error has been handled by the promise infrastructure before we\n                        //  begin a new handling chain.\n                        //\n                        callonerror(promise, value, detailsForHandledError, waitedUpon, error);\n                        promise._error(value);\n                    }\n                };\n                error.handlesOnError = true;\n                waitedUpon.then(\n                    promise._completed.bind(promise),\n                    error,\n                    promise._progress.bind(promise)\n                );\n            }\n        },\n        cancel: function (promise) {\n            promise._setState(state_waiting_canceled);\n        },\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Waiting canceled state, when a promise has been in a waiting state and receives a\n    // request to cancel its pending work it will forward that request to the child promise\n    // and then waits to be informed of the result. This promise moves itself into the\n    // canceling state but understands that the child promise may instead push it to a\n    // different state.\n    //\n    state_waiting_canceled = {\n        name: \"waiting_canceled\",\n        enter: function (promise) {\n            // Initiate a transition to canceling. Triggering a cancel on the promise\n            // that we are waiting upon may result in a different state transition\n            // before the state machine pump runs again.\n            promise._setState(state_canceling);\n            var waitedUpon = promise._value;\n            if (waitedUpon.cancel) {\n                waitedUpon.cancel();\n            }\n        },\n        cancel: _,\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Canceled state, moves to the canceling state and then tells the promise to do\n    // whatever it might need to do on cancelation.\n    //\n    state_canceled = {\n        name: \"canceled\",\n        enter: function (promise) {\n            // Initiate a transition to canceling. The _cancelAction may change the state\n            // before the state machine pump runs again.\n            promise._setState(state_canceling);\n            promise._cancelAction();\n        },\n        cancel: _,\n        done: done,\n        then: then,\n        _completed: completed,\n        _error: error,\n        _notify: _,\n        _progress: progress,\n        _setCompleteValue: setCompleteValue,\n        _setErrorValue: setErrorValue\n    };\n\n    // Canceling state, commits to the promise moving to an error state with an error\n    // object whose 'name' and 'message' properties contain the string \"Canceled\"\n    //\n    state_canceling = {\n        name: \"canceling\",\n        enter: function (promise) {\n            var error = new Error(canceledName);\n            error.name = error.message;\n            promise._value = error;\n            promise._setState(state_error_notify);\n        },\n        cancel: _,\n        done: _,\n        then: _,\n        _completed: _,\n        _error: _,\n        _notify: _,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Success notify state, moves a promise to the success state and notifies all children\n    //\n    state_success_notify = {\n        name: \"complete_notify\",\n        enter: function (promise) {\n            promise.done = CompletePromise.prototype.done;\n            promise.then = CompletePromise.prototype.then;\n            if (promise._listeners) {\n                var queue = [promise];\n                var p;\n                while (queue.length) {\n                    p = queue.shift();\n                    p._state._notify(p, queue);\n                }\n            }\n            promise._setState(state_success);\n        },\n        cancel: _,\n        done: null, /*error to get here */\n        then: null, /*error to get here */\n        _completed: _,\n        _error: _,\n        _notify: notifySuccess,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Success state, moves a promise to the success state and does NOT notify any children.\n    // Some upstream promise is owning the notification pass.\n    //\n    state_success = {\n        name: \"success\",\n        enter: function (promise) {\n            promise.done = CompletePromise.prototype.done;\n            promise.then = CompletePromise.prototype.then;\n            promise._cleanupAction();\n        },\n        cancel: _,\n        done: null, /*error to get here */\n        then: null, /*error to get here */\n        _completed: _,\n        _error: _,\n        _notify: notifySuccess,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Error notify state, moves a promise to the error state and notifies all children\n    //\n    state_error_notify = {\n        name: \"error_notify\",\n        enter: function (promise) {\n            promise.done = ErrorPromise.prototype.done;\n            promise.then = ErrorPromise.prototype.then;\n            if (promise._listeners) {\n                var queue = [promise];\n                var p;\n                while (queue.length) {\n                    p = queue.shift();\n                    p._state._notify(p, queue);\n                }\n            }\n            promise._setState(state_error);\n        },\n        cancel: _,\n        done: null, /*error to get here*/\n        then: null, /*error to get here*/\n        _completed: _,\n        _error: _,\n        _notify: notifyError,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    // Error state, moves a promise to the error state and does NOT notify any children.\n    // Some upstream promise is owning the notification pass.\n    //\n    state_error = {\n        name: \"error\",\n        enter: function (promise) {\n            promise.done = ErrorPromise.prototype.done;\n            promise.then = ErrorPromise.prototype.then;\n            promise._cleanupAction();\n        },\n        cancel: _,\n        done: null, /*error to get here*/\n        then: null, /*error to get here*/\n        _completed: _,\n        _error: _,\n        _notify: notifyError,\n        _progress: _,\n        _setCompleteValue: _,\n        _setErrorValue: _\n    };\n\n    //\n    // The statemachine implementation follows a very particular pattern, the states are specified\n    // as static stateless bags of functions which are then indirected through the state machine\n    // instance (a Promise). As such all of the functions on each state have the promise instance\n    // passed to them explicitly as a parameter and the Promise instance members do a little\n    // dance where they indirect through the state and insert themselves in the argument list.\n    //\n    // We could instead call directly through the promise states however then every caller\n    // would have to remember to do things like pumping the state machine to catch state transitions.\n    //\n\n    var PromiseStateMachine = _Base.Class.define(null, {\n        _listeners: null,\n        _nextState: null,\n        _state: null,\n        _value: null,\n\n        cancel: function () {\n            /// <signature helpKeyword=\"WinJS.PromiseStateMachine.cancel\">\n            /// <summary locid=\"WinJS.PromiseStateMachine.cancel\">\n            /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't\n            /// already been fulfilled and cancellation is supported, the promise enters\n            /// the error state with a value of Error(\"Canceled\").\n            /// </summary>\n            /// </signature>\n            this._state.cancel(this);\n            this._run();\n        },\n        done: function Promise_done(onComplete, onError, onProgress) {\n            /// <signature helpKeyword=\"WinJS.PromiseStateMachine.done\">\n            /// <summary locid=\"WinJS.PromiseStateMachine.done\">\n            /// Allows you to specify the work to be done on the fulfillment of the promised value,\n            /// the error handling to be performed if the promise fails to fulfill\n            /// a value, and the handling of progress notifications along the way.\n            ///\n            /// After the handlers have finished executing, this function throws any error that would have been returned\n            /// from then() as a promise in the error state.\n            /// </summary>\n            /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.done_p:onComplete\">\n            /// The function to be called if the promise is fulfilled successfully with a value.\n            /// The fulfilled value is passed as the single argument. If the value is null,\n            /// the fulfilled value is returned. The value returned\n            /// from the function becomes the fulfilled value of the promise returned by\n            /// then(). If an exception is thrown while executing the function, the promise returned\n            /// by then() moves into the error state.\n            /// </param>\n            /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onError\">\n            /// The function to be called if the promise is fulfilled with an error. The error\n            /// is passed as the single argument. If it is null, the error is forwarded.\n            /// The value returned from the function is the fulfilled value of the promise returned by then().\n            /// </param>\n            /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onProgress\">\n            /// the function to be called if the promise reports progress. Data about the progress\n            /// is passed as the single argument. Promises are not required to support\n            /// progress.\n            /// </param>\n            /// </signature>\n            this._state.done(this, onComplete, onError, onProgress);\n        },\n        then: function Promise_then(onComplete, onError, onProgress) {\n            /// <signature helpKeyword=\"WinJS.PromiseStateMachine.then\">\n            /// <summary locid=\"WinJS.PromiseStateMachine.then\">\n            /// Allows you to specify the work to be done on the fulfillment of the promised value,\n            /// the error handling to be performed if the promise fails to fulfill\n            /// a value, and the handling of progress notifications along the way.\n            /// </summary>\n            /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.then_p:onComplete\">\n            /// The function to be called if the promise is fulfilled successfully with a value.\n            /// The value is passed as the single argument. If the value is null, the value is returned.\n            /// The value returned from the function becomes the fulfilled value of the promise returned by\n            /// then(). If an exception is thrown while this function is being executed, the promise returned\n            /// by then() moves into the error state.\n            /// </param>\n            /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onError\">\n            /// The function to be called if the promise is fulfilled with an error. The error\n            /// is passed as the single argument. If it is null, the error is forwarded.\n            /// The value returned from the function becomes the fulfilled value of the promise returned by then().\n            /// </param>\n            /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onProgress\">\n            /// The function to be called if the promise reports progress. Data about the progress\n            /// is passed as the single argument. Promises are not required to support\n            /// progress.\n            /// </param>\n            /// <returns type=\"WinJS.Promise\" locid=\"WinJS.PromiseStateMachine.then_returnValue\">\n            /// The promise whose value is the result of executing the complete or\n            /// error function.\n            /// </returns>\n            /// </signature>\n            return this._state.then(this, onComplete, onError, onProgress);\n        },\n\n        _chainedError: function (value, context) {\n            var result = this._state._error(this, value, detailsForChainedError, context);\n            this._run();\n            return result;\n        },\n        _completed: function (value) {\n            var result = this._state._completed(this, value);\n            this._run();\n            return result;\n        },\n        _error: function (value) {\n            var result = this._state._error(this, value, detailsForError);\n            this._run();\n            return result;\n        },\n        _progress: function (value) {\n            this._state._progress(this, value);\n        },\n        _setState: function (state) {\n            this._nextState = state;\n        },\n        _setCompleteValue: function (value) {\n            this._state._setCompleteValue(this, value);\n            this._run();\n        },\n        _setChainedErrorValue: function (value, context) {\n            var result = this._state._setErrorValue(this, value, detailsForChainedError, context);\n            this._run();\n            return result;\n        },\n        _setExceptionValue: function (value) {\n            var result = this._state._setErrorValue(this, value, detailsForException);\n            this._run();\n            return result;\n        },\n        _run: function () {\n            while (this._nextState) {\n                this._state = this._nextState;\n                this._nextState = null;\n                this._state.enter(this);\n            }\n        }\n    }, {\n        supportedForProcessing: false\n    });\n\n    //\n    // Implementations of shared state machine code.\n    //\n\n    function completed(promise, value) {\n        var targetState;\n        if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n            targetState = state_waiting;\n        } else {\n            targetState = state_success_notify;\n        }\n        promise._value = value;\n        promise._setState(targetState);\n    }\n    function createErrorDetails(exception, error, promise, id, parent, handler) {\n        return {\n            exception: exception,\n            error: error,\n            promise: promise,\n            handler: handler,\n            id: id,\n            parent: parent\n        };\n    }\n    function detailsForHandledError(promise, errorValue, context, handler) {\n        var exception = context._isException;\n        var errorId = context._errorId;\n        return createErrorDetails(\n            exception ? errorValue : null,\n            exception ? null : errorValue,\n            promise,\n            errorId,\n            context,\n            handler\n        );\n    }\n    function detailsForChainedError(promise, errorValue, context) {\n        var exception = context._isException;\n        var errorId = context._errorId;\n        setErrorInfo(promise, errorId, exception);\n        return createErrorDetails(\n            exception ? errorValue : null,\n            exception ? null : errorValue,\n            promise,\n            errorId,\n            context\n        );\n    }\n    function detailsForError(promise, errorValue) {\n        var errorId = ++error_number;\n        setErrorInfo(promise, errorId);\n        return createErrorDetails(\n            null,\n            errorValue,\n            promise,\n            errorId\n        );\n    }\n    function detailsForException(promise, exceptionValue) {\n        var errorId = ++error_number;\n        setErrorInfo(promise, errorId, true);\n        return createErrorDetails(\n            exceptionValue,\n            null,\n            promise,\n            errorId\n        );\n    }\n    function done(promise, onComplete, onError, onProgress) {\n        var asyncOpID = _Trace._traceAsyncOperationStarting(\"WinJS.Promise.done\");\n        pushListener(promise, { c: onComplete, e: onError, p: onProgress, asyncOpID: asyncOpID });\n    }\n    function error(promise, value, onerrorDetails, context) {\n        promise._value = value;\n        callonerror(promise, value, onerrorDetails, context);\n        promise._setState(state_error_notify);\n    }\n    function notifySuccess(promise, queue) {\n        var value = promise._value;\n        var listeners = promise._listeners;\n        if (!listeners) {\n            return;\n        }\n        promise._listeners = null;\n        var i, len;\n        for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {\n            var listener = len === 1 ? listeners : listeners[i];\n            var onComplete = listener.c;\n            var target = listener.promise;\n\n            _Trace._traceAsyncOperationCompleted(listener.asyncOpID, _Global.Debug && _Global.Debug.MS_ASYNC_OP_STATUS_SUCCESS);\n\n            if (target) {\n                _Trace._traceAsyncCallbackStarting(listener.asyncOpID);\n                try {\n                    target._setCompleteValue(onComplete ? onComplete(value) : value);\n                } catch (ex) {\n                    target._setExceptionValue(ex);\n                } finally {\n                    _Trace._traceAsyncCallbackCompleted();\n                }\n                if (target._state !== state_waiting && target._listeners) {\n                    queue.push(target);\n                }\n            } else {\n                CompletePromise.prototype.done.call(promise, onComplete);\n            }\n        }\n    }\n    function notifyError(promise, queue) {\n        var value = promise._value;\n        var listeners = promise._listeners;\n        if (!listeners) {\n            return;\n        }\n        promise._listeners = null;\n        var i, len;\n        for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {\n            var listener = len === 1 ? listeners : listeners[i];\n            var onError = listener.e;\n            var target = listener.promise;\n\n            var errorID = _Global.Debug && (value && value.name === canceledName ? _Global.Debug.MS_ASYNC_OP_STATUS_CANCELED : _Global.Debug.MS_ASYNC_OP_STATUS_ERROR);\n            _Trace._traceAsyncOperationCompleted(listener.asyncOpID, errorID);\n\n            if (target) {\n                var asyncCallbackStarted = false;\n                try {\n                    if (onError) {\n                        _Trace._traceAsyncCallbackStarting(listener.asyncOpID);\n                        asyncCallbackStarted = true;\n                        if (!onError.handlesOnError) {\n                            callonerror(target, value, detailsForHandledError, promise, onError);\n                        }\n                        target._setCompleteValue(onError(value));\n                    } else {\n                        target._setChainedErrorValue(value, promise);\n                    }\n                } catch (ex) {\n                    target._setExceptionValue(ex);\n                } finally {\n                    if (asyncCallbackStarted) {\n                        _Trace._traceAsyncCallbackCompleted();\n                    }\n                }\n                if (target._state !== state_waiting && target._listeners) {\n                    queue.push(target);\n                }\n            } else {\n                ErrorPromise.prototype.done.call(promise, null, onError);\n            }\n        }\n    }\n    function callonerror(promise, value, onerrorDetailsGenerator, context, handler) {\n        if (promiseEventListeners._listeners[errorET]) {\n            if (value instanceof Error && value.message === canceledName) {\n                return;\n            }\n            promiseEventListeners.dispatchEvent(errorET, onerrorDetailsGenerator(promise, value, context, handler));\n        }\n    }\n    function progress(promise, value) {\n        var listeners = promise._listeners;\n        if (listeners) {\n            var i, len;\n            for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {\n                var listener = len === 1 ? listeners : listeners[i];\n                var onProgress = listener.p;\n                if (onProgress) {\n                    try { onProgress(value); } catch (ex) { }\n                }\n                if (!(listener.c || listener.e) && listener.promise) {\n                    listener.promise._progress(value);\n                }\n            }\n        }\n    }\n    function pushListener(promise, listener) {\n        var listeners = promise._listeners;\n        if (listeners) {\n            // We may have either a single listener (which will never be wrapped in an array)\n            // or 2+ listeners (which will be wrapped). Since we are now adding one more listener\n            // we may have to wrap the single listener before adding the second.\n            listeners = Array.isArray(listeners) ? listeners : [listeners];\n            listeners.push(listener);\n        } else {\n            listeners = listener;\n        }\n        promise._listeners = listeners;\n    }\n    // The difference beween setCompleteValue()/setErrorValue() and complete()/error() is that setXXXValue() moves\n    // a promise directly to the success/error state without starting another notification pass (because one\n    // is already ongoing).\n    function setErrorInfo(promise, errorId, isException) {\n        promise._isException = isException || false;\n        promise._errorId = errorId;\n    }\n    function setErrorValue(promise, value, onerrorDetails, context) {\n        promise._value = value;\n        callonerror(promise, value, onerrorDetails, context);\n        promise._setState(state_error);\n    }\n    function setCompleteValue(promise, value) {\n        var targetState;\n        if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n            targetState = state_waiting;\n        } else {\n            targetState = state_success;\n        }\n        promise._value = value;\n        promise._setState(targetState);\n    }\n    function then(promise, onComplete, onError, onProgress) {\n        var result = new ThenPromise(promise);\n        var asyncOpID = _Trace._traceAsyncOperationStarting(\"WinJS.Promise.then\");\n        pushListener(promise, { promise: result, c: onComplete, e: onError, p: onProgress, asyncOpID: asyncOpID });\n        return result;\n    }\n\n    //\n    // Internal implementation detail promise, ThenPromise is created when a promise needs\n    // to be returned from a then() method.\n    //\n    var ThenPromise = _Base.Class.derive(PromiseStateMachine,\n        function (creator) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.thenPromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._creator = creator;\n            this._setState(state_created);\n            this._run();\n        }, {\n            _creator: null,\n\n            _cancelAction: function () { if (this._creator) { this._creator.cancel(); } },\n            _cleanupAction: function () { this._creator = null; }\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    //\n    // Slim promise implementations for already completed promises, these are created\n    // under the hood on synchronous completion paths as well as by WinJS.Promise.wrap\n    // and WinJS.Promise.wrapError.\n    //\n\n    var ErrorPromise = _Base.Class.define(\n        function ErrorPromise_ctor(value) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.errorPromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._value = value;\n            callonerror(this, value, detailsForError);\n        }, {\n            cancel: function () {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.cancel\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.cancel\">\n                /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't\n                /// already been fulfilled and cancellation is supported, the promise enters\n                /// the error state with a value of Error(\"Canceled\").\n                /// </summary>\n                /// </signature>\n            },\n            done: function ErrorPromise_done(unused, onError) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.done\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.done\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                ///\n                /// After the handlers have finished executing, this function throws any error that would have been returned\n                /// from then() as a promise in the error state.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.done_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The fulfilled value is passed as the single argument. If the value is null,\n                /// the fulfilled value is returned. The value returned\n                /// from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while executing the function, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function is the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onProgress\">\n                /// the function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// </signature>\n                var value = this._value;\n                if (onError) {\n                    try {\n                        if (!onError.handlesOnError) {\n                            callonerror(null, value, detailsForHandledError, this, onError);\n                        }\n                        var result = onError(value);\n                        if (result && typeof result === \"object\" && typeof result.done === \"function\") {\n                            // If a promise is returned we need to wait on it.\n                            result.done();\n                        }\n                        return;\n                    } catch (ex) {\n                        value = ex;\n                    }\n                }\n                if (value instanceof Error && value.message === canceledName) {\n                    // suppress cancel\n                    return;\n                }\n                // force the exception to be thrown asyncronously to avoid any try/catch blocks\n                //\n                Promise._doneHandler(value);\n            },\n            then: function ErrorPromise_then(unused, onError) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.then\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.then\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.then_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The value is passed as the single argument. If the value is null, the value is returned.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while this function is being executed, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onProgress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.PromiseStateMachine.then_returnValue\">\n                /// The promise whose value is the result of executing the complete or\n                /// error function.\n                /// </returns>\n                /// </signature>\n\n                // If the promise is already in a error state and no error handler is provided\n                // we optimize by simply returning the promise instead of creating a new one.\n                //\n                if (!onError) { return this; }\n                var result;\n                var value = this._value;\n                try {\n                    if (!onError.handlesOnError) {\n                        callonerror(null, value, detailsForHandledError, this, onError);\n                    }\n                    result = new CompletePromise(onError(value));\n                } catch (ex) {\n                    // If the value throw from the error handler is the same as the value\n                    // provided to the error handler then there is no need for a new promise.\n                    //\n                    if (ex === value) {\n                        result = this;\n                    } else {\n                        result = new ExceptionPromise(ex);\n                    }\n                }\n                return result;\n            }\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    var ExceptionPromise = _Base.Class.derive(ErrorPromise,\n        function ExceptionPromise_ctor(value) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.exceptionPromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._value = value;\n            callonerror(this, value, detailsForException);\n        }, {\n            /* empty */\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    var CompletePromise = _Base.Class.define(\n        function CompletePromise_ctor(value) {\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.completePromise))) {\n                this._stack = Promise._getStack();\n            }\n\n            if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n                var result = new ThenPromise(null);\n                result._setCompleteValue(value);\n                return result;\n            }\n            this._value = value;\n        }, {\n            cancel: function () {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.cancel\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.cancel\">\n                /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't\n                /// already been fulfilled and cancellation is supported, the promise enters\n                /// the error state with a value of Error(\"Canceled\").\n                /// </summary>\n                /// </signature>\n            },\n            done: function CompletePromise_done(onComplete) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.done\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.done\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                ///\n                /// After the handlers have finished executing, this function throws any error that would have been returned\n                /// from then() as a promise in the error state.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.done_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The fulfilled value is passed as the single argument. If the value is null,\n                /// the fulfilled value is returned. The value returned\n                /// from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while executing the function, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function is the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.done_p:onProgress\">\n                /// the function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// </signature>\n                if (!onComplete) { return; }\n                try {\n                    var result = onComplete(this._value);\n                    if (result && typeof result === \"object\" && typeof result.done === \"function\") {\n                        result.done();\n                    }\n                } catch (ex) {\n                    // force the exception to be thrown asynchronously to avoid any try/catch blocks\n                    Promise._doneHandler(ex);\n                }\n            },\n            then: function CompletePromise_then(onComplete) {\n                /// <signature helpKeyword=\"WinJS.PromiseStateMachine.then\">\n                /// <summary locid=\"WinJS.PromiseStateMachine.then\">\n                /// Allows you to specify the work to be done on the fulfillment of the promised value,\n                /// the error handling to be performed if the promise fails to fulfill\n                /// a value, and the handling of progress notifications along the way.\n                /// </summary>\n                /// <param name='onComplete' type='Function' locid=\"WinJS.PromiseStateMachine.then_p:onComplete\">\n                /// The function to be called if the promise is fulfilled successfully with a value.\n                /// The value is passed as the single argument. If the value is null, the value is returned.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by\n                /// then(). If an exception is thrown while this function is being executed, the promise returned\n                /// by then() moves into the error state.\n                /// </param>\n                /// <param name='onError' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onError\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument. If it is null, the error is forwarded.\n                /// The value returned from the function becomes the fulfilled value of the promise returned by then().\n                /// </param>\n                /// <param name='onProgress' type='Function' optional='true' locid=\"WinJS.PromiseStateMachine.then_p:onProgress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.PromiseStateMachine.then_returnValue\">\n                /// The promise whose value is the result of executing the complete or\n                /// error function.\n                /// </returns>\n                /// </signature>\n                try {\n                    // If the value returned from the completion handler is the same as the value\n                    // provided to the completion handler then there is no need for a new promise.\n                    //\n                    var newValue = onComplete ? onComplete(this._value) : this._value;\n                    return newValue === this._value ? this : new CompletePromise(newValue);\n                } catch (ex) {\n                    return new ExceptionPromise(ex);\n                }\n            }\n        }, {\n            supportedForProcessing: false\n        }\n    );\n\n    //\n    // Promise is the user-creatable WinJS.Promise object.\n    //\n\n    function timeout(timeoutMS) {\n        var id;\n        return new Promise(\n            function (c) {\n                if (timeoutMS) {\n                    id = _Global.setTimeout(c, timeoutMS);\n                } else {\n                    _BaseCoreUtils._setImmediate(c);\n                }\n            },\n            function () {\n                if (id) {\n                    _Global.clearTimeout(id);\n                }\n            }\n        );\n    }\n\n    function timeoutWithPromise(timeout, promise) {\n        var cancelPromise = function () { promise.cancel(); };\n        var cancelTimeout = function () { timeout.cancel(); };\n        timeout.then(cancelPromise);\n        promise.then(cancelTimeout, cancelTimeout);\n        return promise;\n    }\n\n    var staticCanceledPromise;\n\n    var Promise = _Base.Class.derive(PromiseStateMachine,\n        function Promise_ctor(init, oncancel) {\n            /// <signature helpKeyword=\"WinJS.Promise\">\n            /// <summary locid=\"WinJS.Promise\">\n            /// A promise provides a mechanism to schedule work to be done on a value that\n            /// has not yet been computed. It is a convenient abstraction for managing\n            /// interactions with asynchronous APIs.\n            /// </summary>\n            /// <param name=\"init\" type=\"Function\" locid=\"WinJS.Promise_p:init\">\n            /// The function that is called during construction of the  promise. The function\n            /// is given three arguments (complete, error, progress). Inside this function\n            /// you should add event listeners for the notifications supported by this value.\n            /// </param>\n            /// <param name=\"oncancel\" optional=\"true\" locid=\"WinJS.Promise_p:oncancel\">\n            /// The function to call if a consumer of this promise wants\n            /// to cancel its undone work. Promises are not required to\n            /// support cancellation.\n            /// </param>\n            /// </signature>\n\n            if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.promise))) {\n                this._stack = Promise._getStack();\n            }\n\n            this._oncancel = oncancel;\n            this._setState(state_created);\n            this._run();\n\n            try {\n                var complete = this._completed.bind(this);\n                var error = this._error.bind(this);\n                var progress = this._progress.bind(this);\n                init(complete, error, progress);\n            } catch (ex) {\n                this._setExceptionValue(ex);\n            }\n        }, {\n            _oncancel: null,\n\n            _cancelAction: function () {\n                // BEGIN monaco change\n                try {\n                    if (this._oncancel) {\n                        this._oncancel();\n                    } else {\n                        throw new Error('Promise did not implement oncancel');\n                    }\n                } catch (ex) {\n                    // Access fields to get them created\n                    var msg = ex.message;\n                    var stack = ex.stack;\n                    promiseEventListeners.dispatchEvent('error', ex);\n                }\n                // END monaco change\n            },\n            _cleanupAction: function () { this._oncancel = null; }\n        }, {\n\n            addEventListener: function Promise_addEventListener(eventType, listener, capture) {\n                /// <signature helpKeyword=\"WinJS.Promise.addEventListener\">\n                /// <summary locid=\"WinJS.Promise.addEventListener\">\n                /// Adds an event listener to the control.\n                /// </summary>\n                /// <param name=\"eventType\" locid=\"WinJS.Promise.addEventListener_p:eventType\">\n                /// The type (name) of the event.\n                /// </param>\n                /// <param name=\"listener\" locid=\"WinJS.Promise.addEventListener_p:listener\">\n                /// The listener to invoke when the event is raised.\n                /// </param>\n                /// <param name=\"capture\" locid=\"WinJS.Promise.addEventListener_p:capture\">\n                /// Specifies whether or not to initiate capture.\n                /// </param>\n                /// </signature>\n                promiseEventListeners.addEventListener(eventType, listener, capture);\n            },\n            any: function Promise_any(values) {\n                /// <signature helpKeyword=\"WinJS.Promise.any\">\n                /// <summary locid=\"WinJS.Promise.any\">\n                /// Returns a promise that is fulfilled when one of the input promises\n                /// has been fulfilled.\n                /// </summary>\n                /// <param name=\"values\" type=\"Array\" locid=\"WinJS.Promise.any_p:values\">\n                /// An array that contains promise objects or objects whose property\n                /// values include promise objects.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.any_returnValue\">\n                /// A promise that on fulfillment yields the value of the input (complete or error).\n                /// </returns>\n                /// </signature>\n                return new Promise(\n                    function (complete, error) {\n                        var keys = Object.keys(values);\n                        if (keys.length === 0) {\n                            complete();\n                        }\n                        var canceled = 0;\n                        keys.forEach(function (key) {\n                            Promise.as(values[key]).then(\n                                function () { complete({ key: key, value: values[key] }); },\n                                function (e) {\n                                    if (e instanceof Error && e.name === canceledName) {\n                                        if ((++canceled) === keys.length) {\n                                            complete(Promise.cancel);\n                                        }\n                                        return;\n                                    }\n                                    error({ key: key, value: values[key] });\n                                }\n                            );\n                        });\n                    },\n                    function () {\n                        var keys = Object.keys(values);\n                        keys.forEach(function (key) {\n                            var promise = Promise.as(values[key]);\n                            if (typeof promise.cancel === \"function\") {\n                                promise.cancel();\n                            }\n                        });\n                    }\n                );\n            },\n            as: function Promise_as(value) {\n                /// <signature helpKeyword=\"WinJS.Promise.as\">\n                /// <summary locid=\"WinJS.Promise.as\">\n                /// Returns a promise. If the object is already a promise it is returned;\n                /// otherwise the object is wrapped in a promise.\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.as_p:value\">\n                /// The value to be treated as a promise.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.as_returnValue\">\n                /// A promise.\n                /// </returns>\n                /// </signature>\n                if (value && typeof value === \"object\" && typeof value.then === \"function\") {\n                    return value;\n                }\n                return new CompletePromise(value);\n            },\n            /// <field type=\"WinJS.Promise\" helpKeyword=\"WinJS.Promise.cancel\" locid=\"WinJS.Promise.cancel\">\n            /// Canceled promise value, can be returned from a promise completion handler\n            /// to indicate cancelation of the promise chain.\n            /// </field>\n            cancel: {\n                get: function () {\n                    return (staticCanceledPromise = staticCanceledPromise || new ErrorPromise(new _ErrorFromName(canceledName)));\n                }\n            },\n            dispatchEvent: function Promise_dispatchEvent(eventType, details) {\n                /// <signature helpKeyword=\"WinJS.Promise.dispatchEvent\">\n                /// <summary locid=\"WinJS.Promise.dispatchEvent\">\n                /// Raises an event of the specified type and properties.\n                /// </summary>\n                /// <param name=\"eventType\" locid=\"WinJS.Promise.dispatchEvent_p:eventType\">\n                /// The type (name) of the event.\n                /// </param>\n                /// <param name=\"details\" locid=\"WinJS.Promise.dispatchEvent_p:details\">\n                /// The set of additional properties to be attached to the event object.\n                /// </param>\n                /// <returns type=\"Boolean\" locid=\"WinJS.Promise.dispatchEvent_returnValue\">\n                /// Specifies whether preventDefault was called on the event.\n                /// </returns>\n                /// </signature>\n                return promiseEventListeners.dispatchEvent(eventType, details);\n            },\n            is: function Promise_is(value) {\n                /// <signature helpKeyword=\"WinJS.Promise.is\">\n                /// <summary locid=\"WinJS.Promise.is\">\n                /// Determines whether a value fulfills the promise contract.\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.is_p:value\">\n                /// A value that may be a promise.\n                /// </param>\n                /// <returns type=\"Boolean\" locid=\"WinJS.Promise.is_returnValue\">\n                /// true if the specified value is a promise, otherwise false.\n                /// </returns>\n                /// </signature>\n                return value && typeof value === \"object\" && typeof value.then === \"function\";\n            },\n            join: function Promise_join(values) {\n                /// <signature helpKeyword=\"WinJS.Promise.join\">\n                /// <summary locid=\"WinJS.Promise.join\">\n                /// Creates a promise that is fulfilled when all the values are fulfilled.\n                /// </summary>\n                /// <param name=\"values\" type=\"Object\" locid=\"WinJS.Promise.join_p:values\">\n                /// An object whose fields contain values, some of which may be promises.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.join_returnValue\">\n                /// A promise whose value is an object with the same field names as those of the object in the values parameter, where\n                /// each field value is the fulfilled value of a promise.\n                /// </returns>\n                /// </signature>\n                return new Promise(\n                    function (complete, error, progress) {\n                        var keys = Object.keys(values);\n                        var errors = Array.isArray(values) ? [] : {};\n                        var results = Array.isArray(values) ? [] : {};\n                        var undefineds = 0;\n                        var pending = keys.length;\n                        var argDone = function (key) {\n                            if ((--pending) === 0) {\n                                var errorCount = Object.keys(errors).length;\n                                if (errorCount === 0) {\n                                    complete(results);\n                                } else {\n                                    var canceledCount = 0;\n                                    keys.forEach(function (key) {\n                                        var e = errors[key];\n                                        if (e instanceof Error && e.name === canceledName) {\n                                            canceledCount++;\n                                        }\n                                    });\n                                    if (canceledCount === errorCount) {\n                                        complete(Promise.cancel);\n                                    } else {\n                                        error(errors);\n                                    }\n                                }\n                            } else {\n                                progress({ Key: key, Done: true });\n                            }\n                        };\n                        keys.forEach(function (key) {\n                            var value = values[key];\n                            if (value === undefined) {\n                                undefineds++;\n                            } else {\n                                Promise.then(value,\n                                    function (value) { results[key] = value; argDone(key); },\n                                    function (value) { errors[key] = value; argDone(key); }\n                                );\n                            }\n                        });\n                        pending -= undefineds;\n                        if (pending === 0) {\n                            complete(results);\n                            return;\n                        }\n                    },\n                    function () {\n                        Object.keys(values).forEach(function (key) {\n                            var promise = Promise.as(values[key]);\n                            if (typeof promise.cancel === \"function\") {\n                                promise.cancel();\n                            }\n                        });\n                    }\n                );\n            },\n            removeEventListener: function Promise_removeEventListener(eventType, listener, capture) {\n                /// <signature helpKeyword=\"WinJS.Promise.removeEventListener\">\n                /// <summary locid=\"WinJS.Promise.removeEventListener\">\n                /// Removes an event listener from the control.\n                /// </summary>\n                /// <param name='eventType' locid=\"WinJS.Promise.removeEventListener_eventType\">\n                /// The type (name) of the event.\n                /// </param>\n                /// <param name='listener' locid=\"WinJS.Promise.removeEventListener_listener\">\n                /// The listener to remove.\n                /// </param>\n                /// <param name='capture' locid=\"WinJS.Promise.removeEventListener_capture\">\n                /// Specifies whether or not to initiate capture.\n                /// </param>\n                /// </signature>\n                promiseEventListeners.removeEventListener(eventType, listener, capture);\n            },\n            supportedForProcessing: false,\n            then: function Promise_then(value, onComplete, onError, onProgress) {\n                /// <signature helpKeyword=\"WinJS.Promise.then\">\n                /// <summary locid=\"WinJS.Promise.then\">\n                /// A static version of the promise instance method then().\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.then_p:value\">\n                /// the value to be treated as a promise.\n                /// </param>\n                /// <param name=\"onComplete\" type=\"Function\" locid=\"WinJS.Promise.then_p:complete\">\n                /// The function to be called if the promise is fulfilled with a value.\n                /// If it is null, the promise simply\n                /// returns the value. The value is passed as the single argument.\n                /// </param>\n                /// <param name=\"onError\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.then_p:error\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument.\n                /// </param>\n                /// <param name=\"onProgress\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.then_p:progress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.then_returnValue\">\n                /// A promise whose value is the result of executing the provided complete function.\n                /// </returns>\n                /// </signature>\n                return Promise.as(value).then(onComplete, onError, onProgress);\n            },\n            thenEach: function Promise_thenEach(values, onComplete, onError, onProgress) {\n                /// <signature helpKeyword=\"WinJS.Promise.thenEach\">\n                /// <summary locid=\"WinJS.Promise.thenEach\">\n                /// Performs an operation on all the input promises and returns a promise\n                /// that has the shape of the input and contains the result of the operation\n                /// that has been performed on each input.\n                /// </summary>\n                /// <param name=\"values\" locid=\"WinJS.Promise.thenEach_p:values\">\n                /// A set of values (which could be either an array or an object) of which some or all are promises.\n                /// </param>\n                /// <param name=\"onComplete\" type=\"Function\" locid=\"WinJS.Promise.thenEach_p:complete\">\n                /// The function to be called if the promise is fulfilled with a value.\n                /// If the value is null, the promise returns the value.\n                /// The value is passed as the single argument.\n                /// </param>\n                /// <param name=\"onError\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.thenEach_p:error\">\n                /// The function to be called if the promise is fulfilled with an error. The error\n                /// is passed as the single argument.\n                /// </param>\n                /// <param name=\"onProgress\" type=\"Function\" optional=\"true\" locid=\"WinJS.Promise.thenEach_p:progress\">\n                /// The function to be called if the promise reports progress. Data about the progress\n                /// is passed as the single argument. Promises are not required to support\n                /// progress.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.thenEach_returnValue\">\n                /// A promise that is the result of calling Promise.join on the values parameter.\n                /// </returns>\n                /// </signature>\n                var result = Array.isArray(values) ? [] : {};\n                Object.keys(values).forEach(function (key) {\n                    result[key] = Promise.as(values[key]).then(onComplete, onError, onProgress);\n                });\n                return Promise.join(result);\n            },\n            timeout: function Promise_timeout(time, promise) {\n                /// <signature helpKeyword=\"WinJS.Promise.timeout\">\n                /// <summary locid=\"WinJS.Promise.timeout\">\n                /// Creates a promise that is fulfilled after a timeout.\n                /// </summary>\n                /// <param name=\"timeout\" type=\"Number\" optional=\"true\" locid=\"WinJS.Promise.timeout_p:timeout\">\n                /// The timeout period in milliseconds. If this value is zero or not specified\n                /// setImmediate is called, otherwise setTimeout is called.\n                /// </param>\n                /// <param name=\"promise\" type=\"Promise\" optional=\"true\" locid=\"WinJS.Promise.timeout_p:promise\">\n                /// A promise that will be canceled if it doesn't complete before the\n                /// timeout has expired.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.timeout_returnValue\">\n                /// A promise that is completed asynchronously after the specified timeout.\n                /// </returns>\n                /// </signature>\n                var to = timeout(time);\n                return promise ? timeoutWithPromise(to, promise) : to;\n            },\n            wrap: function Promise_wrap(value) {\n                /// <signature helpKeyword=\"WinJS.Promise.wrap\">\n                /// <summary locid=\"WinJS.Promise.wrap\">\n                /// Wraps a non-promise value in a promise. You can use this function if you need\n                /// to pass a value to a function that requires a promise.\n                /// </summary>\n                /// <param name=\"value\" locid=\"WinJS.Promise.wrap_p:value\">\n                /// Some non-promise value to be wrapped in a promise.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.wrap_returnValue\">\n                /// A promise that is successfully fulfilled with the specified value\n                /// </returns>\n                /// </signature>\n                return new CompletePromise(value);\n            },\n            wrapError: function Promise_wrapError(error) {\n                /// <signature helpKeyword=\"WinJS.Promise.wrapError\">\n                /// <summary locid=\"WinJS.Promise.wrapError\">\n                /// Wraps a non-promise error value in a promise. You can use this function if you need\n                /// to pass an error to a function that requires a promise.\n                /// </summary>\n                /// <param name=\"error\" locid=\"WinJS.Promise.wrapError_p:error\">\n                /// A non-promise error value to be wrapped in a promise.\n                /// </param>\n                /// <returns type=\"WinJS.Promise\" locid=\"WinJS.Promise.wrapError_returnValue\">\n                /// A promise that is in an error state with the specified value.\n                /// </returns>\n                /// </signature>\n                return new ErrorPromise(error);\n            },\n\n            _veryExpensiveTagWithStack: {\n                get: function () { return tagWithStack; },\n                set: function (value) { tagWithStack = value; }\n            },\n            _veryExpensiveTagWithStack_tag: tag,\n            _getStack: function () {\n                if (_Global.Debug && _Global.Debug.debuggerEnabled) {\n                    try { throw new Error(); } catch (e) { return e.stack; }\n                }\n            },\n\n            _cancelBlocker: function Promise__cancelBlocker(input, oncancel) {\n                //\n                // Returns a promise which on cancelation will still result in downstream cancelation while\n                //  protecting the promise 'input' from being  canceled which has the effect of allowing\n                //  'input' to be shared amoung various consumers.\n                //\n                if (!Promise.is(input)) {\n                    return Promise.wrap(input);\n                }\n                var complete;\n                var error;\n                var output = new Promise(\n                    function (c, e) {\n                        complete = c;\n                        error = e;\n                    },\n                    function () {\n                        complete = null;\n                        error = null;\n                        oncancel && oncancel();\n                    }\n                );\n                input.then(\n                    function (v) { complete && complete(v); },\n                    function (e) { error && error(e); }\n                );\n                return output;\n            },\n\n        }\n    );\n    Object.defineProperties(Promise, _Events.createEventProperties(errorET));\n\n    Promise._doneHandler = function (value) {\n        _BaseCoreUtils._setImmediate(function Promise_done_rethrow() {\n            throw value;\n        });\n    };\n\n    return {\n        PromiseStateMachine: PromiseStateMachine,\n        Promise: Promise,\n        state_created: state_created\n    };\n});\n\n_winjs(\"WinJS/Promise\", [\"WinJS/Core/_Base\",\"WinJS/Promise/_StateMachine\"], function promiseInit( _Base, _StateMachine) {\n    \"use strict\";\n\n    _Base.Namespace.define(\"WinJS\", {\n        Promise: _StateMachine.Promise\n    });\n\n    return _StateMachine.Promise;\n});\n\nvar exported = _modules[\"WinJS/Core/_WinJS\"];\n\nif (typeof exports === 'undefined' && typeof define === 'function' && define.amd) {\n    define(\"vs/base/common/winjs.base.raw\", exported);\n} else {\n    module.exports = exported;\n}\n\nif (typeof process !== 'undefined' && typeof process.nextTick === 'function') {\n    _modules[\"WinJS/Core/_BaseCoreUtils\"]._setImmediate = function(handler) {\n        return process.nextTick(handler);\n    };\n}\n\n})();","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n/**\n * A message sent from the UI thread to a worker\n */\nexport interface IClientMessage {\n\tid:number;\n\ttype:string;\n\ttimestamp:number;\n\tpayload:any;\n}\n\n/**\n * A message sent from a worker to the UI thread\n */\nexport interface IServerMessage {\n\tmonacoWorker:boolean;\n\tfrom:number;\n\treq:string;\n\ttype:string;\n\tpayload:any;\n}\n\n/**\n * A message sent from a worker to the UI thread in reply to a UI thread request\n */\nexport interface IServerReplyMessage extends IServerMessage {\n\tid:number;\n\taction:string;\n}\n\n/**\n * A message sent from a worker to the UI thread for debugging purposes (console.log, console.info, etc.)\n */\nexport interface IServerPrintMessage extends IServerMessage {\n\tlevel:string;\n}\n\nexport var MessageType = {\n\tINITIALIZE: '$initialize',\n\tREPLY: '$reply',\n\tPRINT: '$print'\n};\n\nexport var ReplyType = {\n\tCOMPLETE: 'complete',\n\tERROR: 'error',\n\tPROGRESS: 'progress'\n};\n\nexport var PrintType = {\n\tLOG: 'log',\n\tDEBUG: 'debug',\n\tINFO: 'info',\n\tWARN: 'warn',\n\tERROR: 'error'\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nexport namespace Arrays {\n\n\t/**\n\t * Given a sorted array of natural number segments, find the segment containing a natural number.\n\t *    For example, the segments [0, 5), [5, 9), [9, infinity) will be represented in the following manner:\n\t *       [{ startIndex: 0 }, { startIndex: 5 }, { startIndex: 9 }]\n\t *    Searching for 0, 1, 2, 3 or 4 will return 0.\n\t *    Searching for 5, 6, 7 or 8 will return 1.\n\t *    Searching for 9, 10, 11, ... will return 2.\n\t * @param arr A sorted array representing natural number segments\n\t * @param desiredIndex The search\n\t * @return The index of the containing segment in the array.\n\t */\n\texport function findIndexInSegmentsArray(arr: { startIndex: number; }[], desiredIndex: number): number {\n\n\t\tlet low = 0;\n\t\tlet high = arr.length - 1;\n\n\t\tif (high <= 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\twhile (low < high) {\n\n\t\t\tlet mid = low + Math.ceil((high - low) / 2);\n\n\t\t\tif (arr[mid].startIndex > desiredIndex) {\n\t\t\t\thigh = mid - 1;\n\t\t\t} else {\n\t\t\t\tlow = mid;\n\t\t\t}\n\t\t}\n\n\t\treturn low;\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IMode, IModeTransition} from 'vs/editor/common/modes';\nimport {Arrays} from 'vs/editor/common/core/arrays';\n\nexport class ModeTransition {\n\t_modeTransitionBrand: void;\n\n\tpublic startIndex:number;\n\tpublic mode:IMode;\n\tpublic modeId: string;\n\n\tconstructor(startIndex:number, mode:IMode) {\n\t\tthis.startIndex = startIndex|0;\n\t\tthis.mode = mode;\n\t\tthis.modeId = mode.getId();\n\t}\n\n\tpublic static findIndexInSegmentsArray(arr:ModeTransition[], desiredIndex: number): number {\n\t\treturn Arrays.findIndexInSegmentsArray(arr, desiredIndex);\n\t}\n\n\tpublic static create(modeTransitions:IModeTransition[]): ModeTransition[] {\n\t\tlet result:ModeTransition[] = [];\n\t\tfor (let i = 0, len = modeTransitions.length; i < len; i++) {\n\t\t\tlet modeTransition = modeTransitions[i];\n\t\t\tresult.push(new ModeTransition(modeTransition.startIndex, modeTransition.mode));\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IPosition} from 'vs/editor/common/editorCommon';\n\n/**\n * A position in the editor.\n */\nexport class Position {\n\t/**\n\t * line number (starts at 1)\n\t */\n\tpublic lineNumber: number;\n\t/**\n\t * column (the first character in a line is between column 1 and column 2)\n\t */\n\tpublic column: number;\n\n\tconstructor(lineNumber: number, column: number) {\n\t\tthis.lineNumber = lineNumber;\n\t\tthis.column = column;\n\t}\n\n\t/**\n\t * Test if this position equals other position\n\t */\n\tpublic equals(other:IPosition): boolean {\n\t\treturn Position.equals(this, other);\n\t}\n\n\t/**\n\t * Test if position `a` equals position `b`\n\t */\n\tpublic static equals(a:IPosition, b:IPosition): boolean {\n\t\tif (!a && !b) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (\n\t\t\t!!a &&\n\t\t\t!!b &&\n\t\t\ta.lineNumber === b.lineNumber &&\n\t\t\ta.column === b.column\n\t\t);\n\t}\n\n\t/**\n\t * Test if this position is before other position.\n\t * If the two positions are equal, the result will be false.\n\t */\n\tpublic isBefore(other:IPosition): boolean {\n\t\treturn Position.isBefore(this, other);\n\t}\n\n\t/**\n\t * Test if position `a` is before position `b`.\n\t * If the two positions are equal, the result will be false.\n\t */\n\tpublic static isBefore(a:IPosition, b:IPosition): boolean {\n\t\tif (a.lineNumber < b.lineNumber) {\n\t\t\treturn true;\n\t\t}\n\t\tif (b.lineNumber < a.lineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.column < b.column;\n\t}\n\n\t/**\n\t * Test if this position is before other position.\n\t * If the two positions are equal, the result will be true.\n\t */\n\tpublic isBeforeOrEqual(other:IPosition): boolean {\n\t\treturn Position.isBeforeOrEqual(this, other);\n\t}\n\n\t/**\n\t * Test if position `a` is before position `b`.\n\t * If the two positions are equal, the result will be true.\n\t */\n\tpublic static isBeforeOrEqual(a:IPosition, b:IPosition): boolean {\n\t\tif (a.lineNumber < b.lineNumber) {\n\t\t\treturn true;\n\t\t}\n\t\tif (b.lineNumber < a.lineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.column <= b.column;\n\t}\n\n\t/**\n\t * Clone this position.\n\t */\n\tpublic clone(): Position {\n\t\treturn new Position(this.lineNumber, this.column);\n\t}\n\n\t/**\n\t * Convert to a human-readable representation.\n\t */\n\tpublic toString(): string {\n\t\treturn '(' + this.lineNumber + ',' + this.column + ')';\n\t}\n\n\t// ---\n\n\t/**\n\t * Create a `Position` from an `IPosition`.\n\t */\n\tpublic static lift(pos:IPosition): Position {\n\t\treturn new Position(pos.lineNumber, pos.column);\n\t}\n\n\t/**\n\t * Test if `obj` is an `IPosition`.\n\t */\n\tpublic static isIPosition(obj: any): obj is IPosition {\n\t\treturn (\n\t\t\tobj\n\t\t\t&& (typeof obj.lineNumber === 'number')\n\t\t\t&& (typeof obj.column === 'number')\n\t\t);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport {Position} from 'vs/editor/common/core/position';\nimport {IPosition, IRange} from 'vs/editor/common/editorCommon';\n\n/**\n * A range in the editor. (startLineNumber,startColumn) is <= (endLineNumber,endColumn)\n */\nexport class Range {\n\n\t/**\n\t * Line number on which the range starts (starts at 1).\n\t */\n\tpublic startLineNumber:number;\n\t/**\n\t * Column on which the range starts in line `startLineNumber` (starts at 1).\n\t */\n\tpublic startColumn:number;\n\t/**\n\t * Line number on which the range ends.\n\t */\n\tpublic endLineNumber:number;\n\t/**\n\t * Column on which the range ends in line `endLineNumber`.\n\t */\n\tpublic endColumn:number;\n\n\tconstructor(startLineNumber:number, startColumn:number, endLineNumber:number, endColumn:number) {\n\t\tif ((startLineNumber > endLineNumber) || (startLineNumber === endLineNumber && startColumn > endColumn)) {\n\t\t\tthis.startLineNumber = endLineNumber;\n\t\t\tthis.startColumn = endColumn;\n\t\t\tthis.endLineNumber = startLineNumber;\n\t\t\tthis.endColumn = startColumn;\n\t\t} else {\n\t\t\tthis.startLineNumber = startLineNumber;\n\t\t\tthis.startColumn = startColumn;\n\t\t\tthis.endLineNumber = endLineNumber;\n\t\t\tthis.endColumn = endColumn;\n\t\t}\n\t}\n\n\t/**\n\t * Test if this range is empty.\n\t */\n\tpublic isEmpty(): boolean {\n\t\treturn Range.isEmpty(this);\n\t}\n\n\t/**\n\t * Test if `range` is empty.\n\t */\n\tpublic static isEmpty(range:IRange): boolean {\n\t\treturn (range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn);\n\t}\n\n\t/**\n\t * Test if position is in this range. If the position is at the edges, will return true.\n\t */\n\tpublic containsPosition(position:IPosition): boolean {\n\t\treturn Range.containsPosition(this, position);\n\t}\n\n\t/**\n\t * Test if `position` is in `range`. If the position is at the edges, will return true.\n\t */\n\tpublic static containsPosition(range:IRange, position:IPosition): boolean {\n\t\tif (position.lineNumber < range.startLineNumber || position.lineNumber > range.endLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (position.lineNumber === range.startLineNumber && position.column < range.startColumn) {\n\t\t\treturn false;\n\t\t}\n\t\tif (position.lineNumber === range.endLineNumber && position.column > range.endColumn) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Test if range is in this range. If the range is equal to this range, will return true.\n\t */\n\tpublic containsRange(range:IRange): boolean {\n\t\treturn Range.containsRange(this, range);\n\t}\n\n\t/**\n\t * Test if `otherRange` is in `range`. If the ranges are equal, will return true.\n\t */\n\tpublic static containsRange(range:IRange, otherRange:IRange): boolean {\n\t\tif (otherRange.startLineNumber < range.startLineNumber || otherRange.endLineNumber < range.startLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.startLineNumber > range.endLineNumber || otherRange.endLineNumber > range.endLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.startLineNumber === range.startLineNumber && otherRange.startColumn < range.startColumn) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.endLineNumber === range.endLineNumber && otherRange.endColumn > range.endColumn) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * A reunion of the two ranges.\n\t * The smallest position will be used as the start point, and the largest one as the end point.\n\t */\n\tpublic plusRange(range:IRange): Range {\n\t\treturn Range.plusRange(this, range);\n\t}\n\n\t/**\n\t * A reunion of the two ranges.\n\t * The smallest position will be used as the start point, and the largest one as the end point.\n\t */\n\tpublic static plusRange(a:IRange, b:IRange): Range {\n\t\tvar startLineNumber:number, startColumn:number, endLineNumber:number, endColumn:number;\n\t\tif (b.startLineNumber < a.startLineNumber) {\n\t\t\tstartLineNumber = b.startLineNumber;\n\t\t\tstartColumn = b.startColumn;\n\t\t} else if (b.startLineNumber === a.startLineNumber) {\n\t\t\tstartLineNumber = b.startLineNumber;\n\t\t\tstartColumn = Math.min(b.startColumn, a.startColumn);\n\t\t} else {\n\t\t\tstartLineNumber = a.startLineNumber;\n\t\t\tstartColumn = a.startColumn;\n\t\t}\n\n\t\tif (b.endLineNumber > a.endLineNumber) {\n\t\t\tendLineNumber = b.endLineNumber;\n\t\t\tendColumn = b.endColumn;\n\t\t} else if (b.endLineNumber === a.endLineNumber) {\n\t\t\tendLineNumber = b.endLineNumber;\n\t\t\tendColumn = Math.max(b.endColumn, a.endColumn);\n\t\t} else {\n\t\t\tendLineNumber = a.endLineNumber;\n\t\t\tendColumn = a.endColumn;\n\t\t}\n\n\t\treturn new Range(startLineNumber, startColumn, endLineNumber, endColumn);\n\t}\n\n\t/**\n\t * A intersection of the two ranges.\n\t */\n\tpublic intersectRanges(range:IRange): Range {\n\t\treturn Range.intersectRanges(this, range);\n\t}\n\n\t/**\n\t * A intersection of the two ranges.\n\t */\n\tpublic static intersectRanges(a:IRange, b:IRange): Range {\n\t\tvar resultStartLineNumber = a.startLineNumber,\n\t\t\tresultStartColumn = a.startColumn,\n\t\t\tresultEndLineNumber = a.endLineNumber,\n\t\t\tresultEndColumn = a.endColumn,\n\t\t\totherStartLineNumber = b.startLineNumber,\n\t\t\totherStartColumn = b.startColumn,\n\t\t\totherEndLineNumber = b.endLineNumber,\n\t\t\totherEndColumn = b.endColumn;\n\n\t\tif (resultStartLineNumber < otherStartLineNumber) {\n\t\t\tresultStartLineNumber = otherStartLineNumber;\n\t\t\tresultStartColumn = otherStartColumn;\n\t\t} else if (resultStartLineNumber === otherStartLineNumber) {\n\t\t\tresultStartColumn = Math.max(resultStartColumn, otherStartColumn);\n\t\t}\n\n\t\tif (resultEndLineNumber > otherEndLineNumber) {\n\t\t\tresultEndLineNumber = otherEndLineNumber;\n\t\t\tresultEndColumn = otherEndColumn;\n\t\t} else if (resultEndLineNumber === otherEndLineNumber) {\n\t\t\tresultEndColumn = Math.min(resultEndColumn, otherEndColumn);\n\t\t}\n\n\t\t// Check if selection is now empty\n\t\tif (resultStartLineNumber > resultEndLineNumber) {\n\t\t\treturn null;\n\t\t}\n\t\tif (resultStartLineNumber === resultEndLineNumber && resultStartColumn > resultEndColumn) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new Range(resultStartLineNumber, resultStartColumn, resultEndLineNumber, resultEndColumn);\n\t}\n\n\t/**\n\t * Test if this range equals other.\n\t */\n\tpublic equalsRange(other:IRange): boolean {\n\t\treturn Range.equalsRange(this, other);\n\t}\n\n\t/**\n\t * Test if range `a` equals `b`.\n\t */\n\tpublic static equalsRange(a:IRange, b:IRange): boolean {\n\t\treturn (\n\t\t\t!!a &&\n\t\t\t!!b &&\n\t\t\ta.startLineNumber === b.startLineNumber &&\n\t\t\ta.startColumn === b.startColumn &&\n\t\t\ta.endLineNumber === b.endLineNumber &&\n\t\t\ta.endColumn === b.endColumn\n\t\t);\n\t}\n\n\t/**\n\t * Return the end position (which will be after or equal to the start position)\n\t */\n\tpublic getEndPosition(): Position {\n\t\treturn new Position(this.endLineNumber, this.endColumn);\n\t}\n\n\t/**\n\t * Return the start position (which will be before or equal to the end position)\n\t */\n\tpublic getStartPosition(): Position {\n\t\treturn new Position(this.startLineNumber, this.startColumn);\n\t}\n\n\t/**\n\t * Clone this range.\n\t */\n\tpublic cloneRange(): Range {\n\t\treturn new Range(this.startLineNumber, this.startColumn, this.endLineNumber, this.endColumn);\n\t}\n\n\t/**\n\t * Transform to a user presentable string representation.\n\t */\n\tpublic toString(): string {\n\t\treturn '[' + this.startLineNumber + ',' + this.startColumn + ' -> ' + this.endLineNumber + ',' + this.endColumn + ']';\n\t}\n\n\t/**\n\t * Create a new range using this range's start position, and using endLineNumber and endColumn as the end position.\n\t */\n\tpublic setEndPosition(endLineNumber: number, endColumn: number): Range {\n\t\treturn new Range(this.startLineNumber, this.startColumn, endLineNumber, endColumn);\n\t}\n\n\t/**\n\t * Create a new range using this range's end position, and using startLineNumber and startColumn as the start position.\n\t */\n\tpublic setStartPosition(startLineNumber: number, startColumn: number): Range {\n\t\treturn new Range(startLineNumber, startColumn, this.endLineNumber, this.endColumn);\n\t}\n\n\t/**\n\t * Create a new empty range using this range's start position.\n\t */\n\tpublic collapseToStart(): Range {\n\t\treturn Range.collapseToStart(this);\n\t}\n\n\t/**\n\t * Create a new empty range using this range's start position.\n\t */\n\tpublic static collapseToStart(range:IRange): Range {\n\t\treturn new Range(range.startLineNumber, range.startColumn, range.startLineNumber, range.startColumn);\n\t}\n\n\t// ---\n\n\t/**\n\t * Create a `Range` from an `IRange`.\n\t */\n\tpublic static lift(range:IRange): Range {\n\t\tif (!range) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t}\n\n\t/**\n\t * Test if `obj` is an `IRange`.\n\t */\n\tpublic static isIRange(obj: any): obj is IRange {\n\t\treturn (\n\t\t\tobj\n\t\t\t&& (typeof obj.startLineNumber === 'number')\n\t\t\t&& (typeof obj.startColumn === 'number')\n\t\t\t&& (typeof obj.endLineNumber === 'number')\n\t\t\t&& (typeof obj.endColumn === 'number')\n\t\t);\n\t}\n\n\t/**\n\t * Test if the two ranges are touching in any way.\n\t */\n\tpublic static areIntersectingOrTouching(a:IRange, b:IRange): boolean {\n\t\t// Check if `a` is before `b`\n\t\tif (a.endLineNumber < b.startLineNumber || (a.endLineNumber === b.startLineNumber && a.endColumn < b.startColumn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if `b` is before `a`\n\t\tif (b.endLineNumber < a.startLineNumber || (b.endLineNumber === a.startLineNumber && b.endColumn < a.startColumn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// These ranges must intersect\n\t\treturn true;\n\t}\n\n\t/**\n\t * A function that compares ranges, useful for sorting ranges\n\t * It will first compare ranges on the startPosition and then on the endPosition\n\t */\n\tpublic static compareRangesUsingStarts(a:IRange, b:IRange): number {\n\t\tlet aStartLineNumber = a.startLineNumber|0;\n\t\tlet bStartLineNumber = b.startLineNumber|0;\n\t\tlet aStartColumn = a.startColumn|0;\n\t\tlet bStartColumn = b.startColumn|0;\n\t\tlet aEndLineNumber = a.endLineNumber|0;\n\t\tlet bEndLineNumber = b.endLineNumber|0;\n\t\tlet aEndColumn = a.endColumn|0;\n\t\tlet bEndColumn = b.endColumn|0;\n\n\t\tif (aStartLineNumber === bStartLineNumber) {\n\t\t\tif (aStartColumn === bStartColumn) {\n\t\t\t\tif (aEndLineNumber === bEndLineNumber) {\n\t\t\t\t\treturn aEndColumn - bEndColumn;\n\t\t\t\t}\n\t\t\t\treturn aEndLineNumber - bEndLineNumber;\n\t\t\t}\n\t\t\treturn aStartColumn - bStartColumn;\n\t\t}\n\t\treturn aStartLineNumber - bStartLineNumber;\n\t}\n\n\t/**\n\t * A function that compares ranges, useful for sorting ranges\n\t * It will first compare ranges on the endPosition and then on the startPosition\n\t */\n\tpublic static compareRangesUsingEnds(a:IRange, b:IRange): number {\n\t\tif (a.endLineNumber === b.endLineNumber) {\n\t\t\tif (a.endColumn === b.endColumn) {\n\t\t\t\tif (a.startLineNumber === b.startLineNumber) {\n\t\t\t\t\treturn a.startColumn - b.startColumn;\n\t\t\t\t}\n\t\t\t\treturn a.startLineNumber - b.startLineNumber;\n\t\t\t}\n\t\t\treturn a.endColumn - b.endColumn;\n\t\t}\n\t\treturn a.endLineNumber - b.endLineNumber;\n\t}\n\n\t/**\n\t * Test if the range spans multiple lines.\n\t */\n\tpublic static spansMultipleLines(range:IRange):boolean {\n\t\treturn range.endLineNumber > range.startLineNumber;\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {Arrays} from 'vs/editor/common/core/arrays';\n\n/**\n * A token on a line.\n */\nexport class ViewLineToken {\n\t_viewLineTokenBrand: void;\n\n\tpublic startIndex:number;\n\tpublic type:string;\n\n\tconstructor(startIndex:number, type:string) {\n\t\tthis.startIndex = startIndex|0;// @perf\n\t\tthis.type = type.replace(/[^a-z0-9\\-]/gi, ' ');\n\t}\n\n\tpublic equals(other:ViewLineToken): boolean {\n\t\treturn (\n\t\t\tthis.startIndex === other.startIndex\n\t\t\t&& this.type === other.type\n\t\t);\n\t}\n\n\tpublic static findIndexInSegmentsArray(arr:ViewLineToken[], desiredIndex: number): number {\n\t\treturn Arrays.findIndexInSegmentsArray(arr, desiredIndex);\n\t}\n\n\tpublic static equalsArray(a:ViewLineToken[], b:ViewLineToken[]): boolean {\n\t\tlet aLen = a.length;\n\t\tlet bLen = b.length;\n\t\tif (aLen !== bLen) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < aLen; i++) {\n\t\t\tif (!a[i].equals(b[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n}\n\nexport class ViewLineTokens {\n\t_viewLineTokensBrand: void;\n\n\tprivate _lineTokens:ViewLineToken[];\n\tprivate _fauxIndentLength:number;\n\tprivate _textLength:number;\n\n\tconstructor(lineTokens:ViewLineToken[], fauxIndentLength:number, textLength:number) {\n\t\tthis._lineTokens = lineTokens;\n\t\tthis._fauxIndentLength = fauxIndentLength|0;\n\t\tthis._textLength = textLength|0;\n\t}\n\n\tpublic getTokens(): ViewLineToken[] {\n\t\treturn this._lineTokens;\n\t}\n\n\tpublic getFauxIndentLength(): number {\n\t\treturn this._fauxIndentLength;\n\t}\n\n\tpublic getTextLength(): number {\n\t\treturn this._textLength;\n\t}\n\n\tpublic equals(other:ViewLineTokens): boolean {\n\t\treturn (\n\t\t\tthis._fauxIndentLength === other._fauxIndentLength\n\t\t\t&& this._textLength === other._textLength\n\t\t\t&& ViewLineToken.equalsArray(this._lineTokens, other._lineTokens)\n\t\t);\n\t}\n\n\tpublic findIndexOfOffset(offset:number): number {\n\t\treturn ViewLineToken.findIndexInSegmentsArray(this._lineTokens, offset);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IAction} from 'vs/base/common/actions';\nimport {IEventEmitter, BulkListenerCallback} from 'vs/base/common/eventEmitter';\nimport {MarkedString} from 'vs/base/common/htmlContent';\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IInstantiationService, IConstructorSignature1, IConstructorSignature2} from 'vs/platform/instantiation/common/instantiation';\nimport {ILineContext, IMode, IToken} from 'vs/editor/common/modes';\nimport {ViewLineToken} from 'vs/editor/common/core/viewLineToken';\nimport {ScrollbarVisibility} from 'vs/base/browser/ui/scrollbar/scrollableElementOptions';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {Position} from 'vs/editor/common/core/position';\nimport {Range} from 'vs/editor/common/core/range';\nimport {Selection} from 'vs/editor/common/core/selection';\nimport {ModeTransition} from 'vs/editor/common/core/modeTransition';\n\n/**\n * @internal\n */\nexport interface Event<T> {\n\t(listener: (e: T) => any, thisArg?: any): IDisposable;\n}\n\n// --- position & range\n\n/**\n * A position in the editor. This interface is suitable for serialization.\n */\nexport interface IPosition {\n\t/**\n\t * line number (starts at 1)\n\t */\n\tlineNumber:number;\n\t/**\n\t * column (the first character in a line is between column 1 and column 2)\n\t */\n\tcolumn:number;\n}\n\n/**\n * A range in the editor. This interface is suitable for serialization.\n */\nexport interface IRange {\n\t/**\n\t * Line number on which the range starts (starts at 1).\n\t */\n\tstartLineNumber:number;\n\t/**\n\t * Column on which the range starts in line `startLineNumber` (starts at 1).\n\t */\n\tstartColumn:number;\n\t/**\n\t * Line number on which the range ends.\n\t */\n\tendLineNumber:number;\n\t/**\n\t * Column on which the range ends in line `endLineNumber`.\n\t */\n\tendColumn:number;\n}\n\n/**\n * A selection in the editor.\n * The selection is a range that has an orientation.\n */\nexport interface ISelection {\n\t/**\n\t * The line number on which the selection has started.\n\t */\n\tselectionStartLineNumber: number;\n\t/**\n\t * The column on `selectionStartLineNumber` where the selection has started.\n\t */\n\tselectionStartColumn: number;\n\t/**\n\t * The line number on which the selection has ended.\n\t */\n\tpositionLineNumber: number;\n\t/**\n\t * The column on `positionLineNumber` where the selection has ended.\n\t */\n\tpositionColumn: number;\n}\n\n/**\n * Configuration options for editor scrollbars\n */\nexport interface IEditorScrollbarOptions {\n\t/**\n\t * The size of arrows (if displayed).\n\t * Defaults to 11.\n\t */\n\tarrowSize?:number;\n\t/**\n\t * Render vertical scrollbar.\n\t * Accepted values: 'auto', 'visible', 'hidden'.\n\t * Defaults to 'auto'.\n\t */\n\tvertical?:string;\n\t/**\n\t * Render horizontal scrollbar.\n\t * Accepted values: 'auto', 'visible', 'hidden'.\n\t * Defaults to 'auto'.\n\t */\n\thorizontal?:string;\n\t/**\n\t * Cast horizontal and vertical shadows when the content is scrolled.\n\t * Defaults to false.\n\t */\n\tuseShadows?:boolean;\n\t/**\n\t * Render arrows at the top and bottom of the vertical scrollbar.\n\t * Defaults to false.\n\t */\n\tverticalHasArrows?:boolean;\n\t/**\n\t * Render arrows at the left and right of the horizontal scrollbar.\n\t * Defaults to false.\n\t */\n\thorizontalHasArrows?:boolean;\n\t/**\n\t * Listen to mouse wheel events and react to them by scrolling.\n\t * Defaults to true.\n\t */\n\thandleMouseWheel?: boolean;\n\t/**\n\t * Height in pixels for the horizontal scrollbar.\n\t * Defaults to 10 (px).\n\t */\n\thorizontalScrollbarSize?: number;\n\t/**\n\t * Width in pixels for the vertical scrollbar.\n\t * Defaults to 10 (px).\n\t */\n\tverticalScrollbarSize?: number;\n\t/**\n\t * Width in pixels for the vertical slider.\n\t * Defaults to `verticalScrollbarSize`.\n\t */\n\tverticalSliderSize?: number;\n\t/**\n\t * Height in pixels for the horizontal slider.\n\t * Defaults to `horizontalScrollbarSize`.\n\t */\n\thorizontalSliderSize?: number;\n}\n\n/**\n * Describes how to indent wrapped lines.\n */\nexport enum WrappingIndent {\n\t/**\n\t * No indentation => wrapped lines begin at column 1.\n\t */\n\tNone = 0,\n\t/**\n\t * Same => wrapped lines get the same indentation as the parent.\n\t */\n\tSame = 1,\n\t/**\n\t * Indent => wrapped lines get +1 indentation as the parent.\n\t */\n\tIndent = 2\n}\n\n/**\n * Configuration options for the editor.\n */\nexport interface IEditorOptions {\n\t/**\n\t * Enable experimental screen reader support.\n\t * Defaults to `true`.\n\t */\n\texperimentalScreenReader?: boolean;\n\t/**\n\t * The aria label for the editor's textarea (when it is focused).\n\t */\n\tariaLabel?: string;\n\t/**\n\t * Render vertical lines at the specified columns.\n\t * Defaults to empty array.\n\t */\n\trulers?: number[];\n\t/**\n\t * A string containing the word separators used when doing word navigation.\n\t * Defaults to `~!@#$%^&*()-=+[{]}\\\\|;:\\'\",.<>/?\n\t */\n\twordSeparators?: string;\n\t/**\n\t * Enable Linux primary clipboard.\n\t * Defaults to true.\n\t */\n\tselectionClipboard?: boolean;\n\t/**\n\t * Control the rendering of line numbers.\n\t * If it is a function, it will be invoked when rendering a line number and the return value will be rendered.\n\t * Otherwise, if it is a truey, line numbers will be rendered normally (equivalent of using an identity function).\n\t * Otherwise, line numbers will not be rendered.\n\t * Defaults to true.\n\t */\n\tlineNumbers?:any;\n\t/**\n\t * Should the corresponding line be selected when clicking on the line number?\n\t * Defaults to true.\n\t */\n\tselectOnLineNumbers?:boolean;\n\t/**\n\t * Control the width of line numbers, by reserving horizontal space for rendering at least an amount of digits.\n\t * Defaults to 5.\n\t */\n\tlineNumbersMinChars?:number;\n\t/**\n\t * Enable the rendering of the glyph margin.\n\t * Defaults to false.\n\t */\n\tglyphMargin?:boolean;\n\t/**\n\t * The width reserved for line decorations (in px).\n\t * Line decorations are placed between line numbers and the editor content.\n\t * Defaults to 10.\n\t */\n\tlineDecorationsWidth?:number;\n\t/**\n\t * When revealing the cursor, a virtual padding (px) is added to the cursor, turning it into a rectangle.\n\t * This virtual padding ensures that the cursor gets revealed before hitting the edge of the viewport.\n\t * Defaults to 30 (px).\n\t */\n\trevealHorizontalRightPadding?:number;\n\t/**\n\t * Render the editor selection with rounded borders.\n\t * Defaults to true.\n\t */\n\troundedSelection?:boolean;\n\t/**\n\t * Theme to be used for rendering. Consists of two parts, the UI theme and the syntax theme,\n\t * separated by a space.\n\t * The current available UI themes are: 'vs' (default), 'vs-dark', 'hc-black'\n\t * The syntax themes are contributed. The default is 'default-theme'\n\t */\n\ttheme?:string;\n\t/**\n\t * Should the editor be read only.\n\t * Defaults to false.\n\t */\n\treadOnly?:boolean;\n\t/**\n\t * Control the behavior and rendering of the scrollbars.\n\t */\n\tscrollbar?:IEditorScrollbarOptions;\n\t/**\n\t * The number of vertical lanes the overview ruler should render.\n\t * Defaults to 2.\n\t */\n\toverviewRulerLanes?:number;\n\t/**\n\t * Control the cursor blinking animation.\n\t * Defaults to 'blink'.\n\t */\n\tcursorBlinking?:string;\n\t/**\n\t * Control the cursor style, either 'block' or 'line'.\n\t * Defaults to 'line'.\n\t */\n\tcursorStyle?:string;\n\t/**\n\t * Enable font ligatures.\n\t * Defaults to false.\n\t */\n\tfontLigatures?:boolean;\n\t/**\n\t * Disable the use of `translate3d`.\n\t * Defaults to false.\n\t */\n\tdisableTranslate3d?:boolean;\n\t/**\n\t * Should the cursor be hidden in the overview ruler.\n\t * Defaults to false.\n\t */\n\thideCursorInOverviewRuler?:boolean;\n\t/**\n\t * Enable that scrolling can go one screen size after the last line.\n\t * Defaults to true.\n\t */\n\tscrollBeyondLastLine?:boolean;\n\t/**\n\t * Enable that the editor will install an interval to check if its container dom node size has changed.\n\t * Enabling this might have a severe performance impact.\n\t * Defaults to false.\n\t */\n\tautomaticLayout?:boolean;\n\t/**\n\t * Control the wrapping strategy of the editor.\n\t * Using -1 means no wrapping whatsoever.\n\t * Using 0 means viewport width wrapping (ajusts with the resizing of the editor).\n\t * Using a positive number means wrapping after a fixed number of characters.\n\t * Defaults to 300.\n\t */\n\twrappingColumn?:number;\n\t/**\n\t * Control indentation of wrapped lines. Can be: 'none', 'same' or 'indent'.\n\t * Defaults to 'none'.\n\t */\n\twrappingIndent?: string;\n\t/**\n\t * Configure word wrapping characters. A break will be introduced before these characters.\n\t * Defaults to '{([+'.\n\t */\n\twordWrapBreakBeforeCharacters?: string;\n\t/**\n\t * Configure word wrapping characters. A break will be introduced after these characters.\n\t * Defaults to ' \\t})]?|&,;'.\n\t */\n\twordWrapBreakAfterCharacters?: string;\n\t/**\n\t * Configure word wrapping characters. A break will be introduced after these characters only if no `wordWrapBreakBeforeCharacters` or `wordWrapBreakAfterCharacters` were found.\n\t * Defaults to '.'.\n\t */\n\twordWrapBreakObtrusiveCharacters?: string;\n\n\t/**\n\t * Control what pressing Tab does.\n\t * If it is false, pressing Tab or Shift-Tab will be handled by the editor.\n\t * If it is true, pressing Tab or Shift-Tab will move the browser focus.\n\t * Defaults to false.\n\t */\n\ttabFocusMode?:boolean;\n\n\t/**\n\t * Performance guard: Stop rendering a line after x characters.\n\t * Defaults to 10000 if wrappingColumn is -1. Defaults to -1 if wrappingColumn is >= 0.\n\t * Use -1 to never stop rendering\n\t */\n\tstopRenderingLineAfter?:number;\n\t/**\n\t * Enable hover.\n\t * Defaults to true.\n\t */\n\thover?:boolean;\n\t/**\n\t * Enable custom contextmenu.\n\t * Defaults to true.\n\t */\n\tcontextmenu?:boolean;\n\t/**\n\t * A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.\n\t * Defaults to 1.\n\t */\n\tmouseWheelScrollSensitivity?: number;\n\t/**\n\t * Enable quick suggestions (shaddow suggestions)\n\t * Defaults to true.\n\t */\n\tquickSuggestions?:boolean;\n\t/**\n\t * Quick suggestions show delay (in ms)\n\t * Defaults to 500 (ms)\n\t */\n\tquickSuggestionsDelay?:number;\n\t/**\n\t * Enables parameter hints\n\t */\n\tparameterHints?:boolean;\n\t/**\n\t * Render icons in suggestions box.\n\t * Defaults to true.\n\t */\n\ticonsInSuggestions?:boolean;\n\t/**\n\t * Enable auto closing brackets.\n\t * Defaults to true.\n\t */\n\tautoClosingBrackets?:boolean;\n\t/**\n\t * Enable format on type.\n\t * Defaults to false.\n\t */\n\tformatOnType?:boolean;\n\t/**\n\t * Enable the suggestion box to pop-up on trigger characters.\n\t * Defaults to true.\n\t */\n\tsuggestOnTriggerCharacters?: boolean;\n\t/**\n\t * Accept suggestions on ENTER.\n\t * Defaults to true.\n\t */\n\tacceptSuggestionOnEnter?: boolean;\n\t/**\n\t * Enable selection highlight.\n\t * Defaults to true.\n\t */\n\tselectionHighlight?:boolean;\n\t/**\n\t * Show lines before classes and methods (based on outline info).\n\t * Defaults to false.\n\t */\n\toutlineMarkers?: boolean;\n\t/**\n\t * Show reference infos (a.k.a. code lenses) for modes that support it\n\t * Defaults to true.\n\t */\n\treferenceInfos?: boolean;\n\t/**\n\t * Enable code folding\n\t * Defaults to true.\n\t */\n\tfolding?: boolean;\n\t/**\n\t * Enable rendering of leading whitespace.\n\t * Defaults to false.\n\t */\n\trenderWhitespace?: boolean;\n\t/**\n\t * Enable rendering of indent guides.\n\t * Defaults to true.\n\t */\n\tindentGuides?: boolean;\n\t/**\n\t * Inserting and deleting whitespace follows tab stops.\n\t */\n\tuseTabStops?: boolean;\n\t/**\n\t * The font family\n\t */\n\tfontFamily?: string;\n\t/**\n\t * The font size\n\t */\n\tfontSize?: number;\n\t/**\n\t * The line height\n\t */\n\tlineHeight?: number;\n}\n\n/**\n * Configuration options for the diff editor.\n */\nexport interface IDiffEditorOptions extends IEditorOptions {\n\t/**\n\t * Allow the user to resize the diff editor split view.\n\t * Defaults to true.\n\t */\n\tenableSplitViewResizing?: boolean;\n\t/**\n\t * Render the differences in two side-by-side editors.\n\t * Defaults to true.\n\t */\n\trenderSideBySide?: boolean;\n\t/**\n\t * Compute the diff by ignoring leading/trailing whitespace\n\t * Defaults to true.\n\t */\n\tignoreTrimWhitespace?: boolean;\n\t/**\n\t * Original model should be editable?\n\t * Defaults to false.\n\t */\n\toriginalEditable?: boolean;\n}\n\nexport class InternalEditorScrollbarOptions {\n\t_internalEditorScrollbarOptionsBrand: void;\n\n\tarrowSize:number;\n\tvertical:ScrollbarVisibility;\n\thorizontal:ScrollbarVisibility;\n\tuseShadows:boolean;\n\tverticalHasArrows:boolean;\n\thorizontalHasArrows:boolean;\n\thandleMouseWheel: boolean;\n\thorizontalScrollbarSize: number;\n\thorizontalSliderSize: number;\n\tverticalScrollbarSize: number;\n\tverticalSliderSize: number;\n\tmouseWheelScrollSensitivity: number;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source:{\n\t\tarrowSize:number;\n\t\tvertical:ScrollbarVisibility;\n\t\thorizontal:ScrollbarVisibility;\n\t\tuseShadows:boolean;\n\t\tverticalHasArrows:boolean;\n\t\thorizontalHasArrows:boolean;\n\t\thandleMouseWheel: boolean;\n\t\thorizontalScrollbarSize: number;\n\t\thorizontalSliderSize: number;\n\t\tverticalScrollbarSize: number;\n\t\tverticalSliderSize: number;\n\t\tmouseWheelScrollSensitivity: number;\n\t}) {\n\t\tthis.arrowSize = source.arrowSize|0;\n\t\tthis.vertical = source.vertical|0;\n\t\tthis.horizontal = source.horizontal|0;\n\t\tthis.useShadows = Boolean(source.useShadows);\n\t\tthis.verticalHasArrows = Boolean(source.verticalHasArrows);\n\t\tthis.horizontalHasArrows = Boolean(source.horizontalHasArrows);\n\t\tthis.handleMouseWheel = Boolean(source.handleMouseWheel);\n\t\tthis.horizontalScrollbarSize = source.horizontalScrollbarSize|0;\n\t\tthis.horizontalSliderSize = source.horizontalSliderSize|0;\n\t\tthis.verticalScrollbarSize = source.verticalScrollbarSize|0;\n\t\tthis.verticalSliderSize = source.verticalSliderSize|0;\n\t\tthis.mouseWheelScrollSensitivity = Number(source.mouseWheelScrollSensitivity);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:InternalEditorScrollbarOptions): boolean {\n\t\treturn (\n\t\t\tthis.arrowSize === other.arrowSize\n\t\t\t&& this.vertical === other.vertical\n\t\t\t&& this.horizontal === other.horizontal\n\t\t\t&& this.useShadows === other.useShadows\n\t\t\t&& this.verticalHasArrows === other.verticalHasArrows\n\t\t\t&& this.horizontalHasArrows === other.horizontalHasArrows\n\t\t\t&& this.handleMouseWheel === other.handleMouseWheel\n\t\t\t&& this.horizontalScrollbarSize === other.horizontalScrollbarSize\n\t\t\t&& this.horizontalSliderSize === other.horizontalSliderSize\n\t\t\t&& this.verticalScrollbarSize === other.verticalScrollbarSize\n\t\t\t&& this.verticalSliderSize === other.verticalSliderSize\n\t\t\t&& this.mouseWheelScrollSensitivity === other.mouseWheelScrollSensitivity\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): InternalEditorScrollbarOptions {\n\t\treturn new InternalEditorScrollbarOptions(this);\n\t}\n}\n\nexport class EditorWrappingInfo {\n\t_editorWrappingInfoBrand: void;\n\n\tisViewportWrapping: boolean;\n\twrappingColumn: number;\n\twrappingIndent: WrappingIndent;\n\twordWrapBreakBeforeCharacters: string;\n\twordWrapBreakAfterCharacters: string;\n\twordWrapBreakObtrusiveCharacters: string;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source:{\n\t\tisViewportWrapping: boolean;\n\t\twrappingColumn: number;\n\t\twrappingIndent: WrappingIndent;\n\t\twordWrapBreakBeforeCharacters: string;\n\t\twordWrapBreakAfterCharacters: string;\n\t\twordWrapBreakObtrusiveCharacters: string;\n\t}) {\n\t\tthis.isViewportWrapping = Boolean(source.isViewportWrapping);\n\t\tthis.wrappingColumn = source.wrappingColumn|0;\n\t\tthis.wrappingIndent = source.wrappingIndent|0;\n\t\tthis.wordWrapBreakBeforeCharacters = String(source.wordWrapBreakBeforeCharacters);\n\t\tthis.wordWrapBreakAfterCharacters = String(source.wordWrapBreakAfterCharacters);\n\t\tthis.wordWrapBreakObtrusiveCharacters = String(source.wordWrapBreakObtrusiveCharacters);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:EditorWrappingInfo): boolean {\n\t\treturn (\n\t\t\tthis.isViewportWrapping === other.isViewportWrapping\n\t\t\t&& this.wrappingColumn === other.wrappingColumn\n\t\t\t&& this.wrappingIndent === other.wrappingIndent\n\t\t\t&& this.wordWrapBreakBeforeCharacters === other.wordWrapBreakBeforeCharacters\n\t\t\t&& this.wordWrapBreakAfterCharacters === other.wordWrapBreakAfterCharacters\n\t\t\t&& this.wordWrapBreakObtrusiveCharacters === other.wordWrapBreakObtrusiveCharacters\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): EditorWrappingInfo {\n\t\treturn new EditorWrappingInfo(this);\n\t}\n}\n\nexport class InternalEditorViewOptions {\n\t_internalEditorViewOptionsBrand: void;\n\n\ttheme:string;\n\tcanUseTranslate3d:boolean;\n\texperimentalScreenReader: boolean;\n\trulers: number[];\n\tariaLabel: string;\n\tlineNumbers:any;\n\tselectOnLineNumbers:boolean;\n\tglyphMargin:boolean;\n\trevealHorizontalRightPadding:number;\n\troundedSelection:boolean;\n\toverviewRulerLanes:number;\n\tcursorBlinking:string;\n\tcursorStyle:TextEditorCursorStyle;\n\thideCursorInOverviewRuler:boolean;\n\tscrollBeyondLastLine:boolean;\n\teditorClassName: string;\n\tstopRenderingLineAfter: number;\n\trenderWhitespace: boolean;\n\tindentGuides: boolean;\n\tscrollbar:InternalEditorScrollbarOptions;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source:{\n\t\ttheme:string;\n\t\tcanUseTranslate3d:boolean;\n\t\texperimentalScreenReader: boolean;\n\t\trulers: number[];\n\t\tariaLabel: string;\n\t\tlineNumbers:any;\n\t\tselectOnLineNumbers:boolean;\n\t\tglyphMargin:boolean;\n\t\trevealHorizontalRightPadding:number;\n\t\troundedSelection:boolean;\n\t\toverviewRulerLanes:number;\n\t\tcursorBlinking:string;\n\t\tcursorStyle:TextEditorCursorStyle;\n\t\thideCursorInOverviewRuler:boolean;\n\t\tscrollBeyondLastLine:boolean;\n\t\teditorClassName: string;\n\t\tstopRenderingLineAfter: number;\n\t\trenderWhitespace: boolean;\n\t\tindentGuides: boolean;\n\t\tscrollbar:InternalEditorScrollbarOptions;\n\t}) {\n\t\tthis.theme = String(source.theme);\n\t\tthis.canUseTranslate3d = Boolean(source.canUseTranslate3d);\n\t\tthis.experimentalScreenReader = Boolean(source.experimentalScreenReader);\n\t\tthis.rulers = InternalEditorViewOptions._toSortedIntegerArray(source.rulers);\n\t\tthis.ariaLabel = String(source.ariaLabel);\n\t\tthis.lineNumbers = source.lineNumbers;\n\t\tthis.selectOnLineNumbers = Boolean(source.selectOnLineNumbers);\n\t\tthis.glyphMargin = Boolean(source.glyphMargin);\n\t\tthis.revealHorizontalRightPadding = source.revealHorizontalRightPadding|0;\n\t\tthis.roundedSelection = Boolean(source.roundedSelection);\n\t\tthis.overviewRulerLanes = source.overviewRulerLanes|0;\n\t\tthis.cursorBlinking = String(source.cursorBlinking);\n\t\tthis.cursorStyle = source.cursorStyle|0;\n\t\tthis.hideCursorInOverviewRuler = Boolean(source.hideCursorInOverviewRuler);\n\t\tthis.scrollBeyondLastLine = Boolean(source.scrollBeyondLastLine);\n\t\tthis.editorClassName = String(source.editorClassName);\n\t\tthis.stopRenderingLineAfter = source.stopRenderingLineAfter|0;\n\t\tthis.renderWhitespace = Boolean(source.renderWhitespace);\n\t\tthis.indentGuides = Boolean(source.indentGuides);\n\t\tthis.scrollbar = source.scrollbar.clone();\n\t}\n\n\tprivate static _toSortedIntegerArray(source:any): number[] {\n\t\tif (!Array.isArray(source)) {\n\t\t\treturn [];\n\t\t}\n\t\tlet arrSource = <any[]>source;\n\t\tlet result = arrSource.map(el => {\n\t\t\tlet r = parseInt(el, 10);\n\t\t\tif (isNaN(r)) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn r;\n\t\t});\n\t\tresult.sort();\n\t\treturn result;\n\t}\n\n\tprivate static _numberArraysEqual(a:number[], b:number[]): boolean {\n\t\tif (a.length !== b.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\tif (a[i] !== b[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:InternalEditorViewOptions): boolean {\n\t\treturn (\n\t\t\tthis.theme === other.theme\n\t\t\t&& this.canUseTranslate3d === other.canUseTranslate3d\n\t\t\t&& this.experimentalScreenReader === other.experimentalScreenReader\n\t\t\t&& InternalEditorViewOptions._numberArraysEqual(this.rulers, other.rulers)\n\t\t\t&& this.ariaLabel === other.ariaLabel\n\t\t\t&& this.lineNumbers === other.lineNumbers\n\t\t\t&& this.selectOnLineNumbers === other.selectOnLineNumbers\n\t\t\t&& this.glyphMargin === other.glyphMargin\n\t\t\t&& this.revealHorizontalRightPadding === other.revealHorizontalRightPadding\n\t\t\t&& this.roundedSelection === other.roundedSelection\n\t\t\t&& this.overviewRulerLanes === other.overviewRulerLanes\n\t\t\t&& this.cursorBlinking === other.cursorBlinking\n\t\t\t&& this.cursorStyle === other.cursorStyle\n\t\t\t&& this.hideCursorInOverviewRuler === other.hideCursorInOverviewRuler\n\t\t\t&& this.scrollBeyondLastLine === other.scrollBeyondLastLine\n\t\t\t&& this.editorClassName === other.editorClassName\n\t\t\t&& this.stopRenderingLineAfter === other.stopRenderingLineAfter\n\t\t\t&& this.renderWhitespace === other.renderWhitespace\n\t\t\t&& this.indentGuides === other.indentGuides\n\t\t\t&& this.scrollbar.equals(other.scrollbar)\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic createChangeEvent(newOpts:InternalEditorViewOptions): IViewConfigurationChangedEvent {\n\t\treturn {\n\t\t\ttheme: this.theme !== newOpts.theme,\n\t\t\tcanUseTranslate3d: this.canUseTranslate3d !== newOpts.canUseTranslate3d,\n\t\t\texperimentalScreenReader: this.experimentalScreenReader !== newOpts.experimentalScreenReader,\n\t\t\trulers: (!InternalEditorViewOptions._numberArraysEqual(this.rulers, newOpts.rulers)),\n\t\t\tariaLabel: this.ariaLabel !== newOpts.ariaLabel,\n\t\t\tlineNumbers: this.lineNumbers !== newOpts.lineNumbers,\n\t\t\tselectOnLineNumbers: this.selectOnLineNumbers !== newOpts.selectOnLineNumbers,\n\t\t\tglyphMargin: this.glyphMargin !== newOpts.glyphMargin,\n\t\t\trevealHorizontalRightPadding: this.revealHorizontalRightPadding !== newOpts.revealHorizontalRightPadding,\n\t\t\troundedSelection: this.roundedSelection !== newOpts.roundedSelection,\n\t\t\toverviewRulerLanes: this.overviewRulerLanes !== newOpts.overviewRulerLanes,\n\t\t\tcursorBlinking: this.cursorBlinking !== newOpts.cursorBlinking,\n\t\t\tcursorStyle: this.cursorStyle !== newOpts.cursorStyle,\n\t\t\thideCursorInOverviewRuler: this.hideCursorInOverviewRuler !== newOpts.hideCursorInOverviewRuler,\n\t\t\tscrollBeyondLastLine: this.scrollBeyondLastLine !== newOpts.scrollBeyondLastLine,\n\t\t\teditorClassName: this.editorClassName !== newOpts.editorClassName,\n\t\t\tstopRenderingLineAfter: this.stopRenderingLineAfter !== newOpts.stopRenderingLineAfter,\n\t\t\trenderWhitespace: this.renderWhitespace !== newOpts.renderWhitespace,\n\t\t\tindentGuides: this.indentGuides !== newOpts.indentGuides,\n\t\t\tscrollbar: (!this.scrollbar.equals(newOpts.scrollbar)),\n\t\t};\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): InternalEditorViewOptions {\n\t\treturn new InternalEditorViewOptions(this);\n\t}\n}\n\nexport interface IViewConfigurationChangedEvent {\n\ttheme: boolean;\n\tcanUseTranslate3d: boolean;\n\texperimentalScreenReader: boolean;\n\trulers: boolean;\n\tariaLabel:  boolean;\n\tlineNumbers: boolean;\n\tselectOnLineNumbers: boolean;\n\tglyphMargin: boolean;\n\trevealHorizontalRightPadding: boolean;\n\troundedSelection: boolean;\n\toverviewRulerLanes: boolean;\n\tcursorBlinking: boolean;\n\tcursorStyle: boolean;\n\thideCursorInOverviewRuler: boolean;\n\tscrollBeyondLastLine: boolean;\n\teditorClassName:  boolean;\n\tstopRenderingLineAfter:  boolean;\n\trenderWhitespace:  boolean;\n\tindentGuides:  boolean;\n\tscrollbar: boolean;\n}\n\nexport class EditorContribOptions {\n\tselectionClipboard: boolean;\n\thover:boolean;\n\tcontextmenu:boolean;\n\tquickSuggestions:boolean;\n\tquickSuggestionsDelay:number;\n\tparameterHints: boolean;\n\ticonsInSuggestions:boolean;\n\tformatOnType:boolean;\n\tsuggestOnTriggerCharacters: boolean;\n\tacceptSuggestionOnEnter: boolean;\n\tselectionHighlight:boolean;\n\toutlineMarkers: boolean;\n\treferenceInfos: boolean;\n\tfolding: boolean;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source:{\n\t\tselectionClipboard: boolean;\n\t\thover:boolean;\n\t\tcontextmenu:boolean;\n\t\tquickSuggestions:boolean;\n\t\tquickSuggestionsDelay:number;\n\t\tparameterHints:boolean;\n\t\ticonsInSuggestions:boolean;\n\t\tformatOnType:boolean;\n\t\tsuggestOnTriggerCharacters: boolean;\n\t\tacceptSuggestionOnEnter: boolean;\n\t\tselectionHighlight:boolean;\n\t\toutlineMarkers: boolean;\n\t\treferenceInfos: boolean;\n\t\tfolding: boolean;\n\t}) {\n\t\tthis.selectionClipboard = Boolean(source.selectionClipboard);\n\t\tthis.hover = Boolean(source.hover);\n\t\tthis.contextmenu = Boolean(source.contextmenu);\n\t\tthis.quickSuggestions = Boolean(source.quickSuggestions);\n\t\tthis.quickSuggestionsDelay = source.quickSuggestionsDelay||0;\n\t\tthis.parameterHints = Boolean(source.parameterHints);\n\t\tthis.iconsInSuggestions = Boolean(source.iconsInSuggestions);\n\t\tthis.formatOnType = Boolean(source.formatOnType);\n\t\tthis.suggestOnTriggerCharacters = Boolean(source.suggestOnTriggerCharacters);\n\t\tthis.acceptSuggestionOnEnter = Boolean(source.acceptSuggestionOnEnter);\n\t\tthis.selectionHighlight = Boolean(source.selectionHighlight);\n\t\tthis.outlineMarkers = Boolean(source.outlineMarkers);\n\t\tthis.referenceInfos = Boolean(source.referenceInfos);\n\t\tthis.folding = Boolean(source.folding);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other: EditorContribOptions): boolean {\n\t\treturn (\n\t\t\tthis.selectionClipboard === other.selectionClipboard\n\t\t\t&& this.hover === other.hover\n\t\t\t&& this.contextmenu === other.contextmenu\n\t\t\t&& this.quickSuggestions === other.quickSuggestions\n\t\t\t&& this.quickSuggestionsDelay === other.quickSuggestionsDelay\n\t\t\t&& this.parameterHints === other.parameterHints\n\t\t\t&& this.iconsInSuggestions === other.iconsInSuggestions\n\t\t\t&& this.formatOnType === other.formatOnType\n\t\t\t&& this.suggestOnTriggerCharacters === other.suggestOnTriggerCharacters\n\t\t\t&& this.acceptSuggestionOnEnter === other.acceptSuggestionOnEnter\n\t\t\t&& this.selectionHighlight === other.selectionHighlight\n\t\t\t&& this.outlineMarkers === other.outlineMarkers\n\t\t\t&& this.referenceInfos === other.referenceInfos\n\t\t\t&& this.folding === other.folding\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): EditorContribOptions {\n\t\treturn new EditorContribOptions(this);\n\t}\n}\n\n/**\n * Internal configuration options (transformed or computed) for the editor.\n */\nexport class InternalEditorOptions {\n\t_internalEditorOptionsBrand: void;\n\n\tlineHeight:number; // todo: move to fontInfo\n\n\treadOnly:boolean;\n\t// ---- cursor options\n\twordSeparators: string;\n\tautoClosingBrackets:boolean;\n\tuseTabStops: boolean;\n\ttabFocusMode:boolean;\n\t// ---- grouped options\n\tlayoutInfo: EditorLayoutInfo;\n\tfontInfo: FontInfo;\n\tviewInfo: InternalEditorViewOptions;\n\twrappingInfo: EditorWrappingInfo;\n\tcontribInfo: EditorContribOptions;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source: {\n\t\tlineHeight:number;\n\t\treadOnly:boolean;\n\t\twordSeparators: string;\n\t\tautoClosingBrackets:boolean;\n\t\tuseTabStops: boolean;\n\t\ttabFocusMode:boolean;\n\t\tlayoutInfo: EditorLayoutInfo;\n\t\tfontInfo: FontInfo;\n\t\tviewInfo: InternalEditorViewOptions;\n\t\twrappingInfo: EditorWrappingInfo;\n\t\tcontribInfo: EditorContribOptions;\n\t}) {\n\t\tthis.lineHeight = source.lineHeight|0;\n\t\tthis.readOnly = Boolean(source.readOnly);\n\t\tthis.wordSeparators = String(source.wordSeparators);\n\t\tthis.autoClosingBrackets = Boolean(source.autoClosingBrackets);\n\t\tthis.useTabStops = Boolean(source.useTabStops);\n\t\tthis.tabFocusMode = Boolean(source.tabFocusMode);\n\t\tthis.layoutInfo = source.layoutInfo.clone();\n\t\tthis.fontInfo = source.fontInfo.clone();\n\t\tthis.viewInfo = source.viewInfo.clone();\n\t\tthis.wrappingInfo = source.wrappingInfo.clone();\n\t\tthis.contribInfo = source.contribInfo.clone();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:InternalEditorOptions): boolean {\n\t\treturn (\n\t\t\tthis.lineHeight === other.lineHeight\n\t\t\t&& this.readOnly === other.readOnly\n\t\t\t&& this.wordSeparators === other.wordSeparators\n\t\t\t&& this.autoClosingBrackets === other.autoClosingBrackets\n\t\t\t&& this.useTabStops === other.useTabStops\n\t\t\t&& this.tabFocusMode === other.tabFocusMode\n\t\t\t&& this.layoutInfo.equals(other.layoutInfo)\n\t\t\t&& this.fontInfo.equals(other.fontInfo)\n\t\t\t&& this.viewInfo.equals(other.viewInfo)\n\t\t\t&& this.wrappingInfo.equals(other.wrappingInfo)\n\t\t\t&& this.contribInfo.equals(other.contribInfo)\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic createChangeEvent(newOpts:InternalEditorOptions): IConfigurationChangedEvent {\n\t\treturn {\n\t\t\tlineHeight: (this.lineHeight !== newOpts.lineHeight),\n\t\t\treadOnly: (this.readOnly !== newOpts.readOnly),\n\t\t\twordSeparators: (this.wordSeparators !== newOpts.wordSeparators),\n\t\t\tautoClosingBrackets: (this.autoClosingBrackets !== newOpts.autoClosingBrackets),\n\t\t\tuseTabStops: (this.useTabStops !== newOpts.useTabStops),\n\t\t\ttabFocusMode: (this.tabFocusMode !== newOpts.tabFocusMode),\n\t\t\tlayoutInfo: (!this.layoutInfo.equals(newOpts.layoutInfo)),\n\t\t\tfontInfo: (!this.fontInfo.equals(newOpts.fontInfo)),\n\t\t\tviewInfo: this.viewInfo.createChangeEvent(newOpts.viewInfo),\n\t\t\twrappingInfo: (!this.wrappingInfo.equals(newOpts.wrappingInfo)),\n\t\t\tcontribInfo: (!this.contribInfo.equals(newOpts.contribInfo)),\n\t\t};\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): InternalEditorOptions {\n\t\treturn new InternalEditorOptions(this);\n\t}\n}\n\n/**\n * An event describing that the configuration of the editor has changed.\n */\nexport interface IConfigurationChangedEvent {\n\tlineHeight: boolean;\n\treadOnly: boolean;\n\twordSeparators: boolean;\n\tautoClosingBrackets: boolean;\n\tuseTabStops: boolean;\n\ttabFocusMode: boolean;\n\tlayoutInfo: boolean;\n\tfontInfo: boolean;\n\tviewInfo: IViewConfigurationChangedEvent;\n\twrappingInfo: boolean;\n\tcontribInfo: boolean;\n}\n\n/**\n * An event describing that one or more supports of a mode have changed.\n * @internal\n */\nexport interface IModeSupportChangedEvent {\n\ttokenizationSupport:boolean;\n}\n\n/**\n * Vertical Lane in the overview ruler of the editor.\n */\nexport enum OverviewRulerLane {\n\tLeft = 1,\n\tCenter = 2,\n\tRight = 4,\n\tFull = 7\n}\n\n/**\n * Options for rendering a model decoration in the overview ruler.\n */\nexport interface IModelDecorationOverviewRulerOptions {\n\t/**\n\t * CSS color to render in the overview ruler.\n\t * e.g.: rgba(100, 100, 100, 0.5)\n\t */\n\tcolor: string;\n\t/**\n\t * CSS color to render in the overview ruler.\n\t * e.g.: rgba(100, 100, 100, 0.5)\n\t */\n\tdarkColor: string;\n\t/**\n\t * The position in the overview ruler.\n\t */\n\tposition: OverviewRulerLane;\n}\n\n/**\n * Options for a model decoration.\n */\nexport interface IModelDecorationOptions {\n\t/**\n\t * Customize the growing behaviour of the decoration when typing at the edges of the decoration.\n\t * Defaults to TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t */\n\tstickiness?:TrackedRangeStickiness;\n\t/**\n\t * CSS class name describing the decoration.\n\t */\n\tclassName?:string;\n\t/**\n\t * Message to be rendered when hovering over the glyph margin decoration.\n\t * @internal\n\t */\n\tglyphMarginHoverMessage?:string;\n\t/**\n\t * Array of MarkedString to render as the decoration message.\n\t */\n\thoverMessage?:MarkedString | MarkedString[];\n\t/**\n\t * Should the decoration expand to encompass a whole line.\n\t */\n\tisWholeLine?:boolean;\n\t/**\n\t * @deprecated : Use `overviewRuler` instead\n\t */\n\tshowInOverviewRuler?:string;\n\t/**\n\t * If set, render this decoration in the overview ruler.\n\t */\n\toverviewRuler?:IModelDecorationOverviewRulerOptions;\n\t/**\n\t * If set, the decoration will be rendered in the glyph margin with this CSS class name.\n\t */\n\tglyphMarginClassName?:string;\n\t/**\n\t * If set, the decoration will be rendered in the lines decorations with this CSS class name.\n\t */\n\tlinesDecorationsClassName?:string;\n\t/**\n\t * If set, the decoration will be rendered inline with the text with this CSS class name.\n\t * Please use this only for CSS rules that must impact the text. For example, use `className`\n\t * to have a background color decoration.\n\t */\n\tinlineClassName?:string;\n\t/**\n\t * If set, the decoration will be rendered before the text with this CSS class name.\n\t */\n\tbeforeContentClassName?:string;\n\t/**\n\t * If set, the decoration will be rendered after the text with this CSS class name.\n\t */\n\tafterContentClassName?:string;\n}\n\n/**\n * New model decorations.\n */\nexport interface IModelDeltaDecoration {\n\t/**\n\t * Range that this decoration covers.\n\t */\n\trange: IRange;\n\t/**\n\t * Options associated with this decoration.\n\t */\n\toptions: IModelDecorationOptions;\n}\n\n/**\n * A tracked range in the model.\n * @internal\n */\nexport interface IModelTrackedRange {\n\t/**\n\t * Identifier for a tracked range\n\t */\n\tid: string;\n\t/**\n\t * Range that this tracked range covers\n\t */\n\trange: Range;\n}\n\n/**\n * A decoration in the model.\n */\nexport interface IModelDecoration {\n\t/**\n\t * Identifier for a decoration.\n\t */\n\tid: string;\n\t/**\n\t * Identifier for a decoration's owener.\n\t */\n\townerId: number;\n\t/**\n\t * Range that this decoration covers.\n\t */\n\trange: Range;\n\t/**\n\t * Options associated with this decoration.\n\t */\n\toptions: IModelDecorationOptions;\n}\n\n/**\n * An accessor that can add, change or remove model decorations.\n * @internal\n */\nexport interface IModelDecorationsChangeAccessor {\n\t/**\n\t * Add a new decoration.\n\t * @param range Range that this decoration covers.\n\t * @param options Options associated with this decoration.\n\t * @return An unique identifier associated with this decoration.\n\t */\n\taddDecoration(range:IRange, options:IModelDecorationOptions): string;\n\t/**\n\t * Change the range that an existing decoration covers.\n\t * @param id The unique identifier associated with the decoration.\n\t * @param newRange The new range that this decoration covers.\n\t */\n\tchangeDecoration(id:string, newRange:IRange): void;\n\t/**\n\t * Change the options associated with an existing decoration.\n\t * @param id The unique identifier associated with the decoration.\n\t * @param newOptions The new options associated with this decoration.\n\t */\n\tchangeDecorationOptions(id: string, newOptions:IModelDecorationOptions): void;\n\t/**\n\t * Remove an existing decoration.\n\t * @param id The unique identifier associated with the decoration.\n\t */\n\tremoveDecoration(id:string): void;\n\t/**\n\t * Perform a minimum ammount of operations, in order to transform the decorations\n\t * identified by `oldDecorations` to the decorations described by `newDecorations`\n\t * and returns the new identifiers associated with the resulting decorations.\n\t *\n\t * @param oldDecorations Array containing previous decorations identifiers.\n\t * @param newDecorations Array describing what decorations should result after the call.\n\t * @return An array containing the new decorations identifiers.\n\t */\n\tdeltaDecorations(oldDecorations:string[], newDecorations:IModelDeltaDecoration[]): string[];\n}\n\n/**\n * Word inside a model.\n */\nexport interface IWordAtPosition {\n\t/**\n\t * The word.\n\t */\n\tword: string;\n\t/**\n\t * The column where the word starts.\n\t */\n\tstartColumn: number;\n\t/**\n\t * The column where the word ends.\n\t */\n\tendColumn: number;\n}\n\n/**\n * Range of a word inside a model.\n * @internal\n */\nexport interface IWordRange {\n\t/**\n\t * The index where the word starts.\n\t */\n\tstart:number;\n\t/**\n\t * The index where the word ends.\n\t */\n\tend:number;\n}\n\n/**\n * @internal\n */\nexport interface ITokenInfo {\n\ttoken: IToken;\n\tlineNumber: number;\n\tstartColumn: number;\n\tendColumn: number;\n}\n\n/**\n * @internal\n */\nexport interface ITokenIterator {\n\thasNext(): boolean;\n\tnext(): ITokenInfo;\n\thasPrev(): boolean;\n\tprev(): ITokenInfo;\n}\n\n/**\n * End of line character preference.\n */\nexport enum EndOfLinePreference {\n\t/**\n\t * Use the end of line character identified in the text buffer.\n\t */\n\tTextDefined = 0,\n\t/**\n\t * Use line feed (\\n) as the end of line character.\n\t */\n\tLF = 1,\n\t/**\n\t * Use carriage return and line feed (\\r\\n) as the end of line character.\n\t */\n\tCRLF = 2\n}\n\n/**\n * The default end of line to use when instantiating models.\n */\nexport enum DefaultEndOfLine {\n\t/**\n\t * Use line feed (\\n) as the end of line character.\n\t */\n\tLF = 1,\n\t/**\n\t * Use carriage return and line feed (\\r\\n) as the end of line character.\n\t */\n\tCRLF = 2\n}\n\n/**\n * End of line character preference.\n */\nexport enum EndOfLineSequence {\n\t/**\n\t * Use line feed (\\n) as the end of line character.\n\t */\n\tLF = 0,\n\t/**\n\t * Use carriage return and line feed (\\r\\n) as the end of line character.\n\t */\n\tCRLF = 1\n}\n\n/**\n * A read-only line marker in the model.\n * @internal\n */\nexport interface IReadOnlyLineMarker {\n\tid: string;\n\tcolumn: number;\n}\n\n/**\n * And identifier for a single edit operation.\n */\nexport interface ISingleEditOperationIdentifier {\n\t/**\n\t * Identifier major\n\t */\n\tmajor:number;\n\t/**\n\t * Identifier minor\n\t */\n\tminor:number;\n}\n\n/**\n * A builder and helper for edit operations for a command.\n */\nexport interface IEditOperationBuilder {\n\t/**\n\t * Add a new edit operation (a replace operation).\n\t * @param range The range to replace (delete). May be empty to represent a simple insert.\n\t * @param text The text to replace with. May be null to represent a simple delete.\n\t */\n\taddEditOperation(range:Range, text:string): void;\n\n\t/**\n\t * Track `selection` when applying edit operations.\n\t * A best effort will be made to not grow/expand the selection.\n\t * An empty selection will clamp to a nearby character.\n\t * @param selection The selection to track.\n\t * @param trackPreviousOnEmpty If set, and the selection is empty, indicates whether the selection\n\t *           should clamp to the previous or the next character.\n\t * @return A unique identifer.\n\t */\n\ttrackSelection(selection:Selection, trackPreviousOnEmpty?:boolean): string;\n}\n\n/**\n * A helper for computing cursor state after a command.\n */\nexport interface ICursorStateComputerData {\n\t/**\n\t * Get the inverse edit operations of the added edit operations.\n\t */\n\tgetInverseEditOperations(): IIdentifiedSingleEditOperation[];\n\t/**\n\t * Get a previously tracked selection.\n\t * @param id The unique identifier returned by `trackSelection`.\n\t * @return The selection.\n\t */\n\tgetTrackedSelection(id:string): Selection;\n}\n\n/**\n * A command that modifies text / cursor state on a model.\n */\nexport interface ICommand {\n\t/**\n\t * Get the edit operations needed to execute this command.\n\t * @param model The model the command will execute on.\n\t * @param builder A helper to collect the needed edit operations and to track selections.\n\t */\n\tgetEditOperations(model:ITokenizedModel, builder:IEditOperationBuilder): void;\n\t/**\n\t * Compute the cursor state after the edit operations were applied.\n\t * @param model The model the commad has executed on.\n\t * @param helper A helper to get inverse edit operations and to get previously tracked selections.\n\t * @return The cursor state after the command executed.\n\t */\n\tcomputeCursorState(model:ITokenizedModel, helper:ICursorStateComputerData): Selection;\n}\n\n/**\n * A single edit operation, that acts as a simple replace.\n * i.e. Replace text at `range` with `text` in model.\n */\nexport interface ISingleEditOperation {\n\t/**\n\t * The range to replace. This can be empty to emulate a simple insert.\n\t */\n\trange: IRange;\n\t/**\n\t * The text to replace with. This can be null to emulate a simple delete.\n\t */\n\ttext: string;\n\t/**\n\t * This indicates that this operation has \"insert\" semantics.\n\t * i.e. forceMoveMarkers = true => if `range` is collapsed, all markers at the position will be moved.\n\t */\n\tforceMoveMarkers?: boolean;\n}\n\n/**\n * A single edit operation, that has an identifier.\n */\nexport interface IIdentifiedSingleEditOperation {\n\t/**\n\t * An identifier associated with this single edit operation.\n\t */\n\tidentifier: ISingleEditOperationIdentifier;\n\t/**\n\t * The range to replace. This can be empty to emulate a simple insert.\n\t */\n\trange: Range;\n\t/**\n\t * The text to replace with. This can be null to emulate a simple delete.\n\t */\n\ttext: string;\n\t/**\n\t * This indicates that this operation has \"insert\" semantics.\n\t * i.e. forceMoveMarkers = true => if `range` is collapsed, all markers at the position will be moved.\n\t */\n\tforceMoveMarkers: boolean;\n\t/**\n\t * This indicates that this operation is inserting automatic whitespace\n\t * that can be removed on next model edit operation if `config.trimAutoWhitespace` is true.\n\t */\n\tisAutoWhitespaceEdit?: boolean;\n}\n\n/**\n * A callback that can compute the cursor state after applying a series of edit operations.\n */\nexport interface ICursorStateComputer {\n\t/**\n\t * A callback that can compute the resulting cursors state after some edit operations have been executed.\n\t */\n\t(inverseEditOperations:IIdentifiedSingleEditOperation[]): Selection[];\n}\n\n/**\n * A list of tokens on a line.\n * @internal\n */\nexport interface ILineTokens {\n\tgetTokenCount(): number;\n\tgetTokenStartIndex(tokenIndex:number): number;\n\tgetTokenType(tokenIndex:number): string;\n\tgetTokenEndIndex(tokenIndex:number, textLength:number): number;\n\n\t/**\n\t * Check if tokens have changed. This is called by the view to validate rendered lines\n\t * and decide which lines need re-rendering.\n\t */\n\tequals(other:ILineTokens): boolean;\n\n\t/**\n\t * Find the token containing offset `offset`.\n\t *    For example, with the following tokens [0, 5), [5, 9), [9, infinity)\n\t *    Searching for 0, 1, 2, 3 or 4 will return 0.\n\t *    Searching for 5, 6, 7 or 8 will return 1.\n\t *    Searching for 9, 10, 11, ... will return 2.\n\t * @param offset The search offset\n\t * @return The index of the token containing the offset.\n\t */\n\tfindIndexOfOffset(offset:number): number;\n\n\t/**\n\t * @internal\n\t */\n\tsliceAndInflate(startOffset:number, endOffset:number, deltaStartIndex:number): ViewLineToken[];\n\n\t/**\n\t * @internal\n\t */\n\tinflate(): ViewLineToken[];\n}\n\nexport interface ITextModelResolvedOptions {\n\ttabSize: number;\n\tinsertSpaces: boolean;\n\tdefaultEOL: DefaultEndOfLine;\n\ttrimAutoWhitespace: boolean;\n}\n\n/**\n * @internal\n */\nexport interface ITextModelCreationOptions {\n\ttabSize: number;\n\tinsertSpaces: boolean;\n\tdetectIndentation: boolean;\n\ttrimAutoWhitespace: boolean;\n\tdefaultEOL: DefaultEndOfLine;\n}\n\nexport interface ITextModelUpdateOptions {\n\ttabSize?: number;\n\tinsertSpaces?: boolean;\n\ttrimAutoWhitespace?: boolean;\n}\n\nexport interface IModelOptionsChangedEvent {\n\ttabSize: boolean;\n\tinsertSpaces: boolean;\n\ttrimAutoWhitespace: boolean;\n}\n\n/**\n * A textual read-only model.\n */\nexport interface ITextModel {\n\n\tgetOptions(): ITextModelResolvedOptions;\n\n\t/**\n\t * Get the current version id of the model.\n\t * Anytime a change happens to the model (even undo/redo),\n\t * the version id is incremented.\n\t */\n\tgetVersionId(): number;\n\n\t/**\n\t * Get the alternative version id of the model.\n\t * This alternative version id is not always incremented,\n\t * it will return the same values in the case of undo-redo.\n\t */\n\tgetAlternativeVersionId(): number;\n\n\t/**\n\t * Replace the entire text buffer value contained in this model.\n\t */\n\tsetValue(newValue:string): void;\n\n\t/**\n\t * Replace the entire text buffer value contained in this model.\n\t */\n\tsetValueFromRawText(newValue:IRawText): void;\n\n\t/**\n\t * Get the text stored in this model.\n\t * @param eol The end of line character preference. Defaults to `EndOfLinePreference.TextDefined`.\n\t * @param preserverBOM Preserve a BOM character if it was detected when the model was constructed.\n\t * @return The text.\n\t */\n\tgetValue(eol?:EndOfLinePreference, preserveBOM?:boolean): string;\n\n\t/**\n\t * Get the length of the text stored in this model.\n\t */\n\tgetValueLength(eol?:EndOfLinePreference, preserveBOM?:boolean): number;\n\n\t/**\n\t * Get the raw text stored in this model.\n\t */\n\ttoRawText(): IRawText;\n\n\t/**\n\t * Check if the raw text stored in this model equals another raw text.\n\t */\n\tequals(other:IRawText): boolean;\n\n\t/**\n\t * Get the text in a certain range.\n\t * @param range The range describing what text to get.\n\t * @param eol The end of line character preference. This will only be used for multiline ranges. Defaults to `EndOfLinePreference.TextDefined`.\n\t * @return The text.\n\t */\n\tgetValueInRange(range:IRange, eol?:EndOfLinePreference): string;\n\n\t/**\n\t * Get the length of text in a certain range.\n\t * @param range The range describing what text length to get.\n\t * @return The text length.\n\t */\n\tgetValueLengthInRange(range:IRange): number;\n\n\t/**\n\t * Splits characters in two buckets. First bucket (A) is of characters that\n\t * sit in lines with length < `LONG_LINE_BOUNDARY`. Second bucket (B) is of\n\t * characters that sit in lines with length >= `LONG_LINE_BOUNDARY`.\n\t * If count(B) > count(A) return true. Returns false otherwise.\n\t * @internal\n\t */\n\tisDominatedByLongLines(): boolean;\n\n\t/**\n\t * Get the number of lines in the model.\n\t */\n\tgetLineCount(): number;\n\n\t/**\n\t * Get the text for a certain line.\n\t */\n\tgetLineContent(lineNumber:number): string;\n\n\t/**\n\t * Get the text for all lines.\n\t */\n\tgetLinesContent(): string[];\n\n\t/**\n\t * Get the end of line sequence predominantly used in the text buffer.\n\t * @return EOL char sequence (e.g.: '\\n' or '\\r\\n').\n\t */\n\tgetEOL(): string;\n\n\t/**\n\t * Change the end of line sequence used in the text buffer.\n\t */\n\tsetEOL(eol: EndOfLineSequence): void;\n\n\t/**\n\t * Get the minimum legal column for line at `lineNumber`\n\t */\n\tgetLineMinColumn(lineNumber:number): number;\n\n\t/**\n\t * Get the maximum legal column for line at `lineNumber`\n\t */\n\tgetLineMaxColumn(lineNumber:number): number;\n\n\t/**\n\t * Returns the column before the first non whitespace character for line at `lineNumber`.\n\t * Returns 0 if line is empty or contains only whitespace.\n\t */\n\tgetLineFirstNonWhitespaceColumn(lineNumber:number): number;\n\n\t/**\n\t * Returns the column after the last non whitespace character for line at `lineNumber`.\n\t * Returns 0 if line is empty or contains only whitespace.\n\t */\n\tgetLineLastNonWhitespaceColumn(lineNumber:number): number;\n\n\t/**\n\t * Create a valid position,\n\t */\n\tvalidatePosition(position:IPosition): Position;\n\n\t/**\n\t * Advances the given position by the given offest (negative offsets are also accepted)\n\t * and returns it as a new valid position.\n\t *\n\t * If the offset and position are such that their combination goes beyond the beginning or\n\t * end of the model, throws an exception.\n\t *\n\t * If the ofsset is such that the new position would be in the middle of a multi-byte\n\t * line terminator, throws an exception.\n\t */\n\tmodifyPosition(position: IPosition, offset: number): Position;\n\n\t/**\n\t * Create a valid range.\n\t */\n\tvalidateRange(range:IRange): Range;\n\n\t/**\n\t * Converts the position to a zero-based offset.\n\t *\n\t * The position will be [adjusted](#TextDocument.validatePosition).\n\t *\n\t * @param position A position.\n\t * @return A valid zero-based offset.\n\t */\n\tgetOffsetAt(position: IPosition): number;\n\n\t/**\n\t * Converts a zero-based offset to a position.\n\t *\n\t * @param offset A zero-based offset.\n\t * @return A valid [position](#Position).\n\t */\n\tgetPositionAt(offset: number): Position;\n\n\t/**\n\t * Get a range covering the entire model\n\t */\n\tgetFullModelRange(): Range;\n\n\t/**\n\t * Returns iff the model was disposed or not.\n\t */\n\tisDisposed(): boolean;\n\n\t/**\n\t * No mode supports allowed on this model because it is simply too large.\n\t * (even tokenization would cause too much memory pressure)\n\t * @internal\n\t */\n\tisTooLargeForHavingAMode(): boolean;\n\n\t/**\n\t * Only basic mode supports allowed on this model because it is simply too large.\n\t * (tokenization is allowed and other basic supports)\n\t * @internal\n\t */\n\tisTooLargeForHavingARichMode(): boolean;\n}\n\nexport interface IReadOnlyModel extends ITextModel {\n\t/**\n\t * Gets the resource associated with this editor model.\n\t */\n\turi: URI;\n\n\t/**\n\t * Get the language associated with this model.\n\t */\n\tgetModeId(): string;\n\n\t/**\n\t * Get the word under or besides `position`.\n\t * @param position The position to look for a word.\n\t * @param skipSyntaxTokens Ignore syntax tokens, as identified by the mode.\n\t * @return The word under or besides `position`. Might be null.\n\t */\n\tgetWordAtPosition(position:IPosition): IWordAtPosition;\n\n\t/**\n\t * Get the word under or besides `position` trimmed to `position`.column\n\t * @param position The position to look for a word.\n\t * @param skipSyntaxTokens Ignore syntax tokens, as identified by the mode.\n\t * @return The word under or besides `position`. Will never be null.\n\t */\n\tgetWordUntilPosition(position:IPosition): IWordAtPosition;\n}\n\n/**\n * @internal\n */\nexport interface IRichEditBracket {\n\tmodeId: string;\n\topen: string;\n\tclose: string;\n\tforwardRegex: RegExp;\n\treversedRegex: RegExp;\n}\n\n/**\n * @internal\n */\nexport interface IFoundBracket {\n\trange: Range;\n\topen: string;\n\tclose: string;\n\tisOpen: boolean;\n}\n\n/**\n * A model that is tokenized.\n */\nexport interface ITokenizedModel extends ITextModel {\n\n\t/**\n\t * Tokenize if necessary and get the tokens for the line `lineNumber`.\n\t * @param lineNumber The line number\n\t * @param inaccurateTokensAcceptable Are inaccurate tokens acceptable? Defaults to false\n\t * @internal\n\t */\n\tgetLineTokens(lineNumber:number, inaccurateTokensAcceptable?:boolean): ILineTokens;\n\n\t/**\n\t * Tokenize if necessary and get the tokenization result for the line `lineNumber`, as returned by the language mode.\n\t * @internal\n\t */\n\tgetLineContext(lineNumber:number): ILineContext;\n\n\t/**\n\t * @internal\n\t */\n\t_getLineModeTransitions(lineNumber:number): ModeTransition[];\n\n\t/**\n\t * Get the current language mode associated with the model.\n\t */\n\tgetMode(): IMode;\n\n\t/**\n\t * Set the current language mode associated with the model.\n\t */\n\tsetMode(newMode:IMode|TPromise<IMode>): void;\n\n\t/**\n\t * A mode can be currently pending loading if a promise is used when constructing a model or calling setMode().\n\t *\n\t * If there is no currently pending loading mode, then the result promise will complete immediately.\n\t * Otherwise, the result will complete once the currently pending loading mode is loaded.\n\t * @internal\n\t */\n\twhenModeIsReady(): TPromise<IMode>;\n\n\t/**\n\t * Returns the true (inner-most) language mode at a given position.\n\t * @internal\n\t */\n\tgetModeIdAtPosition(lineNumber:number, column:number): string;\n\n\t/**\n\t * Get the word under or besides `position`.\n\t * @param position The position to look for a word.\n\t * @param skipSyntaxTokens Ignore syntax tokens, as identified by the mode.\n\t * @return The word under or besides `position`. Might be null.\n\t */\n\tgetWordAtPosition(position:IPosition): IWordAtPosition;\n\n\t/**\n\t * Get the word under or besides `position` trimmed to `position`.column\n\t * @param position The position to look for a word.\n\t * @param skipSyntaxTokens Ignore syntax tokens, as identified by the mode.\n\t * @return The word under or besides `position`. Will never be null.\n\t */\n\tgetWordUntilPosition(position:IPosition): IWordAtPosition;\n\n\t/**\n\t * Returns an iterator that can be used to read\n\t * next and previous tokens from the provided position.\n\t * The iterator is made available through the callback\n\t * function and can't be used afterwards.\n\t * @internal\n\t */\n\ttokenIterator(position: IPosition, callback: (it: ITokenIterator) =>any): any;\n\n\t/**\n\t * Find the matching bracket of `request` up, counting brackets.\n\t * @param request The bracket we're searching for\n\t * @param position The position at which to start the search.\n\t * @return The range of the matching bracket, or null if the bracket match was not found.\n\t * @internal\n\t */\n\tfindMatchingBracketUp(bracket:string, position:IPosition): Range;\n\n\t// /**\n\t//  * Find the first bracket in the model before `position`.\n\t//  * @param position The position at which to start the search.\n\t//  * @return The info for the first bracket before `position`, or null if there are no more brackets before `positions`.\n\t//  */\n\t// findPrevBracket(position:IPosition): IFoundBracket;\n\n\t// /**\n\t//  * Find the first bracket in the model after `position`.\n\t//  * @param position The position at which to start the search.\n\t//  * @return The info for the first bracket after `position`, or null if there are no more brackets after `positions`.\n\t//  */\n\t// findNextBracket(position:IPosition): IFoundBracket;\n\n\t/**\n\t * Given a `position`, if the position is on top or near a bracket,\n\t * find the matching bracket of that bracket and return the ranges of both brackets.\n\t * @param position The position at which to look for a bracket.\n\t * @internal\n\t */\n\tmatchBracket(position:IPosition): [Range,Range];\n}\n\n/**\n * A model that can track markers.\n */\nexport interface ITextModelWithMarkers extends ITextModel {\n\t/**\n\t * @internal\n\t */\n\t_addMarker(lineNumber:number, column:number, stickToPreviousCharacter:boolean): string;\n\t/**\n\t * @internal\n\t */\n\t_changeMarker(id:string, newLineNumber:number, newColumn:number): void;\n\t/**\n\t * @internal\n\t */\n\t_changeMarkerStickiness(id:string, newStickToPreviousCharacter:boolean): void;\n\t/**\n\t * @internal\n\t */\n\t_getMarker(id:string): Position;\n\t/**\n\t * @internal\n\t */\n\t_removeMarker(id:string): void;\n\t/**\n\t * @internal\n\t */\n\t_getLineMarkers(lineNumber: number): IReadOnlyLineMarker[];\n}\n\n/**\n * A map of changed ranges used during the model internal processing\n * @internal\n */\nexport interface IChangedTrackedRanges {\n\t[key:string]:IRange;\n}\n\n/**\n * Describes the behaviour of decorations when typing/editing near their edges.\n */\nexport enum TrackedRangeStickiness {\n\tAlwaysGrowsWhenTypingAtEdges = 0,\n\tNeverGrowsWhenTypingAtEdges = 1,\n\tGrowsOnlyWhenTypingBefore = 2,\n\tGrowsOnlyWhenTypingAfter = 3,\n}\n\n/**\n * A model that can track ranges.\n */\nexport interface ITextModelWithTrackedRanges extends ITextModel {\n\t/**\n\t * Start tracking a range (across edit operations).\n\t * @param range The range to start tracking.\n\t * @param stickiness The behaviour when typing at the edges of the range.\n\t * @return A unique identifier for the tracked range.\n\t * @internal\n\t */\n\taddTrackedRange(range:IRange, stickiness:TrackedRangeStickiness): string;\n\n\t/**\n\t * Change the range of a tracked range.\n\t * @param id The id of the tracked range, as returned by a `addTrackedRange` call.\n\t * @param newRange The new range of the tracked range.\n\t * @internal\n\t */\n\tchangeTrackedRange(id:string, newRange:IRange): void;\n\n\t/**\n\t * Change the stickiness (behaviour when typing at the edges of the range) for a tracked range.\n\t * @param id The id of the tracked range, as returned by a `addTrackedRange` call.\n\t * @param newStickiness The new behaviour when typing at the edges of the range.\n\t * @internal\n\t */\n\tchangeTrackedRangeStickiness(id:string, newStickiness:TrackedRangeStickiness): void;\n\n\t/**\n\t * Remove a tracked range.\n\t * @param id The id of the tracked range, as returned by a `addTrackedRaneg` call.\n\t * @internal\n\t */\n\tremoveTrackedRange(id:string): void;\n\n\t/**\n\t * Get the range of a tracked range.\n\t * @param id The id of the tracked range, as returned by a `addTrackedRaneg` call.\n\t * @internal\n\t */\n\tgetTrackedRange(id:string): Range;\n\n\t/**\n\t * Gets all the tracked ranges for the lines between `startLineNumber` and `endLineNumber` as an array.\n\t * @param startLineNumber The start line number\n\t * @param endLineNumber The end line number\n\t * @return An array with the tracked ranges\n\t * @internal\n\t */\n\tgetLinesTrackedRanges(startLineNumber:number, endLineNumber:number): IModelTrackedRange[];\n}\n\n/**\n * A model that can have decorations.\n */\nexport interface ITextModelWithDecorations {\n\t/**\n\t * Change the decorations. The callback will be called with a change accessor\n\t * that becomes invalid as soon as the callback finishes executing.\n\t * This allows for all events to be queued up until the change\n\t * is completed. Returns whatever the callback returns.\n\t * @param ownerId Identifies the editor id in which these decorations should appear. If no `ownerId` is provided, the decorations will appear in all editors that attach this model.\n\t * @internal\n\t */\n\tchangeDecorations(callback: (changeAccessor:IModelDecorationsChangeAccessor)=>any, ownerId?:number): any;\n\n\t/**\n\t * Perform a minimum ammount of operations, in order to transform the decorations\n\t * identified by `oldDecorations` to the decorations described by `newDecorations`\n\t * and returns the new identifiers associated with the resulting decorations.\n\t *\n\t * @param oldDecorations Array containing previous decorations identifiers.\n\t * @param newDecorations Array describing what decorations should result after the call.\n\t * @param ownerId Identifies the editor id in which these decorations should appear. If no `ownerId` is provided, the decorations will appear in all editors that attach this model.\n\t * @return An array containing the new decorations identifiers.\n\t */\n\tdeltaDecorations(oldDecorations:string[], newDecorations:IModelDeltaDecoration[], ownerId?:number): string[];\n\n\t/**\n\t * Remove all decorations that have been added with this specific ownerId.\n\t * @param ownerId The owner id to search for.\n\t * @internal\n\t */\n\tremoveAllDecorationsWithOwnerId(ownerId:number): void;\n\n\t/**\n\t * Get the options associated with a decoration.\n\t * @param id The decoration id.\n\t * @return The decoration options or null if the decoration was not found.\n\t */\n\tgetDecorationOptions(id:string): IModelDecorationOptions;\n\n\t/**\n\t * Get the range associated with a decoration.\n\t * @param id The decoration id.\n\t * @return The decoration range or null if the decoration was not found.\n\t */\n\tgetDecorationRange(id:string): Range;\n\n\t/**\n\t * Gets all the decorations for the line `lineNumber` as an array.\n\t * @param lineNumber The line number\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t * @return An array with the decorations\n\t */\n\tgetLineDecorations(lineNumber:number, ownerId?:number, filterOutValidation?:boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the decorations for the lines between `startLineNumber` and `endLineNumber` as an array.\n\t * @param startLineNumber The start line number\n\t * @param endLineNumber The end line number\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t * @return An array with the decorations\n\t */\n\tgetLinesDecorations(startLineNumber:number, endLineNumber:number, ownerId?:number, filterOutValidation?:boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the deocorations in a range as an array. Only `startLineNumber` and `endLineNumber` from `range` are used for filtering.\n\t * So for now it returns all the decorations on the same line as `range`.\n\t * @param range The range to search in\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t * @return An array with the decorations\n\t */\n\tgetDecorationsInRange(range:IRange, ownerId?:number, filterOutValidation?:boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the decorations as an array.\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t */\n\tgetAllDecorations(ownerId?:number, filterOutValidation?:boolean): IModelDecoration[];\n}\n\n/**\n * An editable text model.\n */\nexport interface IEditableTextModel extends ITextModelWithMarkers {\n\n\t/**\n\t * Normalize a string containing whitespace according to indentation rules (converts to spaces or to tabs).\n\t */\n\tnormalizeIndentation(str:string): string;\n\n\t/**\n\t * Get what is considered to be one indent (e.g. a tab character or 4 spaces, etc.).\n\t */\n\tgetOneIndent(): string;\n\n\t/**\n\t * Change the options of this model.\n\t */\n\tupdateOptions(newOpts:ITextModelUpdateOptions): void;\n\n\t/**\n\t * Detect the indentation options for this model from its content.\n\t */\n\tdetectIndentation(defaultInsertSpaces:boolean, defaultTabSize:number): void;\n\n\t/**\n\t * Push a stack element onto the undo stack. This acts as an undo/redo point.\n\t * The idea is to use `pushEditOperations` to edit the model and then to\n\t * `pushStackElement` to create an undo/redo stop point.\n\t */\n\tpushStackElement(): void;\n\n\t/**\n\t * Push edit operations, basically editing the model. This is the preferred way\n\t * of editing the model. The edit operations will land on the undo stack.\n\t * @param beforeCursorState The cursor state before the edit operaions. This cursor state will be returned when `undo` or `redo` are invoked.\n\t * @param editOperations The edit operations.\n\t * @param cursorStateComputer A callback that can compute the resulting cursors state after the edit operations have been executed.\n\t * @return The cursor state returned by the `cursorStateComputer`.\n\t */\n\tpushEditOperations(beforeCursorState:Selection[], editOperations:IIdentifiedSingleEditOperation[], cursorStateComputer:ICursorStateComputer): Selection[];\n\n\t/**\n\t * Edit the model without adding the edits to the undo stack.\n\t * This can have dire consequences on the undo stack! See @pushEditOperations for the preferred way.\n\t * @param operations The edit operations.\n\t * @return The inverse edit operations, that, when applied, will bring the model back to the previous state.\n\t */\n\tapplyEdits(operations:IIdentifiedSingleEditOperation[]): IIdentifiedSingleEditOperation[];\n\n\t/**\n\t * Undo edit operations until the first previous stop point created by `pushStackElement`.\n\t * The inverse edit operations will be pushed on the redo stack.\n\t * @internal\n\t */\n\tundo(): Selection[];\n\n\t/**\n\t * Redo edit operations until the next stop point created by `pushStackElement`.\n\t * The inverse edit operations will be pushed on the undo stack.\n\t * @internal\n\t */\n\tredo(): Selection[];\n\n\t/**\n\t * Set an editable range on the model.\n\t * @internal\n\t */\n\tsetEditableRange(range:IRange): void;\n\n\t/**\n\t * Check if the model has an editable range.\n\t * @internal\n\t */\n\thasEditableRange(): boolean;\n\n\t/**\n\t * Get the editable range on the model.\n\t * @internal\n\t */\n\tgetEditableRange(): Range;\n}\n\n/**\n * A model.\n */\nexport interface IModel extends IReadOnlyModel, IEditableTextModel, ITextModelWithMarkers, ITokenizedModel, ITextModelWithTrackedRanges, ITextModelWithDecorations, IEditorModel {\n\t/**\n\t * @deprecated Please use `onDidChangeContent` instead.\n\t * An event emitted when the contents of the model have changed.\n\t * @internal\n\t */\n\tonDidChangeRawContent(listener: (e:IModelContentChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the contents of the model have changed.\n\t */\n\tonDidChangeContent(listener: (e:IModelContentChangedEvent2)=>void): IDisposable;\n\t/**\n\t * @internal\n\t */\n\tonDidChangeModeSupport(listener: (e:IModeSupportChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when decorations of the model have changed.\n\t */\n\tonDidChangeDecorations(listener: (e:IModelDecorationsChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the model options have changed.\n\t */\n\tonDidChangeOptions(listener: (e:IModelOptionsChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the language associated with the model has changed.\n\t */\n\tonDidChangeMode(listener: (e:IModelModeChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted right before disposing the model.\n\t */\n\tonWillDispose(listener: ()=>void): IDisposable;\n\n\t/**\n\t * @internal\n\t */\n\taddBulkListener(listener:BulkListenerCallback):IDisposable;\n\n\t/**\n\t * A unique identifier associated with this model.\n\t */\n\tid: string;\n\n\t/**\n\t * Destroy this model. This will unbind the model from the mode\n\t * and make all necessary clean-up to release this object to the GC.\n\t * @internal\n\t */\n\tdestroy(): void;\n\n\t/**\n\t * Destroy this model. This will unbind the model from the mode\n\t * and make all necessary clean-up to release this object to the GC.\n\t */\n\tdispose(): void;\n\n\t/**\n\t * Search the model.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchOnlyEditableRange Limit the searching to only search inside the editable range of the model.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wholeWord Force the matching to match entire words only.\n\t * @param limitResultCount Limit the number of results\n\t * @return The ranges where the matches are. It is empty if not matches have been found.\n\t */\n\tfindMatches(searchString:string, searchOnlyEditableRange:boolean, isRegex:boolean, matchCase:boolean, wholeWord:boolean, limitResultCount?:number): Range[];\n\t/**\n\t * Search the model.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchScope Limit the searching to only search inside this range.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wholeWord Force the matching to match entire words only.\n\t * @param limitResultCount Limit the number of results\n\t * @return The ranges where the matches are. It is empty if no matches have been found.\n\t */\n\tfindMatches(searchString:string, searchScope:IRange, isRegex:boolean, matchCase:boolean, wholeWord:boolean, limitResultCount?:number): Range[];\n\t/**\n\t * Search the model for the next match. Loops to the beginning of the model if needed.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchStart Start the searching at the specified position.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wholeWord Force the matching to match entire words only.\n\t * @return The range where the next match is. It is null if no next match has been found.\n\t */\n\tfindNextMatch(searchString:string, searchStart:IPosition, isRegex:boolean, matchCase:boolean, wholeWord:boolean): Range;\n\t/**\n\t * Search the model for the previous match. Loops to the end of the model if needed.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchStart Start the searching at the specified position.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wholeWord Force the matching to match entire words only.\n\t * @return The range where the previous match is. It is null if no previous match has been found.\n\t */\n\tfindPreviousMatch(searchString:string, searchStart:IPosition, isRegex:boolean, matchCase:boolean, wholeWord:boolean): Range;\n\n\t/**\n\t * @internal\n\t */\n\tonBeforeAttached(): void;\n\n\t/**\n\t * @internal\n\t */\n\tonBeforeDetached(): void;\n\n\t/**\n\t * Returns iff this model is attached to an editor or not.\n\t * @internal\n\t */\n\tisAttachedToEditor(): boolean;\n}\n\n/**\n * @internal\n */\nexport interface IRangeWithText {\n\ttext:string;\n\trange:IRange;\n}\n\n/**\n * @internal\n */\nexport interface IMirrorModel extends IEventEmitter, ITokenizedModel {\n\turi: URI;\n\n\tgetOffsetFromPosition(position:IPosition): number;\n\tgetPositionFromOffset(offset:number): Position;\n\tgetOffsetAndLengthFromRange(range:IRange): {offset:number; length:number;};\n\tgetRangeFromOffsetAndLength(offset:number, length:number): Range;\n\tgetLineStart(lineNumber:number): number;\n\n\tgetAllWordsWithRange(): IRangeWithText[];\n\tgetAllUniqueWords(skipWordOnce?:string): string[];\n\n\tgetModeId(): string;\n}\n\n/**\n * An event describing that the current mode associated with a model has changed.\n */\nexport interface IModelModeChangedEvent {\n\t/**\n\t * Previous mode\n\t */\n\toldMode:IMode;\n\t/**\n\t * New mode\n\t */\n\tnewMode:IMode;\n}\n\n/**\n * An event describing a change in the text of a model.\n */\nexport interface IModelContentChangedEvent2 {\n\t/**\n\t * The range that got replaced.\n\t */\n\trange: IRange;\n\t/**\n\t * The length of the range that got replaced.\n\t */\n\trangeLength: number;\n\t/**\n\t * The new text for the range.\n\t */\n\ttext: string;\n\t/**\n\t * The (new) end-of-line character.\n\t */\n\teol: string;\n\t/**\n\t * The new version id the model has transitioned to.\n\t */\n\tversionId: number;\n\t/**\n\t * Flag that indicates that this event was generated while undoing.\n\t */\n\tisUndoing: boolean;\n\t/**\n\t * Flag that indicates that this event was generated while redoing.\n\t */\n\tisRedoing: boolean;\n}\n/**\n * An event describing a change in the text of a model.\n * @internal\n */\nexport interface IModelContentChangedEvent {\n\t/**\n\t * The event type. It can be used to detect the actual event type:\n\t * \t\tEditorCommon.EventType.ModelContentChangedFlush => IModelContentChangedFlushEvent\n\t * \t\tEditorCommon.EventType.ModelContentChangedLinesDeleted => IModelContentChangedLineChangedEvent\n\t * \t\tEditorCommon.EventType.ModelContentChangedLinesInserted => IModelContentChangedLinesDeletedEvent\n\t * \t\tEditorCommon.EventType.ModelContentChangedLineChanged => IModelContentChangedLinesInsertedEvent\n\t */\n\tchangeType: string;\n\t/**\n\t * The new version id the model has transitioned to.\n\t */\n\tversionId: number;\n\t/**\n\t * Flag that indicates that this event was generated while undoing.\n\t */\n\tisUndoing: boolean;\n\t/**\n\t * Flag that indicates that this event was generated while redoing.\n\t */\n\tisRedoing: boolean;\n}\n\n/**\n * The raw text backing a model.\n */\nexport interface IRawText {\n\t/**\n\t * The entire text length.\n\t */\n\tlength: number;\n\t/**\n\t * The text split into lines.\n\t */\n\tlines: string[];\n\t/**\n\t * The BOM (leading character sequence of the file).\n\t */\n\tBOM: string;\n\t/**\n\t * The end of line sequence.\n\t */\n\tEOL: string;\n\t/**\n\t * The options associated with this text.\n\t */\n\toptions: ITextModelResolvedOptions;\n}\n\n/**\n * An event describing that a model has been reset to a new value.\n * @internal\n */\nexport interface IModelContentChangedFlushEvent extends IModelContentChangedEvent {\n\t/**\n\t * The new text content of the model.\n\t */\n\tdetail: IRawText;\n}\n/**\n * An event describing that a line has changed in a model.\n * @internal\n */\nexport interface IModelContentChangedLineChangedEvent extends IModelContentChangedEvent {\n\t/**\n\t * The line that has changed.\n\t */\n\tlineNumber: number;\n\t/**\n\t * The new value of the line.\n\t */\n\tdetail: string;\n}\n/**\n * An event describing that line(s) have been deleted in a model.\n * @internal\n */\nexport interface IModelContentChangedLinesDeletedEvent extends IModelContentChangedEvent {\n\t/**\n\t * At what line the deletion began (inclusive).\n\t */\n\tfromLineNumber: number;\n\t/**\n\t * At what line the deletion stopped (inclusive).\n\t */\n\ttoLineNumber: number;\n}\n/**\n * An event describing that line(s) have been inserted in a model.\n * @internal\n */\nexport interface IModelContentChangedLinesInsertedEvent extends IModelContentChangedEvent {\n\t/**\n\t * Before what line did the insertion begin\n\t */\n\tfromLineNumber: number;\n\t/**\n\t * `toLineNumber` - `fromLineNumber` + 1 denotes the number of lines that were inserted\n\t */\n\ttoLineNumber: number;\n\t/**\n\t * The text that was inserted\n\t */\n\tdetail: string;\n}\n/**\n * Decoration data associated with a model decorations changed event.\n */\nexport interface IModelDecorationsChangedEventDecorationData {\n\t/**\n\t * The id of the decoration.\n\t */\n\tid:string;\n\t/**\n\t * The owner id of the decoration.\n\t */\n\townerId:number;\n\t/**\n\t * The range of the decoration.\n\t */\n\trange:IRange;\n\t/**\n\t * A flag describing if this is a problem decoration (e.g. warning/error).\n\t */\n\tisForValidation:boolean;\n\t/**\n\t * The options for this decoration.\n\t */\n\toptions:IModelDecorationOptions;\n}\n/**\n * An event describing that model decorations have changed.\n */\nexport interface IModelDecorationsChangedEvent {\n\t/**\n\t * A summary with ids of decorations that have changed.\n\t */\n\tids:string[];\n\t/**\n\t * Lists of details for added or changed decorations.\n\t */\n\taddedOrChangedDecorations:IModelDecorationsChangedEventDecorationData[];\n\t/**\n\t * List of ids for removed decorations.\n\t */\n\tremovedDecorations:string[];\n\t/**\n\t * Details regarding old options.\n\t */\n\toldOptions:{[decorationId:string]:IModelDecorationOptions;};\n\t/**\n\t * Details regarding old ranges.\n\t */\n\toldRanges:{[decorationId:string]:IRange;};\n}\n/**\n * An event describing that a range of lines has been tokenized\n */\nexport interface IModelTokensChangedEvent {\n\t/**\n\t * The start of the range (inclusive)\n\t */\n\tfromLineNumber:number;\n\t/**\n\t * The end of the range (inclusive)\n\t */\n\ttoLineNumber:number;\n}\n\n/**\n * Describes the reason the cursor has changed its position.\n */\nexport enum CursorChangeReason {\n\t/**\n\t * Unknown or not set.\n\t */\n\tNotSet = 0,\n\t/**\n\t * A `model.setValue()` was called.\n\t */\n\tContentFlush = 1,\n\t/**\n\t * The `model` has been changed outside of this cursor and the cursor recovers its position from associated markers.\n\t */\n\tRecoverFromMarkers = 2,\n\t/**\n\t * There was an explicit user gesture.\n\t */\n\tExplicit = 3,\n\t/**\n\t * There was a Paste.\n\t */\n\tPaste = 4,\n\t/**\n\t * There was an Undo.\n\t */\n\tUndo = 5,\n\t/**\n\t * There was a Redo.\n\t */\n\tRedo = 6,\n}\n/**\n * An event describing that the cursor position has changed.\n */\nexport interface ICursorPositionChangedEvent {\n\t/**\n\t * Primary cursor's position.\n\t */\n\tposition:Position;\n\t/**\n\t * Primary cursor's view position\n\t */\n\tviewPosition:Position;\n\t/**\n\t * Secondary cursors' position.\n\t */\n\tsecondaryPositions:Position[];\n\t/**\n\t * Secondary cursors' view position.\n\t */\n\tsecondaryViewPositions:Position[];\n\t/**\n\t * Reason.\n\t */\n\treason:CursorChangeReason;\n\t/**\n\t * Source of the call that caused the event.\n\t */\n\tsource:string;\n\t/**\n\t * Is the primary cursor in the editable range?\n\t */\n\tisInEditableRange:boolean;\n}\n/**\n * An event describing that the cursor selection has changed.\n */\nexport interface ICursorSelectionChangedEvent {\n\t/**\n\t * The primary selection.\n\t */\n\tselection:Selection;\n\t/**\n\t * The primary selection in view coordinates.\n\t */\n\tviewSelection:Selection;\n\t/**\n\t * The secondary selections.\n\t */\n\tsecondarySelections:Selection[];\n\t/**\n\t * The secondary selections in view coordinates.\n\t */\n\tsecondaryViewSelections:Selection[];\n\t/**\n\t * Source of the call that caused the event.\n\t */\n\tsource:string;\n\t/**\n\t * Reason.\n\t */\n\treason:CursorChangeReason;\n}\n/**\n * @internal\n */\nexport enum VerticalRevealType {\n\tSimple = 0,\n\tCenter = 1,\n\tCenterIfOutsideViewport = 2\n}\n/**\n * An event describing a request to reveal a specific range in the view of the editor.\n * @internal\n */\nexport interface ICursorRevealRangeEvent {\n\t/**\n\t * Range to be reavealed.\n\t */\n\trange:Range;\n\t/**\n\t * View range to be reavealed.\n\t */\n\tviewRange:Range;\n\n\tverticalType: VerticalRevealType;\n\t/**\n\t * If true: there should be a horizontal & vertical revealing\n\t * If false: there should be just a vertical revealing\n\t */\n\trevealHorizontal:boolean;\n}\n\n/**\n * @internal\n */\nexport interface ICursorScrollRequestEvent {\n\tdeltaLines: number;\n}\n\n/**\n * An event describing that an editor has had its model reset (i.e. `editor.setModel()`).\n */\nexport interface IModelChangedEvent {\n\t/**\n\t * The `uri` of the previous model or null.\n\t */\n\toldModelUrl: URI;\n\t/**\n\t * The `uri` of the new model or null.\n\t */\n\tnewModelUrl: URI;\n}\n\n/**\n * @internal\n */\nexport interface IEditorWhitespace {\n\tid:number;\n\tafterLineNumber:number;\n\theightInLines:number;\n}\n\n/**\n * A description for the overview ruler position.\n */\nexport class OverviewRulerPosition {\n\t_overviewRulerPositionBrand: void;\n\n\t/**\n\t * Width of the overview ruler\n\t */\n\twidth:number;\n\t/**\n\t * Height of the overview ruler\n\t */\n\theight:number;\n\t/**\n\t * Top position for the overview ruler\n\t */\n\ttop:number;\n\t/**\n\t * Right position for the overview ruler\n\t */\n\tright:number;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source:{\n\t\twidth:number;\n\t\theight:number;\n\t\ttop:number;\n\t\tright:number;\n\t}) {\n\t\tthis.width = source.width|0;\n\t\tthis.height = source.height|0;\n\t\tthis.top = source.top|0;\n\t\tthis.right = source.right|0;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:OverviewRulerPosition): boolean {\n\t\treturn (\n\t\t\tthis.width === other.width\n\t\t\t&& this.height === other.height\n\t\t\t&& this.top === other.top\n\t\t\t&& this.right === other.right\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): OverviewRulerPosition {\n\t\treturn new OverviewRulerPosition(this);\n\t}\n}\n\n/**\n * The internal layout details of the editor.\n */\nexport class EditorLayoutInfo {\n\t_editorLayoutInfoBrand: void;\n\n\t/**\n\t * Full editor width.\n\t */\n\twidth:number;\n\t/**\n\t * Full editor height.\n\t */\n\theight:number;\n\n\t/**\n\t * Left position for the glyph margin.\n\t */\n\tglyphMarginLeft:number;\n\t/**\n\t * The width of the glyph margin.\n\t */\n\tglyphMarginWidth:number;\n\t/**\n\t * The height of the glyph margin.\n\t */\n\tglyphMarginHeight:number;\n\n\t/**\n\t * Left position for the line numbers.\n\t */\n\tlineNumbersLeft:number;\n\t/**\n\t * The width of the line numbers.\n\t */\n\tlineNumbersWidth:number;\n\t/**\n\t * The height of the line numbers.\n\t */\n\tlineNumbersHeight:number;\n\n\t/**\n\t * Left position for the line decorations.\n\t */\n\tdecorationsLeft:number;\n\t/**\n\t * The width of the line decorations.\n\t */\n\tdecorationsWidth:number;\n\t/**\n\t * The height of the line decorations.\n\t */\n\tdecorationsHeight:number;\n\n\t/**\n\t * Left position for the content (actual text)\n\t */\n\tcontentLeft:number;\n\t/**\n\t * The width of the content (actual text)\n\t */\n\tcontentWidth:number;\n\t/**\n\t * The height of the content (actual height)\n\t */\n\tcontentHeight:number;\n\n\t/**\n\t * The width of the vertical scrollbar.\n\t */\n\tverticalScrollbarWidth:number;\n\t/**\n\t * The height of the horizontal scrollbar.\n\t */\n\thorizontalScrollbarHeight:number;\n\n\t/**\n\t * The position of the overview ruler.\n\t */\n\toverviewRuler:OverviewRulerPosition;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(source:{\n\t\twidth:number;\n\t\theight:number;\n\t\tglyphMarginLeft:number;\n\t\tglyphMarginWidth:number;\n\t\tglyphMarginHeight:number;\n\t\tlineNumbersLeft:number;\n\t\tlineNumbersWidth:number;\n\t\tlineNumbersHeight:number;\n\t\tdecorationsLeft:number;\n\t\tdecorationsWidth:number;\n\t\tdecorationsHeight:number;\n\t\tcontentLeft:number;\n\t\tcontentWidth:number;\n\t\tcontentHeight:number;\n\t\tverticalScrollbarWidth:number;\n\t\thorizontalScrollbarHeight:number;\n\t\toverviewRuler:OverviewRulerPosition;\n\t}) {\n\t\tthis.width = source.width|0;\n\t\tthis.height = source.height|0;\n\t\tthis.glyphMarginLeft = source.glyphMarginLeft|0;\n\t\tthis.glyphMarginWidth = source.glyphMarginWidth|0;\n\t\tthis.glyphMarginHeight = source.glyphMarginHeight|0;\n\t\tthis.lineNumbersLeft = source.lineNumbersLeft|0;\n\t\tthis.lineNumbersWidth = source.lineNumbersWidth|0;\n\t\tthis.lineNumbersHeight = source.lineNumbersHeight|0;\n\t\tthis.decorationsLeft = source.decorationsLeft|0;\n\t\tthis.decorationsWidth = source.decorationsWidth|0;\n\t\tthis.decorationsHeight = source.decorationsHeight|0;\n\t\tthis.contentLeft = source.contentLeft|0;\n\t\tthis.contentWidth = source.contentWidth|0;\n\t\tthis.contentHeight = source.contentHeight|0;\n\t\tthis.verticalScrollbarWidth = source.verticalScrollbarWidth|0;\n\t\tthis.horizontalScrollbarHeight = source.horizontalScrollbarHeight|0;\n\t\tthis.overviewRuler = source.overviewRuler.clone();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:EditorLayoutInfo): boolean {\n\t\treturn (\n\t\t\tthis.width === other.width\n\t\t\t&& this.height === other.height\n\t\t\t&& this.glyphMarginLeft === other.glyphMarginLeft\n\t\t\t&& this.glyphMarginWidth === other.glyphMarginWidth\n\t\t\t&& this.glyphMarginHeight === other.glyphMarginHeight\n\t\t\t&& this.lineNumbersLeft === other.lineNumbersLeft\n\t\t\t&& this.lineNumbersWidth === other.lineNumbersWidth\n\t\t\t&& this.lineNumbersHeight === other.lineNumbersHeight\n\t\t\t&& this.decorationsLeft === other.decorationsLeft\n\t\t\t&& this.decorationsWidth === other.decorationsWidth\n\t\t\t&& this.decorationsHeight === other.decorationsHeight\n\t\t\t&& this.contentLeft === other.contentLeft\n\t\t\t&& this.contentWidth === other.contentWidth\n\t\t\t&& this.contentHeight === other.contentHeight\n\t\t\t&& this.verticalScrollbarWidth === other.verticalScrollbarWidth\n\t\t\t&& this.horizontalScrollbarHeight === other.horizontalScrollbarHeight\n\t\t\t&& this.overviewRuler.equals(other.overviewRuler)\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): EditorLayoutInfo {\n\t\treturn new EditorLayoutInfo(this);\n\t}\n}\n\n/**\n * Options for creating the editor.\n */\nexport interface ICodeEditorWidgetCreationOptions extends IEditorOptions {\n\t/**\n\t * The initial model associated with this code editor.\n\t */\n\tmodel?:IModel;\n}\n\n/**\n * An editor model.\n */\nexport interface IEditorModel {\n}\n/**\n * An editor view state.\n */\nexport interface IEditorViewState {\n}\nexport interface IDimension {\n\twidth:number;\n\theight:number;\n}\n/**\n * Conditions describing action enablement\n */\nexport interface IActionEnablement {\n\t/**\n\t * The action is enabled only if text in the editor is focused (e.g. blinking cursor).\n\t * Warning: This condition will be disabled if the action is marked to be displayed in the context menu\n\t * Defaults to false.\n\t */\n\ttextFocus?: boolean;\n\t/**\n\t * The action is enabled only if the editor or its widgets have focus (e.g. focus is in find widget).\n\t * Defaults to false.\n\t */\n\twidgetFocus?: boolean;\n\t/**\n\t * The action is enabled only if the editor is not in read only mode.\n\t * Defaults to false.\n\t */\n\twriteableEditor?: boolean;\n\t/**\n\t * The action is enabled only if the cursor position is over tokens of a certain kind.\n\t * Defaults to no tokens required.\n\t */\n\ttokensAtPosition?: string[];\n\t/**\n\t * The action is enabled only if the cursor position is over a word (i.e. not whitespace).\n\t * Defaults to false.\n\t */\n\twordAtPosition?: boolean;\n}\n\n/**\n * A (serializable) state of the cursors.\n */\nexport interface ICursorState {\n\tinSelectionMode:boolean;\n\tselectionStart:IPosition;\n\tposition:IPosition;\n}\n/**\n * A (serializable) state of the view.\n */\nexport interface IViewState {\n\tscrollTop: number;\n\tscrollTopWithoutViewZones: number;\n\tscrollLeft: number;\n}\n/**\n * A (serializable) state of the code editor.\n */\nexport interface ICodeEditorViewState extends IEditorViewState {\n\tcursorState:ICursorState[];\n\tviewState:IViewState;\n\tcontributionsState: {[id:string]:any};\n}\n\n/**\n * Type of hit element with the mouse in the editor.\n */\nexport enum MouseTargetType {\n\t/**\n\t * Mouse is on top of an unknown element.\n\t */\n\tUNKNOWN,\n\t/**\n\t * Mouse is on top of the textarea used for input.\n\t */\n\tTEXTAREA,\n\t/**\n\t * Mouse is on top of the glyph margin\n\t */\n\tGUTTER_GLYPH_MARGIN,\n\t/**\n\t * Mouse is on top of the line numbers\n\t */\n\tGUTTER_LINE_NUMBERS,\n\t/**\n\t * Mouse is on top of the line decorations\n\t */\n\tGUTTER_LINE_DECORATIONS,\n\t/**\n\t * Mouse is on top of the whitespace left in the gutter by a view zone.\n\t */\n\tGUTTER_VIEW_ZONE,\n\t/**\n\t * Mouse is on top of text in the content.\n\t */\n\tCONTENT_TEXT,\n\t/**\n\t * Mouse is on top of empty space in the content (e.g. after line text or below last line)\n\t */\n\tCONTENT_EMPTY,\n\t/**\n\t * Mouse is on top of a view zone in the content.\n\t */\n\tCONTENT_VIEW_ZONE,\n\t/**\n\t * Mouse is on top of a content widget.\n\t */\n\tCONTENT_WIDGET,\n\t/**\n\t * Mouse is on top of the decorations overview ruler.\n\t */\n\tOVERVIEW_RULER,\n\t/**\n\t * Mouse is on top of a scrollbar.\n\t */\n\tSCROLLBAR,\n\t/**\n\t * Mouse is on top of an overlay widget.\n\t */\n\tOVERLAY_WIDGET\n}\n\n/**\n * A model for the diff editor.\n */\nexport interface IDiffEditorModel extends IEditorModel {\n\t/**\n\t * Original model.\n\t */\n\toriginal: IModel;\n\t/**\n\t * Modified model.\n\t */\n\tmodified: IModel;\n}\n/**\n * (Serializable) View state for the diff editor.\n */\nexport interface IDiffEditorViewState extends IEditorViewState {\n\toriginal: ICodeEditorViewState;\n\tmodified: ICodeEditorViewState;\n}\n/**\n * A change\n */\nexport interface IChange {\n\toriginalStartLineNumber:number;\n\toriginalEndLineNumber:number;\n\tmodifiedStartLineNumber:number;\n\tmodifiedEndLineNumber:number;\n}\n/**\n * A character level change.\n */\nexport interface ICharChange extends IChange {\n\toriginalStartColumn:number;\n\toriginalEndColumn:number;\n\tmodifiedStartColumn:number;\n\tmodifiedEndColumn:number;\n}\n/**\n * A line change\n */\nexport interface ILineChange extends IChange {\n\tcharChanges:ICharChange[];\n}\n/**\n * Information about a line in the diff editor\n * @internal\n */\nexport interface IDiffLineInformation {\n\tequivalentLineNumber: number;\n}\n\n/**\n * A context key that is set when the editor's text has focus (cursor is blinking).\n */\nexport const KEYBINDING_CONTEXT_EDITOR_TEXT_FOCUS = 'editorTextFocus';\n\n/**\n * A context key that is set when the editor's text or an editor's widget has focus.\n */\nexport const KEYBINDING_CONTEXT_EDITOR_FOCUS = 'editorFocus';\n/**\n * @internal\n */\nexport const KEYBINDING_CONTEXT_EDITOR_TAB_MOVES_FOCUS = 'editorTabMovesFocus';\n/**\n * A context key that is set when the editor has multiple selections (multiple cursors).\n */\nexport const KEYBINDING_CONTEXT_EDITOR_HAS_MULTIPLE_SELECTIONS = 'editorHasMultipleSelections';\n/**\n * A context key that is set when the editor has a non-collapsed selection.\n */\nexport const KEYBINDING_CONTEXT_EDITOR_HAS_NON_EMPTY_SELECTION = 'editorHasSelection';\n/**\n * A context key that is set to the language associated with the model associated with the editor.\n */\nexport const KEYBINDING_CONTEXT_EDITOR_LANGUAGE_ID = 'editorLangId';\n/**\n * @internal\n */\nexport const SHOW_ACCESSIBILITY_HELP_ACTION_ID = 'editor.action.showAccessibilityHelp';\n\nexport class BareFontInfo {\n\t_bareFontInfoBrand: void;\n\n\tfontFamily: string;\n\tfontSize: number;\n\tlineHeight: number;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(opts: {\n\t\tfontFamily: string;\n\t\tfontSize: number;\n\t\tlineHeight: number;\n\t}) {\n\t\tthis.fontFamily = String(opts.fontFamily);\n\t\tthis.fontSize = opts.fontSize|0;\n\t\tthis.lineHeight = opts.lineHeight|0;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic getId(): string {\n\t\treturn this.fontFamily + '-' + this.fontSize + '-' + this.lineHeight;\n\t}\n}\n\nexport class FontInfo extends BareFontInfo {\n\t_editorStylingBrand: void;\n\n\ttypicalHalfwidthCharacterWidth:number;\n\ttypicalFullwidthCharacterWidth:number;\n\tspaceWidth:number;\n\tmaxDigitWidth: number;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(opts:{\n\t\tfontFamily: string;\n\t\tfontSize: number;\n\t\tlineHeight: number;\n\t\ttypicalHalfwidthCharacterWidth:number;\n\t\ttypicalFullwidthCharacterWidth:number;\n\t\tspaceWidth:number;\n\t\tmaxDigitWidth: number;\n\t}) {\n\t\tsuper(opts);\n\t\tthis.typicalHalfwidthCharacterWidth = opts.typicalHalfwidthCharacterWidth;\n\t\tthis.typicalFullwidthCharacterWidth = opts.typicalFullwidthCharacterWidth;\n\t\tthis.spaceWidth = opts.spaceWidth;\n\t\tthis.maxDigitWidth = opts.maxDigitWidth;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other:FontInfo): boolean {\n\t\treturn (\n\t\t\tthis.fontFamily === other.fontFamily\n\t\t\t&& this.fontSize === other.fontSize\n\t\t\t&& this.lineHeight === other.lineHeight\n\t\t\t&& this.typicalHalfwidthCharacterWidth === other.typicalHalfwidthCharacterWidth\n\t\t\t&& this.typicalFullwidthCharacterWidth === other.typicalFullwidthCharacterWidth\n\t\t\t&& this.spaceWidth === other.spaceWidth\n\t\t\t&& this.maxDigitWidth === other.maxDigitWidth\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic clone(): FontInfo {\n\t\treturn new FontInfo(this);\n\t}\n}\n\n/**\n * @internal\n */\nexport interface IConfiguration {\n\tonDidChange: Event<IConfigurationChangedEvent>;\n\n\teditor:InternalEditorOptions;\n\n\tsetLineCount(lineCount:number): void;\n}\n\n// --- view\n\n/**\n * @internal\n */\nexport interface IViewEventNames {\n\tModelFlushedEvent: string;\n\tLinesDeletedEvent: string;\n\tLinesInsertedEvent: string;\n\tLineChangedEvent: string;\n\tTokensChangedEvent: string;\n\tDecorationsChangedEvent: string;\n\tCursorPositionChangedEvent: string;\n\tCursorSelectionChangedEvent: string;\n\tRevealRangeEvent: string;\n\tLineMappingChangedEvent: string;\n}\n\n/**\n * @internal\n */\nexport var ViewEventNames = {\n\tModelFlushedEvent: 'modelFlushedEvent',\n\tLinesDeletedEvent: 'linesDeletedEvent',\n\tLinesInsertedEvent: 'linesInsertedEvent',\n\tLineChangedEvent: 'lineChangedEvent',\n\tTokensChangedEvent: 'tokensChangedEvent',\n\tDecorationsChangedEvent: 'decorationsChangedEvent',\n\tCursorPositionChangedEvent: 'cursorPositionChangedEvent',\n\tCursorSelectionChangedEvent: 'cursorSelectionChangedEvent',\n\tRevealRangeEvent: 'revealRangeEvent',\n\tLineMappingChangedEvent: 'lineMappingChangedEvent',\n\tScrollRequestEvent: 'scrollRequestEvent'\n};\n\nexport interface IScrollEvent {\n\tscrollTop: number;\n\tscrollLeft: number;\n\tscrollWidth: number;\n\tscrollHeight: number;\n\n\tscrollTopChanged: boolean;\n\tscrollLeftChanged: boolean;\n\tscrollWidthChanged: boolean;\n\tscrollHeightChanged: boolean;\n}\n\nexport interface INewScrollPosition {\n\tscrollLeft?: number;\n\tscrollTop?: number;\n}\n\n/**\n * @internal\n */\nexport interface IViewLinesDeletedEvent {\n\t/**\n\t * At what line the deletion began (inclusive).\n\t */\n\tfromLineNumber: number;\n\t/**\n\t * At what line the deletion stopped (inclusive).\n\t */\n\ttoLineNumber: number;\n}\n\n/**\n * @internal\n */\nexport interface IViewLinesInsertedEvent {\n\t/**\n\t * Before what line did the insertion begin\n\t */\n\tfromLineNumber: number;\n\t/**\n\t * `toLineNumber` - `fromLineNumber` + 1 denotes the number of lines that were inserted\n\t */\n\ttoLineNumber: number;\n}\n\n/**\n * @internal\n */\nexport interface IViewLineChangedEvent {\n\t/**\n\t * The line that has changed.\n\t */\n\tlineNumber: number;\n}\n\n/**\n * @internal\n */\nexport interface IViewTokensChangedEvent {\n\t/**\n\t * Start line number of range\n\t */\n\tfromLineNumber: number;\n\t/**\n\t * End line number of range\n\t */\n\ttoLineNumber: number;\n}\n\n/**\n * @internal\n */\nexport interface IViewDecorationsChangedEvent {\n\t/**\n\t * signals that at least one inline decoration has changed\n\t */\n\tinlineDecorationsChanged: boolean;\n}\n\n/**\n * @internal\n */\nexport interface IViewCursorPositionChangedEvent {\n\t/**\n\t * Primary cursor's position.\n\t */\n\tposition: Position;\n\t/**\n\t * Secondary cursors' position.\n\t */\n\tsecondaryPositions: Position[];\n\t/**\n\t * Is the primary cursor in the editable range?\n\t */\n\tisInEditableRange: boolean;\n}\n\n/**\n * @internal\n */\nexport interface IViewCursorSelectionChangedEvent {\n\t/**\n\t * The primary selection.\n\t */\n\tselection: Selection;\n\t/**\n\t * The secondary selections.\n\t */\n\tsecondarySelections: Selection[];\n}\n\n/**\n * @internal\n */\nexport interface IViewRevealRangeEvent {\n\t/**\n\t * Range to be reavealed.\n\t */\n\trange: Range;\n\n\tverticalType: VerticalRevealType;\n\t/**\n\t * If true: there should be a horizontal & vertical revealing\n\t * If false: there should be just a vertical revealing\n\t */\n\trevealHorizontal: boolean;\n}\n\n/**\n * @internal\n */\nexport interface IViewScrollRequestEvent {\n\tdeltaLines: number;\n}\n\n/**\n * @internal\n */\nexport interface IViewWhitespaceViewportData {\n\tid:number;\n\tafterLineNumber:number;\n\tverticalOffset:number;\n\theight:number;\n}\n\n/**\n * @internal\n */\nexport class Viewport {\n\t_viewportBrand: void;\n\n\ttop: number;\n\tleft: number;\n\twidth: number;\n\theight: number;\n\n\tconstructor(top:number, left:number, width:number, height:number) {\n\t\tthis.top = top|0;\n\t\tthis.left = left|0;\n\t\tthis.width = width|0;\n\t\tthis.height = height|0;\n\t}\n}\n\n/**\n * Description of an action contribution\n */\nexport interface IActionDescriptor {\n\t/**\n\t * An unique identifier of the contributed action.\n\t */\n\tid: string;\n\t/**\n\t * A label of the action that will be presented to the user.\n\t */\n\tlabel: string;\n\t/**\n\t * An array of keybindings for the action.\n\t */\n\tkeybindings?: number[];\n\t/**\n\t * The keybinding rule.\n\t */\n\tkeybindingContext?: string;\n\t/**\n\t * A set of enablement conditions.\n\t */\n\tenablement?: IActionEnablement;\n\t/**\n\t * Control if the action should show up in the context menu and where.\n\t * Built-in groups:\n\t *   1_goto/* => e.g. 1_goto/1_peekDefinition\n\t *   2_change/* => e.g. 2_change/2_format\n\t *   3_edit/* => e.g. 3_edit/1_copy\n\t *   4_tools/* => e.g. 4_tools/1_commands\n\t * You can also create your own group.\n\t * Defaults to null (don't show in context menu).\n\t */\n\tcontextMenuGroupId?: string;\n\t/**\n\t * Method that will be executed when the action is triggered.\n\t * @param editor The editor instance is passed in as a convinience\n\t */\n\trun:(editor:ICommonCodeEditor)=>TPromise<void>;\n}\n\n/**\n * Data associated with an editor action contribution\n * @internal\n */\nexport interface IEditorActionDescriptorData {\n\tid:string;\n\tlabel:string;\n\talias?:string;\n}\n\n/**\n * @internal\n */\nexport type IEditorActionContributionCtor = IConstructorSignature2<IEditorActionDescriptorData, ICommonCodeEditor, IEditorContribution>;\n\n/**\n * @internal\n */\nexport type ICommonEditorContributionCtor = IConstructorSignature1<ICommonCodeEditor, IEditorContribution>;\n\n/**\n * An editor contribution descriptor that will be used to construct editor contributions\n * @internal\n */\nexport interface ICommonEditorContributionDescriptor {\n\t/**\n\t * Create an instance of the contribution\n\t */\n\tcreateInstance(instantiationService:IInstantiationService, editor:ICommonCodeEditor): IEditorContribution;\n}\n\n/**\n * An editor.\n */\nexport interface IEditor {\n\t/**\n\t * @deprecated. Please use `onDidChangeModelContent` instead.\n\t * An event emitted when the content of the current model has changed.\n\t * @internal\n\t */\n\tonDidChangeModelRawContent(listener: (e:IModelContentChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the content of the current model has changed.\n\t */\n\tonDidChangeModelContent(listener: (e:IModelContentChangedEvent2)=>void): IDisposable;\n\t/**\n\t * An event emitted when the language of the current model has changed.\n\t */\n\tonDidChangeModelMode(listener: (e:IModelModeChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the options of the current model has changed.\n\t */\n\tonDidChangeModelOptions(listener: (e:IModelOptionsChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the configuration of the editor has changed. (e.g. `editor.updateOptions()`)\n\t */\n\tonDidChangeConfiguration(listener: (e:IConfigurationChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the cursor position has changed.\n\t */\n\tonDidChangeCursorPosition(listener: (e:ICursorPositionChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the cursor selection has changed.\n\t */\n\tonDidChangeCursorSelection(listener: (e:ICursorSelectionChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the editor has been disposed.\n\t */\n\tonDidDispose(listener: ()=>void): IDisposable;\n\n\t/**\n\t * Dispose the editor.\n\t */\n\tdispose(): void;\n\n\t/**\n\t * Get a unique id for this editor instance.\n\t */\n\tgetId(): string;\n\n\t/**\n\t * Get the editor type. Please see `EditorType`.\n\t * This is to avoid an instanceof check\n\t */\n\tgetEditorType(): string;\n\n\t/**\n\t * Destroy the editor.\n\t * @internal\n\t */\n\tdestroy(): void;\n\n\t/**\n\t * Update the editor's options after the editor has been created.\n\t */\n\tupdateOptions(newOptions: IEditorOptions): void;\n\n\t/**\n\t * Indicates that the editor becomes visible.\n\t * @internal\n\t */\n\tonVisible(): void;\n\n\t/**\n\t * Indicates that the editor becomes hidden.\n\t * @internal\n\t */\n\tonHide(): void;\n\n\t/**\n\t * Instructs the editor to remeasure its container. This method should\n\t * be called when the container of the editor gets resized.\n\t */\n\tlayout(dimension?:IDimension): void;\n\n\t/**\n\t * Brings browser focus to the editor text\n\t */\n\tfocus(): void;\n\n\t/**\n\t * Returns true if this editor has keyboard focus (e.g. cursor is blinking).\n\t */\n\tisFocused(): boolean;\n\n\t/**\n\t * Add a new action to this editor.\n\t */\n\taddAction(descriptor:IActionDescriptor): void;\n\n\t/**\n\t * Returns all actions associated with this editor.\n\t */\n\tgetActions(): IAction[];\n\n\t/**\n\t * Saves current view state of the editor in a serializable object.\n\t */\n\tsaveViewState(): IEditorViewState;\n\n\t/**\n\t * Restores the view state of the editor from a serializable object generated by `saveViewState`.\n\t */\n\trestoreViewState(state: IEditorViewState): void;\n\n\t/**\n\t * Given a position, returns a column number that takes tab-widths into account.\n\t */\n\tgetVisibleColumnFromPosition(position:IPosition): number;\n\n\t/**\n\t * Returns the primary position of the cursor.\n\t */\n\tgetPosition(): Position;\n\n\t/**\n\t * Set the primary position of the cursor. This will remove any secondary cursors.\n\t * @param position New primary cursor's position\n\t */\n\tsetPosition(position:IPosition): void;\n\n\t/**\n\t * Scroll vertically as necessary and reveal a line.\n\t */\n\trevealLine(lineNumber: number): void;\n\n\t/**\n\t * Scroll vertically as necessary and reveal a line centered vertically.\n\t */\n\trevealLineInCenter(lineNumber: number): void;\n\n\t/**\n\t * Scroll vertically as necessary and reveal a line centered vertically only if it lies outside the viewport.\n\t */\n\trevealLineInCenterIfOutsideViewport(lineNumber: number): void;\n\n\t/**\n\t * Scroll vertically or horizontally as necessary and reveal a position.\n\t */\n\trevealPosition(position: IPosition): void;\n\n\t/**\n\t * Scroll vertically or horizontally as necessary and reveal a position centered vertically.\n\t */\n\trevealPositionInCenter(position: IPosition): void;\n\n\t/**\n\t * Scroll vertically or horizontally as necessary and reveal a position centered vertically only if it lies outside the viewport.\n\t */\n\trevealPositionInCenterIfOutsideViewport(position: IPosition): void;\n\n\t/**\n\t * Returns the primary selection of the editor.\n\t */\n\tgetSelection(): Selection;\n\n\t/**\n\t * Returns all the selections of the editor.\n\t */\n\tgetSelections(): Selection[];\n\n\t/**\n\t * Set the primary selection of the editor. This will remove any secondary cursors.\n\t * @param selection The new selection\n\t */\n\tsetSelection(selection:IRange): void;\n\t/**\n\t * Set the primary selection of the editor. This will remove any secondary cursors.\n\t * @param selection The new selection\n\t */\n\tsetSelection(selection:Range): void;\n\t/**\n\t * Set the primary selection of the editor. This will remove any secondary cursors.\n\t * @param selection The new selection\n\t */\n\tsetSelection(selection:ISelection): void;\n\t/**\n\t * Set the primary selection of the editor. This will remove any secondary cursors.\n\t * @param selection The new selection\n\t */\n\tsetSelection(selection:Selection): void;\n\n\t/**\n\t * Set the selections for all the cursors of the editor.\n\t * Cursors will be removed or added, as necessary.\n\t */\n\tsetSelections(selections:ISelection[]): void;\n\n\t/**\n\t * Scroll vertically as necessary and reveal lines.\n\t */\n\trevealLines(startLineNumber: number, endLineNumber: number): void;\n\n\t/**\n\t * Scroll vertically as necessary and reveal lines centered vertically.\n\t */\n\trevealLinesInCenter(lineNumber: number, endLineNumber: number): void;\n\n\t/**\n\t * Scroll vertically as necessary and reveal lines centered vertically only if it lies outside the viewport.\n\t */\n\trevealLinesInCenterIfOutsideViewport(lineNumber: number, endLineNumber: number): void;\n\n\t/**\n\t * Scroll vertically or horizontally as necessary and reveal a range.\n\t */\n\trevealRange(range: IRange): void;\n\n\t/**\n\t * Scroll vertically or horizontally as necessary and reveal a range centered vertically.\n\t */\n\trevealRangeInCenter(range: IRange): void;\n\n\t/**\n\t * Scroll vertically or horizontally as necessary and reveal a range centered vertically only if it lies outside the viewport.\n\t */\n\trevealRangeInCenterIfOutsideViewport(range: IRange): void;\n\n\n\t/**\n\t * Directly trigger a handler or an editor action.\n\t * @param source The source of the call.\n\t * @param handlerId The id of the handler or the id of a contribution.\n\t * @param payload Extra data to be sent to the handler.\n\t */\n\ttrigger(source:string, handlerId:string, payload:any): void;\n\n\t/**\n\t * Gets the current model attached to this editor.\n\t */\n\tgetModel(): IEditorModel;\n\n\t/**\n\t * Sets the current model attached to this editor.\n\t * If the previous model was created by the editor via the value key in the options\n\t * literal object, it will be destroyed. Otherwise, if the previous model was set\n\t * via setModel, or the model key in the options literal object, the previous model\n\t * will not be destroyed.\n\t * It is safe to call setModel(null) to simply detach the current model from the editor.\n\t */\n\tsetModel(model:IEditorModel): void;\n\n\t/**\n\t * Change the decorations. All decorations added through this changeAccessor\n\t * will get the ownerId of the editor (meaning they will not show up in other\n\t * editors).\n\t * @see IModel.changeDecorations\n\t * @internal\n\t */\n\tchangeDecorations(callback: (changeAccessor:IModelDecorationsChangeAccessor)=>any): any;\n}\n\n/**\n * @internal\n */\nexport interface ICodeEditorState {\n\tvalidate(editor:ICommonCodeEditor): boolean;\n}\n\n/**\n * @internal\n */\nexport enum CodeEditorStateFlag {\n\tValue,\n\tSelection,\n\tPosition,\n\tScroll\n}\n\n/**\n * An editor contribution that gets created every time a new editor gets created and gets disposed when the editor gets disposed.\n */\nexport interface IEditorContribution {\n\t/**\n\t * Get a unique identifier for this contribution.\n\t */\n\tgetId(): string;\n\t/**\n\t * Dispose this contribution.\n\t */\n\tdispose(): void;\n\t/**\n\t * Store view state.\n\t */\n\tsaveViewState?(): any;\n\t/**\n\t * Restore view state.\n\t */\n\trestoreViewState?(state: any): void;\n}\n\n/**\n * @internal\n */\nexport interface IThemeDecorationRenderOptions {\n\tbackgroundColor?: string;\n\n\toutline?: string;\n\toutlineColor?: string;\n\toutlineStyle?: string;\n\toutlineWidth?: string;\n\n\tborder?:string;\n\tborderColor?: string;\n\tborderRadius?: string;\n\tborderSpacing?: string;\n\tborderStyle?: string;\n\tborderWidth?: string;\n\n\ttextDecoration?: string;\n\tcursor?: string;\n\tcolor?: string;\n\tletterSpacing?: string;\n\n\tgutterIconPath?: string;\n\tgutterIconSize?: string;\n\n\toverviewRulerColor?: string;\n\n\tbefore?: IContentDecorationRenderOptions;\n\tafter?: IContentDecorationRenderOptions;\n}\n\n/**\n * @internal\n */\nexport interface IContentDecorationRenderOptions {\n\tcontentText?: string;\n\tcontentIconPath?: string;\n\n\tborder?: string;\n\ttextDecoration?: string;\n\tcolor?: string;\n\tbackgroundColor?: string;\n\n\tmargin?: string;\n\twidth?: string;\n\theight?: string;\n}\n\n/**\n * @internal\n */\nexport interface IDecorationRenderOptions extends IThemeDecorationRenderOptions {\n\tisWholeLine?: boolean;\n\toverviewRulerLane?: OverviewRulerLane;\n\n\tlight?: IThemeDecorationRenderOptions;\n\tdark?: IThemeDecorationRenderOptions;\n}\n\n/**\n * @internal\n */\nexport interface IThemeDecorationInstanceRenderOptions {\n\tbefore?: IContentDecorationRenderOptions;\n\tafter?: IContentDecorationRenderOptions;\n}\n\n/**\n * @internal\n */\nexport interface IDecorationInstanceRenderOptions extends IThemeDecorationInstanceRenderOptions {\n\tlight?: IThemeDecorationInstanceRenderOptions;\n\tdark?: IThemeDecorationInstanceRenderOptions;\n}\n\n/**\n * @internal\n */\nexport interface IDecorationOptions {\n\trange: IRange;\n\thoverMessage?: MarkedString | MarkedString[];\n\trenderOptions? : IDecorationInstanceRenderOptions;\n}\n\n\nexport interface ICommonCodeEditor extends IEditor {\n\t/**\n\t * An event emitted when the model of this editor has changed (e.g. `editor.setModel()`).\n\t */\n\tonDidChangeModel(listener: (e:IModelChangedEvent)=>void): IDisposable;\n\t/**\n\t * @internal\n\t */\n\tonDidChangeModelModeSupport(listener: (e:IModeSupportChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the decorations of the current model have changed.\n\t */\n\tonDidChangeModelDecorations(listener: (e:IModelDecorationsChangedEvent)=>void): IDisposable;\n\t/**\n\t * An event emitted when the text inside this editor gained focus (i.e. cursor blinking).\n\t */\n\tonDidFocusEditorText(listener: ()=>void): IDisposable;\n\t/**\n\t * An event emitted when the text inside this editor lost focus.\n\t */\n\tonDidBlurEditorText(listener: ()=>void): IDisposable;\n\t/**\n\t * An event emitted when the text inside this editor or an editor widget gained focus.\n\t */\n\tonDidFocusEditor(listener: ()=>void): IDisposable;\n\t/**\n\t * An event emitted when the text inside this editor or an editor widget lost focus.\n\t */\n\tonDidBlurEditor(listener: ()=>void): IDisposable;\n\n\t/**\n\t * Returns true if this editor or one of its widgets has keyboard focus.\n\t */\n\thasWidgetFocus(): boolean;\n\n\t/**\n\t * Get a contribution of this editor.\n\t * @id Unique identifier of the contribution.\n\t * @return The contribution or null if contribution not found.\n\t */\n\tgetContribution(id: string): IEditorContribution;\n\n\t/**\n\t * @internal\n\t */\n\tcaptureState(...flags:CodeEditorStateFlag[]): ICodeEditorState;\n\n\t/**\n\t * Type the getModel() of IEditor.\n\t */\n\tgetModel(): IModel;\n\n\t/**\n\t * Returns the current editor's configuration\n\t */\n\tgetConfiguration(): InternalEditorOptions;\n\n\t/**\n\t * Returns the 'raw' editor's configuration, as it was applied over the defaults, but without any computed members.\n\t * @internal\n\t */\n\tgetRawConfiguration(): IEditorOptions;\n\n\t/**\n\t * Get value of the current model attached to this editor.\n\t * @see IModel.getValue\n\t */\n\tgetValue(options?: { preserveBOM: boolean; lineEnding: string; }): string;\n\n\t/**\n\t * Set the value of the current model attached to this editor.\n\t * @see IModel.setValue\n\t */\n\tsetValue(newValue: string): void;\n\n\t/**\n\t * Get the scrollWidth of the editor's viewport.\n\t */\n\tgetScrollWidth(): number;\n\t/**\n\t * Get the scrollLeft of the editor's viewport.\n\t */\n\tgetScrollLeft(): number;\n\n\t/**\n\t * Get the scrollHeight of the editor's viewport.\n\t */\n\tgetScrollHeight(): number;\n\t/**\n\t * Get the scrollTop of the editor's viewport.\n\t */\n\tgetScrollTop(): number;\n\n\t/**\n\t * Change the scrollLeft of the editor's viewport.\n\t */\n\tsetScrollLeft(newScrollLeft: number): void;\n\t/**\n\t * Change the scrollTop of the editor's viewport.\n\t */\n\tsetScrollTop(newScrollTop: number): void;\n\t/**\n\t * Change the scroll position of the editor's viewport.\n\t */\n\tsetScrollPosition(position: INewScrollPosition): void;\n\n\t/**\n\t * Get an action that is a contribution to this editor.\n\t * @id Unique identifier of the contribution.\n\t * @return The action or null if action not found.\n\t */\n\tgetAction(id: string): IAction;\n\n\t/**\n\t * Execute a command on the editor.\n\t * @param source The source of the call.\n\t * @param command The command to execute\n\t */\n\texecuteCommand(source: string, command: ICommand): void;\n\n\t/**\n\t * Execute a command on the editor.\n\t * @param source The source of the call.\n\t * @param command The command to execute\n\t */\n\texecuteEdits(source: string, edits: IIdentifiedSingleEditOperation[]): boolean;\n\n\t/**\n\t * Execute multiple (concommitent) commands on the editor.\n\t * @param source The source of the call.\n\t * @param command The commands to execute\n\t */\n\texecuteCommands(source: string, commands: ICommand[]): void;\n\n\t/**\n\t * Get all the decorations on a line (filtering out decorations from other editors).\n\t */\n\tgetLineDecorations(lineNumber: number): IModelDecoration[];\n\n\t/**\n\t * All decorations added through this call will get the ownerId of this editor.\n\t * @see IModel.deltaDecorations\n\t */\n\tdeltaDecorations(oldDecorations: string[], newDecorations: IModelDeltaDecoration[]): string[];\n\n\t/**\n\t * @internal\n\t */\n\tsetDecorations(decorationTypeKey: string, ranges: IDecorationOptions[]): void;\n\n\t/**\n\t * @internal\n\t */\n\tremoveDecorations(decorationTypeKey:string): void;\n\n\t/**\n\t * Get the layout info for the editor.\n\t */\n\tgetLayoutInfo(): EditorLayoutInfo;\n\n\t/**\n\t * Prevent the editor from sending a widgetFocusLost event,\n\t * set it in a state where it believes that focus is in one of its widgets.\n\t * Use this method with care and always add a matching `endForcedWidgetFocus`\n\t * @internal\n\t */\n\tbeginForcedWidgetFocus(): void;\n\n\t/**\n\t * End the preventing of sending a widgetFocusLost event.\n\t * @internal\n\t */\n\tendForcedWidgetFocus(): void;\n\n\t/**\n\t * This listener is notified when a keypress produces a visible character.\n\t * The callback should not do operations on the view, as the view might not be updated to reflect previous typed characters.\n\t * @param character Character to listen to.\n\t * @param callback Function to call when `character` is typed.\n\t * @internal\n\t */\n\taddTypingListener(character: string, callback: () => void): IDisposable;\n\n}\n\nexport interface ICommonDiffEditor extends IEditor {\n\t/**\n\t * An event emitted when the diff information computed by this diff editor has been updated.\n\t */\n\tonDidUpdateDiff(listener: ()=>void): IDisposable;\n\n\t/**\n\t * Type the getModel() of IEditor.\n\t */\n\tgetModel(): IDiffEditorModel;\n\n\t/**\n\t * Get the `original` editor.\n\t */\n\tgetOriginalEditor(): ICommonCodeEditor;\n\n\t/**\n\t * Get the `modified` editor.\n\t */\n\tgetModifiedEditor(): ICommonCodeEditor;\n\n\t/**\n\t * Get the computed diff information.\n\t */\n\tgetLineChanges(): ILineChange[];\n\n\t/**\n\t * Get information based on computed diff about a line number from the original model.\n\t * If the diff computation is not finished or the model is missing, will return null.\n\t * @internal\n\t */\n\tgetDiffLineInformationForOriginal(lineNumber:number): IDiffLineInformation;\n\n\t/**\n\t * Get information based on computed diff about a line number from the modified model.\n\t * If the diff computation is not finished or the model is missing, will return null.\n\t * @internal\n\t */\n\tgetDiffLineInformationForModified(lineNumber:number): IDiffLineInformation;\n\n\t/**\n\t * @see ICodeEditor.getValue\n\t */\n\tgetValue(options?:{ preserveBOM:boolean; lineEnding:string; }): string;\n\n\t/**\n\t * Returns whether the diff editor is ignoring trim whitespace or not.\n\t * @internal\n\t */\n\tignoreTrimWhitespace: boolean;\n\n\t/**\n\t * Returns whether the diff editor is rendering side by side or not.\n\t * @internal\n\t */\n\trenderSideBySide: boolean;\n}\n\n/**\n * The type of the `IEditor`.\n */\nexport var EditorType = {\n\tICodeEditor: 'vs.editor.ICodeEditor',\n\tIDiffEditor: 'vs.editor.IDiffEditor'\n};\n\n/**\n * @internal\n */\nexport var ClassName = {\n\tEditorWarningDecoration: 'greensquiggly',\n\tEditorErrorDecoration: 'redsquiggly'\n};\n\n/**\n * @internal\n */\nexport var EventType = {\n\tDisposed: 'disposed',\n\n\tConfigurationChanged: 'configurationChanged',\n\n\tModelDispose: 'modelDispose',\n\n\tModelChanged: 'modelChanged',\n\n\tModelTokensChanged: 'modelTokensChanged',\n\tModelModeChanged: 'modelsModeChanged',\n\tModelModeSupportChanged: 'modelsModeSupportChanged',\n\tModelOptionsChanged: 'modelOptionsChanged',\n\tModelRawContentChanged: 'contentChanged',\n\tModelContentChanged2: 'contentChanged2',\n\tModelRawContentChangedFlush: 'flush',\n\tModelRawContentChangedLinesDeleted: 'linesDeleted',\n\tModelRawContentChangedLinesInserted: 'linesInserted',\n\tModelRawContentChangedLineChanged: 'lineChanged',\n\n\tEditorTextBlur: 'blur',\n\tEditorTextFocus: 'focus',\n\tEditorFocus: 'widgetFocus',\n\tEditorBlur: 'widgetBlur',\n\n\tModelDecorationsChanged: 'decorationsChanged',\n\n\tCursorPositionChanged: 'positionChanged',\n\tCursorSelectionChanged: 'selectionChanged',\n\tCursorRevealRange: 'revealRange',\n\tCursorScrollRequest: 'scrollRequest',\n\n\tViewFocusGained: 'focusGained',\n\tViewFocusLost: 'focusLost',\n\tViewFocusChanged: 'focusChanged',\n\tViewScrollChanged: 'scrollChanged',\n\tViewZonesChanged: 'zonesChanged',\n\n\tViewLayoutChanged: 'viewLayoutChanged',\n\n\tContextMenu: 'contextMenu',\n\tMouseDown: 'mousedown',\n\tMouseUp: 'mouseup',\n\tMouseMove: 'mousemove',\n\tMouseLeave: 'mouseleave',\n\tKeyDown: 'keydown',\n\tKeyUp: 'keyup',\n\n\tEditorLayout: 'editorLayout',\n\n\tDiffUpdated: 'diffUpdated'\n};\n\n/**\n * Built-in commands.\n */\nexport var Handler = {\n\tExecuteCommand:\t\t\t\t'executeCommand',\n\tExecuteCommands:\t\t\t'executeCommands',\n\n\tCursorLeft:\t\t\t\t\t'cursorLeft',\n\tCursorLeftSelect:\t\t\t'cursorLeftSelect',\n\n\tCursorWordLeft:\t\t\t\t'cursorWordLeft',\n\tCursorWordStartLeft:\t\t'cursorWordStartLeft',\n\tCursorWordEndLeft:\t\t\t'cursorWordEndLeft',\n\n\tCursorWordLeftSelect:\t\t'cursorWordLeftSelect',\n\tCursorWordStartLeftSelect:\t'cursorWordStartLeftSelect',\n\tCursorWordEndLeftSelect:\t'cursorWordEndLeftSelect',\n\n\tCursorRight:\t\t\t\t'cursorRight',\n\tCursorRightSelect:\t\t\t'cursorRightSelect',\n\n\tCursorWordRight:\t\t\t'cursorWordRight',\n\tCursorWordStartRight:\t\t'cursorWordStartRight',\n\tCursorWordEndRight:\t\t\t'cursorWordEndRight',\n\n\tCursorWordRightSelect:\t\t'cursorWordRightSelect',\n\tCursorWordStartRightSelect:\t'cursorWordStartRightSelect',\n\tCursorWordEndRightSelect:\t'cursorWordEndRightSelect',\n\n\tCursorUp:\t\t\t\t\t'cursorUp',\n\tCursorUpSelect:\t\t\t\t'cursorUpSelect',\n\tCursorDown:\t\t\t\t\t'cursorDown',\n\tCursorDownSelect:\t\t\t'cursorDownSelect',\n\n\tCursorPageUp:\t\t\t\t'cursorPageUp',\n\tCursorPageUpSelect:\t\t\t'cursorPageUpSelect',\n\tCursorPageDown:\t\t\t\t'cursorPageDown',\n\tCursorPageDownSelect:\t\t'cursorPageDownSelect',\n\n\tCursorHome:\t\t\t\t\t'cursorHome',\n\tCursorHomeSelect:\t\t\t'cursorHomeSelect',\n\n\tCursorEnd:\t\t\t\t\t'cursorEnd',\n\tCursorEndSelect:\t\t\t'cursorEndSelect',\n\n\tExpandLineSelection:\t\t'expandLineSelection',\n\n\tCursorTop:\t\t\t\t\t'cursorTop',\n\tCursorTopSelect:\t\t\t'cursorTopSelect',\n\tCursorBottom:\t\t\t\t'cursorBottom',\n\tCursorBottomSelect:\t\t\t'cursorBottomSelect',\n\n\tCursorColumnSelectLeft:\t\t'cursorColumnSelectLeft',\n\tCursorColumnSelectRight:\t'cursorColumnSelectRight',\n\tCursorColumnSelectUp:\t\t'cursorColumnSelectUp',\n\tCursorColumnSelectPageUp:\t'cursorColumnSelectPageUp',\n\tCursorColumnSelectDown:\t\t'cursorColumnSelectDown',\n\tCursorColumnSelectPageDown:\t'cursorColumnSelectPageDown',\n\n\tAddCursorDown:\t\t\t\t'addCursorDown',\n\tAddCursorUp:\t\t\t\t'addCursorUp',\n\tCursorUndo:\t\t\t\t\t'cursorUndo',\n\tMoveTo:\t\t\t\t\t\t'moveTo',\n\tMoveToSelect:\t\t\t\t'moveToSelect',\n\tColumnSelect:\t\t\t\t'columnSelect',\n\tCreateCursor:\t\t\t\t'createCursor',\n\tLastCursorMoveToSelect:\t\t'lastCursorMoveToSelect',\n\n\tJumpToBracket:\t\t\t\t'jumpToBracket',\n\n\tType:\t\t\t\t\t\t'type',\n\tReplacePreviousChar:\t\t'replacePreviousChar',\n\tPaste:\t\t\t\t\t\t'paste',\n\n\tTab:\t\t\t\t\t\t'tab',\n\tIndent:\t\t\t\t\t\t'indent',\n\tOutdent:\t\t\t\t\t'outdent',\n\n\tDeleteLeft:\t\t\t\t\t'deleteLeft',\n\tDeleteRight:\t\t\t\t'deleteRight',\n\n\tDeleteWordLeft:\t\t\t\t'deleteWordLeft',\n\tDeleteWordStartLeft:\t\t'deleteWordStartLeft',\n\tDeleteWordEndLeft:\t\t\t'deleteWordEndLeft',\n\n\tDeleteWordRight:\t\t\t'deleteWordRight',\n\tDeleteWordStartRight:\t\t'deleteWordStartRight',\n\tDeleteWordEndRight:\t\t\t'deleteWordEndRight',\n\n\tDeleteAllLeft:\t\t\t\t'deleteAllLeft',\n\tDeleteAllRight:\t\t\t\t'deleteAllRight',\n\n\tRemoveSecondaryCursors: \t'removeSecondaryCursors',\n\tCancelSelection:\t\t\t'cancelSelection',\n\n\tCut:\t\t\t\t\t\t'cut',\n\n\tUndo:\t\t\t\t\t\t'undo',\n\tRedo:\t\t\t\t\t\t'redo',\n\n\tWordSelect:\t\t\t\t\t'wordSelect',\n\tWordSelectDrag:\t\t\t\t'wordSelectDrag',\n\tLastCursorWordSelect: \t\t'lastCursorWordSelect',\n\n\tLineSelect:\t\t\t\t\t'lineSelect',\n\tLineSelectDrag:\t\t\t\t'lineSelectDrag',\n\tLastCursorLineSelect:\t\t'lastCursorLineSelect',\n\tLastCursorLineSelectDrag:\t'lastCursorLineSelectDrag',\n\tLineInsertBefore:\t\t\t'lineInsertBefore',\n\tLineInsertAfter:\t\t\t'lineInsertAfter',\n\tLineBreakInsert:\t\t\t'lineBreakInsert',\n\n\tSelectAll:\t\t\t\t\t'selectAll',\n\n\tScrollLineUp:\t\t\t\t'scrollLineUp',\n\tScrollLineDown:\t\t\t\t'scrollLineDown',\n\n\tScrollPageUp:\t\t\t\t'scrollPageUp',\n\tScrollPageDown:\t\t\t\t'scrollPageDown'\n};\n\n/**\n * The style in which the editor's cursor should be rendered.\n */\nexport enum TextEditorCursorStyle {\n\t/**\n\t * As a vertical line (sitting between two characters).\n\t */\n\tLine = 1,\n\t/**\n\t * As a block (sitting on top of a character).\n\t */\n\tBlock = 2,\n\t/**\n\t * As a horizontal line (sitting under a character).\n\t */\n\tUnderline = 3\n}\n\n/**\n * @internal\n */\nexport function cursorStyleToString(cursorStyle:TextEditorCursorStyle): string {\n\tif (cursorStyle === TextEditorCursorStyle.Line) {\n\t\treturn 'line';\n\t} else if (cursorStyle === TextEditorCursorStyle.Block) {\n\t\treturn 'block';\n\t} else if (cursorStyle === TextEditorCursorStyle.Underline) {\n\t\treturn 'underline';\n\t} else {\n\t\tthrow new Error('cursorStyleToString: Unknown cursorStyle');\n\t}\n}\n\n/**\n * @internal\n */\nexport class ColorZone {\n\t_colorZoneBrand: void;\n\n\tfrom: number;\n\tto: number;\n\tcolorId: number;\n\tposition: OverviewRulerLane;\n\n\tconstructor(from:number, to:number, colorId:number, position: OverviewRulerLane) {\n\t\tthis.from = from|0;\n\t\tthis.to = to|0;\n\t\tthis.colorId = colorId|0;\n\t\tthis.position = position|0;\n\t}\n}\n\n/**\n * A zone in the overview ruler\n * @internal\n */\nexport class OverviewRulerZone {\n\t_overviewRulerZoneBrand: void;\n\n\tstartLineNumber: number;\n\tendLineNumber: number;\n\tposition: OverviewRulerLane;\n\tforceHeight: number;\n\n\tprivate _color: string;\n\tprivate _darkColor: string;\n\n\tprivate _colorZones: ColorZone[];\n\n\tconstructor(\n\t\tstartLineNumber: number, endLineNumber: number,\n\t\tposition: OverviewRulerLane,\n\t\tforceHeight: number,\n\t\tcolor: string, darkColor: string\n\t) {\n\t\tthis.startLineNumber = startLineNumber;\n\t\tthis.endLineNumber = endLineNumber;\n\t\tthis.position = position;\n\t\tthis.forceHeight = forceHeight;\n\t\tthis._color = color;\n\t\tthis._darkColor = darkColor;\n\t\tthis._colorZones = null;\n\t}\n\n\tpublic getColor(useDarkColor:boolean): string {\n\t\tif (useDarkColor) {\n\t\t\treturn this._darkColor;\n\t\t}\n\t\treturn this._color;\n\t}\n\n\tpublic equals(other:OverviewRulerZone): boolean {\n\t\treturn (\n\t\t\tthis.startLineNumber === other.startLineNumber\n\t\t\t&& this.endLineNumber === other.endLineNumber\n\t\t\t&& this.position === other.position\n\t\t\t&& this.forceHeight === other.forceHeight\n\t\t\t&& this._color === other._color\n\t\t\t&& this._darkColor === other._darkColor\n\t\t);\n\t}\n\n\tpublic compareTo(other:OverviewRulerZone): number {\n\t\tif (this.startLineNumber === other.startLineNumber) {\n\t\t\tif (this.endLineNumber === other.endLineNumber) {\n\t\t\t\tif (this.forceHeight === other.forceHeight) {\n\t\t\t\t\tif (this.position === other.position) {\n\t\t\t\t\t\tif (this._darkColor === other._darkColor) {\n\t\t\t\t\t\t\tif (this._color === other._color) {\n\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn this._color < other._color ? -1 : 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn this._darkColor < other._darkColor ? -1 : 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn this.position - other.position;\n\t\t\t\t}\n\t\t\t\treturn this.forceHeight - other.forceHeight;\n\t\t\t}\n\t\t\treturn this.endLineNumber - other.endLineNumber;\n\t\t}\n\t\treturn this.startLineNumber - other.startLineNumber;\n\t}\n\n\tpublic setColorZones(colorZones:ColorZone[]): void {\n\t\tthis._colorZones = colorZones;\n\t}\n\n\tpublic getColorZones(): ColorZone[] {\n\t\treturn this._colorZones;\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nconst __space = ' '.charCodeAt(0);\nconst __tab = '\\t'.charCodeAt(0);\n\n/**\n * Compute the diff in spaces between two line's indentation.\n */\nfunction spacesDiff(a:string, aLength:number, b:string, bLength:number): number {\n\n\t// This can go both ways (e.g.):\n\t//  - a: \"\\t\"\n\t//  - b: \"\\t    \"\n\t//  => This should count 1 tab and 4 spaces\n\n\tlet i:number;\n\n\tfor (i = 0; i < aLength && i < bLength; i++) {\n\t\tlet aCharCode = a.charCodeAt(i);\n\t\tlet bCharCode = b.charCodeAt(i);\n\n\t\tif (aCharCode !== bCharCode) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tlet aSpacesCnt = 0, aTabsCount = 0;\n\tfor (let j = i; j < aLength; j++) {\n\t\tlet aCharCode = a.charCodeAt(j);\n\t\tif (aCharCode === __space) {\n\t\t\taSpacesCnt++;\n\t\t} else {\n\t\t\taTabsCount++;\n\t\t}\n\t}\n\n\tlet bSpacesCnt = 0, bTabsCount = 0;\n\tfor (let j = i; j < bLength; j++) {\n\t\tlet bCharCode = b.charCodeAt(j);\n\t\tif (bCharCode === __space) {\n\t\t\tbSpacesCnt++;\n\t\t} else {\n\t\t\tbTabsCount++;\n\t\t}\n\t}\n\n\tif (aSpacesCnt > 0 && aTabsCount > 0) {\n\t\treturn 0;\n\t}\n\tif (bSpacesCnt > 0 && bTabsCount > 0) {\n\t\treturn 0;\n\t}\n\n\tlet tabsDiff = Math.abs(aTabsCount - bTabsCount);\n\tlet spacesDiff = Math.abs(aSpacesCnt - bSpacesCnt);\n\n\tif (tabsDiff === 0) {\n\t\treturn spacesDiff;\n\t}\n\tif (spacesDiff % tabsDiff === 0) {\n\t\treturn spacesDiff / tabsDiff;\n\t}\n\treturn 0;\n}\n\n/**\n * Result for a guessIndentation\n */\nexport interface IGuessedIndentation {\n\t/**\n\t * If indentation is based on spaces (`insertSpaces` = true), then what is the number of spaces that make an indent?\n\t */\n\ttabSize: number;\n\t/**\n\t * Is indentation based on spaces?\n\t */\n\tinsertSpaces: boolean;\n}\n\nexport function guessIndentation(lines:string[], defaultTabSize:number, defaultInsertSpaces:boolean): IGuessedIndentation {\n\tlet linesIndentedWithTabsCount = 0;\t\t\t\t// number of lines that contain at least one tab in indentation\n\tlet linesIndentedWithSpacesCount = 0;\t\t\t// number of lines that contain only spaces in indentation\n\n\tlet previousLineText = '';\t\t\t\t\t\t// content of latest line that contained non-whitespace chars\n\tlet previousLineIndentation = 0;\t\t\t\t// index at which latest line contained the first non-whitespace char\n\n\tconst ALLOWED_TAB_SIZE_GUESSES = [2, 4, 6, 8];\t// limit guesses for `tabSize` to 2, 4, 6 or 8.\n\tconst MAX_ALLOWED_TAB_SIZE_GUESS = 8;\t\t\t// max(2,4,6,8) = 8\n\n\tlet spacesDiffCount = [0,0,0,0,0,0,0,0,0];\t\t// `tabSize` scores\n\n\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\tlet currentLineText = lines[i];\n\n\t\tlet currentLineHasContent = false;\t\t\t// does `currentLineText` contain non-whitespace chars\n\t\tlet currentLineIndentation = 0;\t\t\t\t// index at which `currentLineText` contains the first non-whitespace char\n\t\tlet currentLineSpacesCount = 0;\t\t\t\t// count of spaces found in `currentLineText` indentation\n\t\tlet currentLineTabsCount = 0;\t\t\t\t// count of tabs found in `currentLineText` indentation\n\t\tfor (let j = 0, lenJ = currentLineText.length; j < lenJ; j++) {\n\t\t\tlet charCode = currentLineText.charCodeAt(j);\n\n\t\t\tif (charCode === __tab) {\n\t\t\t\tcurrentLineTabsCount++;\n\t\t\t} else if (charCode === __space) {\n\t\t\t\tcurrentLineSpacesCount++;\n\t\t\t} else {\n\t\t\t\t// Hit non whitespace character on this line\n\t\t\t\tcurrentLineHasContent = true;\n\t\t\t\tcurrentLineIndentation = j;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Ignore empty or only whitespace lines\n\t\tif (!currentLineHasContent) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (currentLineTabsCount > 0) {\n\t\t\tlinesIndentedWithTabsCount++;\n\t\t} else if (currentLineSpacesCount > 1) {\n\t\t\tlinesIndentedWithSpacesCount++;\n\t\t}\n\n\t\tlet currentSpacesDiff = spacesDiff(previousLineText, previousLineIndentation, currentLineText, currentLineIndentation);\n\t\tif (currentSpacesDiff <= MAX_ALLOWED_TAB_SIZE_GUESS) {\n\t\t\tspacesDiffCount[currentSpacesDiff]++;\n\t\t}\n\n\t\tpreviousLineText = currentLineText;\n\t\tpreviousLineIndentation = currentLineIndentation;\n\t}\n\n\t// Take into account the last line as well\n\tlet deltaSpacesCount = spacesDiff(previousLineText, previousLineIndentation, '', 0);\n\tif (deltaSpacesCount <= MAX_ALLOWED_TAB_SIZE_GUESS) {\n\t\tspacesDiffCount[deltaSpacesCount]++;\n\t}\n\n\tlet insertSpaces = defaultInsertSpaces;\n\tif (linesIndentedWithTabsCount !== linesIndentedWithSpacesCount) {\n\t\tinsertSpaces = (linesIndentedWithTabsCount < linesIndentedWithSpacesCount);\n\t}\n\n\tlet tabSize = defaultTabSize;\n\tlet tabSizeScore = (insertSpaces ? 0 : 0.1 * lines.length);\n\n\t// console.log(\"score threshold: \" + tabSizeScore);\n\n\tALLOWED_TAB_SIZE_GUESSES.forEach((possibleTabSize) => {\n\t\tlet possibleTabSizeScore = spacesDiffCount[possibleTabSize];\n\t\tif (possibleTabSizeScore > tabSizeScore) {\n\t\t\ttabSizeScore = possibleTabSizeScore;\n\t\t\ttabSize = possibleTabSize;\n\t\t}\n\t});\n\n\n\t// console.log('--------------------------');\n\t// console.log('linesIndentedWithTabsCount: ' + linesIndentedWithTabsCount + ', linesIndentedWithSpacesCount: ' + linesIndentedWithSpacesCount);\n\t// console.log('spacesDiffCount: ' + spacesDiffCount);\n\t// console.log('tabSize: ' + tabSize + ', tabSizeScore: ' + tabSizeScore);\n\n\treturn {\n\t\tinsertSpaces: insertSpaces,\n\t\ttabSize: tabSize\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {Arrays} from 'vs/editor/common/core/arrays';\n\n/**\n * A token on a line.\n */\nexport class LineToken {\n\tpublic _lineTokenBrand: void;\n\n\tpublic startIndex:number;\n\tpublic type:string;\n\n\tconstructor(startIndex:number, type:string) {\n\t\tthis.startIndex = startIndex|0;// @perf\n\t\tthis.type = type;\n\t}\n\n\tpublic equals(other:LineToken): boolean {\n\t\treturn (\n\t\t\tthis.startIndex === other.startIndex\n\t\t\t&& this.type === other.type\n\t\t);\n\t}\n\n\tpublic static findIndexInSegmentsArray(arr:LineToken[], desiredIndex: number): number {\n\t\treturn Arrays.findIndexInSegmentsArray(arr, desiredIndex);\n\t}\n\n\tpublic static equalsArray(a:LineToken[], b:LineToken[]): boolean {\n\t\tlet aLen = a.length;\n\t\tlet bLen = b.length;\n\t\tif (aLen !== bLen) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < aLen; i++) {\n\t\t\tif (!a[i].equals(b[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as editorCommon from 'vs/editor/common/editorCommon';\n\nexport class TokenIterator implements editorCommon.ITokenIterator {\n\n\tprivate _model:editorCommon.ITokenizedModel;\n\tprivate _currentLineNumber:number;\n\tprivate _currentTokenIndex:number;\n\tprivate _currentLineTokens:editorCommon.ILineTokens;\n\tprivate _next:editorCommon.ITokenInfo;\n\tprivate _prev:editorCommon.ITokenInfo;\n\n\tconstructor(model:editorCommon.ITokenizedModel, position:editorCommon.IPosition) {\n\t\tthis._model = model;\n\t\tthis._currentLineNumber = position.lineNumber;\n\t\tthis._currentTokenIndex = 0;\n\t\tthis._readLineTokens(this._currentLineNumber);\n\t\tthis._next = null;\n\t\tthis._prev = null;\n\n\t\t// start with a position to next/prev run\n\t\tvar columnIndex = position.column - 1, tokenEndIndex = Number.MAX_VALUE;\n\n\t\tfor (var i = this._currentLineTokens.getTokenCount() - 1; i >= 0; i--) {\n\t\t\tlet tokenStartIndex = this._currentLineTokens.getTokenStartIndex(i);\n\n\t\t\tif (tokenStartIndex <= columnIndex && columnIndex <= tokenEndIndex) {\n\n\t\t\t\tthis._currentTokenIndex = i;\n\t\t\t\tthis._next = this._current();\n\t\t\t\tthis._prev = this._current();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\ttokenEndIndex = tokenStartIndex;\n\t\t}\n\t}\n\n\tprivate _readLineTokens(lineNumber:number): void {\n\t\tthis._currentLineTokens = this._model.getLineTokens(lineNumber, false);\n\t}\n\n\tprivate _advanceNext() {\n\t\tthis._prev = this._next;\n\t\tthis._next = null;\n\t\tif (this._currentTokenIndex + 1 < this._currentLineTokens.getTokenCount()) {\n\t\t\t// There are still tokens on current line\n\t\t\tthis._currentTokenIndex++;\n\t\t\tthis._next = this._current();\n\n\t\t} else {\n\t\t\t// find the next line with tokens\n\t\t\twhile (this._currentLineNumber + 1 <= this._model.getLineCount()) {\n\t\t\t\tthis._currentLineNumber++;\n\t\t\t\tthis._readLineTokens(this._currentLineNumber);\n\t\t\t\tif (this._currentLineTokens.getTokenCount() > 0) {\n\t\t\t\t\tthis._currentTokenIndex = 0;\n\t\t\t\t\tthis._next = this._current();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._next === null) {\n\t\t\t\t// prepare of a previous run\n\t\t\t\tthis._readLineTokens(this._currentLineNumber);\n\t\t\t\tthis._currentTokenIndex = this._currentLineTokens.getTokenCount();\n\t\t\t\tthis._advancePrev();\n\t\t\t\tthis._next = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _advancePrev() {\n\t\tthis._next = this._prev;\n\t\tthis._prev = null;\n\t\tif (this._currentTokenIndex > 0) {\n\t\t\t// There are still tokens on current line\n\t\t\tthis._currentTokenIndex--;\n\t\t\tthis._prev = this._current();\n\n\t\t} else {\n\t\t\t// find previous line with tokens\n\t\t\twhile (this._currentLineNumber > 1) {\n\t\t\t\tthis._currentLineNumber--;\n\t\t\t\tthis._readLineTokens(this._currentLineNumber);\n\t\t\t\tif (this._currentLineTokens.getTokenCount() > 0) {\n\t\t\t\t\tthis._currentTokenIndex = this._currentLineTokens.getTokenCount() - 1;\n\t\t\t\t\tthis._prev = this._current();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _current(): editorCommon.ITokenInfo {\n\t\tlet startIndex = this._currentLineTokens.getTokenStartIndex(this._currentTokenIndex);\n\t\tlet type = this._currentLineTokens.getTokenType(this._currentTokenIndex);\n\t\tlet endIndex = this._currentLineTokens.getTokenEndIndex(this._currentTokenIndex, this._model.getLineContent(this._currentLineNumber).length);\n\n\t\treturn {\n\t\t\ttoken: {\n\t\t\t\tstartIndex: startIndex,\n\t\t\t\ttype: type\n\t\t\t},\n\t\t\tlineNumber: this._currentLineNumber,\n\t\t\tstartColumn: startIndex + 1,\n\t\t\tendColumn: endIndex + 1\n\t\t};\n\t}\n\n\tpublic hasNext(): boolean {\n\t\treturn this._next !== null;\n\t}\n\n\tpublic next(): editorCommon.ITokenInfo {\n\t\tvar result = this._next;\n\t\tthis._advanceNext();\n\t\treturn result;\n\t}\n\n\tpublic hasPrev(): boolean {\n\t\treturn this._prev !== null;\n\t}\n\n\tpublic prev(): editorCommon.ITokenInfo {\n\t\tvar result = this._prev;\n\t\tthis._advancePrev();\n\t\treturn result;\n\t}\n\n\tpublic _invalidate() {\n\t\t// replace all public functions with errors\n\t\tvar errorFn = function(): any {\n\t\t\tthrow new Error('iteration isn\\'t valid anymore');\n\t\t};\n\t\tthis.hasNext = errorFn;\n\t\tthis.next = errorFn;\n\t\tthis.hasPrev = errorFn;\n\t\tthis.prev = errorFn;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IWordAtPosition} from 'vs/editor/common/editorCommon';\n\nexport const USUAL_WORD_SEPARATORS = '`~!@#$%^&*()-=+[{]}\\\\|;:\\'\",.<>/?';\n\n/**\n * Create a word definition regular expression based on default word separators.\n * Optionally provide allowed separators that should be included in words.\n *\n * The default would look like this:\n * /(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>\\/\\?\\s]+)/g\n */\nexport function createWordRegExp(allowInWords:string = ''): RegExp {\n\tvar usualSeparators = USUAL_WORD_SEPARATORS;\n\tvar source = '(-?\\\\d*\\\\.\\\\d\\\\w*)|([^';\n\tfor (var i = 0; i < usualSeparators.length; i++) {\n\t\tif (allowInWords.indexOf(usualSeparators[i]) >= 0) {\n\t\t\tcontinue;\n\t\t}\n\t\tsource += '\\\\' + usualSeparators[i];\n\t}\n\tsource += '\\\\s]+)';\n\treturn new RegExp(source, 'g');\n}\n\n// catches numbers (including floating numbers) in the first group, and alphanum in the second\nexport const DEFAULT_WORD_REGEXP = createWordRegExp();\n\nexport function ensureValidWordDefinition(wordDefinition?:RegExp): RegExp {\n\tvar result: RegExp = DEFAULT_WORD_REGEXP;\n\n\tif (wordDefinition && (wordDefinition instanceof RegExp)) {\n\t\tif (!wordDefinition.global) {\n\t\t\tvar flags = 'g';\n\t\t\tif (wordDefinition.ignoreCase) {\n\t\t\t\tflags += 'i';\n\t\t\t}\n\t\t\tif (wordDefinition.multiline) {\n\t\t\t\tflags += 'm';\n\t\t\t}\n\t\t\tresult = new RegExp(wordDefinition.source, flags);\n\t\t} else {\n\t\t\tresult = wordDefinition;\n\t\t}\n\t}\n\n\tresult.lastIndex = 0;\n\n\treturn result;\n}\n\nexport function getWordAtText(column:number, wordDefinition:RegExp, text:string, textOffset:number): IWordAtPosition {\n\n\t// console.log('_getWordAtText: ', column, text, textOffset);\n\n\tvar words = text.match(wordDefinition),\n\t\tk:number,\n\t\tstartWord:number,\n\t\tendWord:number,\n\t\tstartColumn:number,\n\t\tendColumn:number,\n\t\tword:string;\n\n\tif (words) {\n\t\tfor (k = 0; k < words.length; k++) {\n\t\t\tword = words[k].trim();\n\t\t\tif (word.length > 0) {\n\t\t\t\tstartWord = text.indexOf(word, endWord);\n\t\t\t\tendWord = startWord + word.length;\n\n\t\t\t\tstartColumn = textOffset + startWord + 1;\n\t\t\t\tendColumn = textOffset + endWord + 1;\n\n\t\t\t\tif (startColumn <= column && column <= endColumn) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tword: word,\n\t\t\t\t\t\tstartColumn: startColumn,\n\t\t\t\t\t\tendColumn: endColumn\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IMode, IState, IStream, ITokenizationResult} from 'vs/editor/common/modes';\n\nexport class AbstractState implements IState {\n\n\tprivate mode:IMode;\n\tprivate stateData:IState;\n\n\tconstructor(mode:IMode, stateData:IState = null) {\n\t\tthis.mode = mode;\n\t\tthis.stateData = stateData;\n\t}\n\n\tpublic getMode():IMode {\n\t\treturn this.mode;\n\t}\n\n\tpublic clone():IState {\n\t\tvar result:AbstractState = this.makeClone();\n\t\tresult.initializeFrom(this);\n\t\treturn result;\n\t}\n\n\tpublic makeClone():AbstractState {\n\t\tthrow new Error('Abstract Method');\n\t}\n\n\tpublic initializeFrom(other:AbstractState): void {\n\t\tthis.stateData = other.stateData !== null ? other.stateData.clone() : null;\n\t}\n\n\tpublic getStateData(): IState {\n\t\treturn this.stateData;\n\t}\n\n\tpublic setStateData(state:IState):void {\n\t\tthis.stateData = state;\n\t}\n\n\tpublic equals(other:IState):boolean {\n\t\tif (other === null || this.mode !== other.getMode()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (other instanceof AbstractState) {\n\t\t\treturn AbstractState.safeEquals(this.stateData, other.stateData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic tokenize(stream:IStream):ITokenizationResult {\n\t\tthrow new Error('Abstract Method');\n\t}\n\n\tpublic static safeEquals(a: IState, b: IState): boolean {\n\t\tif (a === null && b === null) {\n\t\t\treturn true;\n\t\t}\n\t\tif (a === null || b === null) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.equals(b);\n\t}\n\n\tpublic static safeClone(state: IState): IState {\n\t\tif (state) {\n\t\t\treturn state.clone();\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport {match as matchGlobPattern} from 'vs/base/common/glob'; // TODO@Alex\n\nexport interface LanguageFilter {\n\tlanguage?: string;\n\tscheme?: string;\n\tpattern?: string;\n}\n\nexport type LanguageSelector = string | LanguageFilter | (string | LanguageFilter)[];\n\nexport default function matches(selection: LanguageSelector, uri: URI, language: string): boolean {\n\treturn score(selection, uri, language) > 0;\n}\n\nexport function score(selector: LanguageSelector, uri: URI, language: string): number {\n\n\tif (Array.isArray(selector)) {\n\t\t// for each\n\t\tlet values = (<LanguageSelector[]>selector).map(item => score(item, uri, language));\n\t\treturn Math.max(...values);\n\n\t} else if (typeof selector === 'string') {\n\t\t// compare language id\n\t\tif (selector === language) {\n\t\t\treturn 10;\n\t\t} else if (selector === '*') {\n\t\t\treturn 5;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t} else if (selector) {\n\t\tlet filter = <LanguageFilter>selector;\n\t\tlet value = 0;\n\n\t\t// language id\n\t\tif (filter.language) {\n\t\t\tif (filter.language === language) {\n\t\t\t\tvalue += 10;\n\t\t\t} else if (filter.language === '*') {\n\t\t\t\tvalue += 5;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\t// scheme\n\t\tif (filter.scheme) {\n\t\t\tif (filter.scheme === uri.scheme) {\n\t\t\t\tvalue += 10;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\t// match fsPath with pattern\n\t\tif (filter.pattern) {\n\t\t\tif (filter.pattern === uri.fsPath) {\n\t\t\t\tvalue += 10;\n\t\t\t} else if (matchGlobPattern(filter.pattern, uri.fsPath)) {\n\t\t\t\tvalue += 5;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IStream} from 'vs/editor/common/modes';\n\nexport class LineStream implements IStream {\n\n\tstatic STRING_TO_ARRAY_CACHE:{ [key:string]:boolean[]; } = {};\n\n\t/*protected*/ _source:string;\n\tprivate sourceLength:number;\n\t/*protected*/ _pos:number;\n\tprivate whitespace:string;\n\tprivate whitespaceArr:boolean[];\n\tprivate separators:string;\n\tprivate separatorsArr:boolean[];\n\tprivate tokenStart:number;\n\tprivate tokenEnd:number;\n\n\tconstructor(source:string) {\n\t\tthis._source = source;\n\t\tthis.sourceLength = source.length;\n\t\tthis._pos = 0;\n\t\tthis.whitespace = '\\t \\u00a0';\n\t\tthis.whitespaceArr = this.stringToArray(this.whitespace);\n\t\tthis.separators = '';\n\t\tthis.separatorsArr = this.stringToArray(this.separators);\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\t}\n\n\tprivate stringToArray(str:string):boolean[] {\n\t\tif (!LineStream.STRING_TO_ARRAY_CACHE.hasOwnProperty(str)) {\n\t\t\tLineStream.STRING_TO_ARRAY_CACHE[str] = this.actualStringToArray(str);\n\t\t}\n\t\treturn LineStream.STRING_TO_ARRAY_CACHE[str];\n\t}\n\n\tprivate actualStringToArray(str:string):boolean[] {\n\t\tlet maxCharCode = 0;\n\t\tfor (let i = 0; i < str.length; i++) {\n\t\t\tmaxCharCode = Math.max(maxCharCode, str.charCodeAt(i));\n\t\t}\n\t\tlet r:boolean[] = [];\n\t\tfor (let i = 0; i <= maxCharCode; i++) {\n\t\t\tr[i] = false;\n\t\t}\n\t\tfor (let i = 0; i < str.length; i++) {\n\t\t\tr[str.charCodeAt(i)] = true;\n\t\t}\n\t\treturn r;\n\t}\n\n\tpublic pos():number {\n\t\treturn this._pos;\n\t}\n\n\tpublic eos() {\n\t\treturn this._pos >= this.sourceLength;\n\t}\n\n\tpublic peek():string {\n\t\t// Check EOS\n\t\tif (this._pos >= this.sourceLength) {\n\t\t\tthrow new Error('Stream is at the end');\n\t\t}\n\t\treturn this._source[this._pos];\n\t}\n\n\tpublic next():string {\n\t\t// Check EOS\n\t\tif (this._pos >= this.sourceLength) {\n\t\t\tthrow new Error('Stream is at the end');\n\t\t}\n\n\t\t// Reset peeked token\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\n\t\treturn this._source[this._pos++];\n\t}\n\n\tpublic next2(): void {\n\t\t// Check EOS\n\t\tif (this._pos >= this.sourceLength) {\n\t\t\tthrow new Error('Stream is at the end');\n\t\t}\n\n\t\t// Reset peeked token\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\n\t\tthis._pos++;\n\t}\n\n\tpublic advance(n: number): string {\n\t\tif (n === 0) {\n\t\t\treturn '';\n\t\t}\n\t\tvar oldPos = this._pos;\n\t\tthis._pos += n;\n\t\t// Reset peeked token\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\t\treturn this._source.substring(oldPos, this._pos);\n\t}\n\n\tprivate _advance2(n: number): number {\n\t\tif (n === 0) {\n\t\t\treturn n;\n\t\t}\n\t\tthis._pos += n;\n\t\t// Reset peeked token\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\t\treturn n;\n\t}\n\n\tpublic advanceToEOS():string {\n\t\tvar oldPos = this._pos;\n\t\tthis._pos = this.sourceLength;\n\t\tthis.resetPeekedToken();\n\t\treturn this._source.substring(oldPos, this._pos);\n\t}\n\n\tpublic goBack(n:number) {\n\t\tthis._pos -= n;\n\t\tthis.resetPeekedToken();\n\t}\n\n\tprivate createPeeker(condition:any):()=>number {\n\t\tif (condition instanceof RegExp) {\n\t\t\treturn () => {\n\t\t\t\tvar result = condition.exec(this._source.substr(this._pos));\n\t\t\t\tif (result === null) {\n\t\t\t\t\treturn 0;\n\t\t\t\t} else if (result.index !== 0) {\n\t\t\t\t\tthrow new Error('Regular expression must begin with the character \"^\"');\n\t\t\t\t}\n\t\t\t\treturn result[0].length;\n\t\t\t};\n\t\t} else if ((condition instanceof String || (typeof condition) === 'string') && condition) {\n\t\t\treturn () => {\n\t\t\t\tvar len = (<String> condition).length, match = this._pos + len <= this.sourceLength;\n\t\t\t\tfor (var i = 0; match && i < len; i++) {\n\t\t\t\t\tmatch = this._source.charCodeAt(this._pos + i) === (<String> condition).charCodeAt(i);\n\t\t\t\t}\n\t\t\t\treturn match ? len : 0;\n\t\t\t};\n\t\t}\n\t\tthrow new Error('Condition must be either a regular expression, function or a non-empty string');\n\t}\n\n\t// --- BEGIN `_advanceIfStringCaseInsensitive`\n\tprivate _advanceIfStringCaseInsensitive(condition:string): number {\n\t\tvar oldPos = this._pos,\n\t\t\tsource = this._source,\n\t\t\tlen = condition.length,\n\t\t\ti:number;\n\n\t\tif (len < 1 || oldPos + len > this.sourceLength) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (source.charAt(oldPos + i).toLowerCase() !== condition.charAt(i).toLowerCase()) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\treturn len;\n\t}\n\tpublic advanceIfStringCaseInsensitive(condition: string): string {\n\t\treturn this.advance(this._advanceIfStringCaseInsensitive(condition));\n\t}\n\tpublic advanceIfStringCaseInsensitive2(condition: string): number {\n\t\treturn this._advance2(this._advanceIfStringCaseInsensitive(condition));\n\t}\n\t// --- END\n\n\t// --- BEGIN `advanceIfString`\n\tprivate _advanceIfString(condition: string): number {\n\t\tvar oldPos = this._pos,\n\t\t\tsource = this._source,\n\t\t\tlen = condition.length,\n\t\t\ti:number;\n\n\t\tif (len < 1 || oldPos + len > this.sourceLength) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (source.charCodeAt(oldPos + i) !== condition.charCodeAt(i)) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\treturn len;\n\t}\n\tpublic advanceIfString(condition:string): string {\n\t\treturn this.advance(this._advanceIfString(condition));\n\t}\n\tpublic advanceIfString2(condition: string): number {\n\t\treturn this._advance2(this._advanceIfString(condition));\n\t}\n\t// --- END\n\n\t// --- BEGIN `advanceIfString`\n\tprivate _advanceIfCharCode(charCode:number): number {\n\t\tif (this._pos < this.sourceLength && this._source.charCodeAt(this._pos) === charCode) {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn 0;\n\t}\n\tpublic advanceIfCharCode(charCode: number): string {\n\t\treturn this.advance(this._advanceIfCharCode(charCode));\n\t}\n\tpublic advanceIfCharCode2(charCode: number): number {\n\t\treturn this._advance2(this._advanceIfCharCode(charCode));\n\t}\n\t// --- END\n\n\t// --- BEGIN `advanceIfRegExp`\n\tprivate _advanceIfRegExp(condition:RegExp): number {\n\t\tif (this._pos >= this.sourceLength) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (!condition.test(this._source.substr(this._pos))) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn RegExp.lastMatch.length;\n\t}\n\tpublic advanceIfRegExp(condition: RegExp): string {\n\t\treturn this.advance(this._advanceIfRegExp(condition));\n\t}\n\tpublic advanceIfRegExp2(condition: RegExp): number {\n\t\treturn this._advance2(this._advanceIfRegExp(condition));\n\t}\n\t// --- END\n\n\tprivate advanceLoop(condition:any, isWhile:boolean, including:boolean):string {\n\t\tif (this.eos()) {\n\t\t\treturn '';\n\t\t}\n\t\tvar peeker = this.createPeeker(condition);\n\t\tvar oldPos = this._pos;\n\t\tvar n = 0;\n\t\tvar f = null;\n\t\tif (isWhile) {\n\t\t\tf = (n) => {\n\t\t\t\treturn n > 0;\n\t\t\t};\n\t\t} else {\n\t\t\tf = (n) => {\n\t\t\t\treturn n === 0;\n\t\t\t};\n\t\t}\n\t\twhile (!this.eos() && f(n = peeker())) {\n\t\t\tif (n > 0) {\n\t\t\t\tthis.advance(n);\n\t\t\t} else {\n\t\t\t\tthis.next();\n\t\t\t}\n\t\t}\n\t\tif (including && !this.eos()) {\n\t\t\tthis.advance(n);\n\t\t}\n\t\treturn this._source.substring(oldPos, this._pos);\n\t}\n\n\tpublic advanceWhile(condition:any):string {\n\t\treturn this.advanceLoop(condition, true, false);\n\t}\n\n\tpublic advanceUntil(condition:any, including:boolean):string {\n\t\treturn this.advanceLoop(condition, false, including);\n\t}\n\n\t// --- BEGIN `advanceUntilString`\n\tprivate _advanceUntilString(condition: string, including: boolean): number {\n\t\tif (this.eos() || condition.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar oldPos = this._pos;\n\t\tvar index = this._source.indexOf(condition, oldPos);\n\n\t\tif (index === -1) {\n\t\t\t// String was not found => advanced to `eos`\n\t\t\treturn (this.sourceLength - oldPos);\n\t\t}\n\n\t\tif (including) {\n\t\t\t// String was found => advance to include `condition`\n\t\t\treturn (index + condition.length - oldPos);\n\t\t}\n\n\t\t// String was found => advance right before `condition`\n\t\treturn (index - oldPos);\n\t}\n\tpublic advanceUntilString(condition: string, including: boolean): string {\n\t\treturn this.advance(this._advanceUntilString(condition, including));\n\t}\n\tpublic advanceUntilString2(condition: string, including: boolean): number {\n\t\treturn this._advance2(this._advanceUntilString(condition, including));\n\t}\n\t// --- END\n\n\tprivate resetPeekedToken() {\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\t}\n\n\tpublic setTokenRules(separators:string, whitespace:string):void {\n\t\tif (this.separators !== separators || this.whitespace !== whitespace) {\n\t\t\tthis.separators = separators;\n\t\t\tthis.separatorsArr = this.stringToArray(this.separators);\n\t\t\tthis.whitespace = whitespace;\n\t\t\tthis.whitespaceArr = this.stringToArray(this.whitespace);\n\t\t\tthis.resetPeekedToken();\n\t\t}\n\t}\n\n\t// --- tokens\n\n\tpublic peekToken():string {\n\t\tif (this.tokenStart !== -1) {\n\t\t\treturn this._source.substring(this.tokenStart, this.tokenEnd);\n\t\t}\n\n\t\tvar\tsource = this._source,\n\t\t\tsourceLength = this.sourceLength,\n\t\t\twhitespaceArr = this.whitespaceArr,\n\t\t\tseparatorsArr = this.separatorsArr,\n\t\t\ttokenStart = this._pos;\n\n\t\t// Check EOS\n\t\tif (tokenStart >= sourceLength) {\n\t\t\tthrow new Error('Stream is at the end');\n\t\t}\n\n\t\t// Skip whitespace\n\t\twhile (whitespaceArr[source.charCodeAt(tokenStart)] && tokenStart < sourceLength) {\n\t\t\ttokenStart++;\n\t\t}\n\n\t\tvar tokenEnd = tokenStart;\n\t\t// If a separator is hit, it is a token\n\t\tif (separatorsArr[source.charCodeAt(tokenEnd)] && tokenEnd < sourceLength) {\n\t\t\ttokenEnd++;\n\t\t} else {\n\t\t\t// Advance until a separator or a whitespace is hit\n\t\t\twhile (!separatorsArr[source.charCodeAt(tokenEnd)] && !whitespaceArr[source.charCodeAt(tokenEnd)] && tokenEnd < sourceLength) {\n\t\t\t\ttokenEnd++;\n\t\t\t}\n\t\t}\n\n\t\t// Cache peeked token\n\t\tthis.tokenStart = tokenStart;\n\t\tthis.tokenEnd = tokenEnd;\n\n\t\treturn source.substring(tokenStart, tokenEnd);\n\t}\n\n\tpublic nextToken():string {\n\t\t// Check EOS\n\t\tif (this._pos >= this.sourceLength) {\n\t\t\tthrow new Error('Stream is at the end');\n\t\t}\n\n\t\t// Peek token if necessary\n\t\tvar result:string;\n\t\tif (this.tokenStart === -1)  {\n\t\t\tresult = this.peekToken();\n\t\t} else {\n\t\t\tresult = this._source.substring(this.tokenStart, this.tokenEnd);\n\t\t}\n\n\t\t// Advance to tokenEnd\n\t\tthis._pos = this.tokenEnd;\n\n\t\t// Reset peeked token\n\t\tthis.tokenStart = -1;\n\t\tthis.tokenEnd = -1;\n\n\t\treturn result;\n\t}\n\n\t// -- whitespace\n\n\tpublic peekWhitespace():string {\n\t\tvar\tsource = this._source,\n\t\t\tsourceLength = this.sourceLength,\n\t\t\twhitespaceArr = this.whitespaceArr,\n\t\t\tpeek = this._pos;\n\n\t\twhile (whitespaceArr[source.charCodeAt(peek)] && peek < sourceLength) {\n\t\t\tpeek++;\n\t\t}\n\t\treturn source.substring(this._pos, peek);\n\t}\n\n\t// --- BEGIN `advanceIfRegExp`\n\tprivate _skipWhitespace(): number {\n\t\tvar source = this._source,\n\t\t\tsourceLength = this.sourceLength,\n\t\t\twhitespaceArr = this.whitespaceArr,\n\t\t\toldPos = this._pos,\n\t\t\tpeek = this._pos;\n\n\t\twhile (whitespaceArr[source.charCodeAt(peek)] && peek < sourceLength) {\n\t\t\tpeek++;\n\t\t}\n\n\t\treturn (peek - oldPos);\n\t}\n\tpublic skipWhitespace(): string {\n\t\treturn this.advance(this._skipWhitespace());\n\t}\n\tpublic skipWhitespace2(): number {\n\t\treturn this._advance2(this._skipWhitespace());\n\t}\n\t// --- END\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n/*\n * This module exports common types and functionality shared between\n * the Monarch compiler that compiles JSON to ILexer, and the Monarch\n * Tokenizer (that highlights at runtime)\n */\n\n/*\n * Type definitions to be used internally to Monarch.\n * Inside monarch we use fully typed definitions and compiled versions of the more abstract JSON descriptions.\n */\n\nexport enum MonarchBracket {\n\tNone = 0,\n\tOpen = 1,\n\tClose = -1\n}\n\nexport interface ILexerMin {\n\tlanguageId: string;\n\tnoThrow: boolean;\n\tignoreCase: boolean;\n\tusesEmbedded: boolean;\n\tdefaultToken: string;\n\tstateNames: Object;\n}\n\nexport interface ILexer extends ILexerMin {\n\tmaxStack: number;\n\tstart: string;\n\tignoreCase: boolean;\n\ttokenPostfix: string;\n\n\ttokenizer: IRule[][];\n\tbrackets: IBracket[];\n}\n\nexport interface IBracket {\n\ttoken: string;\n\topen: string;\n\tclose: string;\n}\n\nexport interface IRule {\n\tregex: RegExp;\n\taction: IAction;\n\tmatchOnlyAtLineStart: boolean;\n\tname: string;\n}\n\nexport interface IAction {\n\t// an action is either a group of actions\n\tgroup?: IAction[];\n\n\t// or a function that returns a fresh action\n\ttest?: (id: string, matches: string[], state: string, eos: boolean) => IAction;\n\n\t// or it is a declarative action with a token value and various other attributes\n\ttoken?: string;\n\ttokenSubst?: boolean;\n\tnext?: string;\n\tnextEmbedded?: string;\n\tbracket?: MonarchBracket;\n\tlog?: string;\n\tswitchTo?: string;\n\tgoBack?: number;\n\ttransform?: (states: string[]) => string[];\n}\n\nexport interface IBranch {\n\tname: string;\n\tvalue: IAction;\n\ttest: (id: string, matches: string[], state: string, eos: boolean) => boolean;\n}\n\n// Small helper functions\n\n/**\n * Is a string null, undefined, or empty?\n */\nexport function empty(s: string): boolean {\n\treturn (s ? false : true);\n}\n\n/**\n * Puts a string to lower case if 'ignoreCase' is set.\n */\nexport function fixCase(lexer: ILexerMin, str: string): string {\n\treturn (lexer.ignoreCase && str ? str.toLowerCase() : str);\n}\n\n/**\n * Ensures there are no bad characters in a CSS token class.\n */\nexport function sanitize(s: string) {\n\treturn s.replace(/[&<>'\"_]/g, '-'); // used on all output token CSS classes\n}\n\n// Logging\n\n/**\n * Logs a message.\n */\nexport function log(lexer: ILexerMin, msg: string) {\n\tconsole.log(`${lexer.languageId}: ${msg}`);\n}\n\n// Throwing errors\n\n/**\n * Throws error. May actually just log the error and continue.\n */\nexport function throwError(lexer: ILexerMin, msg: string) {\n\tthrow new Error(`${lexer.languageId}: ${msg}`);\n}\n\n// Helper functions for rule finding and substitution\n\n/**\n * substituteMatches is used on lexer strings and can substitutes predefined patterns:\n * \t\t$$  => $\n * \t\t$#  => id\n * \t\t$n  => matched entry n\n * \t\t@attr => contents of lexer[attr]\n *\n * See documentation for more info\n */\nexport function substituteMatches(lexer: ILexerMin, str: string, id: string, matches: string[], state: string) {\n\tvar re = /\\$((\\$)|(#)|(\\d\\d?)|[sS](\\d\\d?)|@(\\w+))/g;\n\tvar stateMatches: string[] = null;\n\treturn str.replace(re, function(full, sub?, dollar?, hash?, n?, s?, attr?, ofs?, total?) {\n\t\tif (!empty(dollar)) {\n\t\t\treturn '$'; // $$\n\t\t}\n\t\tif (!empty(hash)) {\n\t\t\treturn fixCase(lexer, id);   // default $#\n\t\t}\n\t\tif (!empty(n) && n < matches.length) {\n\t\t\treturn fixCase(lexer, matches[n]); // $n\n\t\t}\n\t\tif (!empty(attr) && lexer && typeof (lexer[attr]) === 'string') {\n\t\t\treturn lexer[attr]; //@attribute\n\t\t}\n\t\tif (stateMatches === null) { // split state on demand\n\t\t\tstateMatches = state.split('.');\n\t\t\tstateMatches.unshift(state);\n\t\t}\n\t\tif (!empty(s) && s < stateMatches.length) {\n\t\t\treturn fixCase(lexer, stateMatches[s]); //$Sn\n\t\t}\n\t\treturn '';\n\t});\n}\n\n/**\n * Find the tokenizer rules for a specific state (i.e. next action)\n */\nexport function findRules(lexer: ILexer, state: string): IRule[] {\n\twhile (state && state.length > 0) {\n\t\tvar rules = lexer.tokenizer[state];\n\t\tif (rules) {\n\t\t\treturn rules;\n\t\t}\n\n\t\tvar idx = state.lastIndexOf('.');\n\t\tif (idx < 0) {\n\t\t\tstate = null; // no further parent\n\t\t} else {\n\t\t\tstate = state.substr(0, idx);\n\t\t}\n\t}\n\treturn null;\n}\n\n/**\n * Is a certain state defined? In contrast to 'findRules' this works on a ILexerMin.\n * This is used during compilation where we may know the defined states\n * but not yet whether the corresponding rules are correct.\n */\nexport function stateExists(lexer: ILexerMin, state: string): boolean {\n\twhile (state && state.length > 0) {\n\t\tvar exist = lexer.stateNames[state];\n\t\tif (exist) {\n\t\t\treturn true;\n\t\t}\n\n\t\tvar idx = state.lastIndexOf('.');\n\t\tif (idx < 0) {\n\t\t\tstate = null; // no further parent\n\t\t} else {\n\t\t\tstate = state.substr(0, idx);\n\t\t}\n\t}\n\treturn false;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n/*\n * This module only exports 'compile' which compiles a JSON langauge definition\n * into a typed and checked ILexer definition.\n */\n\nimport * as objects from 'vs/base/common/objects';\nimport * as monarchCommon from 'vs/editor/common/modes/monarch/monarchCommon';\nimport {IMonarchLanguage, IMonarchLanguageBracket} from 'vs/editor/common/modes/monarch/monarchTypes';\n\n/*\n * Type helpers\n *\n * Note: this is just for sanity checks on the JSON description which is\n * helpful for the programmer. No checks are done anymore once the lexer is\n * already 'compiled and checked'.\n *\n */\n\nfunction isArrayOf(elemType: (x: any) => boolean, obj: any): boolean {\n\tif (!obj) {\n\t\treturn false;\n\t}\n\tif (!(Array.isArray(obj))) {\n\t\treturn false;\n\t}\n\tvar idx: any;\n\tfor (idx in obj) {\n\t\tif (obj.hasOwnProperty(idx)) {\n\t\t\tif (!(elemType(obj[idx]))) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn true;\n}\n\nfunction bool(prop: any, def?: boolean, onerr?: () => void ): boolean {\n\tif (typeof (prop) === 'boolean') {\n\t\treturn prop;\n\t}\n\tif (onerr && (prop || def === undefined)) {\n\t\tonerr(); // type is wrong, or there is no default\n\t}\n\treturn (def === undefined ? null : def);\n}\n\nfunction string(prop: any, def?: string, onerr?: () => void ): string {\n\tif (typeof (prop) === 'string') {\n\t\treturn prop;\n\t}\n\tif (onerr && (prop || def === undefined)) {\n\t\tonerr(); // type is wrong, or there is no default\n\t}\n\treturn (def === undefined ? null : def);\n\n}\n\n// Lexer helpers\n\n/**\n * Compiles a regular expression string, adding the 'i' flag if 'ignoreCase' is set.\n * Also replaces @\\w+ or sequences with the content of the specified attribute\n */\nfunction compileRegExp(lexer: monarchCommon.ILexerMin, str: string): RegExp {\n\tif (typeof (str) !== 'string') {\n\t\treturn null;\n\t}\n\n\tvar n = 0;\n\twhile (str.indexOf('@') >= 0 && n < 5) { // at most 5 expansions\n\t\tn++;\n\t\tstr = str.replace(/@(\\w+)/g, function(s, attr?) {\n\t\t\tvar sub = '';\n\t\t\tif (typeof (lexer[attr]) === 'string') {\n\t\t\t\tsub = lexer[attr];\n\t\t\t} else if (lexer[attr] && lexer[attr] instanceof RegExp) {\n\t\t\t\tsub = lexer[attr].source;\n\t\t\t} else {\n\t\t\t\tif (lexer[attr] === undefined) {\n\t\t\t\t\tmonarchCommon.throwError(lexer, 'language definition does not contain attribute \\'' + attr + '\\', used at: ' + str);\n\t\t\t\t} else {\n\t\t\t\t\tmonarchCommon.throwError(lexer, 'attribute reference \\'' + attr + '\\' must be a string, used at: ' + str);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (monarchCommon.empty(sub) ? '' : '(?:' + sub + ')');\n\t\t});\n\t}\n\n\treturn new RegExp(str, (lexer.ignoreCase ? 'i' : ''));\n}\n\n/**\n * Compiles guard functions for case matches.\n * This compiles 'cases' attributes into efficient match functions.\n *\n */\nfunction selectScrutinee(id: string, matches: string[], state: string, num: number): string {\n\tif (num < 0) {\n\t\treturn id;\n\t}\n\tif (num < matches.length) {\n\t\treturn matches[num];\n\t}\n\tif (num >= 100) {\n\t\tnum = num - 100;\n\t\tvar parts = state.split('.');\n\t\tparts.unshift(state);\n\t\tif (num < parts.length) {\n\t\t\treturn parts[num];\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction createGuard(lexer: monarchCommon.ILexerMin, ruleName: string, tkey: string, val: monarchCommon.IAction): monarchCommon.IBranch {\n\t// get the scrutinee and pattern\n\tvar scrut = -1; // -1: $!, 0-99: $n, 100+n: $Sn\n\tvar oppat = tkey;\n\tvar matches: string[] = tkey.match(/^\\$(([sS]?)(\\d\\d?)|#)(.*)$/);\n\tif (matches) {\n\t\tif (matches[3]) { // if digits\n\t\t\tscrut = parseInt(matches[3]);\n\t\t\tif (matches[2]) {\n\t\t\t\tscrut = scrut + 100; // if [sS] present\n\t\t\t}\n\t\t}\n\t\toppat = matches[4];\n\t}\n\t// get operator\n\tvar op = '~';\n\tvar pat = oppat;\n\tif (!oppat || oppat.length === 0) {\n\t\top = '!=';\n\t\tpat = '';\n\t}\n\telse if (/^\\w*$/.test(pat)) {  // just a word\n\t\top = '==';\n\t}\n\telse {\n\t\tmatches = oppat.match(/^(@|!@|~|!~|==|!=)(.*)$/);\n\t\tif (matches) {\n\t\t\top = matches[1];\n\t\t\tpat = matches[2];\n\t\t}\n\t}\n\n\t// set the tester function\n\tvar tester: (s: string, id: string, matches: string[], state: string, eos: boolean) => boolean;\n\n\t// special case a regexp that matches just words\n\tif ((op === '~' || op === '!~') && /^(\\w|\\|)*$/.test(pat)) {\n\t\tvar inWords = objects.createKeywordMatcher(pat.split('|'), lexer.ignoreCase);\n\t\ttester = function(s) { return (op === '~' ? inWords(s) : !inWords(s)); };\n\t}\n\telse if (op === '@' || op === '!@') {\n\t\tvar words = lexer[pat];\n\t\tif (!words) {\n\t\t\tmonarchCommon.throwError(lexer, 'the @ match target \\'' + pat + '\\' is not defined, in rule: ' + ruleName);\n\t\t}\n\t\tif (!(isArrayOf(function(elem) { return (typeof (elem) === 'string'); }, words))) {\n\t\t\tmonarchCommon.throwError(lexer, 'the @ match target \\'' + pat + '\\' must be an array of strings, in rule: ' + ruleName);\n\t\t}\n\t\tvar inWords = objects.createKeywordMatcher(words, lexer.ignoreCase);\n\t\ttester = function(s) { return (op === '@' ? inWords(s) : !inWords(s)); };\n\t}\n\telse if (op === '~' || op === '!~') {\n\t\tif (pat.indexOf('$') < 0) {\n\t\t\t// precompile regular expression\n\t\t\tvar re = compileRegExp(lexer, '^' + pat + '$');\n\t\t\ttester = function(s) { return (op === '~' ? re.test(s) : !re.test(s)); };\n\t\t}\n\t\telse {\n\t\t\ttester = function(s, id, matches, state) {\n\t\t\t\tvar re = compileRegExp(lexer, '^' + monarchCommon.substituteMatches(lexer, pat, id, matches, state) + '$');\n\t\t\t\treturn re.test(s);\n\t\t\t};\n\t\t}\n\t}\n\telse { // if (op==='==' || op==='!=') {\n\t\tif (pat.indexOf('$') < 0) {\n\t\t\tvar patx = monarchCommon.fixCase(lexer, pat);\n\t\t\ttester = function(s) { return (op === '==' ? s === patx : s !== patx); };\n\t\t}\n\t\telse {\n\t\t\tvar patx = monarchCommon.fixCase(lexer, pat);\n\t\t\ttester = function(s, id, matches, state, eos) {\n\t\t\t\tvar patexp = monarchCommon.substituteMatches(lexer, patx, id, matches, state);\n\t\t\t\treturn (op === '==' ? s === patexp : s !== patexp);\n\t\t\t};\n\t\t}\n\t}\n\n\t// return the branch object\n\tif (scrut === -1) {\n\t\treturn {\n\t\t\tname: tkey, value: val, test: function(id, matches, state, eos) {\n\t\t\t\treturn tester(id, id, matches, state, eos);\n\t\t\t}\n\t\t};\n\t}\n\telse {\n\t\treturn {\n\t\t\tname: tkey, value: val, test: function(id, matches, state, eos) {\n\t\t\t\tvar scrutinee = selectScrutinee(id, matches, state, scrut);\n\t\t\t\treturn tester(!scrutinee ? '' : scrutinee, id, matches, state, eos);\n\t\t\t}\n\t\t};\n\t}\n}\n\n/**\n * Compiles an action: i.e. optimize regular expressions and case matches\n * and do many sanity checks.\n *\n * This is called only during compilation but if the lexer definition\n * contains user functions as actions (which is usually not allowed), then this\n * may be called during lexing. It is important therefore to compile common cases efficiently\n */\nfunction compileAction(lexer: monarchCommon.ILexerMin, ruleName: string, action: any): monarchCommon.IAction {\n\tif (!action) {\n\t\treturn { token: '' };\n\t}\n\telse if (typeof (action) === 'string') {\n\t\treturn action; // { token: action };\n\t}\n\telse if (action.token || action.token === '') {\n\t\tif (typeof (action.token) !== 'string') {\n\t\t\tmonarchCommon.throwError(lexer, 'a \\'token\\' attribute must be of type string, in rule: ' + ruleName);\n\t\t\treturn { token: '' };\n\t\t}\n\t\telse {\n\t\t\t// only copy specific typed fields (only happens once during compile Lexer)\n\t\t\tvar newAction: monarchCommon.IAction = { token: action.token };\n\t\t\tif (action.token.indexOf('$') >= 0) {\n\t\t\t\tnewAction.tokenSubst = true;\n\t\t\t}\n\t\t\tif (typeof (action.bracket) === 'string') {\n\t\t\t\tif (action.bracket === '@open') {\n\t\t\t\t\tnewAction.bracket = monarchCommon.MonarchBracket.Open;\n\t\t\t\t} else if (action.bracket === '@close') {\n\t\t\t\t\tnewAction.bracket = monarchCommon.MonarchBracket.Close;\n\t\t\t\t} else {\n\t\t\t\t\tmonarchCommon.throwError(lexer, 'a \\'bracket\\' attribute must be either \\'@open\\' or \\'@close\\', in rule: ' + ruleName);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (action.next) {\n\t\t\t\tif (typeof (action.next) !== 'string') {\n\t\t\t\t\tmonarchCommon.throwError(lexer, 'the next state must be a string value in rule: ' + ruleName);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar next: string = action.next;\n\t\t\t\t\tif (!/^(@pop|@push|@popall)$/.test(next)) {\n\t\t\t\t\t\tif (next[0] === '@') {\n\t\t\t\t\t\t\tnext = next.substr(1); // peel off starting @ sign\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (next.indexOf('$') < 0) {  // no dollar substitution, we can check if the state exists\n\t\t\t\t\t\t\tif (!monarchCommon.stateExists(lexer, monarchCommon.substituteMatches(lexer, next, '', [], ''))) {\n\t\t\t\t\t\t\t\tmonarchCommon.throwError(lexer, 'the next state \\'' + action.next + '\\' is not defined in rule: ' + ruleName);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tnewAction.next = next;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof (action.goBack) === 'number') {\n\t\t\t\tnewAction.goBack = action.goBack;\n\t\t\t}\n\t\t\tif (typeof (action.switchTo) === 'string') {\n\t\t\t\tnewAction.switchTo = action.switchTo;\n\t\t\t}\n\t\t\tif (typeof (action.log) === 'string') {\n\t\t\t\tnewAction.log = action.log;\n\t\t\t}\n\t\t\tif (typeof (action.nextEmbedded) === 'string') {\n\t\t\t\tnewAction.nextEmbedded = action.nextEmbedded;\n\t\t\t\tlexer.usesEmbedded = true;\n\t\t\t}\n\t\t\treturn newAction;\n\t\t}\n\t}\n\telse if (Array.isArray(action)) {\n\t\tvar results = [];\n\t\tvar idx: string;\n\t\tfor (idx in action) {\n\t\t\tif (action.hasOwnProperty(idx)) {\n\t\t\t\tresults[idx] = compileAction(lexer, ruleName, action[idx]);\n\t\t\t}\n\t\t}\n\t\treturn { group: results };\n\t}\n\telse if (action.cases) {\n\t\t// build an array of test cases\n\t\tvar cases: monarchCommon.IBranch[] = [];\n\n\t\t// for each case, push a test function and result value\n\t\tvar tkey: string;\n\t\tfor (tkey in action.cases) {\n\t\t\tif (action.cases.hasOwnProperty(tkey)) {\n\t\t\t\tvar val = compileAction(lexer, ruleName, action.cases[tkey]);\n\n\t\t\t\t// what kind of case\n\t\t\t\tif (tkey === '@default' || tkey === '@' || tkey === '') {\n\t\t\t\t\tcases.push({ test: null, value: val, name: tkey });\n\t\t\t\t}\n\t\t\t\telse if (tkey === '@eos') {\n\t\t\t\t\tcases.push({ test: function(id, matches, state, eos) { return eos; }, value: val, name: tkey });\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcases.push(createGuard(lexer, ruleName, tkey, val));  // call separate function to avoid local variable capture\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// create a matching function\n\t\tvar def = lexer.defaultToken;\n\t\treturn {\n\t\t\ttest: function(id, matches, state, eos) {\n\t\t\t\tvar idx: string;\n\t\t\t\tfor (idx in cases) {\n\t\t\t\t\tif (cases.hasOwnProperty(idx)) {\n\t\t\t\t\t\tvar didmatch = (!cases[idx].test || cases[idx].test(id, matches, state, eos));\n\t\t\t\t\t\tif (didmatch) {\n\t\t\t\t\t\t\treturn cases[idx].value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn def;\n\t\t\t}\n\t\t};\n\t}\n\telse {\n\t\tmonarchCommon.throwError(lexer, 'an action must be a string, an object with a \\'token\\' or \\'cases\\' attribute, or an array of actions; in rule: ' + ruleName);\n\t\treturn '';\n\t}\n}\n\n/**\n * Helper class for creating matching rules\n */\nclass Rule implements monarchCommon.IRule {\n\tpublic regex: RegExp = new RegExp('');\n\tpublic action: monarchCommon.IAction = { token: '' };\n\tpublic matchOnlyAtLineStart: boolean = false;\n\tpublic name: string = '';\n\n\tconstructor(name: string) {\n\t\tthis.name = name;\n\t}\n\n\tpublic setRegex(lexer: monarchCommon.ILexerMin, re: string);\n\tpublic setRegex(lexer: monarchCommon.ILexerMin, re: RegExp);\n\tpublic setRegex(lexer: monarchCommon.ILexerMin, re: any) {\n\t\tvar sregex: string;\n\t\tif (typeof (re) === 'string') {\n\t\t\tsregex = re;\n\t\t}\n\t\telse if (re instanceof RegExp) {\n\t\t\tsregex = (<RegExp>re).source;\n\t\t}\n\t\telse {\n\t\t\tmonarchCommon.throwError(lexer, 'rules must start with a match string or regular expression: ' + this.name);\n\t\t}\n\n\t\tthis.matchOnlyAtLineStart = (sregex.length > 0 && sregex[0] === '^');\n\t\tthis.name = this.name + ': ' + sregex;\n\t\tthis.regex = compileRegExp(lexer, '^(?:' + (this.matchOnlyAtLineStart ? sregex.substr(1) : sregex) + ')');\n\t}\n\n\tpublic setAction(lexer: monarchCommon.ILexerMin, act: monarchCommon.IAction) {\n\t\tthis.action = compileAction(lexer, this.name, act);\n\t}\n}\n\n/**\n * Compiles a json description function into json where all regular expressions,\n * case matches etc, are compiled and all include rules are expanded.\n * We also compile the bracket definitions, supply defaults, and do many sanity checks.\n * If the 'jsonStrict' parameter is 'false', we allow at certain locations\n * regular expression objects and functions that get called during lexing.\n * (Currently we have no samples that need this so perhaps we should always have\n * jsonStrict to true).\n */\nexport function compile(languageId:string, json: IMonarchLanguage): monarchCommon.ILexer {\n\tif (!json || typeof (json) !== 'object') {\n\t\tthrow new Error('Monarch: expecting a language definition object');\n\t}\n\n\t// Create our lexer\n\tvar lexer: monarchCommon.ILexer = <monarchCommon.ILexer>{};\n\tlexer.languageId = languageId;\n\tlexer.noThrow = false; // raise exceptions during compilation\n\tlexer.maxStack = 100;\n\n\t// Set standard fields: be defensive about types\n\tlexer.start = string(json.start);\n\tlexer.ignoreCase = bool(json.ignoreCase, false);\n\n\tlexer.tokenPostfix = string(json.tokenPostfix, '.' + lexer.languageId);\n\tlexer.defaultToken = string(json.defaultToken, 'source', function () { monarchCommon.throwError(lexer, 'the \\'defaultToken\\' must be a string'); });\n\n\tlexer.usesEmbedded = false; // becomes true if we find a nextEmbedded action\n\n\t// For calling compileAction later on\n\tvar lexerMin: monarchCommon.ILexerMin = <any>json;\n\tlexerMin.languageId = languageId;\n\tlexerMin.ignoreCase = lexer.ignoreCase;\n\tlexerMin.noThrow = lexer.noThrow;\n\tlexerMin.usesEmbedded = lexer.usesEmbedded;\n\tlexerMin.stateNames = json.tokenizer;\n\tlexerMin.defaultToken = lexer.defaultToken;\n\n\n\t// Compile an array of rules into newrules where RegExp objects are created.\n\tfunction addRules(state: string, newrules: monarchCommon.IRule[], rules: any[]) {\n\t\tvar idx: string;\n\t\tfor (idx in rules) {\n\t\t\tif (rules.hasOwnProperty(idx)) {\n\t\t\t\tvar rule = rules[idx];\n\t\t\t\tvar include = rule.include;\n\t\t\t\tif (include) {\n\t\t\t\t\tif (typeof (include) !== 'string') {\n\t\t\t\t\t\tmonarchCommon.throwError(lexer, 'an \\'include\\' attribute must be a string at: ' + state);\n\t\t\t\t\t}\n\t\t\t\t\tif (include[0] === '@') {\n\t\t\t\t\t\tinclude = include.substr(1); // peel off starting @\n\t\t\t\t\t}\n\t\t\t\t\tif (!json.tokenizer[include]) {\n\t\t\t\t\t\tmonarchCommon.throwError(lexer, 'include target \\'' + include + '\\' is not defined at: ' + state);\n\t\t\t\t\t}\n\t\t\t\t\taddRules(state + '.' + include, newrules, json.tokenizer[include]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar newrule = new Rule(state);\n\n\n\t\t\t\t\t// Set up new rule attributes\n\t\t\t\t\tif (Array.isArray(rule) && rule.length >= 1 && rule.length <= 3) {\n\t\t\t\t\t\tnewrule.setRegex(lexerMin, rule[0]);\n\t\t\t\t\t\tif (rule.length >= 3) {\n\t\t\t\t\t\t\tif (typeof (rule[1]) === 'string') {\n\t\t\t\t\t\t\t\tnewrule.setAction(lexerMin, { token: rule[1], next: rule[2] });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (typeof (rule[1]) === 'object') {\n\t\t\t\t\t\t\t\tvar rule1 = rule[1];\n\t\t\t\t\t\t\t\trule1.next = rule[2];\n\t\t\t\t\t\t\t\tnewrule.setAction(lexerMin, rule1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tmonarchCommon.throwError(lexer, 'a next state as the last element of a rule can only be given if the action is either an object or a string, at: ' + state);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnewrule.setAction(lexerMin, rule[1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (!rule.regex) {\n\t\t\t\t\t\t\tmonarchCommon.throwError(lexer, 'a rule must either be an array, or an object with a \\'regex\\' or \\'include\\' field at: ' + state);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (rule.name) {\n\t\t\t\t\t\t\tnewrule.name = string(rule.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (rule.matchOnlyAtStart) {\n\t\t\t\t\t\t\tnewrule.matchOnlyAtLineStart = bool(rule.matchOnlyAtLineStart);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnewrule.setRegex(lexerMin, rule.regex);\n\t\t\t\t\t\tnewrule.setAction(lexerMin, rule.action);\n\t\t\t\t\t}\n\n\t\t\t\t\tnewrules.push(newrule);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// compile the tokenizer rules\n\tif (!json.tokenizer || typeof (json.tokenizer) !== 'object') {\n\t\tmonarchCommon.throwError(lexer, 'a language definition must define the \\'tokenizer\\' attribute as an object');\n\t}\n\n\tlexer.tokenizer = [];\n\tvar key: string;\n\tfor (key in json.tokenizer) {\n\t\tif (json.tokenizer.hasOwnProperty(key)) {\n\t\t\tif (!lexer.start) {\n\t\t\t\tlexer.start = key;\n\t\t\t}\n\n\t\t\tvar rules = json.tokenizer[key];\n\t\t\tlexer.tokenizer[key] = new Array();\n\t\t\taddRules('tokenizer.' + key, lexer.tokenizer[key], rules);\n\t\t}\n\t}\n\tlexer.usesEmbedded = lexerMin.usesEmbedded;  // can be set during compileAction\n\n\t// Set simple brackets\n\tif (json.brackets) {\n\t\tif (!(Array.isArray(<any>json.brackets))) {\n\t\t\tmonarchCommon.throwError(lexer, 'the \\'brackets\\' attribute must be defined as an array');\n\t\t}\n\t}\n\telse {\n\t\tjson.brackets = [\n\t\t\t{ open: '{', close: '}', token: 'delimiter.curly' },\n\t\t\t{ open: '[', close: ']', token: 'delimiter.square' },\n\t\t\t{ open: '(', close: ')', token: 'delimiter.parenthesis' },\n\t\t\t{ open: '<', close: '>', token: 'delimiter.angle' }];\n\t}\n\tvar brackets : IMonarchLanguageBracket[] = [];\n\tfor (var bracketIdx in json.brackets) {\n\t\tif (json.brackets.hasOwnProperty(bracketIdx)) {\n\t\t\tvar desc = <any> json.brackets[bracketIdx];\n\t\t\tif (desc && Array.isArray(desc) && desc.length === 3) {\n\t\t\t\tdesc = { token: desc[2], open: desc[0], close: desc[1] };\n\t\t\t}\n\t\t\tif (desc.open === desc.close) {\n\t\t\t\tmonarchCommon.throwError(lexer, 'open and close brackets in a \\'brackets\\' attribute must be different: ' + desc.open +\n\t\t\t\t\t'\\n hint: use the \\'bracket\\' attribute if matching on equal brackets is required.');\n\t\t\t}\n\t\t\tif (typeof (desc.open) === 'string' && typeof (desc.token) === 'string') {\n\t\t\t\tbrackets.push({\n\t\t\t\t\ttoken: string(desc.token) + lexer.tokenPostfix\n\t\t\t\t\t, open: monarchCommon.fixCase(lexer, string(desc.open))\n\t\t\t\t\t, close: monarchCommon.fixCase(lexer, string(desc.close))\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmonarchCommon.throwError(lexer, 'every element in the \\'brackets\\' array must be a \\'{open,close,token}\\' object or array');\n\t\t\t}\n\t\t}\n\t}\n\tlexer.brackets = brackets;\n\n\t// Disable throw so the syntax highlighter goes, no matter what\n\tlexer.noThrow = true;\n\treturn lexer;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as modes from 'vs/editor/common/modes';\n\nexport class NullState implements modes.IState {\n\n\tprivate mode: modes.IMode;\n\tprivate stateData: modes.IState;\n\n\tconstructor(mode: modes.IMode, stateData: modes.IState) {\n\t\tthis.mode = mode;\n\t\tthis.stateData = stateData;\n\t}\n\n\tpublic clone(): modes.IState {\n\t\tvar stateDataClone:modes.IState = (this.stateData ? this.stateData.clone() : null);\n\t\treturn new NullState(this.mode, stateDataClone);\n\t}\n\n\tpublic equals(other:modes.IState): boolean {\n\t\tif (this.mode !== other.getMode()) {\n\t\t\treturn false;\n\t\t}\n\t\tvar otherStateData = other.getStateData();\n\t\tif (!this.stateData && !otherStateData) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.stateData && otherStateData) {\n\t\t\treturn this.stateData.equals(otherStateData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic getMode(): modes.IMode {\n\t\treturn this.mode;\n\t}\n\n\tpublic tokenize(stream:modes.IStream):modes.ITokenizationResult {\n\t\tstream.advanceToEOS();\n\t\treturn { type:'' };\n\t}\n\n\tpublic getStateData(): modes.IState {\n\t\treturn this.stateData;\n\t}\n\n\tpublic setStateData(stateData:modes.IState):void {\n\t\tthis.stateData = stateData;\n\t}\n}\n\nexport class NullMode implements modes.IMode {\n\n\n\tpublic static ID = 'vs.editor.modes.nullMode';\n\n\tconstructor() {\n\t}\n\n\tpublic getId():string {\n\t\treturn NullMode.ID;\n\t}\n\n\tpublic toSimplifiedMode(): modes.IMode {\n\t\treturn this;\n\t}\n}\n\nexport function nullTokenize(mode: modes.IMode, buffer:string, state: modes.IState, deltaOffset:number = 0, stopAtOffset?:number): modes.ILineTokens {\n\tvar tokens:modes.IToken[] = [\n\t\t{\n\t\t\tstartIndex: deltaOffset,\n\t\t\ttype: ''\n\t\t}\n\t];\n\n\tvar modeTransitions:modes.IModeTransition[] = [\n\t\t{\n\t\t\tstartIndex: deltaOffset,\n\t\t\tmode: mode\n\t\t}\n\t];\n\n\treturn {\n\t\ttokens: tokens,\n\t\tactualStopOffset: deltaOffset + buffer.length,\n\t\tendState: state,\n\t\tmodeTransitions: modeTransitions\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as strings from 'vs/base/common/strings';\nimport * as objects from 'vs/base/common/objects';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IReadOnlyModel, IPosition} from 'vs/editor/common/editorCommon';\nimport * as modes from 'vs/editor/common/modes';\nimport {ModeTransition} from 'vs/editor/common/core/modeTransition';\n\nexport class Token implements modes.IToken {\n\t_tokenBrand: void;\n\n\tpublic startIndex:number;\n\tpublic type:string;\n\n\tconstructor(startIndex:number, type:string) {\n\t\tthis.startIndex = startIndex;\n\t\tthis.type = type;\n\t}\n\n\tpublic toString(): string {\n\t\treturn '(' + this.startIndex + ', ' + this.type + ')';\n\t}\n}\n\nexport class LineTokens implements modes.ILineTokens {\n\t_lineTokensBrand: void;\n\n\ttokens: Token[];\n\tmodeTransitions: ModeTransition[];\n\tactualStopOffset: number;\n\tendState: modes.IState;\n\tretokenize: TPromise<void>;\n\n\tconstructor(tokens:Token[], modeTransitions: ModeTransition[], actualStopOffset:number, endState:modes.IState) {\n\t\tthis.tokens = tokens;\n\t\tthis.modeTransitions = modeTransitions;\n\t\tthis.actualStopOffset = actualStopOffset;\n\t\tthis.endState = endState;\n\t\tthis.retokenize = null;\n\t}\n}\n\nexport function handleEvent<T>(context:modes.ILineContext, offset:number, runner:(modeId:string, newContext:modes.ILineContext, offset:number)=>T):T {\n\tvar modeTransitions = context.modeTransitions;\n\tif (modeTransitions.length === 1) {\n\t\treturn runner(modeTransitions[0].modeId, context, offset);\n\t}\n\n\tvar modeIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, offset);\n\tvar nestedMode = modeTransitions[modeIndex].mode;\n\tvar modeStartIndex = modeTransitions[modeIndex].startIndex;\n\n\tvar firstTokenInModeIndex = context.findIndexOfOffset(modeStartIndex);\n\tvar nextCharacterAfterModeIndex = -1;\n\tvar nextTokenAfterMode = -1;\n\tif (modeIndex + 1 < modeTransitions.length) {\n\t\tnextTokenAfterMode = context.findIndexOfOffset(modeTransitions[modeIndex + 1].startIndex);\n\t\tnextCharacterAfterModeIndex = context.getTokenStartIndex(nextTokenAfterMode);\n\t} else {\n\t\tnextTokenAfterMode = context.getTokenCount();\n\t\tnextCharacterAfterModeIndex = context.getLineContent().length;\n\t}\n\n\tvar firstTokenCharacterOffset = context.getTokenStartIndex(firstTokenInModeIndex);\n\tvar newCtx = new FilteredLineContext(context, nestedMode, firstTokenInModeIndex, nextTokenAfterMode, firstTokenCharacterOffset, nextCharacterAfterModeIndex);\n\treturn runner(nestedMode.getId(), newCtx, offset - firstTokenCharacterOffset);\n}\n\nexport class FilteredLineContext implements modes.ILineContext {\n\n\tpublic modeTransitions: ModeTransition[];\n\n\tprivate _actual:modes.ILineContext;\n\tprivate _firstTokenInModeIndex:number;\n\tprivate _nextTokenAfterMode:number;\n\tprivate _firstTokenCharacterOffset:number;\n\tprivate _nextCharacterAfterModeIndex:number;\n\n\tconstructor(actual:modes.ILineContext, mode:modes.IMode,\n\t\t\tfirstTokenInModeIndex:number, nextTokenAfterMode:number,\n\t\t\tfirstTokenCharacterOffset:number, nextCharacterAfterModeIndex:number) {\n\n\t\tthis.modeTransitions = [new ModeTransition(0, mode)];\n\t\tthis._actual = actual;\n\t\tthis._firstTokenInModeIndex = firstTokenInModeIndex;\n\t\tthis._nextTokenAfterMode = nextTokenAfterMode;\n\t\tthis._firstTokenCharacterOffset = firstTokenCharacterOffset;\n\t\tthis._nextCharacterAfterModeIndex = nextCharacterAfterModeIndex;\n\t}\n\n\tpublic getLineContent(): string {\n\t\tvar actualLineContent = this._actual.getLineContent();\n\t\treturn actualLineContent.substring(this._firstTokenCharacterOffset, this._nextCharacterAfterModeIndex);\n\t}\n\n\tpublic getTokenCount(): number {\n\t\treturn this._nextTokenAfterMode - this._firstTokenInModeIndex;\n\t}\n\n\tpublic findIndexOfOffset(offset:number): number {\n\t\treturn this._actual.findIndexOfOffset(offset + this._firstTokenCharacterOffset) - this._firstTokenInModeIndex;\n\t}\n\n\tpublic getTokenStartIndex(tokenIndex:number): number {\n\t\treturn this._actual.getTokenStartIndex(tokenIndex + this._firstTokenInModeIndex) - this._firstTokenCharacterOffset;\n\t}\n\n\tpublic getTokenEndIndex(tokenIndex:number): number {\n\t\treturn this._actual.getTokenEndIndex(tokenIndex + this._firstTokenInModeIndex) - this._firstTokenCharacterOffset;\n\t}\n\n\tpublic getTokenType(tokenIndex:number): string {\n\t\treturn this._actual.getTokenType(tokenIndex + this._firstTokenInModeIndex);\n\t}\n\n\tpublic getTokenText(tokenIndex:number): string {\n\t\treturn this._actual.getTokenText(tokenIndex + this._firstTokenInModeIndex);\n\t}\n}\n\nconst IGNORE_IN_TOKENS = /\\b(comment|string|regex)\\b/;\nexport function ignoreBracketsInToken(tokenType:string): boolean {\n\treturn IGNORE_IN_TOKENS.test(tokenType);\n}\n\n// TODO@Martin: find a better home for this code:\n// TODO@Martin: modify suggestSupport to return a boolean if snippets should be presented or not\n//       and turn this into a real registry\nexport class SnippetsRegistry {\n\n\tprivate static _defaultSnippets: { [modeId: string]: modes.ISuggestion[] } = Object.create(null);\n\tprivate static _snippets: { [modeId: string]: { [path: string]: modes.ISuggestion[] } } = Object.create(null);\n\n\tpublic static registerDefaultSnippets(modeId: string, snippets: modes.ISuggestion[]): void {\n\t\tthis._defaultSnippets[modeId] = (this._defaultSnippets[modeId] || []).concat(snippets);\n\t}\n\n\tpublic static registerSnippets(modeId: string, path: string, snippets: modes.ISuggestion[]): void {\n\t\tlet snippetsByMode = this._snippets[modeId];\n\t\tif (!snippetsByMode) {\n\t\t\tthis._snippets[modeId] = snippetsByMode = {};\n\t\t}\n\t\tsnippetsByMode[path] = snippets;\n\t}\n\n\t// the previous\n\tprivate static getNonWhitespacePrefix(model: IReadOnlyModel, position: IPosition) {\n\t\tlet line = model.getLineContent(position.lineNumber);\n\t\tlet match = line.match(/[^\\s]+$/);\n\t\tif (match) {\n\t\t\treturn match[0];\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic static getSnippets(model: IReadOnlyModel, position: IPosition): modes.ISuggestResult {\n\t\tlet word = model.getWordAtPosition(position);\n\t\tlet currentWord = word ? word.word.substring(0, position.column - word.startColumn).toLowerCase() : '';\n\t\tlet currentFullWord = SnippetsRegistry.getNonWhitespacePrefix(model, position).toLowerCase();\n\t\tlet result : modes.ISuggestResult = {\n\t\t\tcurrentWord: currentWord,\n\t\t\tincomplete: currentWord.length === 0,\n\t\t\tsuggestions: []\n\t\t};\n\n\t\tlet modeId = model.getModeId();\n\t\tlet snippets : modes.ISuggestion[]= [];\n\t\tlet snipppetsByMode = this._snippets[modeId];\n\t\tif (snipppetsByMode) {\n\t\t\tfor (let s in snipppetsByMode) {\n\t\t\t\tsnippets = snippets.concat(snipppetsByMode[s]);\n\t\t\t}\n\t\t}\n\t\tlet defaultSnippets = this._defaultSnippets[modeId];\n\t\tif (defaultSnippets) {\n\t\t\tsnippets = snippets.concat(defaultSnippets);\n\t\t}\n\t\t// to avoid that snippets are too prominent in the intellisense proposals:\n\t\t// enforce that current word is matched or the position is after a whitespace\n\t\tsnippets.forEach(p => {\n\t\t\tif (currentWord.length === 0 && currentFullWord.length === 0) {\n\t\t\t\t// if there's no prefix, only show snippets at the beginning of the line, or after a whitespace\n\t\t\t} else {\n\t\t\t\tlet label = p.label.toLowerCase();\n\t\t\t\t// force that the current word or full word matches with the snippet prefix\n\t\t\t\tif (currentWord.length > 0 && strings.startsWith(label, currentWord)) {\n\t\t\t\t\t// ok\n\t\t\t\t} else if (currentFullWord.length > currentWord.length && strings.startsWith(label, currentFullWord)) {\n\t\t\t\t\tp = objects.clone(p);\n\t\t\t\t\tp.overwriteBefore = currentFullWord.length;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tresult.suggestions.push(p);\n\t\t});\n\n\t\t// if (result.suggestions.length > 0) {\n\t\t// \tif (word) {\n\t\t// \t\t// Push also the current word as first suggestion, to avoid unexpected snippet acceptance on Enter.\n\t\t// \t\tresult.suggestions = result.suggestions.slice(0);\n\t\t// \t\tresult.suggestions.unshift({\n\t\t// \t\t\tcodeSnippet: word.word,\n\t\t// \t\t\tlabel: word.word,\n\t\t// \t\t\ttype: 'text'\n\t\t// \t\t});\n\t\t// \t}\n\t\t// \tresult.incomplete = true;\n\t\t// }\n\n\t\treturn result;\n\n\t}\n\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IAutoClosingPair, IAutoClosingPairConditional, ILineContext, IRichEditCharacterPair, CharacterPair} from 'vs/editor/common/modes';\nimport {handleEvent} from 'vs/editor/common/modes/supports';\nimport {LanguageConfigurationRegistryImpl} from 'vs/editor/common/modes/languageConfigurationRegistry';\n\nexport class CharacterPairSupport implements IRichEditCharacterPair {\n\n\tprivate _registry: LanguageConfigurationRegistryImpl;\n\tprivate _modeId: string;\n\tprivate _autoClosingPairs: IAutoClosingPairConditional[];\n\tprivate _surroundingPairs: IAutoClosingPair[];\n\n\tconstructor(registry: LanguageConfigurationRegistryImpl, modeId: string, config: { brackets?: CharacterPair[]; autoClosingPairs?: IAutoClosingPairConditional[], surroundingPairs?: IAutoClosingPair[]}) {\n\t\tthis._registry = registry;\n\t\tthis._modeId = modeId;\n\t\tthis._autoClosingPairs = config.autoClosingPairs;\n\t\tif (!this._autoClosingPairs) {\n\t\t\tthis._autoClosingPairs = config.brackets ? config.brackets.map(b => ({ open: b[0], close: b[1] })) : [];\n\t\t}\n\t\tthis._surroundingPairs = config.surroundingPairs || this._autoClosingPairs;\n\t}\n\n\tpublic getAutoClosingPairs(): IAutoClosingPair[] {\n\t\treturn this._autoClosingPairs;\n\t}\n\n\tpublic shouldAutoClosePair(character:string, context:ILineContext, offset:number): boolean {\n\t\treturn handleEvent(context, offset, (nestedModeId:string, context:ILineContext, offset:number) => {\n\t\t\tif (this._modeId === nestedModeId) {\n\n\t\t\t\t// Always complete on empty line\n\t\t\t\tif (context.getTokenCount() === 0) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tvar tokenIndex = context.findIndexOfOffset(offset - 1);\n\t\t\t\tvar tokenType = context.getTokenType(tokenIndex);\n\n\t\t\t\tfor (var i = 0; i < this._autoClosingPairs.length; ++i) {\n\t\t\t\t\tif (this._autoClosingPairs[i].open === character) {\n\t\t\t\t\t\tif (this._autoClosingPairs[i].notIn) {\n\t\t\t\t\t\t\tfor (var notInIndex = 0; notInIndex < this._autoClosingPairs[i].notIn.length; ++notInIndex) {\n\t\t\t\t\t\t\t\tif (tokenType.indexOf(this._autoClosingPairs[i].notIn[notInIndex]) > -1) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet characterPairSupport = this._registry.getCharacterPairSupport(nestedModeId);\n\t\t\tif (characterPairSupport) {\n\t\t\t\treturn characterPairSupport.shouldAutoClosePair(character, context, offset);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tpublic getSurroundingPairs(): IAutoClosingPair[]{\n\t\treturn this._surroundingPairs;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as strings from 'vs/base/common/strings';\nimport {Range} from 'vs/editor/common/core/range';\nimport {IRichEditBracket} from 'vs/editor/common/editorCommon';\nimport {IRichEditBrackets, CharacterPair} from 'vs/editor/common/modes';\n\ninterface ISimpleInternalBracket {\n\topen: string;\n\tclose: string;\n}\n\nexport class RichEditBrackets implements IRichEditBrackets {\n\n\tpublic brackets: IRichEditBracket[];\n\tpublic forwardRegex: RegExp;\n\tpublic reversedRegex: RegExp;\n\tpublic maxBracketLength: number;\n\tpublic textIsBracket: {[text:string]:IRichEditBracket;};\n\tpublic textIsOpenBracket: {[text:string]:boolean;};\n\n\tconstructor(modeId: string, brackets: CharacterPair[]) {\n\t\tthis.brackets = brackets.map((b) => {\n\t\t\treturn {\n\t\t\t\tmodeId: modeId,\n\t\t\t\topen: b[0],\n\t\t\t\tclose: b[1],\n\t\t\t\tforwardRegex: getRegexForBracketPair({ open: b[0], close: b[1] }),\n\t\t\t\treversedRegex: getReversedRegexForBracketPair({ open: b[0], close: b[1] })\n\t\t\t};\n\t\t});\n\t\tthis.forwardRegex = getRegexForBrackets(this.brackets);\n\t\tthis.reversedRegex = getReversedRegexForBrackets(this.brackets);\n\n\t\tthis.textIsBracket = {};\n\t\tthis.textIsOpenBracket = {};\n\t\tthis.maxBracketLength = 0;\n\t\tthis.brackets.forEach((b) => {\n\t\t\tthis.textIsBracket[b.open] = b;\n\t\t\tthis.textIsBracket[b.close] = b;\n\t\t\tthis.textIsOpenBracket[b.open] = true;\n\t\t\tthis.textIsOpenBracket[b.close] = false;\n\t\t\tthis.maxBracketLength = Math.max(this.maxBracketLength, b.open.length);\n\t\t\tthis.maxBracketLength = Math.max(this.maxBracketLength, b.close.length);\n\t\t});\n\t}\n}\n\nfunction once<T, R>(keyFn:(input:T)=>string, computeFn:(input:T)=>R):(input:T)=>R {\n\tlet cache: {[key:string]:R;} = {};\n\treturn (input:T):R => {\n\t\tlet key = keyFn(input);\n\t\tif (!cache.hasOwnProperty(key)) {\n\t\t\tcache[key] = computeFn(input);\n\t\t}\n\t\treturn cache[key];\n\t};\n}\n\nvar getRegexForBracketPair = once<ISimpleInternalBracket,RegExp>(\n\t(input) => `${input.open};${input.close}`,\n\t(input) => {\n\t\treturn createOrRegex([input.open, input.close]);\n\t}\n);\n\nvar getReversedRegexForBracketPair = once<ISimpleInternalBracket,RegExp>(\n\t(input) => `${input.open};${input.close}`,\n\t(input) => {\n\t\treturn createOrRegex([toReversedString(input.open), toReversedString(input.close)]);\n\t}\n);\n\nvar getRegexForBrackets = once<ISimpleInternalBracket[],RegExp>(\n\t(input) => input.map(b => `${b.open};${b.close}`).join(';'),\n\t(input) => {\n\t\tlet pieces: string[] = [];\n\t\tinput.forEach((b) => {\n\t\t\tpieces.push(b.open);\n\t\t\tpieces.push(b.close);\n\t\t});\n\t\treturn createOrRegex(pieces);\n\t}\n);\n\nvar getReversedRegexForBrackets = once<ISimpleInternalBracket[],RegExp>(\n\t(input) => input.map(b => `${b.open};${b.close}`).join(';'),\n\t(input) => {\n\t\tlet pieces: string[] = [];\n\t\tinput.forEach((b) => {\n\t\t\tpieces.push(toReversedString(b.open));\n\t\t\tpieces.push(toReversedString(b.close));\n\t\t});\n\t\treturn createOrRegex(pieces);\n\t}\n);\n\nfunction createOrRegex(pieces:string[]): RegExp {\n\tlet regexStr = `(${pieces.map(strings.escapeRegExpCharacters).join(')|(')})`;\n\treturn strings.createRegExp(regexStr, true, false, false, false);\n}\n\nfunction toReversedString(str:string): string {\n\tlet reversedStr = '';\n\tfor (let i = str.length - 1; i >= 0; i--) {\n\t\treversedStr += str.charAt(i);\n\t}\n\treturn reversedStr;\n}\n\nexport class BracketsUtils {\n\n\tprivate static _findPrevBracketInText(reversedBracketRegex:RegExp, lineNumber:number, reversedText:string, offset:number): Range {\n\t\tlet m = reversedText.match(reversedBracketRegex);\n\n\t\tif (!m) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet matchOffset = reversedText.length - m.index;\n\t\tlet matchLength = m[0].length;\n\t\tlet absoluteMatchOffset = offset + matchOffset;\n\n\t\treturn new Range(lineNumber, absoluteMatchOffset - matchLength + 1, lineNumber, absoluteMatchOffset + 1);\n\t}\n\n\tpublic static findPrevBracketInToken(reversedBracketRegex:RegExp, lineNumber:number, lineText:string, currentTokenStart:number, currentTokenEnd:number): Range {\n\t\t// Because JS does not support backwards regex search, we search forwards in a reversed string with a reversed regex ;)\n\t\tlet currentTokenReversedText = '';\n\t\tfor (let index = currentTokenEnd - 1; index >= currentTokenStart; index--) {\n\t\t\tcurrentTokenReversedText += lineText.charAt(index);\n\t\t}\n\n\t\treturn this._findPrevBracketInText(reversedBracketRegex, lineNumber, currentTokenReversedText, currentTokenStart);\n\t}\n\n\tpublic static findNextBracketInText(bracketRegex:RegExp, lineNumber:number, text:string, offset:number): Range {\n\t\tlet m = text.match(bracketRegex);\n\n\t\tif (!m) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet matchOffset = m.index;\n\t\tlet matchLength = m[0].length;\n\t\tlet absoluteMatchOffset = offset + matchOffset;\n\n\t\treturn new Range(lineNumber, absoluteMatchOffset + 1, lineNumber, absoluteMatchOffset + 1 + matchLength);\n\t}\n\n\tpublic static findNextBracketInToken(bracketRegex:RegExp, lineNumber:number, lineText:string, currentTokenStart:number, currentTokenEnd:number): Range {\n\t\tlet currentTokenText = lineText.substring(currentTokenStart, currentTokenEnd);\n\n\t\treturn this.findNextBracketInText(bracketRegex, lineNumber, currentTokenText, currentTokenStart);\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as strings from 'vs/base/common/strings';\nimport * as modes from 'vs/editor/common/modes';\nimport {handleEvent, ignoreBracketsInToken} from 'vs/editor/common/modes/supports';\nimport {BracketsUtils} from 'vs/editor/common/modes/supports/richEditBrackets';\nimport {LanguageConfigurationRegistryImpl} from 'vs/editor/common/modes/languageConfigurationRegistry';\n\n/**\n * Definition of documentation comments (e.g. Javadoc/JSdoc)\n */\nexport interface IDocComment {\n\tscope: string; // What tokens should be used to detect a doc comment (e.g. 'comment.documentation').\n\topen: string; // The string that starts a doc comment (e.g. '/**')\n\tlineStart: string; // The string that appears at the start of each line, except the first and last (e.g. ' * ').\n\tclose?: string; // The string that appears on the last line and closes the doc comment (e.g. ' */').\n}\n\nexport interface IBracketElectricCharacterContribution {\n\tdocComment?: IDocComment;\n\tembeddedElectricCharacters?: string[];\n}\n\nexport class BracketElectricCharacterSupport implements modes.IRichEditElectricCharacter {\n\n\tprivate _registry: LanguageConfigurationRegistryImpl;\n\tprivate _modeId: string;\n\tprivate contribution: IBracketElectricCharacterContribution;\n\tprivate brackets: Brackets;\n\n\tconstructor(registry:LanguageConfigurationRegistryImpl, modeId: string, brackets: modes.IRichEditBrackets, contribution: IBracketElectricCharacterContribution) {\n\t\tthis._registry = registry;\n\t\tthis._modeId = modeId;\n\t\tthis.contribution = contribution || {};\n\t\tthis.brackets = new Brackets(modeId, brackets, this.contribution.docComment);\n\t}\n\n\tpublic getElectricCharacters(): string[]{\n\t\tif (Array.isArray(this.contribution.embeddedElectricCharacters)) {\n\t\t\treturn this.contribution.embeddedElectricCharacters.concat(this.brackets.getElectricCharacters());\n\t\t}\n\t\treturn this.brackets.getElectricCharacters();\n\t}\n\n\tpublic onElectricCharacter(context:modes.ILineContext, offset:number): modes.IElectricAction {\n\t\treturn handleEvent(context, offset, (nestedModeId:string, context:modes.ILineContext, offset:number) => {\n\t\t\tif (this._modeId === nestedModeId) {\n\t\t\t\treturn this.brackets.onElectricCharacter(context, offset);\n\t\t\t}\n\t\t\tlet electricCharacterSupport = this._registry.getElectricCharacterSupport(nestedModeId);\n\t\t\tif (electricCharacterSupport) {\n\t\t\t\treturn electricCharacterSupport.onElectricCharacter(context, offset);\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\t}\n}\n\n\n\nexport class Brackets {\n\n\tprivate _modeId: string;\n\tprivate _richEditBrackets: modes.IRichEditBrackets;\n\tprivate _docComment: IDocComment;\n\n\tconstructor(modeId: string, richEditBrackets: modes.IRichEditBrackets, docComment: IDocComment = null) {\n\t\tthis._modeId = modeId;\n\t\tthis._richEditBrackets = richEditBrackets;\n\t\tthis._docComment = docComment ? docComment : null;\n\t}\n\n\tpublic getElectricCharacters():string[] {\n\t\tvar result: string[] = [];\n\n\t\tif (this._richEditBrackets) {\n\t\t\tfor (let i = 0, len = this._richEditBrackets.brackets.length; i < len; i++) {\n\t\t\t\tlet bracketPair = this._richEditBrackets.brackets[i];\n\t\t\t\tlet lastChar = bracketPair.close.charAt(bracketPair.close.length - 1);\n\t\t\t\tresult.push(lastChar);\n\t\t\t}\n\t\t}\n\n\t\t// Doc comments\n\t\tif (this._docComment){\n\t\t\tresult.push(this._docComment.open.charAt(this._docComment.open.length - 1));\n\t\t}\n\n\t\t// Filter duplicate entries\n\t\tresult = result.filter((item, pos, array) => {\n\t\t\treturn array.indexOf(item) === pos;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tpublic onElectricCharacter(context: modes.ILineContext, offset: number): modes.IElectricAction {\n\t\tif (context.getTokenCount() === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (this._onElectricCharacterDocComment(context, offset) ||\n\t\t\tthis._onElectricCharacterStandardBrackets(context, offset));\n\t}\n\n\tprivate containsTokenTypes(fullTokenSpec: string, tokensToLookFor: string): boolean {\n\t\tvar array = tokensToLookFor.split('.');\n\t\tfor (var i = 0; i < array.length; ++i) {\n\t\t\tif (fullTokenSpec.indexOf(array[i]) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate _onElectricCharacterStandardBrackets(context: modes.ILineContext, offset: number): modes.IElectricAction {\n\n\t\tif (!this._richEditBrackets || this._richEditBrackets.brackets.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet reversedBracketRegex = this._richEditBrackets.reversedRegex;\n\n\t\tlet lineText = context.getLineContent();\n\t\tlet tokenIndex = context.findIndexOfOffset(offset);\n\t\tlet tokenStart = context.getTokenStartIndex(tokenIndex);\n\t\tlet tokenEnd = offset + 1;\n\n\t\tvar firstNonWhitespaceIndex = strings.firstNonWhitespaceIndex(context.getLineContent());\n\t\tif (firstNonWhitespaceIndex !== -1 && firstNonWhitespaceIndex < tokenStart) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!ignoreBracketsInToken(context.getTokenType(tokenIndex))) {\n\t\t\tlet r = BracketsUtils.findPrevBracketInToken(reversedBracketRegex, 1, lineText, tokenStart, tokenEnd);\n\t\t\tif (r) {\n\t\t\t\tlet text = lineText.substring(r.startColumn - 1, r.endColumn - 1);\n\t\t\t\tlet isOpen = this._richEditBrackets.textIsOpenBracket[text];\n\t\t\t\tif (!isOpen) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tmatchOpenBracket: text\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _onElectricCharacterDocComment(context: modes.ILineContext, offset: number): modes.IElectricAction {\n\t\t// We only auto-close, so do nothing if there is no closing part.\n\t\tif (!this._docComment || !this._docComment.close) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar line = context.getLineContent();\n\t\tvar char: string = line[offset];\n\n\t\t// See if the right electric character was pressed\n\t\tif (char !== this._docComment.open.charAt(this._docComment.open.length - 1)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// If this line already contains the closing tag, do nothing.\n\t\tif (line.indexOf(this._docComment.close, offset) >= 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// If we're not in a documentation comment, do nothing.\n\t\tvar lastTokenIndex = context.findIndexOfOffset(offset);\n\t\tif (! this.containsTokenTypes(context.getTokenType(lastTokenIndex), this._docComment.scope)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (line.substring(context.getTokenStartIndex(lastTokenIndex), offset+1/* include electric char*/) !== this._docComment.open) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn { appendText: this._docComment.close};\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport * as modes from 'vs/editor/common/modes';\nimport {LineStream} from 'vs/editor/common/modes/lineStream';\nimport {NullMode, NullState, nullTokenize} from 'vs/editor/common/modes/nullMode';\nimport {Token} from 'vs/editor/common/modes/supports';\n\nexport interface ILeavingNestedModeData {\n\t/**\n\t * The part of the line that will be tokenized by the nested mode\n\t */\n\tnestedModeBuffer: string;\n\n\t/**\n\t * The part of the line that will be tokenized by the parent mode when it continues after the nested mode\n\t */\n\tbufferAfterNestedMode: string;\n\n\t/**\n\t * The state that will be used for continuing tokenization by the parent mode after the nested mode\n\t */\n\tstateAfterNestedMode: modes.IState;\n}\n\nexport interface IEnteringNestedModeData {\n\tmode:modes.IMode;\n\tmissingModePromise:TPromise<void>;\n}\n\nexport interface ITokenizationCustomization {\n\n\tgetInitialState():modes.IState;\n\n\tenterNestedMode?: (state:modes.IState) => boolean;\n\n\tgetNestedMode?: (state:modes.IState) => IEnteringNestedModeData;\n\n\tgetNestedModeInitialState?: (myState:modes.IState) => { state:modes.IState; missingModePromise:TPromise<void>; };\n\n\t/**\n\t * Return null if the line does not leave the nested mode\n\t */\n\tgetLeavingNestedModeData?: (line:string, state:modes.IState) => ILeavingNestedModeData;\n\n\t/**\n\t * Callback for when leaving a nested mode and returning to the outer mode.\n\t * @param myStateAfterNestedMode The outer mode's state that will begin to tokenize\n\t * @param lastNestedModeState The nested mode's last state\n\t */\n\tonReturningFromNestedMode?: (myStateAfterNestedMode:modes.IState, lastNestedModeState:modes.IState)=> void;\n}\n\nfunction isFunction(something) {\n\treturn typeof something === 'function';\n}\n\nexport class TokenizationSupport implements modes.ITokenizationSupport, IDisposable {\n\n\tstatic MAX_EMBEDDED_LEVELS = 5;\n\n\tprivate customization:ITokenizationCustomization;\n\tprivate defaults: {\n\t\tenterNestedMode: boolean;\n\t\tgetNestedMode: boolean;\n\t\tgetNestedModeInitialState: boolean;\n\t\tgetLeavingNestedModeData: boolean;\n\t\tonReturningFromNestedMode: boolean;\n\t};\n\n\tpublic supportsNestedModes:boolean;\n\n\tprivate _mode:modes.IMode;\n\tprivate _embeddedModesListeners: { [modeId:string]: IDisposable; };\n\n\tconstructor(mode:modes.IMode, customization:ITokenizationCustomization, supportsNestedModes:boolean) {\n\t\tthis._mode = mode;\n\t\tthis.customization = customization;\n\t\tthis.supportsNestedModes = supportsNestedModes;\n\t\tthis._embeddedModesListeners = {};\n\t\tif (this.supportsNestedModes) {\n\t\t\tif (!this._mode.setTokenizationSupport) {\n\t\t\t\tthrow new Error('Cannot be a mode with nested modes unless I can emit a tokenizationSupport changed event!');\n\t\t\t}\n\t\t}\n\t\tthis.defaults = {\n\t\t\tenterNestedMode: !isFunction(customization.enterNestedMode),\n\t\t\tgetNestedMode: !isFunction(customization.getNestedMode),\n\t\t\tgetNestedModeInitialState: !isFunction(customization.getNestedModeInitialState),\n\t\t\tgetLeavingNestedModeData: !isFunction(customization.getLeavingNestedModeData),\n\t\t\tonReturningFromNestedMode: !isFunction(customization.onReturningFromNestedMode)\n\t\t};\n\t}\n\n\tpublic dispose() : void {\n\t\tfor (var listener in this._embeddedModesListeners) {\n\t\t\tthis._embeddedModesListeners[listener].dispose();\n\t\t\tdelete this._embeddedModesListeners[listener];\n\t\t}\n\t}\n\n\tpublic getInitialState(): modes.IState {\n\t\treturn this.customization.getInitialState();\n\t}\n\n\tpublic tokenize(line:string, state:modes.IState, deltaOffset:number = 0, stopAtOffset:number = deltaOffset + line.length):modes.ILineTokens {\n\t\tif (state.getMode() !== this._mode) {\n\t\t\treturn this._nestedTokenize(line, state, deltaOffset, stopAtOffset, [], []);\n\t\t} else {\n\t\t\treturn this._myTokenize(line, state, deltaOffset, stopAtOffset, [], []);\n\t\t}\n\t}\n\n\t/**\n\t * Precondition is: nestedModeState.getMode() !== this\n\t * This means we are in a nested mode when parsing starts on this line.\n\t */\n\tprivate _nestedTokenize(buffer:string, nestedModeState:modes.IState, deltaOffset:number, stopAtOffset:number, prependTokens:modes.IToken[], prependModeTransitions:modes.IModeTransition[]):modes.ILineTokens {\n\t\tvar myStateBeforeNestedMode = nestedModeState.getStateData();\n\t\tvar leavingNestedModeData = this.getLeavingNestedModeData(buffer, myStateBeforeNestedMode);\n\n\t\t// Be sure to give every embedded mode the\n\t\t// opportunity to leave nested mode.\n\t\t// i.e. Don't go straight to the most nested mode\n\t\tvar stepOnceNestedState = nestedModeState;\n\t\twhile (stepOnceNestedState.getStateData() && stepOnceNestedState.getStateData().getMode() !== this._mode) {\n\t\t\tstepOnceNestedState = stepOnceNestedState.getStateData();\n\t\t}\n\t\tvar nestedMode = stepOnceNestedState.getMode();\n\n\t\tif (!leavingNestedModeData) {\n\t\t\t// tokenization will not leave nested mode\n\t\t\tvar result:modes.ILineTokens;\n\t\t\tif (nestedMode.tokenizationSupport) {\n\t\t\t\tresult = nestedMode.tokenizationSupport.tokenize(buffer, nestedModeState, deltaOffset, stopAtOffset);\n\t\t\t} else {\n\t\t\t\t// The nested mode doesn't have tokenization support,\n\t\t\t\t// unfortunatelly this means we have to fake it\n\t\t\t\tresult = nullTokenize(nestedMode, buffer, nestedModeState, deltaOffset);\n\t\t\t}\n\t\t\tresult.tokens = prependTokens.concat(result.tokens);\n\t\t\tresult.modeTransitions = prependModeTransitions.concat(result.modeTransitions);\n\t\t\treturn result;\n\t\t}\n\n\t\tvar nestedModeBuffer = leavingNestedModeData.nestedModeBuffer;\n\t\tif (nestedModeBuffer.length > 0) {\n\t\t\t// Tokenize with the nested mode\n\t\t\tvar nestedModeLineTokens:modes.ILineTokens;\n\t\t\tif (nestedMode.tokenizationSupport) {\n\t\t\t\tnestedModeLineTokens = nestedMode.tokenizationSupport.tokenize(nestedModeBuffer, nestedModeState, deltaOffset, stopAtOffset);\n\t\t\t} else {\n\t\t\t\t// The nested mode doesn't have tokenization support,\n\t\t\t\t// unfortunatelly this means we have to fake it\n\t\t\t\tnestedModeLineTokens = nullTokenize(nestedMode, nestedModeBuffer, nestedModeState, deltaOffset);\n\t\t\t}\n\n\t\t\t// Save last state of nested mode\n\t\t\tnestedModeState = nestedModeLineTokens.endState;\n\n\t\t\t// Prepend nested mode's result to our result\n\t\t\tprependTokens = prependTokens.concat(nestedModeLineTokens.tokens);\n\t\t\tprependModeTransitions = prependModeTransitions.concat(nestedModeLineTokens.modeTransitions);\n\t\t}\n\n\t\tvar bufferAfterNestedMode = leavingNestedModeData.bufferAfterNestedMode;\n\t\tvar myStateAfterNestedMode = leavingNestedModeData.stateAfterNestedMode;\n\t\tmyStateAfterNestedMode.setStateData(myStateBeforeNestedMode.getStateData());\n\t\tthis.onReturningFromNestedMode(myStateAfterNestedMode, nestedModeState);\n\n\t\treturn this._myTokenize(bufferAfterNestedMode, myStateAfterNestedMode, deltaOffset + nestedModeBuffer.length, stopAtOffset, prependTokens, prependModeTransitions);\n\t}\n\n\t/**\n\t * Precondition is: state.getMode() === this\n\t * This means we are in the current mode when parsing starts on this line.\n\t */\n\tprivate _myTokenize(buffer:string, myState:modes.IState, deltaOffset:number, stopAtOffset:number, prependTokens:modes.IToken[], prependModeTransitions:modes.IModeTransition[]):modes.ILineTokens {\n\t\tvar lineStream = new LineStream(buffer);\n\t\tvar tokenResult:modes.ITokenizationResult, beforeTokenizeStreamPos:number;\n\t\tvar previousType:string = null;\n\t\tvar retokenize:TPromise<void> = null;\n\n\t\tmyState = myState.clone();\n\t\tif (prependModeTransitions.length <= 0 || prependModeTransitions[prependModeTransitions.length-1].mode !== this._mode) {\n\t\t\t// Avoid transitioning to the same mode (this can happen in case of empty embedded modes)\n\t\t\tprependModeTransitions.push({\n\t\t\t\tstartIndex: deltaOffset,\n\t\t\t\tmode: this._mode\n\t\t\t});\n\t\t}\n\n\t\tvar maxPos = Math.min(stopAtOffset - deltaOffset, buffer.length);\n\t\twhile (lineStream.pos() < maxPos) {\n\t\t\tbeforeTokenizeStreamPos = lineStream.pos();\n\n\t\t\tdo {\n\t\t\t\ttokenResult = myState.tokenize(lineStream);\n\t\t\t\tif (tokenResult === null || tokenResult === undefined ||\n\t\t\t\t\t((tokenResult.type === undefined || tokenResult.type === null) &&\n\t\t\t\t\t(tokenResult.nextState === undefined || tokenResult.nextState === null))) {\n\t\t\t\t\tthrow new Error('Tokenizer must return a valid state');\n\t\t\t\t}\n\n\t\t\t\tif (tokenResult.nextState) {\n\t\t\t\t\ttokenResult.nextState.setStateData(myState.getStateData());\n\t\t\t\t\tmyState = tokenResult.nextState;\n\t\t\t\t}\n\t\t\t\tif (lineStream.pos() <= beforeTokenizeStreamPos) {\n\t\t\t\t\tthrow new Error('Stream did not advance while tokenizing. Mode id is ' + this._mode.getId() + ' (stuck at token type: \"' + tokenResult.type + '\", prepend tokens: \"' + (prependTokens.map(t => t.type).join(',')) + '\").');\n\t\t\t\t}\n\t\t\t} while (!tokenResult.type && tokenResult.type !== '');\n\n\t\t\tif (previousType !== tokenResult.type || tokenResult.dontMergeWithPrev || previousType === null) {\n\t\t\t\tprependTokens.push(new Token(beforeTokenizeStreamPos + deltaOffset, tokenResult.type));\n\t\t\t}\n\n\t\t\tpreviousType = tokenResult.type;\n\n\t\t\tif (this.supportsNestedModes && this.enterNestedMode(myState)) {\n\t\t\t\tvar currentEmbeddedLevels = this._getEmbeddedLevel(myState);\n\t\t\t\tif (currentEmbeddedLevels < TokenizationSupport.MAX_EMBEDDED_LEVELS) {\n\t\t\t\t\tvar nestedModeState = this.getNestedModeInitialState(myState);\n\n\t\t\t\t\t// Re-emit tokenizationSupport change events from all modes that I ever embedded\n\t\t\t\t\tvar embeddedMode = nestedModeState.state.getMode();\n\t\t\t\t\tif (typeof embeddedMode.addSupportChangedListener === 'function' && !this._embeddedModesListeners.hasOwnProperty(embeddedMode.getId())) {\n\t\t\t\t\t\tvar emitting = false;\n\t\t\t\t\t\tthis._embeddedModesListeners[embeddedMode.getId()] = embeddedMode.addSupportChangedListener((e) => {\n\t\t\t\t\t\t\tif (emitting) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (e.tokenizationSupport) {\n\t\t\t\t\t\t\t\temitting = true;\n\t\t\t\t\t\t\t\tthis._mode.setTokenizationSupport((mode) => {\n\t\t\t\t\t\t\t\t\treturn mode.tokenizationSupport;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\temitting = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\n\t\t\t\t\tif (!lineStream.eos()) {\n\t\t\t\t\t\t// There is content from the embedded mode\n\t\t\t\t\t\tvar restOfBuffer = buffer.substr(lineStream.pos());\n\t\t\t\t\t\tvar result = this._nestedTokenize(restOfBuffer, nestedModeState.state, deltaOffset + lineStream.pos(), stopAtOffset, prependTokens, prependModeTransitions);\n\t\t\t\t\t\tresult.retokenize = result.retokenize || nestedModeState.missingModePromise;\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Transition to the nested mode state\n\t\t\t\t\t\tmyState = nestedModeState.state;\n\t\t\t\t\t\tretokenize = nestedModeState.missingModePromise;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttokens: prependTokens,\n\t\t\tactualStopOffset: lineStream.pos() + deltaOffset,\n\t\t\tmodeTransitions: prependModeTransitions,\n\t\t\tendState: myState,\n\t\t\tretokenize: retokenize\n\t\t};\n\t}\n\n\tprivate _getEmbeddedLevel(state:modes.IState): number {\n\t\tvar result = -1;\n\t\twhile(state) {\n\t\t\tresult++;\n\t\t\tstate = state.getStateData();\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate enterNestedMode(state:modes.IState): boolean {\n\t\tif (this.defaults.enterNestedMode) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.customization.enterNestedMode(state);\n\n\t}\n\n\tprivate getNestedMode(state:modes.IState): IEnteringNestedModeData {\n\t\tif (this.defaults.getNestedMode) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.customization.getNestedMode(state);\n\t}\n\n\tprivate static _validatedNestedMode(input:IEnteringNestedModeData): IEnteringNestedModeData {\n\t\tvar mode: modes.IMode = new NullMode(),\n\t\t\tmissingModePromise: TPromise<void> = null;\n\n\t\tif (input && input.mode) {\n\t\t\tmode = input.mode;\n\t\t}\n\t\tif (input && input.missingModePromise) {\n\t\t\tmissingModePromise = input.missingModePromise;\n\t\t}\n\n\t\treturn {\n\t\t\tmode: mode,\n\t\t\tmissingModePromise: missingModePromise\n\t\t};\n\t}\n\n\tprivate getNestedModeInitialState(state:modes.IState): { state:modes.IState; missingModePromise:TPromise<void>; } {\n\t\tif (this.defaults.getNestedModeInitialState) {\n\t\t\tvar nestedMode = TokenizationSupport._validatedNestedMode(this.getNestedMode(state));\n\t\t\tvar missingModePromise = nestedMode.missingModePromise;\n\t\t\tvar nestedModeState: modes.IState;\n\n\t\t\tif (nestedMode.mode.tokenizationSupport) {\n\t\t\t\tnestedModeState = nestedMode.mode.tokenizationSupport.getInitialState();\n\t\t\t} else {\n\t\t\t\tnestedModeState = new NullState(nestedMode.mode, null);\n\t\t\t}\n\n\t\t\tnestedModeState.setStateData(state);\n\n\t\t\treturn {\n\t\t\t\tstate: nestedModeState,\n\t\t\t\tmissingModePromise: missingModePromise\n\t\t\t};\n\t\t}\n\t\treturn this.customization.getNestedModeInitialState(state);\n\t}\n\n\tprivate getLeavingNestedModeData(line:string, state:modes.IState): ILeavingNestedModeData {\n\t\tif (this.defaults.getLeavingNestedModeData) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.customization.getLeavingNestedModeData(line, state);\n\t}\n\n\tprivate onReturningFromNestedMode(myStateAfterNestedMode:modes.IState, lastNestedModeState:modes.IState): void {\n\t\tif (this.defaults.onReturningFromNestedMode) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.customization.onReturningFromNestedMode(myStateAfterNestedMode, lastNestedModeState);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\n/**\n * Create a syntax highighter with a fully declarative JSON style lexer description\n * using regular expressions.\n */\n\nimport * as modes from 'vs/editor/common/modes';\nimport {AbstractState} from 'vs/editor/common/modes/abstractState';\nimport {LineStream} from 'vs/editor/common/modes/lineStream';\nimport * as monarchCommon from 'vs/editor/common/modes/monarch/monarchCommon';\nimport {IEnteringNestedModeData, TokenizationSupport} from 'vs/editor/common/modes/supports/tokenizationSupport';\nimport {IModeService} from 'vs/editor/common/services/modeService';\n\n/**\n * The MonarchLexer class implements a monaco lexer that highlights source code.\n * It takes a compiled lexer to guide the tokenizer and maintains a stack of\n * lexer states.\n */\nexport class MonarchLexer extends AbstractState {\n\n\tstatic ID = 0;\n\n\tprivate modeService:IModeService;\n\n\tprivate id: number;\n\tprivate lexer: monarchCommon.ILexer;\n\tprivate stack: string[];\n\n\tpublic embeddedMode: string;\n\tpublic embeddedEntered: boolean;\n\n\tprivate groupActions: monarchCommon.IAction[];\n\tprivate groupMatches: string[];\n\tprivate groupMatched: string[];\n\tprivate groupRule: monarchCommon.IRule;\n\n\tconstructor(mode: modes.IMode, modeService:IModeService, lexer: monarchCommon.ILexer, stack?: string[], embeddedMode?: string) {\n\t\tsuper(mode);\n\t\tthis.id = MonarchLexer.ID++; // for debugging, assigns unique id to each instance\n\t\tthis.modeService = modeService;\n\n\t\tthis.lexer = lexer; // (compiled) lexer description\n\t\tthis.stack = (stack ? stack : [lexer.start]); // stack of states\n\t\tthis.embeddedMode = (embeddedMode ? embeddedMode : null); // are we scanning an embedded section?\n\n\t\t// did we encounter an embedded start on this line?\n\t\t// no need for cloning or equality since it is used only within a line\n\t\tthis.embeddedEntered = false;\n\n\t\t// regular expression group matching\n\t\t// these never need cloning or equality since they are only used within a line match\n\t\tthis.groupActions = null;\n\t\tthis.groupMatches = null;\n\t\tthis.groupMatched = null;\n\t\tthis.groupRule = null;\n\t}\n\n\tpublic makeClone(): MonarchLexer {\n\t\treturn new MonarchLexer(this.getMode(), this.modeService, this.lexer, this.stack.slice(0), this.embeddedMode);\n\t}\n\n\tpublic equals(other: modes.IState): boolean {\n\t\tif (!super.equals(other)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!(other instanceof MonarchLexer)) {\n\t\t\treturn false;\n\t\t}\n\t\tvar otherm: MonarchLexer = <MonarchLexer>other;\n\t\tif ((this.stack.length !== otherm.stack.length) || (this.lexer.languageId !== otherm.lexer.languageId) ||\n\t\t\t(this.embeddedMode !== otherm.embeddedMode)) {\n\t\t\treturn false;\n\t\t}\n\t\tvar idx: string;\n\t\tfor (idx in this.stack) {\n\t\t\tif (this.stack.hasOwnProperty(idx)) {\n\t\t\t\tif (this.stack[idx] !== otherm.stack[idx]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * The main tokenizer: this function gets called by monaco to tokenize lines\n\t * Note: we don't want to raise exceptions here and always keep going..\n\t *\n\t * TODO: there are many optimizations possible here for the common cases\n\t * but for now I concentrated on functionality and correctness.\n\t */\n\tpublic tokenize(stream: modes.IStream, noConsumeIsOk?: boolean): modes.ITokenizationResult {\n\t\tvar stackLen0 = this.stack.length;  // these are saved to check progress\n\t\tvar groupLen0 = 0;\n\t\tvar state: string = this.stack[0];  // the current state\n\t\tthis.embeddedEntered = false;\n\n\t\tvar matches: string[] = null;\n\t\tvar matched: string = null;\n\t\tvar action: monarchCommon.IAction = null;\n\t\tvar next: string = null;\n\t\tvar rule: monarchCommon.IRule = null;\n\n\t\t// check if we need to process group matches first\n\t\tif (this.groupActions) {\n\t\t\tgroupLen0 = this.groupActions.length;\n\t\t\tmatches = this.groupMatches;\n\t\t\tmatched = this.groupMatched.shift();\n\t\t\taction = this.groupActions.shift();\n\t\t\trule = this.groupRule;\n\n\t\t\t// cleanup if necessary\n\t\t\tif (this.groupActions.length === 0) {\n\t\t\t\tthis.groupActions = null;\n\t\t\t\tthis.groupMatches = null;\n\t\t\t\tthis.groupMatched = null;\n\t\t\t\tthis.groupRule = null;\n\t\t\t}\n\t\t}\n\t\t\t// otherwise we match on the token stream\n\t\telse {\n\t\t\t// nothing to do\n\t\t\tif (stream.eos()) {\n\t\t\t\treturn { type: '' };\n\t\t\t}\n\n\t\t\t// get the entire line\n\t\t\tvar line = stream.advanceToEOS();\n\t\t\tstream.goBack(line.length);\n\n\t\t\t// get the rules for this state\n\t\t\tvar rules = this.lexer.tokenizer[state];\n\t\t\tif (!rules) {\n\t\t\t\trules = monarchCommon.findRules(this.lexer, state); // do parent matching\n\t\t\t}\n\n\t\t\tif (!rules) {\n\t\t\t\tmonarchCommon.throwError(this.lexer, 'tokenizer state is not defined: ' + state);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// try each rule until we match\n\t\t\t\trule = null;\n\t\t\t\tvar pos = stream.pos();\n\t\t\t\tvar idx: string;\n\t\t\t\tfor (idx in rules) {\n\t\t\t\t\tif (rules.hasOwnProperty(idx)) {\n\t\t\t\t\t\trule = rules[idx];\n\t\t\t\t\t\tif (pos === 0 || !rule.matchOnlyAtLineStart) {\n\t\t\t\t\t\t\tmatches = line.match(rule.regex);\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tmatched = matches[0];\n\t\t\t\t\t\t\t\taction = rule.action;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// We matched 'rule' with 'matches' and 'action'\n\t\tif (!matches) {\n\t\t\tmatches = [''];\n\t\t\tmatched = '';\n\t\t}\n\t\tif (!action) {\n\t\t\t// bad: we didn't match anything, and there is no action to take\n\t\t\t// we need to advance the stream or we get progress trouble\n\t\t\tif (!stream.eos()) {\n\t\t\t\tmatches = [stream.peek()];\n\t\t\t\tmatched = matches[0];\n\t\t\t}\n\t\t\taction = this.lexer.defaultToken;\n\t\t}\n\n\t\t// advance stream\n\t\tstream.advance(matched.length);\n\n\t\t// maybe call action function (used for 'cases')\n\t\twhile (action.test) {\n\t\t\tvar callres = action.test(matched, matches, state, stream.eos());\n\t\t\taction = callres;\n\t\t}\n\n\t\t// set the result: either a string or an array of actions\n\t\tvar result = null;\n\t\tif (typeof (action) === 'string' || Array.isArray(action)) {\n\t\t\tresult = action;\n\t\t}\n\t\telse if (action.group) {\n\t\t\tresult = action.group;\n\t\t}\n\t\telse if (action.token !== null && action.token !== undefined) {\n\t\t\tresult = action.token;\n\n\t\t\t// do $n replacements?\n\t\t\tif (action.tokenSubst) {\n\t\t\t\tresult = monarchCommon.substituteMatches(this.lexer, result, matched, matches, state);\n\t\t\t}\n\n\t\t\t// enter embedded mode?\n\t\t\tif (action.nextEmbedded) {\n\t\t\t\tif (action.nextEmbedded === '@pop') {\n\t\t\t\t\tif (!this.embeddedMode) {\n\t\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'cannot pop embedded mode if not inside one');\n\t\t\t\t\t}\n\t\t\t\t\tthis.embeddedMode = null;\n\t\t\t\t}\n\t\t\t\telse if (this.embeddedMode) {\n\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'cannot enter embedded mode from within an embedded mode');\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.embeddedMode = monarchCommon.substituteMatches(this.lexer, action.nextEmbedded, matched, matches, state);\n\n\t\t\t\t\t// substitute language alias to known modes to support syntax highlighting\n\t\t\t\t\tvar embeddedMode = this.modeService.getModeIdForLanguageName(this.embeddedMode);\n\t\t\t\t\tif (this.embeddedMode && embeddedMode) {\n\t\t\t\t\t\tthis.embeddedMode = embeddedMode;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.embeddedEntered = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// state transformations\n\t\t\tif (action.goBack) { // back up the stream..\n\t\t\t\tstream.goBack(action.goBack);\n\t\t\t}\n\t\t\tif (action.switchTo && typeof action.switchTo === 'string') {\n\t\t\t\tvar nextState = monarchCommon.substituteMatches(this.lexer, action.switchTo, matched, matches, state);  // switch state without a push...\n\t\t\t\tif (nextState[0] === '@') {\n\t\t\t\t\tnextState = nextState.substr(1); // peel off starting '@'\n\t\t\t\t}\n\t\t\t\tif (!monarchCommon.findRules(this.lexer, nextState)) {\n\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'trying to switch to a state \\'' + nextState + '\\' that is undefined in rule: ' + rule.name);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.stack[0] = nextState;\n\t\t\t\t}\n\t\t\t\tnext = null;\n\t\t\t}\n\t\t\telse if (action.transform && typeof action.transform === 'function') {\n\t\t\t\tthis.stack = action.transform(this.stack); // if you need to do really funky stuff...\n\t\t\t\tnext = null;\n\t\t\t}\n\t\t\telse if (action.next) {\n\t\t\t\tif (action.next === '@push') {\n\t\t\t\t\tif (this.stack.length >= this.lexer.maxStack) {\n\t\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'maximum tokenizer stack size reached: [' +\n\t\t\t\t\t\t\tthis.stack[0] + ',' + this.stack[1] + ',...,' +\n\t\t\t\t\t\t\tthis.stack[this.stack.length - 2] + ',' + this.stack[this.stack.length - 1] + ']');\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.stack.unshift(state);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (action.next === '@pop') {\n\t\t\t\t\tif (this.stack.length <= 1) {\n\t\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'trying to pop an empty stack in rule: ' + rule.name);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.stack.shift();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (action.next === '@popall') {\n\t\t\t\t\tif (this.stack.length > 1) {\n\t\t\t\t\t\tthis.stack = [this.stack[this.stack.length - 1]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar nextState = monarchCommon.substituteMatches(this.lexer, action.next, matched, matches, state);\n\t\t\t\t\tif (nextState[0] === '@') {\n\t\t\t\t\t\tnextState = nextState.substr(1); // peel off starting '@'\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!monarchCommon.findRules(this.lexer, nextState)) {\n\t\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'trying to set a next state \\'' + nextState + '\\' that is undefined in rule: ' + rule.name);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.stack.unshift(nextState);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (action.log && typeof (action.log) === 'string') {\n\t\t\t\tmonarchCommon.log(this.lexer, this.lexer.languageId + ': ' + monarchCommon.substituteMatches(this.lexer, action.log, matched, matches, state));\n\t\t\t}\n\t\t}\n\n\t\t// check result\n\t\tif (result === null) {\n\t\t\tmonarchCommon.throwError(this.lexer, 'lexer rule has no well-defined action in rule: ' + rule.name);\n\t\t\tresult = this.lexer.defaultToken;\n\t\t}\n\n\t\t// is the result a group match?\n\t\tif (Array.isArray(result)) {\n\t\t\tif (this.groupActions && this.groupActions.length > 0) {\n\t\t\t\tmonarchCommon.throwError(this.lexer, 'groups cannot be nested: ' + rule.name);\n\t\t\t}\n\t\t\tif (matches.length !== result.length + 1) {\n\t\t\t\tmonarchCommon.throwError(this.lexer, 'matched number of groups does not match the number of actions in rule: ' + rule.name);\n\t\t\t}\n\t\t\tvar totalLen = 0;\n\t\t\tfor (var i = 1; i < matches.length; i++) {\n\t\t\t\ttotalLen += matches[i].length;\n\t\t\t}\n\t\t\tif (totalLen !== matched.length) {\n\t\t\t\tmonarchCommon.throwError(this.lexer, 'with groups, all characters should be matched in consecutive groups in rule: ' + rule.name);\n\t\t\t}\n\t\t\tthis.groupMatches = matches;\n\t\t\tthis.groupMatched = matches.slice(1);\n\t\t\tthis.groupActions = result.slice(0);\n\t\t\tthis.groupRule = rule;\n\t\t\tstream.goBack(matched.length);\n\t\t\treturn this.tokenize(stream);  // call recursively to initiate first result match\n\t\t}\n\t\t\t// regular result\n\t\telse {\n\t\t\t// check for '@rematch'\n\t\t\tif (result === '@rematch') {\n\t\t\t\tstream.goBack(matched.length);\n\t\t\t\tmatched = '';  // better set the next state too..\n\t\t\t\tmatches = null;\n\t\t\t\tresult = '';\n\t\t\t}\n\n\t\t\t// check progress\n\t\t\tif (matched.length === 0) {\n\t\t\t\tif (stackLen0 !== this.stack.length || state !== this.stack[0]\n\t\t\t\t\t|| (!this.groupActions ? 0 : this.groupActions.length) !== groupLen0) {\n\t\t\t\t\tif (!noConsumeIsOk) { // used for nested modes..\n\t\t\t\t\t\treturn this.tokenize(stream); // tokenize again in the new state\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmonarchCommon.throwError(this.lexer, 'no progress in tokenizer in rule: ' + rule.name);\n\t\t\t\t\tstream.advanceToEOS(); // must make progress or editor loops\n\t\t\t\t\t// result='';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// return the result (and check for brace matching)\n\t\t\t// todo: for efficiency we could pre-sanitize tokenPostfix and substitutions\n\t\t\tif (result.indexOf('@brackets') === 0) {\n\t\t\t\tvar rest = result.substr('@brackets'.length);\n\t\t\t\tvar bracket = findBracket(this.lexer, matched);\n\t\t\t\tif (!bracket) {\n\t\t\t\t\tmonarchCommon.throwError(this.lexer, '@brackets token returned but no bracket defined as: ' + matched);\n\t\t\t\t\tbracket = { token: '', bracketType: monarchCommon.MonarchBracket.None };\n\t\t\t\t}\n\t\t\t\treturn { type: monarchCommon.sanitize(bracket.token + rest) };\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar token = (result === '' ? '' : result + this.lexer.tokenPostfix);\n\t\t\t\treturn { type: monarchCommon.sanitize(token) };\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Searches for a bracket in the 'brackets' attribute that matches the input.\n */\nfunction findBracket(lexer: monarchCommon.ILexer, matched: string) {\n\tif (!matched) {\n\t\treturn null;\n\t}\n\tmatched = monarchCommon.fixCase(lexer, matched);\n\n\tvar brackets = lexer.brackets;\n\tfor (var i = 0; i < brackets.length; i++) {\n\t\tvar bracket = brackets[i];\n\t\tif (bracket.open === matched) {\n\t\t\treturn { token: bracket.token, bracketType: monarchCommon.MonarchBracket.Open };\n\t\t}\n\t\telse if (bracket.close === matched) {\n\t\t\treturn { token: bracket.token, bracketType: monarchCommon.MonarchBracket.Close };\n\t\t}\n\t}\n\treturn null;\n}\n\nexport function createTokenizationSupport(modeService:IModeService, mode:modes.IMode, lexer: monarchCommon.ILexer): modes.ITokenizationSupport {\n\treturn new TokenizationSupport(mode, {\n\t\tgetInitialState: (): modes.IState => {\n\t\t\treturn new MonarchLexer(mode, modeService, lexer);\n\t\t},\n\n\t\tenterNestedMode: (state: modes.IState): boolean => {\n\t\t\tif (state instanceof MonarchLexer) {\n\t\t\t\treturn state.embeddedEntered;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tgetNestedMode: (rawState: modes.IState): IEnteringNestedModeData => {\n\t\t\tvar mime = (<MonarchLexer>rawState).embeddedMode;\n\n\t\t\tif (!modeService.isRegisteredMode(mime)) {\n\t\t\t\t// unknown mode\n\t\t\t\treturn {\n\t\t\t\t\tmode: modeService.getMode('text/plain'),\n\t\t\t\t\tmissingModePromise: null\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar mode = modeService.getMode(mime);\n\t\t\tif (mode) {\n\t\t\t\t// mode is available\n\t\t\t\treturn {\n\t\t\t\t\tmode: mode,\n\t\t\t\t\tmissingModePromise: null\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// mode is not yet loaded\n\t\t\treturn {\n\t\t\t\tmode: modeService.getMode('text/plain'),\n\t\t\t\tmissingModePromise: modeService.getOrCreateMode(mime).then(() => null)\n\t\t\t};\n\t\t},\n\n\t\tgetLeavingNestedModeData: (line: string, state: modes.IState) => {\n\t\t\t// state = state.clone();\n\t\t\tvar mstate = <MonarchLexer>state.clone();\n\t\t\tvar stream = new LineStream(line);\n\t\t\twhile (!stream.eos() && mstate.embeddedMode) {\n\t\t\t\tmstate.tokenize(stream, true); // allow no consumption for @rematch\n\t\t\t}\n\t\t\tif (mstate.embeddedMode) {\n\t\t\t\treturn null;  // don't leave yet\n\t\t\t}\n\n\t\t\tvar end = stream.pos();\n\t\t\treturn {\n\t\t\t\tnestedModeBuffer: line.substring(0, end),\n\t\t\t\tbufferAfterNestedMode: line.substring(end),\n\t\t\t\tstateAfterNestedMode: mstate\n\t\t\t};\n\t\t}\n\t}, lexer.usesEmbedded);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nexport class PrefixSumIndexOfResult {\n\t_prefixSumIndexOfResultBrand: void;\n\n\tindex: number;\n\tremainder: number;\n\n\tconstructor(index:number, remainder:number) {\n\t\tthis.index = index;\n\t\tthis.remainder = remainder;\n\t}\n}\n\nexport class PrefixSumComputer {\n\n\t/**\n\t * values[i] is the value at index i\n\t */\n\tprivate values:number[];\n\n\t/**\n\t * prefixSum[i] = SUM(heights[j]), 0 <= j <= i\n\t */\n\tprivate prefixSum:number[];\n\n\t/**\n\t * prefixSum[i], 0 <= i <= prefixSumValidIndex can be trusted\n\t */\n\tprivate prefixSumValidIndex:number;\n\n\tconstructor(values:number[]) {\n\t\tthis.values = values;\n\t\tthis.prefixSum = [];\n\t\tfor (let i = 0, len = this.values.length; i < len; i++) {\n\t\t\tthis.prefixSum[i] = 0;\n\t\t}\n\t\tthis.prefixSumValidIndex = -1;\n\t}\n\n\tpublic getCount(): number {\n\t\treturn this.values.length;\n\t}\n\n\tpublic insertValue(insertIndex:number, value:number): void {\n\t\tinsertIndex = Math.floor(insertIndex); //@perf\n\t\tvalue = Math.floor(value); //@perf\n\n\t\tthis.values.splice(insertIndex, 0, value);\n\t\tthis.prefixSum.splice(insertIndex, 0, 0);\n\t\tif (insertIndex - 1 < this.prefixSumValidIndex) {\n\t\t\tthis.prefixSumValidIndex = insertIndex - 1;\n\t\t}\n\t}\n\n\tpublic insertValues(insertIndex: number, values: number[]): void {\n\t\tinsertIndex = Math.floor(insertIndex); //@perf\n\n\t\tif (values.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.values = this.values.slice(0, insertIndex).concat(values).concat(this.values.slice(insertIndex));\n\t\tthis.prefixSum = this.prefixSum.slice(0, insertIndex).concat(PrefixSumComputer._zeroArray(values.length)).concat(this.prefixSum.slice(insertIndex));\n\n\t\tif (insertIndex - 1 < this.prefixSumValidIndex) {\n\t\t\tthis.prefixSumValidIndex = insertIndex - 1;\n\t\t}\n\t}\n\n\tprivate static _zeroArray(count: number): number[] {\n\t\tcount = Math.floor(count); //@perf\n\n\t\tlet r: number[] = [];\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tr[i] = 0;\n\t\t}\n\t\treturn r;\n\t}\n\n\tpublic changeValue(index:number, value:number): void {\n\t\tindex = Math.floor(index); //@perf\n\t\tvalue = Math.floor(value); //@perf\n\n\t\tif (this.values[index] === value) {\n\t\t\treturn;\n\t\t}\n\t\tthis.values[index] = value;\n\t\tif (index - 1 < this.prefixSumValidIndex) {\n\t\t\tthis.prefixSumValidIndex = index - 1;\n\t\t}\n\t}\n\n\tpublic removeValues(startIndex:number, cnt:number): void {\n\t\tstartIndex = Math.floor(startIndex); //@perf\n\t\tcnt = Math.floor(cnt); //@perf\n\n\t\tthis.values.splice(startIndex, cnt);\n\t\tthis.prefixSum.splice(startIndex, cnt);\n\t\tif (startIndex - 1 < this.prefixSumValidIndex) {\n\t\t\tthis.prefixSumValidIndex = startIndex - 1;\n\t\t}\n\t}\n\n\tpublic getTotalValue(): number {\n\t\tif (this.values.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn this.getAccumulatedValue(this.values.length - 1);\n\t}\n\n\tpublic getAccumulatedValue(index:number): number {\n\t\tindex = Math.floor(index); //@perf\n\n\t\tif (index < 0) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (index <= this.prefixSumValidIndex) {\n\t\t\treturn this.prefixSum[index];\n\t\t}\n\n\t\tlet startIndex = this.prefixSumValidIndex + 1;\n\t\tif (startIndex === 0) {\n\t\t\tthis.prefixSum[0] = this.values[0];\n\t\t\tstartIndex++;\n\t\t}\n\n\t\tif (index >= this.values.length) {\n\t\t\tindex = this.values.length - 1;\n\t\t}\n\n\t\tfor (let i = startIndex; i <= index; i++) {\n\t\t\tthis.prefixSum[i] = this.prefixSum[i - 1] + this.values[i];\n\t\t}\n\t\tthis.prefixSumValidIndex = Math.max(this.prefixSumValidIndex, index);\n\t\treturn this.prefixSum[index];\n\t}\n\n\tpublic getIndexOf(accumulatedValue:number): PrefixSumIndexOfResult {\n\t\taccumulatedValue = Math.floor(accumulatedValue); //@perf\n\n\t\tlet low = 0;\n\t\tlet high = this.values.length - 1;\n\t\tlet mid:number;\n\t\tlet midStop:number;\n\t\tlet midStart:number;\n\n\t\twhile (low <= high) {\n\t\t\tmid = low + ( (high-low)/2 ) | 0;\n\n\t\t\tmidStop = this.getAccumulatedValue(mid);\n\t\t\tmidStart = midStop - this.values[mid];\n\n\t\t\tif (accumulatedValue < midStart) {\n\t\t\t\thigh = mid - 1;\n\t\t\t} else if (accumulatedValue >= midStop) {\n\t\t\t\tlow = mid + 1;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn new PrefixSumIndexOfResult(mid, accumulatedValue - midStart);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport nls = require('vs/nls');\nimport objects = require('vs/base/common/objects');\nimport platform = require('vs/base/common/platform');\nimport types = require('vs/base/common/types');\nimport arrays = require('vs/base/common/arrays');\nimport strings = require('vs/base/common/strings');\nimport {IAction} from 'vs/base/common/actions';\nimport {IXHRResponse} from 'vs/base/common/http';\nimport Severity from 'vs/base/common/severity';\nimport { TPromise } from 'vs/base/common/winjs.base';\n\nexport interface ErrorListenerCallback {\n\t(error: any): void;\n}\n\nexport interface ErrorListenerUnbind {\n\t(): void;\n}\n\n// Avoid circular dependency on EventEmitter by implementing a subset of the interface.\nexport class ErrorHandler {\n\tprivate unexpectedErrorHandler: (e: any) => void;\n\tprivate listeners: ErrorListenerCallback[];\n\n\tconstructor() {\n\n\t\tthis.listeners = [];\n\n\t\tthis.unexpectedErrorHandler = function(e: any) {\n\t\t\tplatform.setTimeout(() => {\n\t\t\t\tif (e.stack) {\n\t\t\t\t\tthrow new Error(e.message + '\\n\\n' + e.stack);\n\t\t\t\t}\n\n\t\t\t\tthrow e;\n\t\t\t}, 0);\n\t\t};\n\t}\n\n\tpublic addListener(listener: ErrorListenerCallback): ErrorListenerUnbind {\n\t\tthis.listeners.push(listener);\n\n\t\treturn () => {\n\t\t\tthis._removeListener(listener);\n\t\t};\n\t}\n\n\tprivate emit(e: any): void {\n\t\tthis.listeners.forEach((listener) => {\n\t\t\tlistener(e);\n\t\t});\n\t}\n\n\tprivate _removeListener(listener: ErrorListenerCallback): void {\n\t\tthis.listeners.splice(this.listeners.indexOf(listener), 1);\n\t}\n\n\tpublic setUnexpectedErrorHandler(newUnexpectedErrorHandler: (e: any) => void): void {\n\t\tthis.unexpectedErrorHandler = newUnexpectedErrorHandler;\n\t}\n\n\tpublic getUnexpectedErrorHandler(): (e: any) => void {\n\t\treturn this.unexpectedErrorHandler;\n\t}\n\n\tpublic onUnexpectedError(e: any): void {\n\t\tthis.unexpectedErrorHandler(e);\n\t\tthis.emit(e);\n\t}\n}\n\nexport let errorHandler = new ErrorHandler();\n\nexport function setUnexpectedErrorHandler(newUnexpectedErrorHandler: (e: any) => void): void {\n\terrorHandler.setUnexpectedErrorHandler(newUnexpectedErrorHandler);\n}\n\nexport function onUnexpectedError(e: any): void {\n\n\t// ignore errors from cancelled promises\n\tif (!isPromiseCanceledError(e)) {\n\t\terrorHandler.onUnexpectedError(e);\n\t}\n}\n\nexport function onUnexpectedPromiseError<T>(promise: TPromise<T>): TPromise<T> {\n\treturn promise.then<T>(null, onUnexpectedError);\n}\n\nexport interface IConnectionErrorData {\n\tstatus: number;\n\tstatusText?: string;\n\tresponseText?: string;\n}\n\nexport function transformErrorForSerialization(error: any): any {\n\tif (error instanceof Error) {\n\t\tlet {name, message} = error;\n\t\tlet stack: string = (<any>error).stacktrace || (<any>error).stack;\n\t\treturn {\n\t\t\t$isError: true,\n\t\t\tname,\n\t\t\tmessage,\n\t\t\tstack\n\t\t};\n\t}\n\n\t// return as is\n\treturn error;\n}\n\n/**\n * The base class for all connection errors originating from XHR requests.\n */\nexport class ConnectionError implements Error {\n\tpublic status: number;\n\tpublic statusText: string;\n\tpublic responseText: string;\n\tpublic errorMessage: string;\n\tpublic errorCode: string;\n\tpublic errorObject: any;\n\tpublic name: string;\n\n\tconstructor(mixin: IConnectionErrorData);\n\tconstructor(request: IXHRResponse);\n\tconstructor(arg: any) {\n\t\tthis.status = arg.status;\n\t\tthis.statusText = arg.statusText;\n\t\tthis.name = 'ConnectionError';\n\n\t\ttry {\n\t\t\tthis.responseText = arg.responseText;\n\t\t} catch (e) {\n\t\t\tthis.responseText = '';\n\t\t}\n\n\t\tthis.errorMessage = null;\n\t\tthis.errorCode = null;\n\t\tthis.errorObject = null;\n\n\t\tif (this.responseText) {\n\t\t\ttry {\n\t\t\t\tlet errorObj = JSON.parse(this.responseText);\n\t\t\t\tthis.errorMessage = errorObj.message;\n\t\t\t\tthis.errorCode = errorObj.code;\n\t\t\t\tthis.errorObject = errorObj;\n\t\t\t} catch (error) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic get message(): string {\n\t\treturn this.connectionErrorToMessage(this, false);\n\t}\n\n\tpublic get verboseMessage(): string {\n\t\treturn this.connectionErrorToMessage(this, true);\n\t}\n\n\tprivate connectionErrorDetailsToMessage(error: ConnectionError, verbose: boolean): string {\n\t\tlet errorCode = error.errorCode;\n\t\tlet errorMessage = error.errorMessage;\n\n\t\tif (errorCode !== null && errorMessage !== null) {\n\t\t\treturn nls.localize(\n\t\t\t\t{\n\t\t\t\t\tkey: 'message',\n\t\t\t\t\tcomment: [\n\t\t\t\t\t\t'{0} represents the error message',\n\t\t\t\t\t\t'{1} represents the error code'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t\"{0}. Error code: {1}\",\n\t\t\t\tstrings.rtrim(errorMessage, '.'), errorCode);\n\t\t}\n\n\t\tif (errorMessage !== null) {\n\t\t\treturn errorMessage;\n\t\t}\n\n\t\tif (verbose && error.responseText !== null) {\n\t\t\treturn error.responseText;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate connectionErrorToMessage(error: ConnectionError, verbose: boolean): string {\n\t\tlet details = this.connectionErrorDetailsToMessage(error, verbose);\n\n\t\t// Status Code based Error\n\t\tif (error.status === 401) {\n\t\t\tif (details !== null) {\n\t\t\t\treturn nls.localize(\n\t\t\t\t\t{\n\t\t\t\t\t\tkey: 'error.permission.verbose',\n\t\t\t\t\t\tcomment: [\n\t\t\t\t\t\t\t'{0} represents detailed information why the permission got denied'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\t\"Permission Denied (HTTP {0})\",\n\t\t\t\t\tdetails);\n\t\t\t}\n\n\t\t\treturn nls.localize('error.permission', \"Permission Denied\");\n\t\t}\n\n\t\t// Return error details if present\n\t\tif (details) {\n\t\t\treturn details;\n\t\t}\n\n\t\t// Fallback to HTTP Status and Code\n\t\tif (error.status > 0 && error.statusText !== null) {\n\t\t\tif (verbose && error.responseText !== null && error.responseText.length > 0) {\n\t\t\t\treturn nls.localize('error.http.verbose', \"{0} (HTTP {1}: {2})\", error.statusText, error.status, error.responseText);\n\t\t\t}\n\n\t\t\treturn nls.localize('error.http', \"{0} (HTTP {1})\", error.statusText, error.status);\n\t\t}\n\n\t\t// Finally its an Unknown Connection Error\n\t\tif (verbose && error.responseText !== null && error.responseText.length > 0) {\n\t\t\treturn nls.localize('error.connection.unknown.verbose', \"Unknown Connection Error ({0})\", error.responseText);\n\t\t}\n\n\t\treturn nls.localize('error.connection.unknown', \"An unknown connection error occurred. Either you are no longer connected to the internet or the server you are connected to is offline.\");\n\t}\n}\n\n// Bug: Can not subclass a JS Type. Do it manually (as done in WinJS.Class.derive)\nobjects.derive(Error, ConnectionError);\n\nfunction xhrToErrorMessage(xhr: IConnectionErrorData, verbose: boolean): string {\n\tlet ce = new ConnectionError(xhr);\n\tif (verbose) {\n\t\treturn ce.verboseMessage;\n\t} else {\n\t\treturn ce.message;\n\t}\n}\n\nfunction exceptionToErrorMessage(exception: any, verbose: boolean): string {\n\tif (exception.message) {\n\t\tif (verbose && (exception.stack || exception.stacktrace)) {\n\t\t\treturn nls.localize('stackTrace.format', \"{0}: {1}\", detectSystemErrorMessage(exception), exception.stack || exception.stacktrace);\n\t\t}\n\n\t\treturn detectSystemErrorMessage(exception);\n\t}\n\n\treturn nls.localize('error.defaultMessage', \"An unknown error occurred. Please consult the log for more details.\");\n}\n\nfunction detectSystemErrorMessage(exception: any): string {\n\n\t// See https://nodejs.org/api/errors.html#errors_class_system_error\n\tif (typeof exception.code === 'string' && typeof exception.errno === 'number' && typeof exception.syscall === 'string') {\n\t\treturn nls.localize('nodeExceptionMessage', \"A system error occured ({0})\", exception.message);\n\t}\n\n\treturn exception.message;\n}\n\n/**\n * Tries to generate a human readable error message out of the error. If the verbose parameter\n * is set to true, the error message will include stacktrace details if provided.\n * @returns A string containing the error message.\n */\nexport function toErrorMessage(error: any = null, verbose: boolean = false): string {\n\tif (!error) {\n\t\treturn nls.localize('error.defaultMessage', \"An unknown error occurred. Please consult the log for more details.\");\n\t}\n\n\tif (Array.isArray(error)) {\n\t\tlet errors: any[] = arrays.coalesce(error);\n\t\tlet msg = toErrorMessage(errors[0], verbose);\n\n\t\tif (errors.length > 1) {\n\t\t\treturn nls.localize('error.moreErrors', \"{0} ({1} errors in total)\", msg, errors.length);\n\t\t}\n\n\t\treturn msg;\n\t}\n\n\tif (types.isString(error)) {\n\t\treturn error;\n\t}\n\n\tif (!types.isUndefinedOrNull(error.status)) {\n\t\treturn xhrToErrorMessage(error, verbose);\n\t}\n\n\tif (error.detail) {\n\t\tlet detail = error.detail;\n\n\t\tif (detail.error) {\n\t\t\tif (detail.error && !types.isUndefinedOrNull(detail.error.status)) {\n\t\t\t\treturn xhrToErrorMessage(detail.error, verbose);\n\t\t\t}\n\n\t\t\tif (types.isArray(detail.error)) {\n\t\t\t\tfor (let i = 0; i < detail.error.length; i++) {\n\t\t\t\t\tif (detail.error[i] && !types.isUndefinedOrNull(detail.error[i].status)) {\n\t\t\t\t\t\treturn xhrToErrorMessage(detail.error[i], verbose);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\treturn exceptionToErrorMessage(detail.error, verbose);\n\t\t\t}\n\t\t}\n\n\t\tif (detail.exception) {\n\t\t\tif (!types.isUndefinedOrNull(detail.exception.status)) {\n\t\t\t\treturn xhrToErrorMessage(detail.exception, verbose);\n\t\t\t}\n\n\t\t\treturn exceptionToErrorMessage(detail.exception, verbose);\n\t\t}\n\t}\n\n\tif (error.stack) {\n\t\treturn exceptionToErrorMessage(error, verbose);\n\t}\n\n\tif (error.message) {\n\t\treturn error.message;\n\t}\n\n\treturn nls.localize('error.defaultMessage', \"An unknown error occurred. Please consult the log for more details.\");\n}\n\nconst canceledName = 'Canceled';\n\n/**\n * Checks if the given error is a promise in canceled state\n */\nexport function isPromiseCanceledError(error: any): boolean {\n\treturn error instanceof Error && error.name === canceledName && error.message === canceledName;\n}\n\n/**\n * Returns an error that signals cancellation.\n */\nexport function canceled(): Error {\n\tlet error = new Error(canceledName);\n\terror.name = error.message;\n\treturn error;\n}\n\n/**\n * Returns an error that signals something is not implemented.\n */\nexport function notImplemented(): Error {\n\treturn new Error(nls.localize('notImplementedError', \"Not Implemented\"));\n}\n\nexport function illegalArgument(name?: string): Error {\n\tif (name) {\n\t\treturn new Error(nls.localize('illegalArgumentError', \"Illegal argument: {0}\", name));\n\t} else {\n\t\treturn new Error(nls.localize('illegalArgumentError2', \"Illegal argument\"));\n\t}\n}\n\nexport function illegalState(name?: string): Error {\n\tif (name) {\n\t\treturn new Error(nls.localize('illegalStateError', \"Illegal state: {0}\", name));\n\t} else {\n\t\treturn new Error(nls.localize('illegalStateError2', \"Illegal state\"));\n\t}\n}\n\nexport function readonly(name?: string): Error {\n\treturn name\n\t\t? new Error(`readonly property '${name} cannot be changed'`)\n\t\t: new Error('readonly property cannot be changed');\n}\n\nexport function loaderError(err: Error): Error {\n\tif (platform.isWeb) {\n\t\treturn new Error(nls.localize('loaderError', \"Failed to load a required file. Either you are no longer connected to the internet or the server you are connected to is offline. Please refresh the browser to try again.\"));\n\t}\n\n\treturn new Error(nls.localize('loaderErrorNative', \"Failed to load a required file. Please restart the application to try again. Details: {0}\", JSON.stringify(err)));\n}\n\nexport interface IErrorOptions {\n\tseverity?: Severity;\n\tactions?: IAction[];\n}\n\nexport function create(message: string, options: IErrorOptions = {}): Error {\n\tlet result = new Error(message);\n\n\tif (types.isNumber(options.severity)) {\n\t\t(<any>result).severity = options.severity;\n\t}\n\n\tif (options.actions) {\n\t\t(<any>result).actions = options.actions;\n\t}\n\n\treturn result;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {onUnexpectedError} from 'vs/base/common/errors';\n\nexport default class CallbackList {\n\n\tprivate _callbacks: Function[];\n\tprivate _contexts: any[];\n\n\tpublic add(callback: Function, context: any = null, bucket?: IDisposable[]): void {\n\t\tif (!this._callbacks) {\n\t\t\tthis._callbacks = [];\n\t\t\tthis._contexts = [];\n\t\t}\n\t\tthis._callbacks.push(callback);\n\t\tthis._contexts.push(context);\n\n\t\tif (Array.isArray(bucket)) {\n\t\t\tbucket.push({ dispose: () => this.remove(callback, context) });\n\t\t}\n\t}\n\n\tpublic remove(callback: Function, context: any = null): void {\n\t\tif (!this._callbacks) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet foundCallbackWithDifferentContext = false;\n\t\tfor (var i = 0, len = this._callbacks.length; i < len; i++) {\n\t\t\tif (this._callbacks[i] === callback) {\n\t\t\t\tif (this._contexts[i] === context) {\n\t\t\t\t\t// callback & context match => remove it\n\t\t\t\t\tthis._callbacks.splice(i, 1);\n\t\t\t\t\tthis._contexts.splice(i, 1);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tfoundCallbackWithDifferentContext = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (foundCallbackWithDifferentContext) {\n\t\t\tthrow new Error('When adding a listener with a context, you should remove it with the same context');\n\t\t}\n\t}\n\n\tpublic invoke(...args: any[]): any[] {\n\t\tif (!this._callbacks) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ret: any[] = [],\n\t\t\tcallbacks = this._callbacks.slice(0),\n\t\t\tcontexts = this._contexts.slice(0);\n\n\t\tfor (var i = 0, len = callbacks.length; i < len; i++) {\n\t\t\ttry {\n\t\t\t\tret.push(callbacks[i].apply(contexts[i], args));\n\t\t\t} catch (e) {\n\t\t\t\tonUnexpectedError(e);\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn !this._callbacks || this._callbacks.length === 0;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._callbacks = undefined;\n\t\tthis._contexts = undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IDisposable}  from 'vs/base/common/lifecycle';\nimport CallbackList from 'vs/base/common/callbackList';\nimport {EventEmitter} from 'vs/base/common/eventEmitter';\n\n/**\n * To an event a function with one or zero parameters\n * can be subscribed. The event is the subscriber function itself.\n */\ninterface Event<T> {\n\t(listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[]): IDisposable;\n}\n\nnamespace Event {\n\tconst _disposable = { dispose() { } };\n\texport const None: Event<any> = function() { return _disposable; };\n}\n\nexport default Event;\n\nexport interface EmitterOptions {\n\tonFirstListenerAdd?: Function;\n\tonLastListenerRemove?: Function;\n}\n\n/**\n * The Emitter can be used to expose an Event to the public\n * to fire it from the insides.\n * Sample:\n\tclass Document {\n\n\t\tprivate _onDidChange = new Emitter<(value:string)=>any>();\n\n\t\tpublic onDidChange = this._onDidChange.event;\n\n\t\t// getter-style\n\t\t// get onDidChange(): Event<(value:string)=>any> {\n\t\t// \treturn this._onDidChange.event;\n\t\t// }\n\n\t\tprivate _doIt() {\n\t\t\t//...\n\t\t\tthis._onDidChange.fire(value);\n\t\t}\n\t}\n */\nexport class Emitter<T> {\n\n\tprivate static _noop = function () { };\n\n\tprivate _event: Event<T>;\n\tprivate _callbacks: CallbackList;\n\tprivate _disposed: boolean;\n\n\tconstructor(private _options?: EmitterOptions) {\n\n\t}\n\n\t/**\n\t * For the public to allow to subscribe\n\t * to events from this Emitter\n\t */\n\tget event(): Event<T> {\n\t\tif (!this._event) {\n\t\t\tthis._event = (listener: (e: T) => any,  thisArgs?: any, disposables?: IDisposable[]) => {\n\t\t\t\tif (!this._callbacks) {\n\t\t\t\t\tthis._callbacks = new CallbackList();\n\t\t\t\t}\n\t\t\t\tif (this._options && this._options.onFirstListenerAdd && this._callbacks.isEmpty()) {\n\t\t\t\t\tthis._options.onFirstListenerAdd(this);\n\t\t\t\t}\n\t\t\t\tthis._callbacks.add(listener, thisArgs);\n\n\t\t\t\tlet result: IDisposable;\n\t\t\t\tresult = {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tresult.dispose = Emitter._noop;\n\t\t\t\t\t\tif (!this._disposed) {\n\t\t\t\t\t\t\tthis._callbacks.remove(listener, thisArgs);\n\t\t\t\t\t\t\tif(this._options && this._options.onLastListenerRemove && this._callbacks.isEmpty()) {\n\t\t\t\t\t\t\t\tthis._options.onLastListenerRemove(this);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif(Array.isArray(disposables)) {\n\t\t\t\t\tdisposables.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\t\treturn this._event;\n\t}\n\n\t/**\n\t * To be kept private to fire an event to\n\t * subscribers\n\t */\n\tfire(event?: T): any {\n\t\tif (this._callbacks) {\n\t\t\tthis._callbacks.invoke.call(this._callbacks, event);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tif(this._callbacks) {\n\t\t\tthis._callbacks.dispose();\n\t\t\tthis._callbacks = undefined;\n\t\t\tthis._disposed = true;\n\t\t}\n\t}\n}\n\n/**\n * Creates an Event which is backed-up by the event emitter. This allows\n * to use the existing eventing pattern and is likely using less memory.\n * Sample:\n *\n * \tclass Document {\n *\n *\t\tprivate _eventbus = new EventEmitter();\n *\n *\t\tpublic onDidChange = fromEventEmitter(this._eventbus, 'changed');\n *\n *\t\t// getter-style\n *\t\t// get onDidChange(): Event<(value:string)=>any> {\n *\t\t// \tcache fromEventEmitter result and return\n *\t\t// }\n *\n *\t\tprivate _doIt() {\n *\t\t\t// ...\n *\t\t\tthis._eventbus.emit('changed', value)\n *\t\t}\n *\t}\n */\nexport function fromEventEmitter<T>(emitter: EventEmitter, eventType: string): Event<T> {\n\treturn function (listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[]): IDisposable {\n\t\tconst result = emitter.addListener2(eventType, function () {\n\t\t\tlistener.apply(thisArgs, arguments);\n\t\t});\n\t\tif(Array.isArray(disposables)) {\n\t\t\tdisposables.push(result);\n\t\t}\n\t\treturn result;\n\t};\n}\n\nexport function mapEvent<I,O>(event: Event<I>, map: (i:I)=>O): Event<O> {\n\treturn (listener, thisArgs = null, disposables?) => event(i => listener.call(thisArgs, map(i)), null, disposables);\n}\n\nexport function filterEvent<T>(event: Event<T>, filter: (e:T)=>boolean): Event<T> {\n\treturn (listener, thisArgs = null, disposables?) => event(e => filter(e) && listener.call(thisArgs, e), null, disposables);\n}\n\nexport function debounceEvent<I, O>(event: Event<I>, merger: (last: O, event: I) => O, delay: number = 100): Event<O> {\n\n\tlet subscription: IDisposable;\n\tlet output: O;\n\tlet handle: number;\n\n\tconst emitter = new Emitter<O>({\n\t\tonFirstListenerAdd() {\n\t\t\tsubscription = event(cur => {\n\t\t\t\toutput = merger(output, cur);\n\t\t\t\tclearTimeout(handle);\n\t\t\t\thandle = setTimeout(() => {\n\t\t\t\t\temitter.fire(output);\n\t\t\t\t\toutput = undefined;\n\t\t\t\t}, delay);\n\t\t\t});\n\t\t},\n\t\tonLastListenerRemove() {\n\t\t\tsubscription.dispose();\n\t\t}\n\t});\n\n\treturn emitter.event;\n}\n\nenum EventDelayerState {\n\tIdle,\n\tRunning\n}\n\n/**\n * The EventDelayer is useful in situations in which you want\n * to delay firing your events during some code.\n * You can wrap that code and be sure that the event will not\n * be fired during that wrap.\n *\n * ```\n * const emitter: Emitter;\n * const delayer = new EventDelayer();\n * const delayedEvent = delayer.delay(emitter.event);\n *\n * delayedEvent(console.log);\n *\n * delayer.wrap(() => {\n *   emitter.fire(); // event will not be fired yet\n * });\n *\n * // event will only be fired at this point\n * ```\n */\nexport class EventBufferer {\n\n\tprivate buffers: Function[][] = [];\n\n\twrapEvent<T>(event: Event<T>): Event<T> {\n\t\treturn (listener, thisArgs?, disposables?) => {\n\t\t\treturn event(i => {\n\t\t\t\tconst buffer = this.buffers[this.buffers.length - 1];\n\n\t\t\t\tif (buffer) {\n\t\t\t\t\tbuffer.push(() => listener.call(thisArgs, i));\n\t\t\t\t} else {\n\t\t\t\t\tlistener.call(thisArgs, i);\n\t\t\t\t}\n\t\t\t}, void 0, disposables);\n\t\t};\n\t}\n\n\tbufferEvents(fn: () => void): void {\n\t\tconst buffer = [];\n\t\tthis.buffers.push(buffer);\n\t\tfn();\n\t\tthis.buffers.pop();\n\t\tbuffer.forEach(flush => flush());\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport Event, {Emitter} from 'vs/base/common/event';\n\nexport interface CancellationToken {\n\tisCancellationRequested: boolean;\n\tonCancellationRequested: Event<any>;\n}\n\nexport namespace CancellationToken {\n\n\texport const None: CancellationToken = Object.freeze({\n\t\tisCancellationRequested: false,\n\t\tonCancellationRequested: Event.None\n\t});\n\n\texport const Cancelled: CancellationToken = Object.freeze({\n\t\tisCancellationRequested: true,\n\t\tonCancellationRequested: Event.None\n\t});\n}\n\nconst shortcutEvent: Event<any> = Object.freeze(function(callback, context?) {\n\tlet handle = setTimeout(callback.bind(context), 0);\n\treturn { dispose() { clearTimeout(handle); } };\n});\n\nclass MutableToken implements CancellationToken {\n\n\tprivate _isCancelled: boolean = false;\n\tprivate _emitter: Emitter<any>;\n\n\tpublic cancel() {\n\t\tif (!this._isCancelled) {\n\t\t\tthis._isCancelled = true;\n\t\t\tif (this._emitter) {\n\t\t\t\tthis._emitter.fire(undefined);\n\t\t\t\tthis._emitter = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCancellationRequested(): boolean {\n\t\treturn this._isCancelled;\n\t}\n\n\tget onCancellationRequested(): Event<any> {\n\t\tif (this._isCancelled) {\n\t\t\treturn shortcutEvent;\n\t\t}\n\t\tif (!this._emitter) {\n\t\t\tthis._emitter = new Emitter<any>();\n\t\t}\n\t\treturn this._emitter.event;\n\t}\n}\n\nexport class CancellationTokenSource {\n\n\tprivate _token: CancellationToken;\n\n\tget token(): CancellationToken {\n\t\tif (!this._token) {\n\t\t\t// be lazy and create the token only when\n\t\t\t// actually needed\n\t\t\tthis._token = new MutableToken();\n\t\t}\n\t\treturn this._token;\n\t}\n\n\tcancel(): void {\n\t\tif (!this._token) {\n\t\t\t// save an object by returning the default\n\t\t\t// cancelled token when cancellation happens\n\t\t\t// before someone asks for the token\n\t\t\tthis._token = CancellationToken.Cancelled;\n\t\t} else {\n\t\t\t(<MutableToken>this._token).cancel();\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.cancel();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Errors = require('vs/base/common/errors');\nimport {IDisposable} from 'vs/base/common/lifecycle';\n\nexport class EmitterEvent {\n\n\tprivate _type:string;\n\tprivate _data:any;\n\n\tconstructor(eventType:string=null, data:any=null) {\n\t\tthis._type = eventType;\n\t\tthis._data = data;\n\t}\n\n\tpublic getType():string {\n\t\treturn this._type;\n\t}\n\n\tpublic getData():any {\n\t\treturn this._data;\n\t}\n}\n\nexport interface ListenerCallback {\n\t(value:any):void;\n}\n\nexport interface BulkListenerCallback {\n\t(value:EmitterEvent[]):void;\n}\n\nexport interface IEventEmitter extends IDisposable {\n\taddListener2(eventType:string, listener:ListenerCallback):IDisposable;\n\taddOneTimeDisposableListener(eventType:string, listener:ListenerCallback):IDisposable;\n\taddBulkListener2(listener:BulkListenerCallback):IDisposable;\n\taddEmitter2(eventEmitter:IEventEmitter):IDisposable;\n}\n\nexport interface IListenersMap {\n\t[key:string]:ListenerCallback[];\n}\n\nexport class EventEmitter implements IEventEmitter {\n\n\tprotected _listeners:IListenersMap;\n\tprotected _bulkListeners:ListenerCallback[];\n\tprivate _collectedEvents:EmitterEvent[];\n\tprivate _deferredCnt:number;\n\tprivate _allowedEventTypes:{[eventType:string]:boolean;};\n\n\tconstructor(allowedEventTypes:string[] = null) {\n\t\tthis._listeners = {};\n\t\tthis._bulkListeners = [];\n\t\tthis._collectedEvents = [];\n\t\tthis._deferredCnt = 0;\n\t\tif (allowedEventTypes) {\n\t\t\tthis._allowedEventTypes = {};\n\t\t\tfor (var i = 0; i < allowedEventTypes.length; i++) {\n\t\t\t\tthis._allowedEventTypes[allowedEventTypes[i]] = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._allowedEventTypes = null;\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._listeners = {};\n\t\tthis._bulkListeners = [];\n\t\tthis._collectedEvents = [];\n\t\tthis._deferredCnt = 0;\n\t\tthis._allowedEventTypes = null;\n\t}\n\n\tprivate addListener(eventType:string, listener:ListenerCallback):IDisposable {\n\t\tif (eventType === '*') {\n\t\t\tthrow new Error('Use addBulkListener(listener) to register your listener!');\n\t\t}\n\n\t\tif (this._allowedEventTypes && !this._allowedEventTypes.hasOwnProperty(eventType)) {\n\t\t\tthrow new Error('This object will never emit this event type!');\n\t\t}\n\n\t\tif (this._listeners.hasOwnProperty(eventType)) {\n\t\t\tthis._listeners[eventType].push(listener);\n\t\t} else {\n\t\t\tthis._listeners[eventType] = [listener];\n\t\t}\n\n\t\tvar bound = this;\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tif (!bound) {\n\t\t\t\t\t// Already called\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbound._removeListener(eventType, listener);\n\n\t\t\t\t// Prevent leakers from holding on to the event emitter\n\t\t\t\tbound = null;\n\t\t\t\tlistener = null;\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic addListener2(eventType:string, listener:ListenerCallback):IDisposable {\n\t\treturn this.addListener(eventType, listener);\n\t}\n\n\tpublic addOneTimeDisposableListener(eventType:string, listener:ListenerCallback):IDisposable {\n\t\tconst disposable = this.addListener(eventType, value => {\n\t\t\tdisposable.dispose();\n\t\t\tlistener(value);\n\t\t});\n\t\t\n\t\treturn disposable;\n\t}\n\n\tprotected addBulkListener(listener:BulkListenerCallback):IDisposable {\n\n\t\tthis._bulkListeners.push(listener);\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._removeBulkListener(listener);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic addBulkListener2(listener:BulkListenerCallback):IDisposable {\n\t\treturn this.addBulkListener(listener);\n\t}\n\n\tprivate addEmitter(eventEmitter:IEventEmitter):IDisposable {\n\t\treturn eventEmitter.addBulkListener2((events:EmitterEvent[]):void => {\n\t\t\tvar newEvents = events;\n\n\t\t\tif (this._deferredCnt === 0) {\n\t\t\t\tthis._emitEvents(<EmitterEvent[]>newEvents);\n\t\t\t} else {\n\t\t\t\t// Collect for later\n\t\t\t\tthis._collectedEvents.push.apply(this._collectedEvents, newEvents);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic addEmitter2(eventEmitter:IEventEmitter):IDisposable {\n\t\treturn this.addEmitter(eventEmitter);\n\t}\n\n\tprivate _removeListener(eventType:string, listener:ListenerCallback): void {\n\t\tif (this._listeners.hasOwnProperty(eventType)) {\n\t\t\tvar listeners = this._listeners[eventType];\n\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\n\t\t\t\tif (listeners[i] === listener) {\n\t\t\t\t\tlisteners.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tprivate _removeBulkListener(listener:BulkListenerCallback): void {\n\t\tfor (var i = 0, len = this._bulkListeners.length; i < len; i++) {\n\t\t\tif (this._bulkListeners[i] === listener) {\n\t\t\t\tthis._bulkListeners.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _emitToSpecificTypeListeners(eventType:string, data:any): void {\n\t\tif (this._listeners.hasOwnProperty(eventType)) {\n\t\t\tvar listeners = this._listeners[eventType].slice(0);\n\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\n\t\t\t\tsafeInvoke1Arg(listeners[i], data);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _emitToBulkListeners(events:EmitterEvent[]): void {\n\t\tvar bulkListeners = this._bulkListeners.slice(0);\n\t\tfor (var i = 0, len = bulkListeners.length; i < len; i++) {\n\t\t\tsafeInvoke1Arg(bulkListeners[i], events);\n\t\t}\n\t}\n\n\tprotected _emitEvents(events:EmitterEvent[]): void {\n\t\tif (this._bulkListeners.length > 0) {\n\t\t\tthis._emitToBulkListeners(events);\n\t\t}\n\t\tfor (var i = 0, len = events.length; i < len; i++) {\n\t\t\tvar e = events[i];\n\n\t\t\tthis._emitToSpecificTypeListeners(e.getType(), e.getData());\n\t\t}\n\t}\n\n\tpublic emit(eventType:string, data:any={}):void {\n\t\tif (this._allowedEventTypes && !this._allowedEventTypes.hasOwnProperty(eventType)) {\n\t\t\tthrow new Error('Cannot emit this event type because it wasn\\'t white-listed!');\n\t\t}\n\t\t// Early return if no listeners would get this\n\t\tif (!this._listeners.hasOwnProperty(eventType) && this._bulkListeners.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tvar emitterEvent = new EmitterEvent(eventType, data);\n\n\t\tif (this._deferredCnt === 0) {\n\t\t\tthis._emitEvents([emitterEvent]);\n\t\t} else {\n\t\t\t// Collect for later\n\t\t\tthis._collectedEvents.push(emitterEvent);\n\t\t}\n\t}\n\n\tpublic deferredEmit(callback:()=>any):any {\n\t\tthis._deferredCnt = this._deferredCnt + 1;\n\t\tvar result: any = safeInvokeNoArg(callback);\n\t\tthis._deferredCnt = this._deferredCnt - 1;\n\n\t\tif (this._deferredCnt === 0) {\n\t\t\tthis._emitCollected();\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _emitCollected(): void {\n\t\t// Flush collected events\n\t\tvar events = this._collectedEvents;\n\t\tthis._collectedEvents = [];\n\n\t\tif (events.length > 0) {\n\t\t\tthis._emitEvents(events);\n\t\t}\n\t}\n}\n\nclass EmitQueueElement {\n\tpublic target: Function;\n\tpublic arg: any;\n\n\tconstructor(target: Function, arg: any) {\n\t\tthis.target = target;\n\t\tthis.arg = arg;\n\t}\n}\n\n/**\n * Same as EventEmitter, but guarantees events are delivered in order to each listener\n */\nexport class OrderGuaranteeEventEmitter extends EventEmitter {\n\n\tprivate _emitQueue: EmitQueueElement[];\n\n\tconstructor(allowedEventTypes:string[] = null) {\n\t\tsuper(allowedEventTypes);\n\t\tthis._emitQueue = [];\n\t}\n\n\tprotected _emitToSpecificTypeListeners(eventType:string, data:any): void {\n\t\tif (this._listeners.hasOwnProperty(eventType)) {\n\t\t\tlet listeners = this._listeners[eventType];\n\t\t\tfor (let i = 0, len = listeners.length; i < len; i++) {\n\t\t\t\tthis._emitQueue.push(new EmitQueueElement(listeners[i], data));\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _emitToBulkListeners(events:EmitterEvent[]): void {\n\t\tlet bulkListeners = this._bulkListeners;\n\t\tfor (let i = 0, len = bulkListeners.length; i < len; i++) {\n\t\t\tthis._emitQueue.push(new EmitQueueElement(bulkListeners[i], events));\n\t\t}\n\t}\n\n\tprotected _emitEvents(events:EmitterEvent[]): void {\n\t\tsuper._emitEvents(events);\n\n\t\twhile (this._emitQueue.length > 0) {\n\t\t\tlet queueElement = this._emitQueue.shift();\n\t\t\tsafeInvoke1Arg(queueElement.target, queueElement.arg);\n\t\t}\n\t}\n}\n\nfunction safeInvokeNoArg(func:Function): any {\n\ttry {\n\t\treturn func();\n\t} catch(e) {\n\t\tErrors.onUnexpectedError(e);\n\t}\n}\n\nfunction safeInvoke1Arg(func:Function, arg1:any): any {\n\ttry {\n\t\treturn func(arg1);\n\t} catch(e) {\n\t\tErrors.onUnexpectedError(e);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Platform = require('vs/base/common/platform');\nimport errors = require('vs/base/common/errors');\nimport precision = require('vs/base/common/stopwatch');\nimport {IDisposable} from 'vs/base/common/lifecycle';\n\nexport var ENABLE_TIMER = false;\nvar msWriteProfilerMark = Platform.globals['msWriteProfilerMark'];\n\nexport enum Topic {\n\tEDITOR,\n\tLANGUAGES,\n\tWORKER,\n\tWORKBENCH,\n\tSTARTUP\n}\n\nexport interface ITimerEvent {\n\tid: number;\n\ttopic: string;\n\tname: string;\n\tdescription: string;\n\tdata: any;\n\n\tstartTime: Date;\n\tstopTime: Date;\n\n\tstop(stopTime?: Date): void;\n\ttimeTaken(): number;\n}\n\nexport interface IExistingTimerEvent {\n\ttopic: string;\n\tname: string;\n\n\tdescription?: string;\n\n\tstartTime: Date;\n\tstopTime: Date;\n}\n\nclass NullTimerEvent implements ITimerEvent {\n\tpublic id: number;\n\tpublic topic: string;\n\tpublic name: string;\n\tpublic description: string;\n\tpublic data: any;\n\n\tpublic startTime: Date;\n\tpublic stopTime: Date;\n\n\tpublic stop(): void {\n\t\treturn;\n\t}\n\n\tpublic timeTaken(): number {\n\t\treturn -1;\n\t}\n}\n\nclass TimerEvent implements ITimerEvent {\n\tpublic id: number;\n\tpublic topic: string;\n\tpublic name: string;\n\tpublic description: string;\n\tpublic data: any;\n\n\tpublic startTime: Date;\n\tpublic stopTime: Date;\n\n\tprivate timeKeeper: TimeKeeper;\n\tprivate sw: precision.StopWatch;\n\n\tconstructor(timeKeeper: TimeKeeper, name: string, topic: string, startTime?: Date, description?: string) {\n\t\tthis.timeKeeper = timeKeeper;\n\t\tthis.name = name;\n\t\tthis.description = description;\n\t\tthis.topic = topic;\n\t\tthis.stopTime = null;\n\n\t\tif (startTime) {\n\t\t\tthis.startTime = startTime;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startTime = new Date();\n\t\tthis.sw = precision.StopWatch.create();\n\n\t\tif (msWriteProfilerMark) {\n\t\t\tvar profilerName = ['Monaco', this.topic, this.name, 'start'];\n\t\t\tmsWriteProfilerMark(profilerName.join('|'));\n\t\t}\n\t}\n\n\tpublic stop(stopTime?: Date): void {\n\n\t\t// already stopped\n\t\tif (this.stopTime !== null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (stopTime) {\n\t\t\tthis.stopTime = stopTime;\n\t\t\tthis.sw = null;\n\t\t\tthis.timeKeeper._onEventStopped(this);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stopTime = new Date();\n\t\tif (this.sw) {\n\t\t\tthis.sw.stop();\n\t\t}\n\n\t\tthis.timeKeeper._onEventStopped(this);\n\n\t\tif (msWriteProfilerMark) {\n\t\t\tvar profilerName = ['Monaco', this.topic, this.name, 'stop'];\n\t\t\tmsWriteProfilerMark(profilerName.join('|'));\n\t\t}\n\t}\n\n\tpublic timeTaken(): number {\n\t\tif (this.sw) {\n\t\t\treturn this.sw.elapsed();\n\t\t}\n\t\tif (this.stopTime) {\n\t\t\treturn this.stopTime.getTime() - this.startTime.getTime();\n\t\t}\n\t\treturn -1;\n\t}\n}\n\nexport interface IEventsListener {\n\t(events: ITimerEvent[]): void;\n}\n\nexport class TimeKeeper {\n\t/**\n\t * After being started for 1 minute, all timers are automatically stopped.\n\t */\n\tprivate static _MAX_TIMER_LENGTH = 60000; // 1 minute\n\t/**\n\t * Every 2 minutes, a sweep of current started timers is done.\n\t */\n\tprivate static _CLEAN_UP_INTERVAL = 120000; // 2 minutes\n\t/**\n\t * Collect at most 1000 events.\n\t */\n\tprivate static _EVENT_CACHE_LIMIT = 1000;\n\n\tprivate static EVENT_ID = 1;\n\tpublic static PARSE_TIME = new Date();\n\n\n\tprivate cleaningIntervalId: Platform.IntervalToken;\n\tprivate collectedEvents: ITimerEvent[];\n\tprivate listeners: IEventsListener[];\n\n\tconstructor() {\n\t\tthis.cleaningIntervalId = -1;\n\t\tthis.collectedEvents = [];\n\t\tthis.listeners = [];\n\t}\n\n\tpublic isEnabled(): boolean {\n\t\treturn ENABLE_TIMER;\n\t}\n\n\tpublic start(topic: Topic|string, name: string, start?: Date, description?: string): ITimerEvent {\n\t\tif (!this.isEnabled()) {\n\t\t\treturn nullEvent;\n\t\t}\n\n\t\tvar strTopic: string;\n\n\t\tif (typeof topic === 'string') {\n\t\t\tstrTopic = topic;\n\t\t} else if (topic === Topic.EDITOR) {\n\t\t\tstrTopic = 'Editor';\n\t\t} else if (topic === Topic.LANGUAGES) {\n\t\t\tstrTopic = 'Languages';\n\t\t} else if (topic === Topic.WORKER) {\n\t\t\tstrTopic = 'Worker';\n\t\t} else if (topic === Topic.WORKBENCH) {\n\t\t\tstrTopic = 'Workbench';\n\t\t} else if (topic === Topic.STARTUP) {\n\t\t\tstrTopic = 'Startup';\n\t\t}\n\n\t\tthis.initAutoCleaning();\n\t\tvar event = new TimerEvent(this, name, strTopic, start, description);\n\t\tthis.addEvent(event);\n\n\t\treturn event;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this.cleaningIntervalId !== -1) {\n\t\t\tPlatform.clearInterval(this.cleaningIntervalId);\n\t\t\tthis.cleaningIntervalId = -1;\n\t\t}\n\t}\n\n\tpublic addListener(listener: IEventsListener): IDisposable {\n\t\tthis.listeners.push(listener);\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tfor (var i = 0; i < this.listeners.length; i++) {\n\t\t\t\t\tif (this.listeners[i] === listener) {\n\t\t\t\t\t\tthis.listeners.splice(i, 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate addEvent(event: ITimerEvent): void {\n\t\tevent.id = TimeKeeper.EVENT_ID;\n\t\tTimeKeeper.EVENT_ID++;\n\t\tthis.collectedEvents.push(event);\n\t\t// expire items from the front of the cache\n\t\tif (this.collectedEvents.length > TimeKeeper._EVENT_CACHE_LIMIT) {\n\t\t\tthis.collectedEvents.shift();\n\t\t}\n\t}\n\n\tprivate initAutoCleaning(): void {\n\t\tif (this.cleaningIntervalId === -1) {\n\t\t\tthis.cleaningIntervalId = Platform.setInterval(() => {\n\t\t\t\tvar now = Date.now();\n\t\t\t\tthis.collectedEvents.forEach((event) => {\n\t\t\t\t\tif (!event.stopTime && (now - event.startTime.getTime()) >= TimeKeeper._MAX_TIMER_LENGTH) {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, TimeKeeper._CLEAN_UP_INTERVAL);\n\t\t}\n\t}\n\n\tpublic getCollectedEvents(): ITimerEvent[] {\n\t\treturn this.collectedEvents.slice(0);\n\t}\n\n\tpublic clearCollectedEvents(): void {\n\t\tthis.collectedEvents = [];\n\t}\n\n\t_onEventStopped(event: ITimerEvent): void {\n\t\tvar emitEvents = [event];\n\n\t\tvar listeners = this.listeners.slice(0);\n\t\tfor (var i = 0; i < listeners.length; i++) {\n\t\t\ttry {\n\t\t\t\tlisteners[i](emitEvents);\n\t\t\t} catch (e) {\n\t\t\t\terrors.onUnexpectedError(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic setInitialCollectedEvents(events: IExistingTimerEvent[], startTime?: Date): void {\n\t\tif (!this.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (startTime) {\n\t\t\tTimeKeeper.PARSE_TIME = startTime;\n\t\t}\n\n\t\tevents.forEach((event) => {\n\t\t\tvar e = new TimerEvent(this, event.name, event.topic, event.startTime, event.description);\n\t\t\te.stop(event.stopTime);\n\t\t\tthis.addEvent(e);\n\t\t});\n\t}\n}\n\nvar timeKeeper = new TimeKeeper();\nexport var nullEvent: ITimerEvent = new NullTimerEvent();\n\nexport function start(topic: Topic|string, name: string, start?: Date, description?: string): ITimerEvent {\n\treturn timeKeeper.start(topic, name, start, description);\n}\n\nexport function getTimeKeeper(): TimeKeeper {\n\treturn timeKeeper;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\ndefine(__m[5], __M([110,2]), function (winjs, __Errors__) {\n\t'use strict';\n\n\tvar outstandingPromiseErrors = {};\n\tfunction promiseErrorHandler(e) {\n\n\t\t//\n\t\t// e.detail looks like: { exception, error, promise, handler, id, parent }\n\t\t//\n\t\tvar details = e.detail;\n\t\tvar id = details.id;\n\n\t\t// If the error has a parent promise then this is not the origination of the\n\t\t//  error so we check if it has a handler, and if so we mark that the error\n\t\t//  was handled by removing it from outstandingPromiseErrors\n\t\t//\n\t\tif (details.parent) {\n\t\t\tif (details.handler && outstandingPromiseErrors) {\n\t\t\t\tdelete outstandingPromiseErrors[id];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Indicate that this error was originated and needs to be handled\n\t\toutstandingPromiseErrors[id] = details;\n\n\t\t// The first time the queue fills up this iteration, schedule a timeout to\n\t\t// check if any errors are still unhandled.\n\t\tif (Object.keys(outstandingPromiseErrors).length === 1) {\n\t\t\tsetTimeout(function () {\n\t\t\t\tvar errors = outstandingPromiseErrors;\n\t\t\t\toutstandingPromiseErrors = {};\n\t\t\t\tObject.keys(errors).forEach(function (errorId) {\n\t\t\t\t\tvar error = errors[errorId];\n\t\t\t\t\tif(error.exception) {\n\t\t\t\t\t\t__Errors__.onUnexpectedError(error.exception);\n\t\t\t\t\t} else if(error.error) {\n\t\t\t\t\t\t__Errors__.onUnexpectedError(error.error);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"WARNING: Promise with no error callback:\" + error.id);\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif(error.exception) {\n\t\t\t\t\t\tconsole.log(error.exception.stack);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\twinjs.Promise.addEventListener(\"error\", promiseErrorHandler);\n\n\treturn {\n\t\tPromise: winjs.Promise,\n\t\tTPromise: winjs.Promise,\n\t\tPPromise: winjs.Promise\n\t};\n});","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport * as errors from 'vs/base/common/errors';\nimport * as platform from 'vs/base/common/platform';\nimport { Promise, TPromise, ValueCallback, ErrorCallback, ProgressCallback } from 'vs/base/common/winjs.base';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Disposable } from 'vs/base/common/lifecycle';\n\nfunction isThenable<T>(obj: any): obj is Thenable<T> {\n\treturn obj && typeof (<Thenable<any>>obj).then === 'function';\n}\n\nexport function toThenable<T>(arg: T | Thenable<T>): Thenable<T> {\n\tif (isThenable(arg)) {\n\t\treturn arg;\n\t} else {\n\t\treturn TPromise.as(arg);\n\t}\n}\n\nexport function asWinJsPromise<T>(callback: (token: CancellationToken) => T | Thenable<T>): TPromise<T> {\n\tlet source = new CancellationTokenSource();\n\treturn new TPromise<T>((resolve, reject) => {\n\t\tlet item = callback(source.token);\n\t\tif (isThenable<T>(item)) {\n\t\t\titem.then(resolve, reject);\n\t\t} else {\n\t\t\tresolve(item);\n\t\t}\n\t}, () => {\n\t\tsource.cancel();\n\t});\n}\n\n/**\n * Hook a cancellation token to a WinJS Promise\n */\nexport function wireCancellationToken<T>(token: CancellationToken, promise: TPromise<T>): Thenable<T> {\n\ttoken.onCancellationRequested(() => promise.cancel());\n\treturn promise;\n}\n\nexport interface ITask<T> {\n\t(): T;\n}\n\n/**\n * A helper to prevent accumulation of sequential async tasks.\n *\n * Imagine a mail man with the sole task of delivering letters. As soon as\n * a letter submitted for delivery, he drives to the destination, delivers it\n * and returns to his base. Imagine that during the trip, N more letters were submitted.\n * When the mail man returns, he picks those N letters and delivers them all in a\n * single trip. Even though N+1 submissions occurred, only 2 deliveries were made.\n *\n * The throttler implements this via the queue() method, by providing it a task\n * factory. Following the example:\n *\n * \t\tvar throttler = new Throttler();\n * \t\tvar letters = [];\n *\n * \t\tfunction deliver() {\n * \t\t\tconst lettersToDeliver = letters;\n * \t\t\tletters = [];\n * \t\t\treturn makeTheTrip(lettersToDeliver);\n * \t\t}\n *\n * \t\tfunction onLetterReceived(l) {\n * \t\t\tletters.push(l);\n * \t\t\tthrottler.queue(deliver);\n * \t\t}\n */\nexport class Throttler {\n\n\tprivate activePromise: Promise;\n\tprivate queuedPromise: Promise;\n\tprivate queuedPromiseFactory: ITask<Promise>;\n\n\tconstructor() {\n\t\tthis.activePromise = null;\n\t\tthis.queuedPromise = null;\n\t\tthis.queuedPromiseFactory = null;\n\t}\n\n\tqueue<T>(promiseFactory: ITask<TPromise<T>>): TPromise<T> {\n\t\tif (this.activePromise) {\n\t\t\tthis.queuedPromiseFactory = promiseFactory;\n\n\t\t\tif (!this.queuedPromise) {\n\t\t\t\tconst onComplete = () => {\n\t\t\t\t\tthis.queuedPromise = null;\n\n\t\t\t\t\tconst result = this.queue(this.queuedPromiseFactory);\n\t\t\t\t\tthis.queuedPromiseFactory = null;\n\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\n\t\t\t\tthis.queuedPromise = new Promise((c, e, p) => {\n\t\t\t\t\tthis.activePromise.then(onComplete, onComplete, p).done(c);\n\t\t\t\t}, () => {\n\t\t\t\t\tthis.activePromise.cancel();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new Promise((c, e, p) => {\n\t\t\t\tthis.queuedPromise.then(c, e, p);\n\t\t\t}, () => {\n\t\t\t\t// no-op\n\t\t\t});\n\t\t}\n\n\t\tthis.activePromise = promiseFactory();\n\n\t\treturn new Promise((c, e, p) => {\n\t\t\tthis.activePromise.done((result: any) => {\n\t\t\t\tthis.activePromise = null;\n\t\t\t\tc(result);\n\t\t\t}, (err: any) => {\n\t\t\t\tthis.activePromise = null;\n\t\t\t\te(err);\n\t\t\t}, p);\n\t\t}, () => {\n\t\t\tthis.activePromise.cancel();\n\t\t});\n\t}\n}\n\n// TODO@Joao: can the previous throttler be replaced with this?\nexport class SimpleThrottler {\n\n\tprivate current = TPromise.as(null);\n\n\tqueue<T>(promiseTask: ITask<TPromise<T>>): TPromise<T> {\n\t\treturn this.current = this.current.then(() => promiseTask());\n\t}\n}\n\n/**\n * A helper to delay execution of a task that is being requested often.\n *\n * Following the throttler, now imagine the mail man wants to optimize the number of\n * trips proactively. The trip itself can be long, so the he decides not to make the trip\n * as soon as a letter is submitted. Instead he waits a while, in case more\n * letters are submitted. After said waiting period, if no letters were submitted, he\n * decides to make the trip. Imagine that N more letters were submitted after the first\n * one, all within a short period of time between each other. Even though N+1\n * submissions occurred, only 1 delivery was made.\n *\n * The delayer offers this behavior via the trigger() method, into which both the task\n * to be executed and the waiting period (delay) must be passed in as arguments. Following\n * the example:\n *\n * \t\tvar delayer = new Delayer(WAITING_PERIOD);\n * \t\tvar letters = [];\n *\n * \t\tfunction letterReceived(l) {\n * \t\t\tletters.push(l);\n * \t\t\tdelayer.trigger(() => { return makeTheTrip(); });\n * \t\t}\n */\nexport class Delayer<T> {\n\n\tprivate timeout: number;\n\tprivate completionPromise: Promise;\n\tprivate onSuccess: ValueCallback;\n\tprivate task: ITask<T>;\n\n\tconstructor(public defaultDelay: number) {\n\t\tthis.timeout = null;\n\t\tthis.completionPromise = null;\n\t\tthis.onSuccess = null;\n\t\tthis.task = null;\n\t}\n\n\ttrigger(task: ITask<T>, delay: number = this.defaultDelay): TPromise<T> {\n\t\tthis.task = task;\n\t\tthis.cancelTimeout();\n\n\t\tif (!this.completionPromise) {\n\t\t\tthis.completionPromise = new Promise((c) => {\n\t\t\t\tthis.onSuccess = c;\n\t\t\t}, () => {\n\t\t\t\t// no-op\n\t\t\t}).then(() => {\n\t\t\t\tthis.completionPromise = null;\n\t\t\t\tthis.onSuccess = null;\n\t\t\t\tconst task = this.task;\n\t\t\t\tthis.task = null;\n\n\t\t\t\treturn task();\n\t\t\t});\n\t\t}\n\n\t\tthis.timeout = setTimeout(() => {\n\t\t\tthis.timeout = null;\n\t\t\tthis.onSuccess(null);\n\t\t}, delay);\n\n\t\treturn this.completionPromise;\n\t}\n\n\tisTriggered(): boolean {\n\t\treturn this.timeout !== null;\n\t}\n\n\tcancel(): void {\n\t\tthis.cancelTimeout();\n\n\t\tif (this.completionPromise) {\n\t\t\tthis.completionPromise.cancel();\n\t\t\tthis.completionPromise = null;\n\t\t}\n\t}\n\n\tprivate cancelTimeout(): void {\n\t\tif (this.timeout !== null) {\n\t\t\tclearTimeout(this.timeout);\n\t\t\tthis.timeout = null;\n\t\t}\n\t}\n}\n\n/**\n * A helper to delay execution of a task that is being requested often, while\n * preventing accumulation of consecutive executions, while the task runs.\n *\n * Simply combine the two mail man strategies from the Throttler and Delayer\n * helpers, for an analogy.\n */\nexport class ThrottledDelayer<T> extends Delayer<TPromise<T>> {\n\n\tprivate throttler: Throttler;\n\n\tconstructor(defaultDelay: number) {\n\t\tsuper(defaultDelay);\n\n\t\tthis.throttler = new Throttler();\n\t}\n\n\ttrigger(promiseFactory: ITask<TPromise<T>>, delay?: number): Promise {\n\t\treturn super.trigger(() => this.throttler.queue(promiseFactory), delay);\n\t}\n}\n\n/**\n * Similar to the ThrottledDelayer, except it also guarantees that the promise\n * factory doesn't get called more often than every `minimumPeriod` milliseconds.\n */\nexport class PeriodThrottledDelayer<T> extends ThrottledDelayer<T> {\n\n\tprivate minimumPeriod: number;\n\tprivate periodThrottler: Throttler;\n\n\tconstructor(defaultDelay: number, minimumPeriod: number = 0) {\n\t\tsuper(defaultDelay);\n\n\t\tthis.minimumPeriod = minimumPeriod;\n\t\tthis.periodThrottler = new Throttler();\n\t}\n\n\ttrigger(promiseFactory: ITask<TPromise<T>>, delay?: number): Promise {\n\t\treturn super.trigger(() => {\n\t\t\treturn this.periodThrottler.queue(() => {\n\t\t\t\treturn Promise.join([\n\t\t\t\t\tTPromise.timeout(this.minimumPeriod),\n\t\t\t\t\tpromiseFactory()\n\t\t\t\t]).then(r => r[1]);\n\t\t\t});\n\t\t}, delay);\n\t}\n}\n\nexport class PromiseSource<T> {\n\n\tprivate _value: TPromise<T>;\n\tprivate _completeCallback: Function;\n\tprivate _errorCallback: Function;\n\n\tconstructor() {\n\t\tthis._value = new TPromise<T>((c, e) => {\n\t\t\tthis._completeCallback = c;\n\t\t\tthis._errorCallback = e;\n\t\t});\n\t}\n\n\tget value(): TPromise<T> {\n\t\treturn this._value;\n\t}\n\n\tcomplete(value?: T): void {\n\t\tthis._completeCallback(value);\n\t}\n\n\terror(err?: any): void {\n\t\tthis._errorCallback(err);\n\t}\n}\n\nexport class ShallowCancelThenPromise<T> extends TPromise<T> {\n\n\tconstructor(outer: TPromise<T>) {\n\n\t\tlet completeCallback: ValueCallback,\n\t\t\terrorCallback: ErrorCallback,\n\t\t\tprogressCallback: ProgressCallback;\n\n\t\tsuper((c, e, p) => {\n\t\t\tcompleteCallback = c;\n\t\t\terrorCallback = e;\n\t\t\tprogressCallback = p;\n\t\t}, () => {\n\t\t\t// cancel this promise but not the\n\t\t\t// outer promise\n\t\t\terrorCallback(errors.canceled());\n\t\t});\n\n\t\touter.then(completeCallback, errorCallback, progressCallback);\n\t}\n}\n\n/**\n * Returns a new promise that joins the provided promise. Upon completion of\n * the provided promise the provided function will always be called. This\n * method is comparable to a try-finally code block.\n * @param promise a promise\n * @param f a function that will be call in the success and error case.\n */\nexport function always<T>(promise: TPromise<T>, f: Function): TPromise<T> {\n\treturn new TPromise<T>((c, e, p) => {\n\t\tpromise.done((result) => {\n\t\t\ttry {\n\t\t\t\tf(result);\n\t\t\t} catch (e1) {\n\t\t\t\terrors.onUnexpectedError(e1);\n\t\t\t}\n\t\t\tc(result);\n\t\t}, (err) => {\n\t\t\ttry {\n\t\t\t\tf(err);\n\t\t\t} catch (e1) {\n\t\t\t\terrors.onUnexpectedError(e1);\n\t\t\t}\n\t\t\te(err);\n\t\t}, (progress) => {\n\t\t\tp(progress);\n\t\t});\n\t}, () => {\n\t\tpromise.cancel();\n\t});\n}\n\n/**\n * Runs the provided list of promise factories in sequential order. The returned\n * promise will complete to an array of results from each promise.\n */\nexport function sequence<T>(promiseFactory: ITask<TPromise<T>>[]): TPromise<T[]> {\n\tconst results: T[] = [];\n\n\t// reverse since we start with last element using pop()\n\tpromiseFactory = promiseFactory.reverse();\n\n\tfunction next(): Promise {\n\t\tif (promiseFactory.length) {\n\t\t\treturn promiseFactory.pop()();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction thenHandler(result: any): Promise {\n\t\tif (result) {\n\t\t\tresults.push(result);\n\t\t}\n\n\t\tconst n = next();\n\t\tif (n) {\n\t\t\treturn n.then(thenHandler);\n\t\t}\n\n\t\treturn TPromise.as(results);\n\t}\n\n\treturn TPromise.as(null).then(thenHandler);\n}\n\nexport function once<T extends Function>(fn: T): T {\n\tconst _this = this;\n\tlet didCall = false;\n\tlet result: any;\n\n\treturn function() {\n\t\tif (didCall) {\n\t\t\treturn result;\n\t\t}\n\n\t\tdidCall = true;\n\t\tresult = fn.apply(_this, arguments);\n\n\t\treturn result;\n\t} as any as T;\n}\n\ninterface ILimitedTaskFactory {\n\tfactory: ITask<Promise>;\n\tc: ValueCallback;\n\te: ErrorCallback;\n\tp: ProgressCallback;\n}\n\n/**\n * A helper to queue N promises and run them all with a max degree of parallelism. The helper\n * ensures that at any time no more than M promises are running at the same time.\n */\nexport class Limiter<T> {\n\tprivate runningPromises: number;\n\tprivate maxDegreeOfParalellism: number;\n\tprivate outstandingPromises: ILimitedTaskFactory[];\n\n\tconstructor(maxDegreeOfParalellism: number) {\n\t\tthis.maxDegreeOfParalellism = maxDegreeOfParalellism;\n\t\tthis.outstandingPromises = [];\n\t\tthis.runningPromises = 0;\n\t}\n\n\tqueue(promiseFactory: ITask<Promise>): Promise;\n\tqueue(promiseFactory: ITask<TPromise<T>>): TPromise<T> {\n\t\treturn new TPromise<T>((c, e, p) => {\n\t\t\tthis.outstandingPromises.push({\n\t\t\t\tfactory: promiseFactory,\n\t\t\t\tc: c,\n\t\t\t\te: e,\n\t\t\t\tp: p\n\t\t\t});\n\n\t\t\tthis.consume();\n\t\t});\n\t}\n\n\tprivate consume(): void {\n\t\twhile (this.outstandingPromises.length && this.runningPromises < this.maxDegreeOfParalellism) {\n\t\t\tconst iLimitedTask = this.outstandingPromises.shift();\n\t\t\tthis.runningPromises++;\n\n\t\t\tconst promise = iLimitedTask.factory();\n\t\t\tpromise.done(iLimitedTask.c, iLimitedTask.e, iLimitedTask.p);\n\t\t\tpromise.done(() => this.consumed(), () => this.consumed());\n\t\t}\n\t}\n\n\tprivate consumed(): void {\n\t\tthis.runningPromises--;\n\t\tthis.consume();\n\t}\n}\n\nexport class TimeoutTimer extends Disposable {\n\tprivate _token: platform.TimeoutToken;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._token = -1;\n\t}\n\n\tdispose(): void {\n\t\tthis.cancel();\n\t\tsuper.dispose();\n\t}\n\n\tcancel(): void {\n\t\tif (this._token !== -1) {\n\t\t\tplatform.clearTimeout(this._token);\n\t\t\tthis._token = -1;\n\t\t}\n\t}\n\n\tcancelAndSet(runner: () => void, timeout:number): void {\n\t\tthis.cancel();\n\t\tthis._token = platform.setTimeout(() => {\n\t\t\tthis._token = -1;\n\t\t\trunner();\n\t\t}, timeout);\n\t}\n\n\tsetIfNotSet(runner: () => void, timeout: number): void {\n\t\tif (this._token !== -1) {\n\t\t\t// timer is already set\n\t\t\treturn;\n\t\t}\n\t\tthis._token = platform.setTimeout(() => {\n\t\t\tthis._token = -1;\n\t\t\trunner();\n\t\t}, timeout);\n\t}\n}\n\nexport class IntervalTimer extends Disposable {\n\n\tprivate _token: platform.IntervalToken;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._token = -1;\n\t}\n\n\tdispose(): void {\n\t\tthis.cancel();\n\t\tsuper.dispose();\n\t}\n\n\tcancel(): void {\n\t\tif (this._token !== -1) {\n\t\t\tplatform.clearInterval(this._token);\n\t\t\tthis._token = -1;\n\t\t}\n\t}\n\n\tcancelAndSet(runner: () => void, interval:number): void {\n\t\tthis.cancel();\n\t\tthis._token = platform.setInterval(() => {\n\t\t\trunner();\n\t\t}, interval);\n\t}\n}\n\nexport class RunOnceScheduler {\n\n\tprivate timeoutToken: platform.TimeoutToken;\n\tprivate runner: () => void;\n\tprivate timeout: number;\n\tprivate timeoutHandler: () => void;\n\n\tconstructor(runner: () => void, timeout: number) {\n\t\tthis.timeoutToken = -1;\n\t\tthis.runner = runner;\n\t\tthis.timeout = timeout;\n\t\tthis.timeoutHandler = this.onTimeout.bind(this);\n\t}\n\n\t/**\n\t * Dispose RunOnceScheduler\n\t */\n\tdispose(): void {\n\t\tthis.cancel();\n\t\tthis.runner = null;\n\t}\n\n\t/**\n\t * Cancel current scheduled runner (if any).\n\t */\n\tcancel(): void {\n\t\tif (this.isScheduled()) {\n\t\t\tplatform.clearTimeout(this.timeoutToken);\n\t\t\tthis.timeoutToken = -1;\n\t\t}\n\t}\n\n\t/**\n\t * Replace runner. If there is a runner already scheduled, the new runner will be called.\n\t */\n\tsetRunner(runner: () => void): void {\n\t\tthis.runner = runner;\n\t}\n\n\t/**\n\t * Cancel previous runner (if any) & schedule a new runner.\n\t */\n\tschedule(delay = this.timeout): void {\n\t\tthis.cancel();\n\t\tthis.timeoutToken = platform.setTimeout(this.timeoutHandler, delay);\n\t}\n\n\t/**\n\t * Returns true if scheduled.\n\t */\n\tisScheduled(): boolean {\n\t\treturn this.timeoutToken !== -1;\n\t}\n\n\tprivate onTimeout() {\n\t\tthis.timeoutToken = -1;\n\t\tif (this.runner) {\n\t\t\tthis.runner();\n\t\t}\n\t}\n}\n\nexport function nfcall(fn: Function, ...args: any[]): Promise;\nexport function nfcall<T>(fn: Function, ...args: any[]): TPromise<T>;\nexport function nfcall(fn: Function, ...args: any[]): any {\n\treturn new Promise((c, e) => fn(...args, (err, result) => err ? e(err) : c(result)));\n}\n\nexport function ninvoke(thisArg: any, fn: Function, ...args: any[]): Promise;\nexport function ninvoke<T>(thisArg: any, fn: Function, ...args: any[]): TPromise<T>;\nexport function ninvoke(thisArg: any, fn: Function, ...args: any[]): any {\n\treturn new Promise((c, e) => fn.call(thisArg, ...args, (err, result) => err ? e(err) : c(result)));\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\n\nexport namespace Schemas {\n\n\t/**\n\t * A schema that is used for models that exist in memory\n\t * only and that have no correspondence on a server or such.\n\t */\n\texport var inMemory:string = 'inmemory';\n\n\t/**\n\t * A schema that is used for setting files\n\t */\n\texport var vscode:string = 'vscode';\n\n\t/**\n\t * A schema that is used for internal private files\n\t */\n\texport var internal:string = 'private';\n\n\texport var http:string = 'http';\n\n\texport var https:string = 'https';\n\n\texport var file:string = 'file';\n}\n\nexport interface IXHROptions {\n\ttype?:string;\n\turl?:string;\n\tuser?:string;\n\tpassword?:string;\n\tresponseType?:string;\n\theaders?:any;\n\tcustomRequestInitializer?:(req:any)=>void;\n\tdata?:any;\n}\n\nexport function xhr(options:IXHROptions): TPromise<XMLHttpRequest> {\n\tlet req:XMLHttpRequest = null;\n\tlet canceled = false;\n\n\treturn new TPromise<XMLHttpRequest>((c, e, p) => {\n\t\treq = new XMLHttpRequest();\n\n\t\treq.onreadystatechange = () => {\n\t\t\tif (canceled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (req.readyState === 4) {\n\t\t\t\t// Handle 1223: http://bugs.jquery.com/ticket/1450\n\t\t\t\tif ((req.status >= 200 && req.status < 300) || req.status === 1223) {\n\t\t\t\t\tc(req);\n\t\t\t\t} else {\n\t\t\t\t\te(req);\n\t\t\t\t}\n\t\t\t\treq.onreadystatechange = () => { };\n\t\t\t} else {\n\t\t\t\tp(req);\n\t\t\t}\n\t\t};\n\n\t\treq.open(\n\t\t\toptions.type || 'GET',\n\t\t\toptions.url,\n\t\t\t// Promise based XHR does not support sync.\n\t\t\t//\n\t\t\ttrue,\n\t\t\toptions.user,\n\t\t\toptions.password\n\t\t);\n\t\treq.responseType = options.responseType || '';\n\n\t\tObject.keys(options.headers || {}).forEach((k) => {\n\t\t\treq.setRequestHeader(k, options.headers[k]);\n\t\t});\n\n\t\tif (options.customRequestInitializer) {\n\t\t\toptions.customRequestInitializer(req);\n\t\t}\n\n\t\treq.send(options.data);\n\t}, () => {\n\t\tcanceled = true;\n\t\treq.abort();\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {setUnexpectedErrorHandler, transformErrorForSerialization} from 'vs/base/common/errors';\nimport {parse, stringify} from 'vs/base/common/marshalling';\nimport * as workerProtocol from 'vs/base/common/worker/workerProtocol';\n\nexport class WorkerServer {\n\n\tprivate _postSerializedMessage:(msg:string)=>void;\n\tprivate _workerId:number;\n\tprivate _requestHandler:any;\n\n\tconstructor(postSerializedMessage:(msg:string)=>void) {\n\t\tthis._postSerializedMessage = postSerializedMessage;\n\t\tthis._workerId = 0;\n\t\tthis._requestHandler = null;\n\t\tthis._bindConsole();\n\t}\n\n\tprivate _bindConsole(): void {\n\t\t(<any> self).console = {\n\t\t\tlog: this._sendPrintMessage.bind(this, workerProtocol.PrintType.LOG),\n\t\t\tdebug: this._sendPrintMessage.bind(this, workerProtocol.PrintType.DEBUG),\n\t\t\tinfo: this._sendPrintMessage.bind(this, workerProtocol.PrintType.INFO),\n\t\t\twarn: this._sendPrintMessage.bind(this, workerProtocol.PrintType.WARN),\n\t\t\terror: this._sendPrintMessage.bind(this, workerProtocol.PrintType.ERROR)\n\t\t};\n\t\tsetUnexpectedErrorHandler((e) => {\n\t\t\tself.console.error(e);\n\t\t});\n\t}\n\n\tprivate _sendPrintMessage(level:string, ...objects:any[]): void {\n\t\tlet transformedObjects = objects.map((obj) => (obj instanceof Error) ? transformErrorForSerialization(obj) : obj);\n\t\tlet msg:workerProtocol.IServerPrintMessage = {\n\t\t\tmonacoWorker: true,\n\t\t\tfrom: this._workerId,\n\t\t\treq: '0',\n\t\t\ttype: workerProtocol.MessageType.PRINT,\n\t\t\tlevel: level,\n\t\t\tpayload: (transformedObjects.length === 1 ? transformedObjects[0] : transformedObjects)\n\t\t};\n\t\tthis._postMessage(msg);\n\t}\n\n\tprivate _sendReply(msgId:number, action:string, payload:any): void {\n\t\tlet msg:workerProtocol.IServerReplyMessage = {\n\t\t\tmonacoWorker: true,\n\t\t\tfrom: this._workerId,\n\t\t\treq: '0',\n\t\t\tid: msgId,\n\t\t\ttype: workerProtocol.MessageType.REPLY,\n\t\t\taction: action,\n\t\t\tpayload: (payload instanceof Error) ? transformErrorForSerialization(payload) : payload\n\t\t};\n\t\tthis._postMessage(msg);\n\t}\n\n\tpublic loadModule(moduleId:string, callback:Function, errorback:(err:any)=>void): void {\n\t\t// Use the global require to be sure to get the global config\n\t\t(<any>self).require([moduleId], (...result:any[]) => {\n\t\t\tcallback(result[0]);\n\t\t}, errorback);\n\t}\n\n\tpublic onmessage(msg:string): void {\n\t\tthis._onmessage(parse(msg));\n\t}\n\n\tprivate _postMessage(msg:workerProtocol.IServerMessage): void {\n\t\tthis._postSerializedMessage(stringify(msg));\n\t}\n\n\tprivate _onmessage(msg:workerProtocol.IClientMessage): void {\n\n\t\tlet c = this._sendReply.bind(this, msg.id, workerProtocol.ReplyType.COMPLETE);\n\t\tlet e = this._sendReply.bind(this, msg.id, workerProtocol.ReplyType.ERROR);\n\t\tlet p = this._sendReply.bind(this, msg.id, workerProtocol.ReplyType.PROGRESS);\n\n\t\tswitch(msg.type) {\n\t\t\tcase workerProtocol.MessageType.INITIALIZE:\n\t\t\t\tthis._workerId = msg.payload.id;\n\n\t\t\t\tlet loaderConfig = msg.payload.loaderConfiguration;\n\t\t\t\t// TODO@Alex: share this code with simpleWorker\n\t\t\t\tif (loaderConfig) {\n\t\t\t\t\t// Remove 'baseUrl', handling it is beyond scope for now\n\t\t\t\t\tif (typeof loaderConfig.baseUrl !== 'undefined') {\n\t\t\t\t\t\tdelete loaderConfig['baseUrl'];\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof loaderConfig.paths !== 'undefined') {\n\t\t\t\t\t\tif (typeof loaderConfig.paths.vs !== 'undefined') {\n\t\t\t\t\t\t\tdelete loaderConfig.paths['vs'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet nlsConfig = loaderConfig['vs/nls'];\n\t\t\t\t\t// We need to have pseudo translation\n\t\t\t\t\tif (nlsConfig && nlsConfig.pseudo) {\n\t\t\t\t\t\trequire(['vs/nls'], function(nlsPlugin) {\n\t\t\t\t\t\t\tnlsPlugin.setPseudoTranslation(nlsConfig.pseudo);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Since this is in a web worker, enable catching errors\n\t\t\t\t\tloaderConfig.catchError = true;\n\t\t\t\t\t(<any>self).require.config(loaderConfig);\n\t\t\t\t}\n\n\t\t\t\tthis.loadModule(msg.payload.moduleId, (handlerModule:any) => {\n\t\t\t\t\tthis._requestHandler = handlerModule.value;\n\t\t\t\t\tc();\n\t\t\t\t}, e);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis._handleMessage(msg, c, e, p);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _handleMessage(msg:workerProtocol.IClientMessage, c:(value:any)=>void, e:(err:any)=>void, p:(progress:any)=>void): void {\n\t\tif (!this._requestHandler) {\n\t\t\te('Request handler not loaded');\n\t\t\treturn;\n\t\t}\n\n\t\tlet handlerMethod = this._requestHandler[msg.type];\n\t\tif (typeof handlerMethod !== 'function') {\n\t\t\te('Handler does not have method ' + msg.type);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\thandlerMethod.call(this._requestHandler, this, c, e, p, msg.payload);\n\t\t} catch (handlerError) {\n\t\t\te(transformErrorForSerialization(handlerError));\n\t\t}\n\t}\n}\n\nexport function create(postMessage:(msg:string)=>void): WorkerServer {\n\treturn new WorkerServer(postMessage);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport * as strings from 'vs/base/common/strings';\nimport {ViewLineToken} from 'vs/editor/common/core/viewLineToken';\nimport {LineToken} from 'vs/editor/common/model/lineToken';\n\nconst START_INDEX_MASK = 0xffffffff;\nconst TYPE_MASK = 0xffff;\nconst START_INDEX_OFFSET = 1;\nconst TYPE_OFFSET = Math.pow(2, 32);\n\nconst DEFAULT_VIEW_TOKEN = new ViewLineToken(0, '');\nconst INFLATED_TOKENS_EMPTY_TEXT:ViewLineToken[] = [];\nconst DEFLATED_TOKENS_EMPTY_TEXT:number[] = [];\nconst INFLATED_TOKENS_NON_EMPTY_TEXT:ViewLineToken[] = [DEFAULT_VIEW_TOKEN];\nconst DEFLATED_TOKENS_NON_EMPTY_TEXT:number[] = [0];\n\nexport class TokensInflatorMap {\n\n\tpublic _inflate:string[];\n\n\tpublic _deflate: {\n\t\t[token:string]:number;\n\t};\n\n\tconstructor() {\n\t\tthis._inflate = [ '' ];\n\t\tthis._deflate = { '': 0 };\n\t}\n}\n\nexport class TokensBinaryEncoding {\n\tpublic static START_INDEX_MASK = START_INDEX_MASK;\n\tpublic static TYPE_MASK = TYPE_MASK;\n\tpublic static START_INDEX_OFFSET = START_INDEX_OFFSET;\n\tpublic static TYPE_OFFSET = TYPE_OFFSET;\n\n\tpublic static deflateArr(map:TokensInflatorMap, tokens:LineToken[]): number[] {\n\t\tif (tokens.length === 0) {\n\t\t\treturn DEFLATED_TOKENS_EMPTY_TEXT;\n\t\t}\n\t\tif (tokens.length === 1 && tokens[0].startIndex === 0 && !tokens[0].type) {\n\t\t\treturn DEFLATED_TOKENS_NON_EMPTY_TEXT;\n\t\t}\n\n\t\tvar i:number,\n\t\t\tlen:number,\n\t\t\tdeflatedToken:number,\n\t\t\tdeflated:number,\n\t\t\ttoken:LineToken,\n\t\t\tinflateMap = map._inflate,\n\t\t\tdeflateMap = map._deflate,\n\t\t\tprevStartIndex:number = -1,\n\t\t\tresult:number[] = new Array(tokens.length);\n\n\t\tfor (i = 0, len = tokens.length; i < len; i++) {\n\t\t\ttoken = tokens[i];\n\n\t\t\tif (token.startIndex <= prevStartIndex) {\n\t\t\t\ttoken.startIndex = prevStartIndex + 1;\n\t\t\t\tonUnexpectedError({\n\t\t\t\t\tmessage: 'Invalid tokens detected',\n\t\t\t\t\ttokens: tokens\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (deflateMap.hasOwnProperty(token.type)) {\n\t\t\t\tdeflatedToken = deflateMap[token.type];\n\t\t\t} else {\n\t\t\t\tdeflatedToken = inflateMap.length;\n\t\t\t\tdeflateMap[token.type] = deflatedToken;\n\t\t\t\tinflateMap.push(token.type);\n\t\t\t}\n\n\t\t\t// http://stackoverflow.com/a/2803010\n\t\t\t// All numbers in JavaScript are actually IEEE-754 compliant floating-point doubles.\n\t\t\t// These have a 53-bit mantissa which should mean that any integer value with a magnitude\n\t\t\t// of approximately 9 quadrillion or less -- more specifically, 9,007,199,254,740,991 --\n\t\t\t// will be represented accurately.\n\n\t\t\t// http://stackoverflow.com/a/6729252\n\t\t\t// Bitwise operations cast numbers to 32bit representation in JS\n\n\t\t\t// 32 bits for startIndex => up to 2^32 = 4,294,967,296\n\t\t\t// 16 bits for token => up to 2^16 = 65,536\n\n\t\t\t// [token][startIndex]\n\t\t\tdeflated = deflatedToken * TYPE_OFFSET + token.startIndex * START_INDEX_OFFSET;\n\n\t\t\tresult[i] = deflated;\n\n\t\t\tprevStartIndex = token.startIndex;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic static getStartIndex(binaryEncodedToken:number): number {\n\t\treturn (binaryEncodedToken / START_INDEX_OFFSET) & START_INDEX_MASK;\n\t}\n\n\tpublic static getType(map:TokensInflatorMap, binaryEncodedToken:number): string {\n\t\tvar deflatedType = (binaryEncodedToken / TYPE_OFFSET) & TYPE_MASK;\n\t\tif (deflatedType === 0) {\n\t\t\treturn strings.empty;\n\t\t}\n\t\treturn map._inflate[deflatedType];\n\t}\n\n\tpublic static inflateArr(map:TokensInflatorMap, binaryEncodedTokens:number[]): ViewLineToken[] {\n\t\tif (binaryEncodedTokens.length === 0) {\n\t\t\treturn INFLATED_TOKENS_EMPTY_TEXT;\n\t\t}\n\t\tif (binaryEncodedTokens.length === 1 && binaryEncodedTokens[0] === 0) {\n\t\t\treturn INFLATED_TOKENS_NON_EMPTY_TEXT;\n\t\t}\n\n\t\tlet result: ViewLineToken[] = [];\n\t\tconst inflateMap = map._inflate;\n\n\t\tfor (let i = 0, len = binaryEncodedTokens.length; i < len; i++) {\n\t\t\tlet deflated = binaryEncodedTokens[i];\n\n\t\t\tlet startIndex = (deflated / START_INDEX_OFFSET) & START_INDEX_MASK;\n\t\t\tlet deflatedType = (deflated / TYPE_OFFSET) & TYPE_MASK;\n\n\t\t\tresult.push(new ViewLineToken(startIndex, inflateMap[deflatedType]));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic static findIndexOfOffset(binaryEncodedTokens:number[], offset:number): number {\n\t\treturn this.findIndexInSegmentsArray(binaryEncodedTokens, offset);\n\t}\n\n\tpublic static sliceAndInflate(map:TokensInflatorMap, binaryEncodedTokens:number[], startOffset:number, endOffset:number, deltaStartIndex:number): ViewLineToken[] {\n\t\tif (binaryEncodedTokens.length === 0) {\n\t\t\treturn INFLATED_TOKENS_EMPTY_TEXT;\n\t\t}\n\t\tif (binaryEncodedTokens.length === 1 && binaryEncodedTokens[0] === 0) {\n\t\t\treturn INFLATED_TOKENS_NON_EMPTY_TEXT;\n\t\t}\n\n\t\tlet startIndex = this.findIndexInSegmentsArray(binaryEncodedTokens, startOffset);\n\t\tlet result: ViewLineToken[] = [];\n\t\tconst inflateMap = map._inflate;\n\n\t\tlet originalToken = binaryEncodedTokens[startIndex];\n\t\tlet deflatedType = (originalToken / TYPE_OFFSET) & TYPE_MASK;\n\t\tlet newStartIndex = 0;\n\t\tresult.push(new ViewLineToken(newStartIndex, inflateMap[deflatedType]));\n\n\t\tfor (let i = startIndex + 1, len = binaryEncodedTokens.length; i < len; i++) {\n\t\t\toriginalToken = binaryEncodedTokens[i];\n\t\t\tlet originalStartIndex = (originalToken / START_INDEX_OFFSET) & START_INDEX_MASK;\n\n\t\t\tif (originalStartIndex >= endOffset) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdeflatedType = (originalToken / TYPE_OFFSET) & TYPE_MASK;\n\t\t\tnewStartIndex = originalStartIndex - startOffset + deltaStartIndex;\n\t\t\tresult.push(new ViewLineToken(newStartIndex, inflateMap[deflatedType]));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate static findIndexInSegmentsArray(arr:number[], desiredIndex: number):number {\n\n\t\tvar low = 0,\n\t\t\thigh = arr.length - 1,\n\t\t\tmid:number,\n\t\t\tvalue:number;\n\n\t\twhile (low < high) {\n\n\t\t\tmid = low + Math.ceil((high - low)/2);\n\n\t\t\tvalue = arr[mid] & 0xffffffff;\n\n\t\t\tif (value > desiredIndex) {\n\t\t\t\thigh = mid - 1;\n\t\t\t} else {\n\t\t\t\tlow = mid;\n\t\t\t}\n\t\t}\n\n\t\treturn low;\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as strings from 'vs/base/common/strings';\nimport {ILineTokens, IReadOnlyLineMarker} from 'vs/editor/common/editorCommon';\nimport {IMode, IState} from 'vs/editor/common/modes';\nimport {TokensBinaryEncoding, TokensInflatorMap} from 'vs/editor/common/model/tokensBinaryEncoding';\nimport {ModeTransition} from 'vs/editor/common/core/modeTransition';\nimport {LineToken} from 'vs/editor/common/model/lineToken';\nimport {ViewLineToken} from 'vs/editor/common/core/viewLineToken';\n\nconst START_INDEX_MASK = TokensBinaryEncoding.START_INDEX_MASK;\nconst TYPE_MASK = TokensBinaryEncoding.TYPE_MASK;\nconst START_INDEX_OFFSET = TokensBinaryEncoding.START_INDEX_OFFSET;\nconst TYPE_OFFSET = TokensBinaryEncoding.TYPE_OFFSET;\n\nexport interface ILineEdit {\n\tstartColumn: number;\n\tendColumn: number;\n\ttext: string;\n\tforceMoveMarkers: boolean;\n}\n\nexport interface ILineMarker extends IReadOnlyLineMarker {\n\tid:string;\n\tcolumn:number;\n\tstickToPreviousCharacter:boolean;\n\n\toldLineNumber:number;\n\toldColumn:number;\n\n\tline:ModelLine;\n}\n\nexport interface IChangedMarkers {\n\t[markerId:string]: boolean;\n}\n\nexport interface ITextWithMarkers {\n\ttext: string;\n\tmarkers: ILineMarker[];\n}\n\ninterface ITokensAdjuster {\n\tadjust(toColumn:number, delta:number, minimumAllowedColumn:number): void;\n\tfinish(delta:number, lineTextLength:number): void;\n}\n\ninterface IMarkersAdjuster {\n\tadjustDelta(toColumn:number, delta:number, minimumAllowedColumn:number, moveSemantics:MarkerMoveSemantics): void;\n\tadjustSet(toColumn:number, newColumn:number, moveSemantics:MarkerMoveSemantics): void;\n\tfinish(delta:number, lineTextLength:number): void;\n}\n\nvar NO_OP_TOKENS_ADJUSTER: ITokensAdjuster = {\n\tadjust: () => {},\n\tfinish: () => {}\n};\nvar NO_OP_MARKERS_ADJUSTER: IMarkersAdjuster = {\n\tadjustDelta: () => {},\n\tadjustSet: () => {},\n\tfinish: () => {}\n};\n\nenum MarkerMoveSemantics {\n\tMarkerDefined = 0,\n\tForceMove = 1,\n\tForceStay = 2\n}\n\nexport class ModelLine {\n\tprivate _lineNumber:number;\n\tpublic get lineNumber():number { return this._lineNumber; }\n\n\tprivate _text:string;\n\tpublic get text():string { return this._text; }\n\n\tprivate _isInvalid:boolean;\n\tpublic get isInvalid():boolean { return this._isInvalid; }\n\tpublic set isInvalid(value:boolean) { this._isInvalid = value; }\n\n\tprivate _state:IState;\n\tprivate _modeTransitions: ModeTransition[];\n\tprivate _lineTokens: LineTokens;\n\tprivate _markers:ILineMarker[];\n\n\tconstructor(lineNumber:number, text:string) {\n\t\tthis._lineNumber = lineNumber|0;\n\t\tthis._text = text;\n\t\tthis._isInvalid = false;\n\t\tthis._state = null;\n\t\tthis._modeTransitions = null;\n\t\tthis._lineTokens = null;\n\t\tthis._markers = null;\n\t}\n\n\t// --- BEGIN STATE\n\n\tpublic setState(state: IState): void {\n\t\tthis._state = state;\n\t}\n\n\tpublic getState(): IState {\n\t\treturn this._state || null;\n\t}\n\n\t// --- END STATE\n\n\t// --- BEGIN MODE TRANSITIONS\n\n\tpublic getModeTransitions(topLevelMode:IMode): ModeTransition[] {\n\t\tif (this._modeTransitions) {\n\t\t\treturn this._modeTransitions;\n\t\t} else {\n\t\t\treturn [new ModeTransition(0, topLevelMode)];\n\t\t}\n\t}\n\n\t// --- END MODE TRANSITIONS\n\n\t// --- BEGIN TOKENS\n\n\tpublic setTokens(map: TokensInflatorMap, tokens: LineToken[], topLevelMode:IMode, modeTransitions:ModeTransition[]): void {\n\t\tthis._lineTokens = toLineTokensFromInflated(map, tokens, this._text.length);\n\t\tthis._modeTransitions = toModeTransitions(topLevelMode, modeTransitions);\n\t}\n\n\tprivate _setLineTokensFromDeflated(map:TokensInflatorMap, tokens:number[]): void {\n\t\tthis._lineTokens = toLineTokensFromDeflated(map, tokens, this._text.length);\n\t}\n\n\tpublic getTokens(): ILineTokens {\n\t\tif (this._lineTokens) {\n\t\t\treturn this._lineTokens;\n\t\t}\n\t\tif (this._text.length === 0) {\n\t\t\treturn EmptyLineTokens.INSTANCE;\n\t\t}\n\t\treturn DefaultLineTokens.INSTANCE;\n\t}\n\n\t// --- END TOKENS\n\n\tprivate _createTokensAdjuster(): ITokensAdjuster {\n\t\tif (!this._lineTokens) {\n\t\t\t// This line does not have real tokens, so there is nothing to adjust\n\t\t\treturn NO_OP_TOKENS_ADJUSTER;\n\t\t}\n\n\t\tvar lineTokens = this._lineTokens;\n\n\t\tlet tokens = lineTokens.getBinaryEncodedTokens();\n\t\tlet tokensLength = tokens.length;\n\t\tlet tokensIndex = 0;\n\t\tlet currentTokenStartIndex = 0;\n\n\t\tlet adjust = (toColumn:number, delta:number, minimumAllowedColumn:number) => {\n\t\t\t// console.log('before call: tokensIndex: ' + tokensIndex + ': ' + String(this.getTokens()));\n\t\t\t// console.log('adjustTokens: ' + toColumn + ' with delta: ' + delta + ' and [' + minimumAllowedColumn + ']');\n\t\t\t// console.log('currentTokenStartIndex: ' + currentTokenStartIndex);\n\t\t\tlet minimumAllowedIndex = minimumAllowedColumn - 1;\n\n\t\t\twhile (currentTokenStartIndex < toColumn && tokensIndex < tokensLength) {\n\n\t\t\t\tif (currentTokenStartIndex > 0 && delta !== 0) {\n\t\t\t\t\t// adjust token's `startIndex` by `delta`\n\t\t\t\t\tlet deflatedType = (tokens[tokensIndex] / TYPE_OFFSET) & TYPE_MASK;\n\t\t\t\t\tlet newStartIndex = Math.max(minimumAllowedIndex, currentTokenStartIndex + delta);\n\t\t\t\t\tlet newToken = deflatedType * TYPE_OFFSET + newStartIndex * START_INDEX_OFFSET;\n\n\t\t\t\t\tif (delta < 0) {\n\t\t\t\t\t\t// pop all previous tokens that have become `collapsed`\n\t\t\t\t\t\twhile (tokensIndex > 0) {\n\t\t\t\t\t\t\tlet prevTokenStartIndex = (tokens[tokensIndex - 1] / START_INDEX_OFFSET) & START_INDEX_MASK;\n\t\t\t\t\t\t\tif (prevTokenStartIndex >= newStartIndex) {\n\t\t\t\t\t\t\t\t// Token at `tokensIndex` - 1 is now `collapsed` => pop it\n\t\t\t\t\t\t\t\ttokens.splice(tokensIndex - 1, 1);\n\t\t\t\t\t\t\t\ttokensLength--;\n\t\t\t\t\t\t\t\ttokensIndex--;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttokens[tokensIndex] = newToken;\n\t\t\t\t}\n\n\t\t\t\ttokensIndex++;\n\n\t\t\t\tif (tokensIndex < tokensLength) {\n\t\t\t\t\tcurrentTokenStartIndex = (tokens[tokensIndex] / START_INDEX_OFFSET) & START_INDEX_MASK;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// console.log('after call: tokensIndex: ' + tokensIndex + ': ' + String(this.getTokens()));\n\t\t};\n\n\t\tlet finish = (delta:number, lineTextLength:number) => {\n\t\t\tadjust(Number.MAX_VALUE, delta, 1);\n\t\t};\n\n\t\treturn {\n\t\t\tadjust: adjust,\n\t\t\tfinish: finish\n\t\t};\n\t}\n\n\tprivate _setText(text:string): void {\n\t\tthis._text = text;\n\n\t\tif (this._lineTokens) {\n\t\t\tlet map = this._lineTokens.getBinaryEncodedTokensMap(),\n\t\t\t\ttokens = this._lineTokens.getBinaryEncodedTokens(),\n\t\t\t\tlineTextLength = this._text.length;\n\n\t\t\t// Remove overflowing tokens\n\t\t\twhile (tokens.length > 0) {\n\t\t\t\tlet lastTokenStartIndex = (tokens[tokens.length - 1] / START_INDEX_OFFSET) & START_INDEX_MASK;\n\t\t\t\tif (lastTokenStartIndex < lineTextLength) {\n\t\t\t\t\t// Valid token\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// This token now overflows the text => remove it\n\t\t\t\ttokens.pop();\n\t\t\t}\n\n\t\t\tthis._setLineTokensFromDeflated(map, tokens);\n\t\t}\n\t}\n\n\t// private _printMarkers(): string {\n\t// \tif (!this._markers) {\n\t// \t\treturn '[]';\n\t// \t}\n\t// \tif (this._markers.length === 0) {\n\t// \t\treturn '[]';\n\t// \t}\n\n\t// \tvar markers = this._markers;\n\n\t// \tvar printMarker = (m:ILineMarker) => {\n\t// \t\tif (m.stickToPreviousCharacter) {\n\t// \t\t\treturn '|' + m.column;\n\t// \t\t}\n\t// \t\treturn m.column + '|';\n\t// \t};\n\t// \treturn '[' + markers.map(printMarker).join(', ') + ']';\n\t// }\n\n\tprivate _createMarkersAdjuster(changedMarkers:IChangedMarkers): IMarkersAdjuster {\n\t\tif (!this._markers) {\n\t\t\treturn NO_OP_MARKERS_ADJUSTER;\n\t\t}\n\t\tif (this._markers.length === 0) {\n\t\t\treturn NO_OP_MARKERS_ADJUSTER;\n\t\t}\n\n\t\tthis._markers.sort(ModelLine._compareMarkers);\n\n\t\tvar markers = this._markers;\n\t\tvar markersLength = markers.length;\n\t\tvar markersIndex = 0;\n\t\tvar marker = markers[markersIndex];\n\n\t\t// console.log('------------- INITIAL MARKERS: ' + this._printMarkers());\n\n\t\tlet adjustMarkerBeforeColumn = (toColumn:number, moveSemantics:MarkerMoveSemantics) => {\n\t\t\tif (marker.column < toColumn) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (marker.column > toColumn) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (moveSemantics === MarkerMoveSemantics.ForceMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (moveSemantics === MarkerMoveSemantics.ForceStay) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn marker.stickToPreviousCharacter;\n\t\t};\n\n\t\tlet adjustDelta = (toColumn:number, delta:number, minimumAllowedColumn:number, moveSemantics:MarkerMoveSemantics) => {\n\t\t\t// console.log('------------------------------');\n\t\t\t// console.log('adjustDelta called: toColumn: ' + toColumn + ', delta: ' + delta + ', minimumAllowedColumn: ' + minimumAllowedColumn + ', moveSemantics: ' + MarkerMoveSemantics[moveSemantics]);\n\t\t\t// console.log('BEFORE::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n\n\t\t\twhile (markersIndex < markersLength && adjustMarkerBeforeColumn(toColumn, moveSemantics)) {\n\t\t\t\tif (delta !== 0) {\n\t\t\t\t\tlet newColumn = Math.max(minimumAllowedColumn, marker.column + delta);\n\t\t\t\t\tif (marker.column !== newColumn) {\n\t\t\t\t\t\tchangedMarkers[marker.id] = true;\n\t\t\t\t\t\tmarker.oldLineNumber = marker.oldLineNumber || this._lineNumber;\n\t\t\t\t\t\tmarker.oldColumn = marker.oldColumn || marker.column;\n\t\t\t\t\t\tmarker.column = newColumn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmarkersIndex++;\n\t\t\t\tif (markersIndex < markersLength) {\n\t\t\t\t\tmarker = markers[markersIndex];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// console.log('AFTER::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n\t\t};\n\n\t\tlet adjustSet = (toColumn:number, newColumn:number, moveSemantics:MarkerMoveSemantics) => {\n\t\t\t// console.log('------------------------------');\n\t\t\t// console.log('adjustSet called: toColumn: ' + toColumn + ', newColumn: ' + newColumn + ', moveSemantics: ' + MarkerMoveSemantics[moveSemantics]);\n\t\t\t// console.log('BEFORE::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n\n\t\t\twhile (markersIndex < markersLength && adjustMarkerBeforeColumn(toColumn, moveSemantics)) {\n\t\t\t\tif (marker.column !== newColumn) {\n\t\t\t\t\tchangedMarkers[marker.id] = true;\n\t\t\t\t\tmarker.oldLineNumber = marker.oldLineNumber || this._lineNumber;\n\t\t\t\t\tmarker.oldColumn = marker.oldColumn || marker.column;\n\t\t\t\t\tmarker.column = newColumn;\n\t\t\t\t}\n\n\t\t\t\tmarkersIndex++;\n\t\t\t\tif (markersIndex < markersLength) {\n\t\t\t\t\tmarker = markers[markersIndex];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// console.log('AFTER::: markersIndex: ' + markersIndex + ' : ' + this._printMarkers());\n\t\t};\n\n\t\tlet finish = (delta:number, lineTextLength:number) => {\n\t\t\tadjustDelta(Number.MAX_VALUE, delta, 1, MarkerMoveSemantics.MarkerDefined);\n\n\t\t\t// console.log('------------- FINAL MARKERS: ' + this._printMarkers());\n\t\t};\n\n\t\treturn {\n\t\t\tadjustDelta: adjustDelta,\n\t\t\tadjustSet: adjustSet,\n\t\t\tfinish: finish\n\t\t};\n\t}\n\n\tpublic applyEdits(changedMarkers: IChangedMarkers, edits:ILineEdit[]): number {\n\t\tlet deltaColumn = 0;\n\t\tlet resultText = this._text;\n\n\t\tlet tokensAdjuster = this._createTokensAdjuster();\n\t\tlet markersAdjuster = this._createMarkersAdjuster(changedMarkers);\n\n\t\tfor (let i = 0, len = edits.length; i < len; i++) {\n\t\t\tlet edit = edits[i];\n\n\t\t\t// console.log();\n\t\t\t// console.log('=============================');\n\t\t\t// console.log('EDIT #' + i + ' [ ' + edit.startColumn + ' -> ' + edit.endColumn + ' ] : <<<' + edit.text + '>>>, forceMoveMarkers: ' + edit.forceMoveMarkers);\n\t\t\t// console.log('deltaColumn: ' + deltaColumn);\n\n\t\t\tlet startColumn = deltaColumn + edit.startColumn;\n\t\t\tlet endColumn = deltaColumn + edit.endColumn;\n\t\t\tlet deletingCnt = endColumn - startColumn;\n\t\t\tlet insertingCnt = edit.text.length;\n\n\t\t\t// Adjust tokens & markers before this edit\n\t\t\t// console.log('Adjust tokens & markers before this edit');\n\t\t\ttokensAdjuster.adjust(edit.startColumn - 1, deltaColumn, 1);\n\t\t\tmarkersAdjuster.adjustDelta(edit.startColumn, deltaColumn, 1, edit.forceMoveMarkers ? MarkerMoveSemantics.ForceMove : (deletingCnt > 0 ? MarkerMoveSemantics.ForceStay : MarkerMoveSemantics.MarkerDefined));\n\n\t\t\t// Adjust tokens & markers for the common part of this edit\n\t\t\tlet commonLength = Math.min(deletingCnt, insertingCnt);\n\t\t\tif (commonLength > 0) {\n\t\t\t\t// console.log('Adjust tokens & markers for the common part of this edit');\n\t\t\t\ttokensAdjuster.adjust(edit.startColumn - 1 + commonLength, deltaColumn, startColumn);\n\n\t\t\t\tif (!edit.forceMoveMarkers) {\n\t\t\t\t\tmarkersAdjuster.adjustDelta(edit.startColumn + commonLength, deltaColumn, startColumn, edit.forceMoveMarkers ? MarkerMoveSemantics.ForceMove : (deletingCnt > insertingCnt ? MarkerMoveSemantics.ForceStay : MarkerMoveSemantics.MarkerDefined));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Perform the edit & update `deltaColumn`\n\t\t\tresultText = resultText.substring(0, startColumn - 1) + edit.text + resultText.substring(endColumn - 1);\n\t\t\tdeltaColumn += insertingCnt - deletingCnt;\n\n\t\t\t// Adjust tokens & markers inside this edit\n\t\t\t// console.log('Adjust tokens & markers inside this edit');\n\t\t\ttokensAdjuster.adjust(edit.endColumn, deltaColumn, startColumn);\n\t\t\tmarkersAdjuster.adjustSet(edit.endColumn, startColumn + insertingCnt, edit.forceMoveMarkers ? MarkerMoveSemantics.ForceMove : MarkerMoveSemantics.MarkerDefined);\n\t\t}\n\n\t\t// Wrap up tokens & markers; adjust remaining if needed\n\t\ttokensAdjuster.finish(deltaColumn, resultText.length);\n\t\tmarkersAdjuster.finish(deltaColumn, resultText.length);\n\n\t\t// Save the resulting text\n\t\tthis._setText(resultText);\n\n\t\treturn deltaColumn;\n\t}\n\n\tpublic split(changedMarkers: IChangedMarkers, splitColumn:number, forceMoveMarkers:boolean): ModelLine {\n\t\t// console.log('--> split @ ' + splitColumn + '::: ' + this._printMarkers());\n\t\tvar myText = this._text.substring(0, splitColumn - 1);\n\t\tvar otherText = this._text.substring(splitColumn - 1);\n\n\t\tvar otherMarkers: ILineMarker[] = null;\n\n\t\tif (this._markers) {\n\t\t\tthis._markers.sort(ModelLine._compareMarkers);\n\t\t\tfor (let i = 0, len = this._markers.length; i < len; i++) {\n\t\t\t\tlet marker = this._markers[i];\n\n\t\t\t\tif (\n\t\t\t\t\tmarker.column > splitColumn\n\t\t\t\t\t|| (\n\t\t\t\t\t\tmarker.column === splitColumn\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\tforceMoveMarkers\n\t\t\t\t\t\t\t|| !marker.stickToPreviousCharacter\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tlet myMarkers = this._markers.slice(0, i);\n\t\t\t\t\totherMarkers = this._markers.slice(i);\n\t\t\t\t\tthis._markers = myMarkers;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (otherMarkers) {\n\t\t\t\tfor (let i = 0, len = otherMarkers.length; i < len; i++) {\n\t\t\t\t\tlet marker = otherMarkers[i];\n\n\t\t\t\t\tchangedMarkers[marker.id] = true;\n\t\t\t\t\tmarker.oldLineNumber = marker.oldLineNumber || this._lineNumber;\n\t\t\t\t\tmarker.oldColumn = marker.oldColumn || marker.column;\n\t\t\t\t\tmarker.column -= splitColumn - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._setText(myText);\n\n\t\tvar otherLine = new ModelLine(this._lineNumber + 1, otherText);\n\t\tif (otherMarkers) {\n\t\t\totherLine.addMarkers(otherMarkers);\n\t\t}\n\t\treturn otherLine;\n\t}\n\n\tpublic append(changedMarkers: IChangedMarkers, other:ModelLine): void {\n\t\t// console.log('--> append: THIS :: ' + this._printMarkers());\n\t\t// console.log('--> append: OTHER :: ' + this._printMarkers());\n\t\tvar thisTextLength = this._text.length;\n\t\tthis._setText(this._text + other._text);\n\n\t\tlet otherLineTokens = other._lineTokens;\n\t\tif (otherLineTokens) {\n\t\t\t// Other has real tokens\n\t\t\tlet otherTokens = otherLineTokens.getBinaryEncodedTokens();\n\n\t\t\t// Adjust other tokens\n\t\t\tif (thisTextLength > 0) {\n\t\t\t\tfor (let i = 0, len = otherTokens.length; i < len; i++) {\n\t\t\t\t\tlet token = otherTokens[i];\n\n\t\t\t\t\tlet deflatedStartIndex = (token / START_INDEX_OFFSET) & START_INDEX_MASK;\n\t\t\t\t\tlet deflatedType = (token / TYPE_OFFSET) & TYPE_MASK;\n\t\t\t\t\tlet newStartIndex = deflatedStartIndex + thisTextLength;\n\t\t\t\t\tlet newToken = deflatedType * TYPE_OFFSET + newStartIndex * START_INDEX_OFFSET;\n\n\t\t\t\t\totherTokens[i] = newToken;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Append other tokens\n\t\t\tlet myLineTokens = this._lineTokens;\n\t\t\tif (myLineTokens) {\n\t\t\t\t// I have real tokens\n\t\t\t\tthis._setLineTokensFromDeflated(myLineTokens.getBinaryEncodedTokensMap(), myLineTokens.getBinaryEncodedTokens().concat(otherTokens));\n\t\t\t} else {\n\t\t\t\t// I don't have real tokens\n\t\t\t\tthis._setLineTokensFromDeflated(otherLineTokens.getBinaryEncodedTokensMap(), otherTokens);\n\t\t\t}\n\t\t}\n\n\t\tif (other._markers) {\n\t\t\t// Other has markers\n\t\t\tlet otherMarkers = other._markers;\n\n\t\t\t// Adjust other markers\n\t\t\tfor (let i = 0, len = otherMarkers.length; i < len; i++) {\n\t\t\t\tlet marker = otherMarkers[i];\n\n\t\t\t\tchangedMarkers[marker.id] = true;\n\t\t\t\tmarker.oldLineNumber = marker.oldLineNumber || other.lineNumber;\n\t\t\t\tmarker.oldColumn = marker.oldColumn || marker.column;\n\t\t\t\tmarker.column += thisTextLength;\n\t\t\t}\n\n\t\t\tthis.addMarkers(otherMarkers);\n\t\t}\n\t}\n\n\tpublic addMarker(marker:ILineMarker): void {\n\t\tmarker.line = this;\n\t\tif (!this._markers) {\n\t\t\tthis._markers = [marker];\n\t\t} else {\n\t\t\tthis._markers.push(marker);\n\t\t}\n\t}\n\n\tpublic addMarkers(markers:ILineMarker[]): void {\n\t\tif (markers.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar i:number,\n\t\t\tlen:number;\n\n\t\tfor (i = 0, len = markers.length; i < len; i++) {\n\t\t\tmarkers[i].line = this;\n\t\t}\n\n\t\tif (!this._markers) {\n\t\t\tthis._markers = markers.slice(0);\n\t\t} else {\n\t\t\tthis._markers = this._markers.concat(markers);\n\t\t}\n\t}\n\n\tprivate static _compareMarkers(a:ILineMarker, b:ILineMarker): number {\n\t\tif (a.column === b.column) {\n\t\t\treturn (a.stickToPreviousCharacter ? 0 : 1) - (b.stickToPreviousCharacter ? 0 : 1);\n\t\t}\n\t\treturn a.column - b.column;\n\t}\n\n\tpublic removeMarker(marker:ILineMarker): void {\n\t\tif (!this._markers) {\n\t\t\treturn;\n\t\t}\n\t\tlet index = this._indexOfMarkerId(marker.id);\n\t\tif (index >= 0) {\n\t\t\tmarker.line = null;\n\t\t\tthis._markers.splice(index, 1);\n\t\t}\n\t\tif (this._markers.length === 0) {\n\t\t\tthis._markers = null;\n\t\t}\n\t}\n\n\tpublic removeMarkers(deleteMarkers: {[markerId:string]:boolean;}): void {\n\t\tif (!this._markers) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0, len = this._markers.length; i < len; i++) {\n\t\t\tlet marker = this._markers[i];\n\n\t\t\tif (deleteMarkers[marker.id]) {\n\t\t\t\tmarker.line = null;\n\t\t\t\tthis._markers.splice(i, 1);\n\t\t\t\tlen--;\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tif (this._markers.length === 0) {\n\t\t\tthis._markers = null;\n\t\t}\n\t}\n\n\tpublic getMarkers(): ILineMarker[] {\n\t\tif (!this._markers) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this._markers.slice(0);\n\t}\n\n\tpublic updateLineNumber(changedMarkers: IChangedMarkers, newLineNumber: number): void {\n\t\tif (this._markers) {\n\t\t\tvar markers = this._markers,\n\t\t\t\ti: number,\n\t\t\t\tlen: number,\n\t\t\t\tmarker: ILineMarker;\n\n\t\t\tfor (i = 0, len = markers.length; i < len; i++) {\n\t\t\t\tmarker = markers[i];\n\n\t\t\t\tchangedMarkers[marker.id] = true;\n\t\t\t\tmarker.oldLineNumber = marker.oldLineNumber || this._lineNumber;\n\t\t\t}\n\t\t}\n\n\t\tthis._lineNumber = newLineNumber;\n\t}\n\n\tpublic deleteLine(changedMarkers: IChangedMarkers, setMarkersColumn:number, setMarkersOldLineNumber:number): ILineMarker[] {\n\t\t// console.log('--> deleteLine: ');\n\t\tif (this._markers) {\n\t\t\tvar markers = this._markers,\n\t\t\t\ti: number,\n\t\t\t\tlen: number,\n\t\t\t\tmarker: ILineMarker;\n\n\t\t\t// Mark all these markers as changed\n\t\t\tfor (i = 0, len = markers.length; i < len; i++) {\n\t\t\t\tmarker = markers[i];\n\n\t\t\t\tchangedMarkers[marker.id] = true;\n\t\t\t\tmarker.oldColumn = marker.oldColumn || marker.column;\n\t\t\t\tmarker.oldLineNumber = marker.oldLineNumber || setMarkersOldLineNumber;\n\t\t\t\tmarker.column = setMarkersColumn;\n\t\t\t}\n\n\t\t\treturn markers;\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate _indexOfMarkerId(markerId:string): number {\n\t\tlet markers = this._markers;\n\t\tfor (let i = 0, len = markers.length; i < len; i++) {\n\t\t\tif (markers[i].id === markerId) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction toLineTokensFromInflated(map:TokensInflatorMap, tokens:LineToken[], textLength:number): LineTokens {\n\tif (textLength === 0) {\n\t\treturn null;\n\t}\n\tif (!tokens || tokens.length === 0) {\n\t\treturn null;\n\t}\n\tif (tokens.length === 1) {\n\t\tif (tokens[0].startIndex === 0 && tokens[0].type === '') {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tlet deflated = TokensBinaryEncoding.deflateArr(map, tokens);\n\treturn new LineTokens(map, deflated);\n}\n\nfunction toLineTokensFromDeflated(map:TokensInflatorMap, tokens:number[], textLength:number): LineTokens {\n\tif (textLength === 0) {\n\t\treturn null;\n\t}\n\tif (!tokens || tokens.length === 0) {\n\t\treturn null;\n\t}\n\tif (tokens.length === 1) {\n\t\tif (tokens[0] === 0) {\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn new LineTokens(map, tokens);\n}\n\nexport class LineTokens implements ILineTokens {\n\n\tprivate map:TokensInflatorMap;\n\tprivate _tokens:number[];\n\n\tconstructor(map:TokensInflatorMap, tokens:number[]) {\n\t\tthis.map = map;\n\t\tthis._tokens = tokens;\n\t}\n\n\tpublic getBinaryEncodedTokensMap(): TokensInflatorMap {\n\t\treturn this.map;\n\t}\n\n\tpublic getBinaryEncodedTokens(): number[] {\n\t\treturn this._tokens;\n\t}\n\n\tpublic getTokenCount(): number {\n\t\treturn this._tokens.length;\n\t}\n\n\tpublic getTokenStartIndex(tokenIndex:number): number {\n\t\treturn TokensBinaryEncoding.getStartIndex(this._tokens[tokenIndex]);\n\t}\n\n\tpublic getTokenType(tokenIndex:number): string {\n\t\treturn TokensBinaryEncoding.getType(this.map, this._tokens[tokenIndex]);\n\t}\n\n\tpublic getTokenEndIndex(tokenIndex:number, textLength:number): number {\n\t\tif (tokenIndex + 1 < this._tokens.length) {\n\t\t\treturn TokensBinaryEncoding.getStartIndex(this._tokens[tokenIndex + 1]);\n\t\t}\n\t\treturn textLength;\n\t}\n\n\tpublic equals(other:ILineTokens): boolean {\n\t\tif (other instanceof LineTokens) {\n\t\t\tif (this.map !== other.map) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this._tokens.length !== other._tokens.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (let i = 0, len = this._tokens.length; i < len; i++) {\n\t\t\t\tif (this._tokens[i] !== other._tokens[i]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\tif (!(other instanceof LineTokens)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tpublic findIndexOfOffset(offset:number): number {\n\t\treturn TokensBinaryEncoding.findIndexOfOffset(this._tokens, offset);\n\t}\n\n\tpublic inflate(): ViewLineToken[] {\n\t\treturn TokensBinaryEncoding.inflateArr(this.map, this._tokens);\n\t}\n\n\tpublic sliceAndInflate(startOffset:number, endOffset:number, deltaStartIndex:number): ViewLineToken[] {\n\t\treturn TokensBinaryEncoding.sliceAndInflate(this.map, this._tokens, startOffset, endOffset, deltaStartIndex);\n\t}\n\n}\n\nclass EmptyLineTokens implements ILineTokens {\n\n\tpublic static INSTANCE = new EmptyLineTokens();\n\n\tpublic getTokenCount(): number {\n\t\treturn 0;\n\t}\n\n\tpublic getTokenStartIndex(tokenIndex:number): number {\n\t\treturn 0;\n\t}\n\n\tpublic getTokenType(tokenIndex:number): string {\n\t\treturn strings.empty;\n\t}\n\n\tpublic getTokenEndIndex(tokenIndex:number, textLength:number): number {\n\t\treturn 0;\n\t}\n\n\tpublic equals(other:ILineTokens): boolean {\n\t\treturn other === this;\n\t}\n\n\tpublic findIndexOfOffset(offset:number): number {\n\t\treturn 0;\n\t}\n\n\tpublic inflate(): ViewLineToken[] {\n\t\treturn [];\n\t}\n\n\tpublic sliceAndInflate(startOffset:number, endOffset:number, deltaStartIndex:number): ViewLineToken[] {\n\t\treturn [];\n\t}\n}\n\nexport class DefaultLineTokens implements ILineTokens {\n\n\tpublic static INSTANCE = new DefaultLineTokens();\n\n\tpublic getTokenCount(): number {\n\t\treturn 1;\n\t}\n\n\tpublic getTokenStartIndex(tokenIndex:number): number {\n\t\treturn 0;\n\t}\n\n\tpublic getTokenType(tokenIndex:number): string {\n\t\treturn strings.empty;\n\t}\n\n\tpublic getTokenEndIndex(tokenIndex:number, textLength:number): number {\n\t\treturn textLength;\n\t}\n\n\tpublic equals(other:ILineTokens): boolean {\n\t\treturn this === other;\n\t}\n\n\tpublic findIndexOfOffset(offset:number): number {\n\t\treturn 0;\n\t}\n\n\tpublic inflate(): ViewLineToken[] {\n\t\treturn [new ViewLineToken(0, '')];\n\t}\n\n\tpublic sliceAndInflate(startOffset:number, endOffset:number, deltaStartIndex:number): ViewLineToken[] {\n\t\treturn [new ViewLineToken(0, '')];\n\t}\n\n}\n\nfunction toModeTransitions(topLevelMode:IMode, modeTransitions:ModeTransition[]): ModeTransition[] {\n\n\tif (!modeTransitions || modeTransitions.length === 0) {\n\t\treturn null;\n\t} else if (modeTransitions.length === 1 && modeTransitions[0].startIndex === 0 && modeTransitions[0].mode === topLevelMode) {\n\t\treturn null;\n\t}\n\n\treturn modeTransitions;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\nimport Event, {Emitter} from 'vs/base/common/event';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {IReadOnlyModel} from 'vs/editor/common/editorCommon';\nimport {LanguageSelector, score} from 'vs/editor/common/modes/languageSelector';\n\ninterface Entry<T> {\n\tselector: LanguageSelector;\n\tprovider: T;\n\tisBuiltin: boolean;\n\t_score: number;\n\t_time: number;\n}\n\nexport default class LanguageFeatureRegistry<T> {\n\n\tprivate _clock: number = 0;\n\tprivate _entries: Entry<T>[] = [];\n\tprivate _onDidChange: Emitter<number> = new Emitter<number>();\n\n\tconstructor() {\n\t}\n\n\tget onDidChange(): Event<number> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tregister(selector: LanguageSelector, provider: T, isBuiltin = false): IDisposable {\n\n\t\tlet entry: Entry<T> = {\n\t\t\tselector,\n\t\t\tprovider,\n\t\t\tisBuiltin,\n\t\t\t_score: -1,\n\t\t\t_time: this._clock++\n\t\t};\n\n\t\tthis._entries.push(entry);\n\t\tthis._lastCandidate = undefined;\n\t\tthis._onDidChange.fire(this._entries.length);\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tif (entry) {\n\t\t\t\t\tlet idx = this._entries.indexOf(entry);\n\t\t\t\t\tif (idx >= 0) {\n\t\t\t\t\t\tthis._entries.splice(idx, 1);\n\t\t\t\t\t\tthis._lastCandidate = undefined;\n\t\t\t\t\t\tthis._onDidChange.fire(this._entries.length);\n\t\t\t\t\t\tentry = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\thas(model: IReadOnlyModel): boolean {\n\t\treturn this.all(model).length > 0;\n\t}\n\n\tall(model: IReadOnlyModel): T[] {\n\t\tif (!model || model.isTooLargeForHavingAMode()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis._updateScores(model);\n\t\tconst result: T[] = [];\n\n\t\t// from registry\n\t\tfor (let entry of this._entries) {\n\t\t\tif (entry._score > 0) {\n\t\t\t\tresult.push(entry.provider);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tordered(model: IReadOnlyModel): T[] {\n\t\tconst result: T[] = [];\n\t\tthis._orderedForEach(model, entry => result.push(entry.provider));\n\t\treturn result;\n\t}\n\n\torderedGroups(model: IReadOnlyModel): T[][] {\n\t\tconst result: T[][] = [];\n\t\tlet lastBucket: T[];\n\t\tlet lastBucketScore: number;\n\n\t\tthis._orderedForEach(model, entry => {\n\t\t\tif (lastBucket && lastBucketScore === entry._score) {\n\t\t\t\tlastBucket.push(entry.provider);\n\t\t\t} else {\n\t\t\t\tlastBucketScore = entry._score;\n\t\t\t\tlastBucket = [entry.provider];\n\t\t\t\tresult.push(lastBucket);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tprivate _orderedForEach(model: IReadOnlyModel, callback: (provider: Entry<T>) => any): void {\n\n\t\tif (!model || model.isTooLargeForHavingAMode()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateScores(model);\n\n\t\tfor (let from = 0; from < this._entries.length; from++) {\n\t\t\tlet entry = this._entries[from];\n\t\t\tif (entry._score > 0) {\n\t\t\t\tcallback(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _lastCandidate: { uri: string; language: string; };\n\n\tprivate _updateScores(model: IReadOnlyModel): boolean {\n\n\t\tlet candidate = {\n\t\t\turi: model.uri.toString(),\n\t\t\tlanguage: model.getModeId()\n\t\t};\n\n\t\tif (this._lastCandidate\n\t\t\t&& this._lastCandidate.language === candidate.language\n\t\t\t&& this._lastCandidate.uri === candidate.uri) {\n\n\t\t\t// nothing has changed\n\t\t\treturn;\n\t\t}\n\n\t\tthis._lastCandidate = candidate;\n\n\t\tfor (let entry of this._entries) {\n\t\t\tentry._score = score(entry.selector, model.uri, model.getModeId());\n\t\t\tif (entry.isBuiltin && entry._score > 0) {\n\t\t\t\tentry._score = .5;\n\t\t\t\tentry._time = -1;\n\t\t\t}\n\t\t}\n\n\t\t// needs sorting\n\t\tthis._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\n\t}\n\n\tprivate static _compareByScoreAndTime(a: Entry<any>, b: Entry<any>): number {\n\t\tif (a._score < b._score) {\n\t\t\treturn 1;\n\t\t} else if (a._score > b._score) {\n\t\t\treturn -1;\n\t\t} else if (a._time < b._time) {\n\t\t\treturn 1;\n\t\t} else if (a._time > b._time) {\n\t\t\treturn -1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {MarkedString} from 'vs/base/common/htmlContent';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IFilter} from 'vs/base/common/filters';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport {ModeTransition} from 'vs/editor/common/core/modeTransition';\nimport LanguageFeatureRegistry from 'vs/editor/common/modes/languageFeatureRegistry';\nimport {CancellationToken} from 'vs/base/common/cancellation';\nimport {Position} from 'vs/editor/common/core/position';\nimport {Range} from 'vs/editor/common/core/range';\n\n/**\n * @internal\n */\nexport interface ITokenizationResult {\n\ttype?:string;\n\tdontMergeWithPrev?:boolean;\n\tnextState?:IState;\n}\n\n/**\n * @internal\n */\nexport interface IState {\n\tclone():IState;\n\tequals(other:IState):boolean;\n\tgetMode():IMode;\n\ttokenize(stream:IStream):ITokenizationResult;\n\tgetStateData(): IState;\n\tsetStateData(state:IState):void;\n}\n\n/**\n * An IStream is a character & token stream abstraction over a line of text. It\n *  is never multi-line. The stream can be navigated character by character, or\n *  token by token, given some token rules.\n * @internal\n */\nexport interface IStream {\n\n\t/**\n\t * Returns the current character position of the stream on the line.\n\t */\n\tpos():number;\n\n\t/**\n\t * Returns true iff the stream is at the end of the line.\n\t */\n\teos():boolean;\n\n\t/**\n\t * Returns the next character in the stream.\n\t */\n\tpeek():string;\n\n\t/**\n\t * Returns the next character in the stream, and advances it by one character.\n\t */\n\tnext(): string;\n\tnext2(): void;\n\n\t/**\n\t * Advances the stream by `n` characters.\n\t */\n\tadvance(n:number):string;\n\n\t/**\n\t * Advances the stream until the end of the line.\n\t */\n\tadvanceToEOS():string;\n\n\t/**\n\t * Brings the stream back `n` characters.\n\t */\n\tgoBack(n:number):void;\n\n\t/**\n\t *  Advances the stream if the next characters validate a condition. A condition can be\n\t *\n\t *      - a regular expression (always starting with ^)\n\t * \t\t\tEXAMPLES: /^\\d+/, /^function|var|interface|class/\n\t *\n\t *  \t- a string\n\t * \t\t\tEXAMPLES: \"1954\", \"albert\"\n\t */\n\tadvanceIfCharCode(charCode: number): string;\n\tadvanceIfCharCode2(charCode:number): number;\n\n\tadvanceIfString(condition: string): string;\n\tadvanceIfString2(condition: string): number;\n\n\tadvanceIfStringCaseInsensitive(condition: string): string;\n\tadvanceIfStringCaseInsensitive2(condition: string): number;\n\n\tadvanceIfRegExp(condition: RegExp): string;\n\tadvanceIfRegExp2(condition:RegExp): number;\n\n\n\t/**\n\t * Advances the stream while the next characters validate a condition. Check #advanceIf for\n\t * details on the possible types for condition.\n\t */\n\tadvanceWhile(condition:string):string;\n\tadvanceWhile(condition:RegExp):string;\n\n\t/**\n\t * Advances the stream until the some characters validate a condition. Check #advanceIf for\n\t * details on the possible types for condition. The `including` boolean value indicates\n\t * whether the stream will advance the characters that matched the condition as well, or not.\n\t */\n\tadvanceUntil(condition: string, including: boolean): string;\n\tadvanceUntil(condition: RegExp, including: boolean): string;\n\n\tadvanceUntilString(condition: string, including: boolean): string;\n\tadvanceUntilString2(condition: string, including: boolean): number;\n\n\t/**\n\t * The token rules define how consecutive characters should be put together as a token,\n\t * or separated into two different tokens. They are given through a separator characters\n\t * string and a whitespace characters string. A separator is always one token. Consecutive\n\t * whitespace is always one token. Everything in between these two token types, is also a token.\n\t *\n\t * \tEXAMPLE: stream.setTokenRules(\"+-\", \" \");\n\t * \tSetting these token rules defines the tokens for the string \"123+456 -    7\" as being\n\t * \t\t[\"123\", \"+\", \"456\", \" \", \"-\", \"    \", \"7\"]\n\t */\n\tsetTokenRules(separators:string, whitespace:string):void;\n\n\t/**\n\t * Returns the next token, given that the stream was configured with token rules.\n\t */\n\tpeekToken():string;\n\n\t/**\n\t * Returns the next token, given that the stream was configured with token rules, and advances the\n\t * stream by the exact length of the found token.\n\t */\n\tnextToken():string;\n\n\t/**\n\t * Returns the next whitespace, if found. Returns an empty string otherwise.\n\t */\n\tpeekWhitespace():string;\n\n\t/**\n\t * Returns the next whitespace, if found, and advances the stream by the exact length of the found\n\t * whitespace. Returns an empty string otherwise.\n\t */\n\tskipWhitespace(): string;\n\tskipWhitespace2(): number;\n}\n\n/**\n * @internal\n */\nexport interface IModeDescriptor {\n\tid:string;\n}\n\n/**\n * @internal\n */\nexport interface ILineContext {\n\tgetLineContent(): string;\n\n\tmodeTransitions: ModeTransition[];\n\n\tgetTokenCount(): number;\n\tgetTokenStartIndex(tokenIndex:number): number;\n\tgetTokenType(tokenIndex:number): string;\n\tgetTokenText(tokenIndex:number): string;\n\tgetTokenEndIndex(tokenIndex:number): number;\n\tfindIndexOfOffset(offset:number): number;\n}\n\n/**\n * A mode. Will soon be obsolete.\n */\nexport interface IMode {\n\n\tgetId(): string;\n\n\t/**\n\t * Return a mode \"similar\" to this one that strips any \"smart\" supports.\n\t * @internal\n\t */\n\ttoSimplifiedMode(): IMode;\n\n\t/**\n\t * @internal\n\t */\n\taddSupportChangedListener?(callback: (e: editorCommon.IModeSupportChangedEvent) => void): IDisposable;\n\n\t/**\n\t * Register a support by name. Only optional.\n\t * @internal\n\t */\n\tsetTokenizationSupport?<T>(callback:(mode:IMode)=>T): IDisposable;\n\n\t/**\n\t * Optional adapter to support tokenization.\n\t * @internal\n\t */\n\ttokenizationSupport?: ITokenizationSupport;\n\n\t/**\n\t * Optional adapter to support inplace-replace.\n\t * @internal\n\t */\n\tinplaceReplaceSupport?:IInplaceReplaceSupport;\n\n\t/**\n\t * Optional adapter to support configuring this mode.\n\t * @internal\n\t */\n\tconfigSupport?:IConfigurationSupport;\n}\n\n/**\n * Interface used for tokenization\n * @internal\n */\nexport interface IToken {\n\tstartIndex:number;\n\ttype:string;\n}\n\n/**\n * @internal\n */\nexport interface IModeTransition {\n\tstartIndex: number;\n\tmode: IMode;\n}\n\n/**\n * @internal\n */\nexport interface ILineTokens {\n\ttokens: IToken[];\n\tactualStopOffset: number;\n\tendState: IState;\n\tmodeTransitions: IModeTransition[];\n\tretokenize?:TPromise<void>;\n}\n\n/**\n * @internal\n */\nexport interface ITokenizationSupport {\n\n\tgetInitialState():IState;\n\n\t// add offsetDelta to each of the returned indices\n\t// stop tokenizing at absolute value stopAtOffset (i.e. stream.pos() + offsetDelta > stopAtOffset)\n\ttokenize(line:string, state:IState, offsetDelta?:number, stopAtOffset?:number):ILineTokens;\n}\n\n/**\n * A token. Only supports a single scope, but will soon support a scope array.\n */\nexport interface IToken2 {\n\tstartIndex: number;\n\tscopes: string|string[];\n}\n/**\n * The result of a line tokenization.\n */\nexport interface ILineTokens2 {\n\t/**\n\t * The list of tokens on the line.\n\t */\n\ttokens: IToken2[];\n\t/**\n\t * The tokenization end state.\n\t * A pointer will be held to this and the object should not be modified by the tokenizer after the pointer is returned.\n\t */\n\tendState: IState2;\n\t/**\n\t * An optional promise to force the model to retokenize this line (e.g. missing information at the point of tokenization)\n\t */\n\tretokenize?: TPromise<void>;\n}\n/**\n * The state of the tokenizer between two lines.\n * It is useful to store flags such as in multiline comment, etc.\n * The model will clone the previous line's state and pass it in to tokenize the next line.\n */\nexport interface IState2 {\n\tclone():IState2;\n\tequals(other:IState2):boolean;\n}\n/**\n * A \"manual\" provider of tokens.\n */\nexport interface TokensProvider {\n\t/**\n\t * The initial state of a language. Will be the state passed in to tokenize the first line.\n\t */\n\tgetInitialState(): IState2;\n\t/**\n\t * Tokenize a line given the state at the beginning of the line.\n\t */\n\ttokenize(line:string, state:IState2): ILineTokens2;\n}\n\n/**\n * A hover represents additional information for a symbol or word. Hovers are\n * rendered in a tooltip-like widget.\n */\nexport interface Hover {\n\t/**\n\t * The contents of this hover.\n\t */\n\tcontents: MarkedString[];\n\n\t/**\n\t * The range to which this hover applies. When missing, the\n\t * editor will use the range at the current position or the\n\t * current position itself.\n\t */\n\trange: editorCommon.IRange;\n}\n\n/**\n * The hover provider interface defines the contract between extensions and\n * the [hover](https://code.visualstudio.com/docs/editor/editingevolved#_hover)-feature.\n */\nexport interface HoverProvider {\n\t/**\n\t * Provide a hover for the given position and document. Multiple hovers at the same\n\t * position will be merged by the editor. A hover can have a range which defaults\n\t * to the word range at the position when omitted.\n\t */\n\tprovideHover(model:editorCommon.IReadOnlyModel, position:Position, token:CancellationToken): Hover | Thenable<Hover>;\n}\n\n/**\n * @internal\n */\nexport type SuggestionType = 'method'\n\t| 'function'\n\t| 'constructor'\n\t| 'field'\n\t| 'variable'\n\t| 'class'\n\t| 'interface'\n\t| 'module'\n\t| 'property'\n\t| 'unit'\n\t| 'value'\n\t| 'enum'\n\t| 'keyword'\n\t| 'snippet'\n\t| 'text'\n\t| 'color'\n\t| 'file'\n\t| 'reference'\n\t| 'customcolor';\n\n/**\n * @internal\n */\nexport interface ISuggestion {\n\tlabel: string;\n\tcodeSnippet: string;\n\ttype: SuggestionType;\n\ttypeLabel?: string;\n\tdocumentationLabel?: string;\n\tfilterText?: string;\n\tsortText?: string;\n\tnoAutoAccept?: boolean;\n\toverwriteBefore?: number;\n\toverwriteAfter?: number;\n}\n\n/**\n * @internal\n */\nexport interface ISuggestResult {\n\tcurrentWord: string;\n\tsuggestions:ISuggestion[];\n\tincomplete?: boolean;\n}\n\n/**\n * @internal\n */\nexport interface ISuggestSupport {\n\n\ttriggerCharacters: string[];\n\n\tshouldAutotriggerSuggest: boolean;\n\n\tfilter?: IFilter;\n\n\tprovideCompletionItems(model:editorCommon.IReadOnlyModel, position:Position, token:CancellationToken): ISuggestResult[] | Thenable<ISuggestResult[]>;\n\n\tresolveCompletionItem?(model:editorCommon.IReadOnlyModel, position:Position, item: ISuggestion, token: CancellationToken): ISuggestion | Thenable<ISuggestion>;\n}\n\n/**\n * Interface used to quick fix typing errors while accesing member fields.\n */\nexport interface CodeAction {\n\tcommand: Command;\n\tscore: number;\n}\n/**\n * The code action interface defines the contract between extensions and\n * the [light bulb](https://code.visualstudio.com/docs/editor/editingevolved#_code-action) feature.\n * @internal\n */\nexport interface CodeActionProvider {\n\t/**\n\t * Provide commands for the given document and range.\n\t */\n\tprovideCodeActions(model:editorCommon.IReadOnlyModel, range:Range, token: CancellationToken): CodeAction[] | Thenable<CodeAction[]>;\n}\n\n/**\n * Represents a parameter of a callable-signature. A parameter can\n * have a label and a doc-comment.\n */\nexport interface ParameterInformation {\n\t/**\n\t * The label of this signature. Will be shown in\n\t * the UI.\n\t */\n\tlabel: string;\n\t/**\n\t * The human-readable doc-comment of this signature. Will be shown\n\t * in the UI but can be omitted.\n\t */\n\tdocumentation: string;\n}\n/**\n * Represents the signature of something callable. A signature\n * can have a label, like a function-name, a doc-comment, and\n * a set of parameters.\n */\nexport interface SignatureInformation {\n\t/**\n\t * The label of this signature. Will be shown in\n\t * the UI.\n\t */\n\tlabel: string;\n\t/**\n\t * The human-readable doc-comment of this signature. Will be shown\n\t * in the UI but can be omitted.\n\t */\n\tdocumentation: string;\n\t/**\n\t * The parameters of this signature.\n\t */\n\tparameters: ParameterInformation[];\n}\n/**\n * Signature help represents the signature of something\n * callable. There can be multiple signatures but only one\n * active and only one active parameter.\n */\nexport interface SignatureHelp {\n\t/**\n\t * One or more signatures.\n\t */\n\tsignatures: SignatureInformation[];\n\t/**\n\t * The active signature.\n\t */\n\tactiveSignature: number;\n\t/**\n\t * The active parameter of the active signature.\n\t */\n\tactiveParameter: number;\n}\n/**\n * The signature help provider interface defines the contract between extensions and\n * the [parameter hints](https://code.visualstudio.com/docs/editor/editingevolved#_parameter-hints)-feature.\n */\nexport interface SignatureHelpProvider {\n\n\tsignatureHelpTriggerCharacters: string[];\n\n\t/**\n\t * Provide help for the signature at the given position and document.\n\t */\n\tprovideSignatureHelp(model: editorCommon.IReadOnlyModel, position: Position, token: CancellationToken): SignatureHelp | Thenable<SignatureHelp>;\n}\n\n/**\n * A document highlight kind.\n */\nexport enum DocumentHighlightKind {\n\t/**\n\t * A textual occurrence.\n\t */\n\tText,\n\t/**\n\t * Read-access of a symbol, like reading a variable.\n\t */\n\tRead,\n\t/**\n\t * Write-access of a symbol, like writing to a variable.\n\t */\n\tWrite\n}\n/**\n * A document highlight is a range inside a text document which deserves\n * special attention. Usually a document highlight is visualized by changing\n * the background color of its range.\n */\nexport interface DocumentHighlight {\n\t/**\n\t * The range this highlight applies to.\n\t */\n\trange: editorCommon.IRange;\n\t/**\n\t * The highlight kind, default is [text](#DocumentHighlightKind.Text).\n\t */\n\tkind: DocumentHighlightKind;\n}\n/**\n * The document highlight provider interface defines the contract between extensions and\n * the word-highlight-feature.\n */\nexport interface DocumentHighlightProvider {\n\t/**\n\t * Provide a set of document highlights, like all occurrences of a variable or\n\t * all exit-points of a function.\n\t */\n\tprovideDocumentHighlights(model: editorCommon.IReadOnlyModel, position: Position, token: CancellationToken): DocumentHighlight[] | Thenable<DocumentHighlight[]>;\n}\n\n/**\n * Value-object that contains additional information when\n * requesting references.\n */\nexport interface ReferenceContext {\n\t/**\n\t * Include the declaration of the current symbol.\n\t */\n\tincludeDeclaration: boolean;\n}\n/**\n * The reference provider interface defines the contract between extensions and\n * the [find references](https://code.visualstudio.com/docs/editor/editingevolved#_peek)-feature.\n */\nexport interface ReferenceProvider {\n\t/**\n\t * Provide a set of project-wide references for the given position and document.\n\t */\n\tprovideReferences(model:editorCommon.IReadOnlyModel, position:Position, context: ReferenceContext, token: CancellationToken): Location[] | Thenable<Location[]>;\n}\n\n/**\n * Represents a location inside a resource, such as a line\n * inside a text file.\n */\nexport interface Location {\n\t/**\n\t * The resource identifier of this location.\n\t */\n\turi: URI;\n\t/**\n\t * The document range of this locations.\n\t */\n\trange: editorCommon.IRange;\n}\n/**\n * The definition of a symbol represented as one or many [locations](#Location).\n * For most programming languages there is only one location at which a symbol is\n * defined.\n */\nexport type Definition = Location | Location[];\n/**\n * The definition provider interface defines the contract between extensions and\n * the [go to definition](https://code.visualstudio.com/docs/editor/editingevolved#_go-to-definition)\n * and peek definition features.\n */\nexport interface DefinitionProvider {\n\t/**\n\t * Provide the definition of the symbol at the given position and document.\n\t */\n\tprovideDefinition(model:editorCommon.IReadOnlyModel, position:Position, token:CancellationToken): Definition | Thenable<Definition>;\n}\n\n\n/**\n * A symbol kind.\n */\nexport enum SymbolKind {\n\tFile,\n\tModule,\n\tNamespace,\n\tPackage,\n\tClass,\n\tMethod,\n\tProperty,\n\tField,\n\tConstructor,\n\tEnum,\n\tInterface,\n\tFunction,\n\tVariable,\n\tConstant,\n\tString,\n\tNumber,\n\tBoolean,\n\tArray,\n\tObject,\n\tKey,\n\tNull\n}\n/**\n * @internal\n */\nexport namespace SymbolKind {\n\n\t/**\n\t * @internal\n\t */\n\texport function from(kind: number | SymbolKind): string {\n\t\tswitch (kind) {\n\t\t\tcase SymbolKind.Method:\n\t\t\t\treturn 'method';\n\t\t\tcase SymbolKind.Function:\n\t\t\t\treturn 'function';\n\t\t\tcase SymbolKind.Constructor:\n\t\t\t\treturn 'constructor';\n\t\t\tcase SymbolKind.Variable:\n\t\t\t\treturn 'variable';\n\t\t\tcase SymbolKind.Class:\n\t\t\t\treturn 'class';\n\t\t\tcase SymbolKind.Interface:\n\t\t\t\treturn 'interface';\n\t\t\tcase SymbolKind.Namespace:\n\t\t\t\treturn 'namespace';\n\t\t\tcase SymbolKind.Package:\n\t\t\t\treturn 'package';\n\t\t\tcase SymbolKind.Module:\n\t\t\t\treturn 'module';\n\t\t\tcase SymbolKind.Property:\n\t\t\t\treturn 'property';\n\t\t\tcase SymbolKind.Enum:\n\t\t\t\treturn 'enum';\n\t\t\tcase SymbolKind.String:\n\t\t\t\treturn 'string';\n\t\t\tcase SymbolKind.File:\n\t\t\t\treturn 'file';\n\t\t\tcase SymbolKind.Array:\n\t\t\t\treturn 'array';\n\t\t\tcase SymbolKind.Number:\n\t\t\t\treturn 'number';\n\t\t\tcase SymbolKind.Boolean:\n\t\t\t\treturn 'boolean';\n\t\t\tcase SymbolKind.Object:\n\t\t\t\treturn 'object';\n\t\t\tcase SymbolKind.Key:\n\t\t\t\treturn 'key';\n\t\t\tcase SymbolKind.Null:\n\t\t\t\treturn 'null';\n\t\t}\n\t\treturn 'property';\n\t}\n\n\t/**\n\t * @internal\n\t */\n\texport function to(type: string): SymbolKind {\n\t\tswitch (type) {\n\t\t\tcase 'method':\n\t\t\t\treturn SymbolKind.Method;\n\t\t\tcase 'function':\n\t\t\t\treturn SymbolKind.Function;\n\t\t\tcase 'constructor':\n\t\t\t\treturn SymbolKind.Constructor;\n\t\t\tcase 'variable':\n\t\t\t\treturn SymbolKind.Variable;\n\t\t\tcase 'class':\n\t\t\t\treturn SymbolKind.Class;\n\t\t\tcase 'interface':\n\t\t\t\treturn SymbolKind.Interface;\n\t\t\tcase 'namespace':\n\t\t\t\treturn SymbolKind.Namespace;\n\t\t\tcase 'package':\n\t\t\t\treturn SymbolKind.Package;\n\t\t\tcase 'module':\n\t\t\t\treturn SymbolKind.Module;\n\t\t\tcase 'property':\n\t\t\t\treturn SymbolKind.Property;\n\t\t\tcase 'enum':\n\t\t\t\treturn SymbolKind.Enum;\n\t\t\tcase 'string':\n\t\t\t\treturn SymbolKind.String;\n\t\t\tcase 'file':\n\t\t\t\treturn SymbolKind.File;\n\t\t\tcase 'array':\n\t\t\t\treturn SymbolKind.Array;\n\t\t\tcase 'number':\n\t\t\t\treturn SymbolKind.Number;\n\t\t\tcase 'boolean':\n\t\t\t\treturn SymbolKind.Boolean;\n\t\t\tcase 'object':\n\t\t\t\treturn SymbolKind.Object;\n\t\t\tcase 'key':\n\t\t\t\treturn SymbolKind.Key;\n\t\t\tcase 'null':\n\t\t\t\treturn SymbolKind.Null;\n\t\t}\n\t\treturn SymbolKind.Property;\n\t}\n}\n/**\n * Represents information about programming constructs like variables, classes,\n * interfaces etc.\n */\nexport interface SymbolInformation {\n\t/**\n\t * The name of this symbol.\n\t */\n\tname: string;\n\t/**\n\t * The name of the symbol containing this symbol.\n\t */\n\tcontainerName?: string;\n\t/**\n\t * The kind of this symbol.\n\t */\n\tkind: SymbolKind;\n\t/**\n\t * The location of this symbol.\n\t */\n\tlocation: Location;\n}\n/**\n * The document symbol provider interface defines the contract between extensions and\n * the [go to symbol](https://code.visualstudio.com/docs/editor/editingevolved#_goto-symbol)-feature.\n */\nexport interface DocumentSymbolProvider {\n\t/**\n\t * Provide symbol information for the given document.\n\t */\n\tprovideDocumentSymbols(model:editorCommon.IReadOnlyModel, token: CancellationToken): SymbolInformation[] | Thenable<SymbolInformation[]>;\n}\n\n/**\n * Interface used to format a model\n */\nexport interface FormattingOptions {\n\t/**\n\t * Size of a tab in spaces.\n\t */\n\ttabSize:number;\n\t/**\n\t * Prefer spaces over tabs.\n\t */\n\tinsertSpaces:boolean;\n}\n/**\n * The document formatting provider interface defines the contract between extensions and\n * the formatting-feature.\n */\nexport interface DocumentFormattingEditProvider {\n\t/**\n\t * Provide formatting edits for a whole document.\n\t */\n\tprovideDocumentFormattingEdits(model: editorCommon.IReadOnlyModel, options: FormattingOptions, token: CancellationToken): editorCommon.ISingleEditOperation[] | Thenable<editorCommon.ISingleEditOperation[]>;\n}\n/**\n * The document formatting provider interface defines the contract between extensions and\n * the formatting-feature.\n */\nexport interface DocumentRangeFormattingEditProvider {\n\t/**\n\t * Provide formatting edits for a range in a document.\n\t *\n\t * The given range is a hint and providers can decide to format a smaller\n\t * or larger range. Often this is done by adjusting the start and end\n\t * of the range to full syntax nodes.\n\t */\n\tprovideDocumentRangeFormattingEdits(model: editorCommon.IReadOnlyModel, range: Range, options: FormattingOptions, token: CancellationToken): editorCommon.ISingleEditOperation[] | Thenable<editorCommon.ISingleEditOperation[]>;\n}\n/**\n * The document formatting provider interface defines the contract between extensions and\n * the formatting-feature.\n */\nexport interface OnTypeFormattingEditProvider {\n\tautoFormatTriggerCharacters: string[];\n\t/**\n\t * Provide formatting edits after a character has been typed.\n\t *\n\t * The given position and character should hint to the provider\n\t * what range the position to expand to, like find the matching `{`\n\t * when `}` has been entered.\n\t */\n\tprovideOnTypeFormattingEdits(model: editorCommon.IReadOnlyModel, position: Position, ch: string, options: FormattingOptions, token: CancellationToken): editorCommon.ISingleEditOperation[] | Thenable<editorCommon.ISingleEditOperation[]>;\n}\n\n/**\n * @internal\n */\nexport interface IInplaceReplaceSupportResult {\n\tvalue: string;\n\trange:editorCommon.IRange;\n}\n\n/**\n * Interface used to navigate with a value-set.\n * @internal\n */\nexport interface IInplaceReplaceSupport {\n\tnavigateValueSet(resource:URI, range:editorCommon.IRange, up:boolean):TPromise<IInplaceReplaceSupportResult>;\n}\n\n/**\n * A link inside the editor.\n */\nexport interface ILink {\n\trange: editorCommon.IRange;\n\turl: string;\n}\n/**\n * A provider of links.\n */\nexport interface LinkProvider {\n\tprovideLinks(model: editorCommon.IReadOnlyModel, token: CancellationToken): ILink[] | Thenable<ILink[]>;\n}\n\n\n/**\n * Interface used to define a configurable editor mode.\n * @internal\n */\nexport interface IConfigurationSupport {\n\tconfigure(options:any):TPromise<void>;\n}\n\n\nexport interface IResourceEdit {\n\tresource: URI;\n\trange: editorCommon.IRange;\n\tnewText: string;\n}\nexport interface WorkspaceEdit {\n\tedits: IResourceEdit[];\n\trejectReason?: string;\n}\nexport interface RenameProvider {\n\tprovideRenameEdits(model:editorCommon.IReadOnlyModel, position:Position, newName: string, token: CancellationToken): WorkspaceEdit | Thenable<WorkspaceEdit>;\n}\n\n\nexport interface Command {\n\tid: string;\n\ttitle: string;\n\targuments?: any[];\n}\nexport interface ICodeLensSymbol {\n\trange: editorCommon.IRange;\n\tid?: string;\n\tcommand?: Command;\n}\nexport interface CodeLensProvider {\n\tprovideCodeLenses(model:editorCommon.IReadOnlyModel, token: CancellationToken): ICodeLensSymbol[] | Thenable<ICodeLensSymbol[]>;\n\tresolveCodeLens?(model:editorCommon.IReadOnlyModel, codeLens: ICodeLensSymbol, token: CancellationToken): ICodeLensSymbol | Thenable<ICodeLensSymbol>;\n}\n\n/**\n * A tuple of two characters, like a pair of\n * opening and closing brackets.\n */\nexport type CharacterPair = [string, string];\n\nexport interface IAutoClosingPairConditional extends IAutoClosingPair {\n\tnotIn?: string[];\n}\n\n/**\n * Interface used to support electric characters\n * @internal\n */\nexport interface IElectricAction {\n\t// Only one of the following properties should be defined:\n\n\t// The line will be indented at the same level of the line\n\t// which contains the matching given bracket type.\n\tmatchOpenBracket?:string;\n\n\t// The text will be appended after the electric character.\n\tappendText?:string;\n\n\t// The number of characters to advance the cursor, useful with appendText\n\tadvanceCount?:number;\n}\n\n/**\n * Describes what to do with the indentation when pressing Enter.\n */\nexport enum IndentAction {\n\t/**\n\t * Insert new line and copy the previous line's indentation.\n\t */\n\tNone,\n\t/**\n\t * Insert new line and indent once (relative to the previous line's indentation).\n\t */\n\tIndent,\n\t/**\n\t * Insert two new lines:\n\t *  - the first one indented which will hold the cursor\n\t *  - the second one at the same indentation level\n\t */\n\tIndentOutdent,\n\t/**\n\t * Insert new line and outdent once (relative to the previous line's indentation).\n\t */\n\tOutdent\n}\n\n/**\n * Describes what to do when pressing Enter.\n */\nexport interface EnterAction {\n\t/**\n\t * Describe what to do with the indentation.\n\t */\n\tindentAction:IndentAction;\n\t/**\n\t * Describes text to be appended after the new line and after the indentation.\n\t */\n\tappendText?:string;\n\t/**\n\t * Describes the number of characters to remove from the new line's indentation.\n\t */\n\tremoveText?:number;\n}\n\n/**\n * @internal\n */\nexport interface IRichEditElectricCharacter {\n\tgetElectricCharacters():string[];\n\t// Should return opening bracket type to match indentation with\n\tonElectricCharacter(context:ILineContext, offset:number):IElectricAction;\n}\n\n/**\n * @internal\n */\nexport interface IRichEditOnEnter {\n\tonEnter(model:editorCommon.ITokenizedModel, position: editorCommon.IPosition): EnterAction;\n}\n\n/**\n * Interface used to support insertion of mode specific comments.\n * @internal\n */\nexport interface ICommentsConfiguration {\n\tlineCommentToken?:string;\n\tblockCommentStartToken?:string;\n\tblockCommentEndToken?:string;\n}\n\nexport interface IAutoClosingPair {\n\topen:string;\n\tclose:string;\n}\n\n/**\n * @internal\n */\nexport interface IRichEditCharacterPair {\n\tgetAutoClosingPairs():IAutoClosingPairConditional[];\n\tshouldAutoClosePair(character:string, context:ILineContext, offset:number):boolean;\n\tgetSurroundingPairs():IAutoClosingPair[];\n}\n\n/**\n * @internal\n */\nexport interface IRichEditBrackets {\n\tmaxBracketLength: number;\n\tforwardRegex: RegExp;\n\treversedRegex: RegExp;\n\tbrackets: editorCommon.IRichEditBracket[];\n\ttextIsBracket: {[text:string]:editorCommon.IRichEditBracket;};\n\ttextIsOpenBracket: {[text:string]:boolean;};\n}\n\n// --- feature registries ------\n\n/**\n * @internal\n */\nexport const ReferenceProviderRegistry = new LanguageFeatureRegistry<ReferenceProvider>();\n\n/**\n * @internal\n */\nexport const RenameProviderRegistry = new LanguageFeatureRegistry<RenameProvider>();\n\n/**\n * @internal\n */\nexport const SuggestRegistry = new LanguageFeatureRegistry<ISuggestSupport>();\n\n/**\n * @internal\n */\nexport const SignatureHelpProviderRegistry = new LanguageFeatureRegistry<SignatureHelpProvider>();\n\n/**\n * @internal\n */\nexport const HoverProviderRegistry = new LanguageFeatureRegistry<HoverProvider>();\n\n/**\n * @internal\n */\nexport const DocumentSymbolProviderRegistry = new LanguageFeatureRegistry<DocumentSymbolProvider>();\n\n/**\n * @internal\n */\nexport const DocumentHighlightProviderRegistry = new LanguageFeatureRegistry<DocumentHighlightProvider>();\n\n/**\n * @internal\n */\nexport const DefinitionProviderRegistry = new LanguageFeatureRegistry<DefinitionProvider>();\n\n/**\n * @internal\n */\nexport const CodeLensProviderRegistry = new LanguageFeatureRegistry<CodeLensProvider>();\n\n/**\n * @internal\n */\nexport const CodeActionProviderRegistry = new LanguageFeatureRegistry<CodeActionProvider>();\n\n/**\n * @internal\n */\nexport const DocumentFormattingEditProviderRegistry = new LanguageFeatureRegistry<DocumentFormattingEditProvider>();\n\n/**\n * @internal\n */\nexport const DocumentRangeFormattingEditProviderRegistry = new LanguageFeatureRegistry<DocumentRangeFormattingEditProvider>();\n\n/**\n * @internal\n */\nexport const OnTypeFormattingEditProviderRegistry = new LanguageFeatureRegistry<OnTypeFormattingEditProvider>();\n\n/**\n * @internal\n */\nexport const LinkProviderRegistry = new LanguageFeatureRegistry<LinkProvider>();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport * as strings from 'vs/base/common/strings';\nimport {IPosition, ITextModel, ITokenizedModel} from 'vs/editor/common/editorCommon';\nimport {EnterAction, ILineContext, IRichEditOnEnter, IndentAction, CharacterPair} from 'vs/editor/common/modes';\nimport {handleEvent} from 'vs/editor/common/modes/supports';\nimport {LanguageConfigurationRegistryImpl} from 'vs/editor/common/modes/languageConfigurationRegistry';\n\n/**\n * Describes indentation rules for a language.\n */\nexport interface IndentationRule {\n\t/**\n\t * If a line matches this pattern, then all the lines after it should be unindendented once (until another rule matches).\n\t */\n\tdecreaseIndentPattern: RegExp;\n\t/**\n\t * If a line matches this pattern, then all the lines after it should be indented once (until another rule matches).\n\t */\n\tincreaseIndentPattern: RegExp;\n\t/**\n\t * If a line matches this pattern, then **only the next line** after it should be indented once.\n\t */\n\tindentNextLinePattern?: RegExp;\n\t/**\n\t * If a line matches this pattern, then its indentation should not be changed and it should not be evaluated against the other rules.\n\t */\n\tunIndentedLinePattern?: RegExp;\n}\n\n/**\n * Describes a rule to be evaluated when pressing Enter.\n */\nexport interface OnEnterRule {\n\t/**\n\t * This rule will only execute if the text before the cursor matches this regular expression.\n\t */\n\tbeforeText: RegExp;\n\t/**\n\t * This rule will only execute if the text after the cursor matches this regular expression.\n\t */\n\tafterText?: RegExp;\n\t/**\n\t * The action to execute.\n\t */\n\taction: EnterAction;\n}\n\nexport interface IOnEnterSupportOptions {\n\tbrackets?: CharacterPair[];\n\tindentationRules?: IndentationRule;\n\tregExpRules?: OnEnterRule[];\n}\n\ninterface IProcessedBracketPair {\n\topen: string;\n\tclose: string;\n\topenRegExp: RegExp;\n\tcloseRegExp: RegExp;\n}\n\nexport class OnEnterSupport implements IRichEditOnEnter {\n\n\tprivate static _INDENT: EnterAction = { indentAction: IndentAction.Indent };\n\tprivate static _INDENT_OUTDENT: EnterAction = { indentAction: IndentAction.IndentOutdent };\n\tprivate static _OUTDENT: EnterAction = { indentAction: IndentAction.Outdent };\n\n\tprivate _registry: LanguageConfigurationRegistryImpl;\n\tprivate _modeId: string;\n\tprivate _brackets: IProcessedBracketPair[];\n\tprivate _indentationRules: IndentationRule;\n\tprivate _regExpRules: OnEnterRule[];\n\n\tconstructor(registry: LanguageConfigurationRegistryImpl, modeId: string, opts?:IOnEnterSupportOptions) {\n\t\tthis._registry = registry;\n\t\topts = opts || {};\n\t\topts.brackets = opts.brackets || [\n\t\t\t['(', ')'],\n\t\t\t['{', '}'],\n\t\t\t['[', ']']\n\t\t];\n\n\t\tthis._modeId = modeId;\n\t\tthis._brackets = opts.brackets.map((bracket) => {\n\t\t\treturn {\n\t\t\t\topen: bracket[0],\n\t\t\t\topenRegExp: OnEnterSupport._createOpenBracketRegExp(bracket[0]),\n\t\t\t\tclose: bracket[1],\n\t\t\t\tcloseRegExp: OnEnterSupport._createCloseBracketRegExp(bracket[1]),\n\t\t\t};\n\t\t});\n\t\tthis._regExpRules = opts.regExpRules || [];\n\t\tthis._indentationRules = opts.indentationRules;\n\t}\n\n\tpublic onEnter(model:ITokenizedModel, position: IPosition): EnterAction {\n\t\tvar context = model.getLineContext(position.lineNumber);\n\n\t\treturn handleEvent(context, position.column - 1, (nestedModeId:string, context:ILineContext, offset:number) => {\n\t\t\tif (this._modeId === nestedModeId) {\n\t\t\t\treturn this._onEnter(model, position);\n\t\t\t}\n\n\t\t\tlet onEnterSupport = this._registry.getOnEnterSupport(nestedModeId);\n\t\t\tif (onEnterSupport) {\n\t\t\t\treturn onEnterSupport.onEnter(model, position);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tprivate _onEnter(model:ITextModel, position: IPosition): EnterAction {\n\t\tlet lineText = model.getLineContent(position.lineNumber);\n\t\tlet beforeEnterText = lineText.substr(0, position.column - 1);\n\t\tlet afterEnterText = lineText.substr(position.column - 1);\n\n\t\tlet oneLineAboveText = position.lineNumber === 1 ? '' : model.getLineContent(position.lineNumber - 1);\n\n\t\treturn this._actualOnEnter(oneLineAboveText, beforeEnterText, afterEnterText);\n\t}\n\n\t_actualOnEnter(oneLineAboveText:string, beforeEnterText:string, afterEnterText:string): EnterAction {\n\t\t// (1): `regExpRules`\n\t\tfor (let i = 0, len = this._regExpRules.length; i < len; i++) {\n\t\t\tlet rule = this._regExpRules[i];\n\t\t\tif (rule.beforeText.test(beforeEnterText)) {\n\t\t\t\tif (rule.afterText) {\n\t\t\t\t\tif (rule.afterText.test(afterEnterText)) {\n\t\t\t\t\t\treturn rule.action;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn rule.action;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (2): Special indent-outdent\n\t\tif (beforeEnterText.length > 0 && afterEnterText.length > 0) {\n\t\t\tfor (let i = 0, len = this._brackets.length; i < len; i++) {\n\t\t\t\tlet bracket = this._brackets[i];\n\t\t\t\tif (bracket.openRegExp.test(beforeEnterText) && bracket.closeRegExp.test(afterEnterText)) {\n\t\t\t\t\treturn OnEnterSupport._INDENT_OUTDENT;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (3): Indentation Support\n\t\tif (this._indentationRules) {\n\t\t\tif (this._indentationRules.increaseIndentPattern && this._indentationRules.increaseIndentPattern.test(beforeEnterText)) {\n\t\t\t\treturn OnEnterSupport._INDENT;\n\t\t\t}\n\t\t\tif (this._indentationRules.indentNextLinePattern && this._indentationRules.indentNextLinePattern.test(beforeEnterText)) {\n\t\t\t\treturn OnEnterSupport._INDENT;\n\t\t\t}\n\t\t\tif (/^\\s/.test(beforeEnterText)) {\n\t\t\t\t// No reason to run regular expressions if there is nothing to outdent from\n\t\t\t\tif (this._indentationRules.decreaseIndentPattern && this._indentationRules.decreaseIndentPattern.test(afterEnterText)) {\n\t\t\t\t\treturn OnEnterSupport._OUTDENT;\n\t\t\t\t}\n\t\t\t\tif (this._indentationRules.indentNextLinePattern && this._indentationRules.indentNextLinePattern.test(oneLineAboveText)) {\n\t\t\t\t\treturn OnEnterSupport._OUTDENT;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (4): Open bracket based logic\n\t\tif (beforeEnterText.length > 0) {\n\t\t\tfor (let i = 0, len = this._brackets.length; i < len; i++) {\n\t\t\t\tlet bracket = this._brackets[i];\n\t\t\t\tif (bracket.openRegExp.test(beforeEnterText)) {\n\t\t\t\t\treturn OnEnterSupport._INDENT;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static _createOpenBracketRegExp(bracket:string): RegExp {\n\t\tvar str = strings.escapeRegExpCharacters(bracket);\n\t\tif (!/\\B/.test(str.charAt(0))) {\n\t\t\tstr = '\\\\b' + str;\n\t\t}\n\t\tstr += '\\\\s*$';\n\t\treturn OnEnterSupport._safeRegExp(str);\n\t}\n\n\tprivate static _createCloseBracketRegExp(bracket:string): RegExp {\n\t\tvar str = strings.escapeRegExpCharacters(bracket);\n\t\tif (!/\\B/.test(str.charAt(str.length - 1))) {\n\t\t\tstr = str + '\\\\b';\n\t\t}\n\t\tstr = '^\\\\s*' + str;\n\t\treturn OnEnterSupport._safeRegExp(str);\n\t}\n\n\tprivate static _safeRegExp(def:string): RegExp {\n\t\ttry {\n\t\t\treturn new RegExp(def);\n\t\t} catch(err) {\n\t\t\tonUnexpectedError(err);\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {ICommentsConfiguration, IRichEditBrackets, IRichEditCharacterPair, IAutoClosingPair,\n\tIAutoClosingPairConditional, IRichEditOnEnter, CharacterPair,\n\tIRichEditElectricCharacter, EnterAction, IndentAction} from 'vs/editor/common/modes';\nimport {CharacterPairSupport} from 'vs/editor/common/modes/supports/characterPair';\nimport {BracketElectricCharacterSupport, IBracketElectricCharacterContribution} from 'vs/editor/common/modes/supports/electricCharacter';\nimport {IndentationRule, OnEnterRule, IOnEnterSupportOptions, OnEnterSupport} from 'vs/editor/common/modes/supports/onEnter';\nimport {RichEditBrackets} from 'vs/editor/common/modes/supports/richEditBrackets';\nimport Event, {Emitter} from 'vs/base/common/event';\nimport {ITokenizedModel} from 'vs/editor/common/editorCommon';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport {Position} from 'vs/editor/common/core/position';\nimport * as strings from 'vs/base/common/strings';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {DEFAULT_WORD_REGEXP} from 'vs/editor/common/model/wordHelper';\n\n/**\n * Describes how comments for a language work.\n */\nexport interface CommentRule {\n\t/**\n\t * The line comment token, like `// this is a comment`\n\t */\n\tlineComment?: string;\n\t/**\n\t * The block comment character pair, like `/* block comment *&#47;`\n\t */\n\tblockComment?: CharacterPair;\n}\n\n/**\n * The language configuration interfaces defines the contract between extensions\n * and various editor features, like automatic bracket insertion, automatic indentation etc.\n */\nexport interface LanguageConfiguration {\n\t/**\n\t * The language's comment settings.\n\t */\n\tcomments?: CommentRule;\n\t/**\n\t * The language's brackets.\n\t * This configuration implicitly affects pressing Enter around these brackets.\n\t */\n\tbrackets?: CharacterPair[];\n\t/**\n\t * The language's word definition.\n\t * If the language supports Unicode identifiers (e.g. JavaScript), it is preferable\n\t * to provide a word definition that uses exclusion of known separators.\n\t * e.g.: A regex that matches anything except known separators (and dot is allowed to occur in a floating point number):\n\t *   /(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\#\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>\\/\\?\\s]+)/g\n\t */\n\twordPattern?: RegExp;\n\t/**\n\t * The language's indentation settings.\n\t */\n\tindentationRules?: IndentationRule;\n\t/**\n\t\t * The language's rules to be evaluated when pressing Enter.\n\t\t */\n\tonEnterRules?: OnEnterRule[];\n\t/**\n\t * The language's auto closing pairs. The 'close' character is automatically inserted with the\n\t * 'open' character is typed. If not set, the configured brackets will be used.\n\t */\n\tautoClosingPairs?: IAutoClosingPairConditional[];\n\t/**\n\t * The language's surrounding pairs. When the 'open' character is typed on a selection, the\n\t * selected string is surrounded by the open and close characters. If not set, the autoclosing pairs\n\t * settings will be used.\n\t */\n\tsurroundingPairs?: IAutoClosingPair[];\n\t/**\n\t * **Deprecated** Do not use.\n\t *\n\t * @deprecated Will be replaced by a better API soon.\n\t */\n\t__electricCharacterSupport?: IBracketElectricCharacterContribution;\n}\n\nexport class RichEditSupport {\n\n\tprivate _conf: LanguageConfiguration;\n\n\tpublic electricCharacter: BracketElectricCharacterSupport;\n\tpublic comments: ICommentsConfiguration;\n\tpublic characterPair: IRichEditCharacterPair;\n\tpublic wordDefinition: RegExp;\n\tpublic onEnter: IRichEditOnEnter;\n\tpublic brackets: IRichEditBrackets;\n\n\tconstructor(modeId:string, previous:RichEditSupport, rawConf:LanguageConfiguration) {\n\n\t\tlet prev:LanguageConfiguration = null;\n\t\tif (previous) {\n\t\t\tprev = previous._conf;\n\t\t}\n\n\t\tthis._conf = RichEditSupport._mergeConf(prev, rawConf);\n\n\t\tif (this._conf.brackets) {\n\t\t\tthis.brackets = new RichEditBrackets(modeId, this._conf.brackets);\n\t\t}\n\n\t\tthis._handleOnEnter(modeId, this._conf);\n\n\t\tthis._handleComments(modeId, this._conf);\n\n\t\tif (this._conf.autoClosingPairs) {\n\t\t\tthis.characterPair = new CharacterPairSupport(LanguageConfigurationRegistry, modeId, this._conf);\n\t\t}\n\n\t\tif (this._conf.__electricCharacterSupport || this._conf.brackets) {\n\t\t\tthis.electricCharacter = new BracketElectricCharacterSupport(LanguageConfigurationRegistry, modeId, this.brackets, this._conf.__electricCharacterSupport);\n\t\t}\n\n\t\tthis.wordDefinition = this._conf.wordPattern || DEFAULT_WORD_REGEXP;\n\t}\n\n\tprivate static _mergeConf(prev:LanguageConfiguration, current:LanguageConfiguration): LanguageConfiguration {\n\t\treturn {\n\t\t\tcomments: (prev ? current.comments || prev.comments : current.comments),\n\t\t\tbrackets: (prev ? current.brackets || prev.brackets : current.brackets),\n\t\t\twordPattern: (prev ? current.wordPattern || prev.wordPattern : current.wordPattern),\n\t\t\tindentationRules: (prev ? current.indentationRules || prev.indentationRules : current.indentationRules),\n\t\t\tonEnterRules: (prev ? current.onEnterRules || prev.onEnterRules : current.onEnterRules),\n\t\t\tautoClosingPairs: (prev ? current.autoClosingPairs || prev.autoClosingPairs : current.autoClosingPairs),\n\t\t\tsurroundingPairs: (prev ? current.surroundingPairs || prev.surroundingPairs : current.surroundingPairs),\n\t\t\t__electricCharacterSupport: (prev ? current.__electricCharacterSupport || prev.__electricCharacterSupport : current.__electricCharacterSupport),\n\t\t};\n\t}\n\n\tprivate _handleOnEnter(modeId:string, conf:LanguageConfiguration): void {\n\t\t// on enter\n\t\tlet onEnter: IOnEnterSupportOptions = {};\n\t\tlet empty = true;\n\n\t\tif (conf.brackets) {\n\t\t\tempty = false;\n\t\t\tonEnter.brackets = conf.brackets;\n\t\t}\n\t\tif (conf.indentationRules) {\n\t\t\tempty = false;\n\t\t\tonEnter.indentationRules = conf.indentationRules;\n\t\t}\n\t\tif (conf.onEnterRules) {\n\t\t\tempty = false;\n\t\t\tonEnter.regExpRules = conf.onEnterRules;\n\t\t}\n\n\t\tif (!empty) {\n\t\t\tthis.onEnter = new OnEnterSupport(LanguageConfigurationRegistry, modeId, onEnter);\n\t\t}\n\t}\n\n\tprivate _handleComments(modeId:string, conf:LanguageConfiguration): void {\n\t\tlet commentRule = conf.comments;\n\n\t\t// comment configuration\n\t\tif (commentRule) {\n\t\t\tthis.comments = {};\n\n\t\t\tif (commentRule.lineComment) {\n\t\t\t\tthis.comments.lineCommentToken = commentRule.lineComment;\n\t\t\t}\n\t\t\tif (commentRule.blockComment) {\n\t\t\t\tlet [blockStart, blockEnd] = commentRule.blockComment;\n\t\t\t\tthis.comments.blockCommentStartToken = blockStart;\n\t\t\t\tthis.comments.blockCommentEndToken = blockEnd;\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nexport class LanguageConfigurationRegistryImpl {\n\n\tprivate _entries: {[languageId:string]:RichEditSupport;};\n\n\tprivate _onDidChange: Emitter<void> = new Emitter<void>();\n\tpublic onDidChange: Event<void> = this._onDidChange.event;\n\n\tconstructor() {\n\t\tthis._entries = Object.create(null);\n\t}\n\n\tpublic register(languageId:string, configuration:LanguageConfiguration): IDisposable {\n\t\tlet previous = this._entries[languageId] || null;\n\t\tthis._entries[languageId] = new RichEditSupport(languageId, previous, configuration);\n\t\tthis._onDidChange.fire(void 0);\n\t\treturn {\n\t\t\tdispose: () => {}\n\t\t};\n\t}\n\n\tprivate _getRichEditSupport(modeId:string): RichEditSupport {\n\t\treturn this._entries[modeId];\n\t}\n\n\tpublic getElectricCharacterSupport(modeId:string): IRichEditElectricCharacter {\n\t\tlet value = this._getRichEditSupport(modeId);\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\treturn value.electricCharacter || null;\n\t}\n\n\tpublic getComments(modeId:string): ICommentsConfiguration {\n\t\tlet value = this._getRichEditSupport(modeId);\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\treturn value.comments || null;\n\t}\n\n\tpublic getCharacterPairSupport(modeId:string): IRichEditCharacterPair {\n\t\tlet value = this._getRichEditSupport(modeId);\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\treturn value.characterPair || null;\n\t}\n\n\tpublic getWordDefinition(modeId:string): RegExp {\n\t\tlet value = this._getRichEditSupport(modeId);\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\treturn value.wordDefinition || null;\n\t}\n\n\tpublic getOnEnterSupport(modeId:string): IRichEditOnEnter {\n\t\tlet value = this._getRichEditSupport(modeId);\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\treturn value.onEnter || null;\n\t}\n\n\tpublic getRawEnterActionAtPosition(model:ITokenizedModel, lineNumber:number, column:number): EnterAction {\n\t\tlet result:EnterAction;\n\n\t\tlet onEnterSupport = this.getOnEnterSupport(model.getMode().getId());\n\n\t\tif (onEnterSupport) {\n\t\t\ttry {\n\t\t\t\tresult = onEnterSupport.onEnter(model, new Position(lineNumber, column));\n\t\t\t} catch (e) {\n\t\t\t\tonUnexpectedError(e);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic getEnterActionAtPosition(model:ITokenizedModel, lineNumber:number, column:number): { enterAction: EnterAction; indentation: string; } {\n\t\tlet lineText = model.getLineContent(lineNumber);\n\t\tlet indentation = strings.getLeadingWhitespace(lineText);\n\t\tif (indentation.length > column - 1) {\n\t\t\tindentation = indentation.substring(0, column - 1);\n\t\t}\n\n\t\tlet enterAction = this.getRawEnterActionAtPosition(model, lineNumber, column);\n\t\tif (!enterAction) {\n\t\t\tenterAction = {\n\t\t\t\tindentAction: IndentAction.None,\n\t\t\t\tappendText: '',\n\t\t\t};\n\t\t} else {\n\t\t\tif(!enterAction.appendText) {\n\t\t\t\tif (\n\t\t\t\t\t(enterAction.indentAction === IndentAction.Indent) ||\n\t\t\t\t\t(enterAction.indentAction === IndentAction.IndentOutdent)\n\t\t\t\t) {\n\t\t\t\t\tenterAction.appendText = '\\t';\n\t\t\t\t} else {\n\t\t\t\t\tenterAction.appendText = '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (enterAction.removeText) {\n\t\t\tindentation = indentation.substring(0, indentation.length - 1);\n\t\t}\n\n\t\treturn {\n\t\t\tenterAction: enterAction,\n\t\t\tindentation: indentation\n\t\t};\n\t}\n\n\tpublic getBracketsSupport(modeId:string): IRichEditBrackets {\n\t\tlet value = this._getRichEditSupport(modeId);\n\t\tif (!value) {\n\t\t\treturn null;\n\t\t}\n\t\treturn value.brackets || null;\n\t}\n}\n\nexport const LanguageConfigurationRegistry = new LanguageConfigurationRegistryImpl();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IPosition, IWordAtPosition} from 'vs/editor/common/editorCommon';\nimport {IMode, IModeTransition} from 'vs/editor/common/modes';\nimport {ModeTransition} from 'vs/editor/common/core/modeTransition';\nimport {LanguageConfigurationRegistry} from 'vs/editor/common/modes/languageConfigurationRegistry';\nimport {getWordAtText, ensureValidWordDefinition} from 'vs/editor/common/model/wordHelper';\n\nexport interface ITextSource {\n\n\t_lineIsTokenized(lineNumber:number): boolean;\n\n\tgetLineContent(lineNumber:number): string;\n\n\tgetMode(): IMode;\n\n\t_getLineModeTransitions(lineNumber:number): ModeTransition[];\n}\n\nexport interface INonWordTokenMap {\n\t[key:string]:boolean;\n}\n\nexport class WordHelper {\n\n\tprivate static _safeGetWordDefinition(mode:IMode): RegExp {\n\t\treturn LanguageConfigurationRegistry.getWordDefinition(mode.getId());\n\t}\n\n\tpublic static massageWordDefinitionOf(mode:IMode): RegExp {\n\t\treturn ensureValidWordDefinition(WordHelper._safeGetWordDefinition(mode));\n\t}\n\n\tprivate static _getWordAtColumn(txt:string, column:number, modeIndex: number, modeTransitions:IModeTransition[]): IWordAtPosition {\n\t\tvar modeStartIndex = modeTransitions[modeIndex].startIndex,\n\t\t\tmodeEndIndex = (modeIndex + 1 < modeTransitions.length ? modeTransitions[modeIndex + 1].startIndex : txt.length),\n\t\t\tmode = modeTransitions[modeIndex].mode;\n\n\t\treturn getWordAtText(\n\t\t\tcolumn, WordHelper.massageWordDefinitionOf(mode),\n\t\t\ttxt.substring(modeStartIndex, modeEndIndex), modeStartIndex\n\t\t);\n\t}\n\n\tpublic static getWordAtPosition(textSource:ITextSource, position:IPosition): IWordAtPosition {\n\n\t\tif (!textSource._lineIsTokenized(position.lineNumber)) {\n\t\t\treturn getWordAtText(position.column, WordHelper.massageWordDefinitionOf(textSource.getMode()), textSource.getLineContent(position.lineNumber), 0);\n\t\t}\n\n\t\tvar result: IWordAtPosition = null;\n\t\tvar txt = textSource.getLineContent(position.lineNumber),\n\t\t\tmodeTransitions = textSource._getLineModeTransitions(position.lineNumber),\n\t\t\tcolumnIndex = position.column - 1,\n\t\t\tmodeIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, columnIndex);\n\n\t\tresult = WordHelper._getWordAtColumn(txt, position.column, modeIndex, modeTransitions);\n\n\t\tif (!result && modeIndex > 0 && modeTransitions[modeIndex].startIndex === columnIndex) {\n\t\t\t// The position is right at the beginning of `modeIndex`, so try looking at `modeIndex` - 1 too\n\t\t\tresult = WordHelper._getWordAtColumn(txt, position.column, modeIndex - 1, modeTransitions);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport nls = require('vs/nls');\nimport strings = require('vs/base/common/strings');\n\nenum Severity {\n\tIgnore = 0,\n\tInfo = 1,\n\tWarning = 2,\n\tError = 3\n}\n\nnamespace Severity {\n\n\tvar _error = 'error',\n\t\t_warning = 'warning',\n\t\t_warn = 'warn',\n\t\t_info = 'info';\n\n\tvar _displayStrings: { [value: number]: string; } = Object.create(null);\n\t_displayStrings[Severity.Error] = nls.localize('sev.error', \"Error\");\n\t_displayStrings[Severity.Warning] = nls.localize('sev.warning', \"Warning\");\n\t_displayStrings[Severity.Info] = nls.localize('sev.info', \"Info\");\n\n\t/**\n\t * Parses 'error', 'warning', 'warn', 'info' in call casings\n\t * and falls back to ignore.\n\t */\n\texport function fromValue(value: string): Severity {\n\t\tif (!value) {\n\t\t\treturn Severity.Ignore;\n\t\t}\n\n\t\tif (strings.equalsIgnoreCase(_error, value)) {\n\t\t\treturn Severity.Error;\n\t\t}\n\n\t\tif (strings.equalsIgnoreCase(_warning, value) || strings.equalsIgnoreCase(_warn, value)) {\n\t\t\treturn Severity.Warning;\n\t\t}\n\n\t\tif (strings.equalsIgnoreCase(_info, value)) {\n\t\t\treturn Severity.Info;\n\t\t}\n\n\t\treturn Severity.Ignore;\n\t}\n\n\texport function toString(value: Severity): string {\n\t\treturn _displayStrings[value] || strings.empty;\n\t}\n\n\texport function compare(a: Severity, b: Severity): number {\n\t\treturn b - a;\n\t}\n}\n\nexport default Severity;","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {IEditorOptions} from 'vs/editor/common/editorCommon';\nimport * as platform from 'vs/base/common/platform';\nimport {USUAL_WORD_SEPARATORS} from 'vs/editor/common/model/wordHelper';\n\nexport interface IConfiguration {\n\teditor:IEditorOptions;\n}\n\nexport const DEFAULT_INDENTATION = {\n\ttabSize: 4,\n\tinsertSpaces: true,\n\tdetectIndentation: true\n};\nexport const DEFAULT_TRIM_AUTO_WHITESPACE = true;\n\nconst DEFAULT_WINDOWS_FONT_FAMILY = 'Consolas, \\'Courier New\\', monospace';\nconst DEFAULT_MAC_FONT_FAMILY = 'Menlo, Monaco, \\'Courier New\\', monospace';\nconst DEFAULT_LINUX_FONT_FAMILY = '\\'Droid Sans Mono\\', \\'Courier New\\', monospace, \\'Droid Sans Fallback\\'';\n\n/**\n * Determined from empirical observations.\n */\nexport const GOLDEN_LINE_HEIGHT_RATIO = platform.isMacintosh ? 1.5 : 1.35;\n\nclass ConfigClass implements IConfiguration {\n\n\tpublic editor: IEditorOptions;\n\n\tconstructor() {\n\t\tthis.editor = {\n\t\t\texperimentalScreenReader: true,\n\t\t\trulers: [],\n\t\t\twordSeparators: USUAL_WORD_SEPARATORS,\n\t\t\tselectionClipboard: true,\n\t\t\tariaLabel: nls.localize('editorViewAccessibleLabel', \"Editor content\"),\n\t\t\tlineNumbers: true,\n\t\t\tselectOnLineNumbers: true,\n\t\t\tlineNumbersMinChars: 5,\n\t\t\tglyphMargin: false,\n\t\t\tlineDecorationsWidth: 10,\n\t\t\trevealHorizontalRightPadding: 30,\n\t\t\troundedSelection: true,\n\t\t\ttheme: 'vs',\n\t\t\treadOnly: false,\n\t\t\tscrollbar: {\n\t\t\t\tverticalScrollbarSize: 14,\n\t\t\t\thorizontal: 'auto',\n\t\t\t\tuseShadows: true,\n\t\t\t\tverticalHasArrows: false,\n\t\t\t\thorizontalHasArrows: false\n\t\t\t},\n\t\t\toverviewRulerLanes: 2,\n\t\t\tcursorBlinking: 'blink',\n\t\t\tcursorStyle: 'line',\n\t\t\tfontLigatures: false,\n\t\t\tdisableTranslate3d: false,\n\t\t\thideCursorInOverviewRuler: false,\n\t\t\tscrollBeyondLastLine: true,\n\t\t\tautomaticLayout: false,\n\t\t\twrappingColumn: 300,\n\t\t\twrappingIndent: 'same',\n\t\t\twordWrapBreakBeforeCharacters: '([{+',\n\t\t\twordWrapBreakAfterCharacters: ' \\t})]?|&,;',\n\t\t\twordWrapBreakObtrusiveCharacters: '.',\n\t\t\ttabFocusMode: false,\n\n\t\t\t// Features\n\t\t\thover: true,\n\t\t\tcontextmenu: true,\n\t\t\tmouseWheelScrollSensitivity: 1,\n\t\t\tquickSuggestions: true,\n\t\t\tquickSuggestionsDelay: 10,\n\t\t\tparameterHints: true,\n\t\t\ticonsInSuggestions: true,\n\t\t\tautoClosingBrackets: true,\n\t\t\tformatOnType: false,\n\t\t\tsuggestOnTriggerCharacters: true,\n\t\t\tacceptSuggestionOnEnter: true,\n\t\t\tselectionHighlight: true,\n\t\t\toutlineMarkers: false,\n\t\t\treferenceInfos: true,\n\t\t\tfolding: true,\n\t\t\trenderWhitespace: false,\n\t\t\tindentGuides: false,\n\t\t\tuseTabStops: true,\n\n\t\t\tfontFamily: (\n\t\t\t\tplatform.isMacintosh ? DEFAULT_MAC_FONT_FAMILY : (platform.isLinux ? DEFAULT_LINUX_FONT_FAMILY : DEFAULT_WINDOWS_FONT_FAMILY)\n\t\t\t),\n\t\t\tfontSize: (\n\t\t\t\tplatform.isMacintosh ? 12 : 14\n\t\t\t),\n\t\t\tlineHeight: 0\n\t\t};\n\t}\n}\n\nexport var DefaultConfig: IConfiguration = new ConfigClass();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {OrderGuaranteeEventEmitter} from 'vs/base/common/eventEmitter';\nimport * as strings from 'vs/base/common/strings';\nimport {Position} from 'vs/editor/common/core/position';\nimport {Range} from 'vs/editor/common/core/range';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport {ModelLine} from 'vs/editor/common/model/modelLine';\nimport {guessIndentation} from 'vs/editor/common/model/indentationGuesser';\nimport {DEFAULT_INDENTATION, DEFAULT_TRIM_AUTO_WHITESPACE} from 'vs/editor/common/config/defaultConfig';\nimport {PrefixSumComputer} from 'vs/editor/common/viewModel/prefixSumComputer';\n\nvar LIMIT_FIND_COUNT = 999;\nexport const LONG_LINE_BOUNDARY = 1000;\n\nexport class TextModel extends OrderGuaranteeEventEmitter implements editorCommon.ITextModel {\n\tprivate static MODEL_SYNC_LIMIT = 5 * 1024 * 1024; // 5 MB\n\tprivate static MODEL_TOKENIZATION_LIMIT = 20 * 1024 * 1024; // 20 MB\n\n\tpublic static DEFAULT_CREATION_OPTIONS: editorCommon.ITextModelCreationOptions = {\n\t\ttabSize: DEFAULT_INDENTATION.tabSize,\n\t\tinsertSpaces: DEFAULT_INDENTATION.insertSpaces,\n\t\tdetectIndentation: false,\n\t\tdefaultEOL: editorCommon.DefaultEndOfLine.LF,\n\t\ttrimAutoWhitespace: DEFAULT_TRIM_AUTO_WHITESPACE,\n\t};\n\n\t/*protected*/ _lines:ModelLine[];\n\tprotected _EOL:string;\n\tprotected _isDisposed:boolean;\n\tprotected _isDisposing:boolean;\n\tprotected _options: editorCommon.ITextModelResolvedOptions;\n\tprotected _lineStarts: PrefixSumComputer;\n\n\tprivate _versionId:number;\n\t/**\n\t * Unlike, versionId, this can go down (via undo) or go to previous values (via redo)\n\t */\n\tprivate _alternativeVersionId: number;\n\tprivate _BOM:string;\n\n\tprivate _shouldSimplifyMode: boolean;\n\tprivate _shouldDenyMode: boolean;\n\n\tconstructor(allowedEventTypes:string[], rawText:editorCommon.IRawText) {\n\t\tallowedEventTypes.push(editorCommon.EventType.ModelRawContentChanged, editorCommon.EventType.ModelOptionsChanged);\n\t\tsuper(allowedEventTypes);\n\n\t\tthis._shouldSimplifyMode = (rawText.length > TextModel.MODEL_SYNC_LIMIT);\n\t\tthis._shouldDenyMode = (rawText.length > TextModel.MODEL_TOKENIZATION_LIMIT);\n\n\t\tthis._options = rawText.options;\n\t\tthis._constructLines(rawText);\n\t\tthis._setVersionId(1);\n\t\tthis._isDisposed = false;\n\t\tthis._isDisposing = false;\n\t}\n\n\tpublic isTooLargeForHavingAMode(): boolean {\n\t\treturn this._shouldDenyMode;\n\t}\n\n\tpublic isTooLargeForHavingARichMode(): boolean {\n\t\treturn this._shouldSimplifyMode;\n\t}\n\n\tpublic getOptions(): editorCommon.ITextModelResolvedOptions {\n\t\treturn this._options;\n\t}\n\n\tpublic updateOptions(newOpts:editorCommon.ITextModelUpdateOptions): void {\n\t\tlet somethingChanged = false;\n\t\tlet changed:editorCommon.IModelOptionsChangedEvent = {\n\t\t\ttabSize: false,\n\t\t\tinsertSpaces: false,\n\t\t\ttrimAutoWhitespace: false\n\t\t};\n\n\t\tif (typeof newOpts.insertSpaces !== 'undefined') {\n\t\t\tif (this._options.insertSpaces !== newOpts.insertSpaces) {\n\t\t\t\tsomethingChanged = true;\n\t\t\t\tchanged.insertSpaces = true;\n\t\t\t\tthis._options.insertSpaces = newOpts.insertSpaces;\n\t\t\t}\n\t\t}\n\t\tif (typeof newOpts.tabSize !== 'undefined') {\n\t\t\tif (this._options.tabSize !== newOpts.tabSize) {\n\t\t\t\tsomethingChanged = true;\n\t\t\t\tchanged.tabSize = true;\n\t\t\t\tthis._options.tabSize = newOpts.tabSize;\n\t\t\t}\n\t\t}\n\t\tif (typeof newOpts.trimAutoWhitespace !== 'undefined') {\n\t\t\tif (this._options.trimAutoWhitespace !== newOpts.trimAutoWhitespace) {\n\t\t\t\tsomethingChanged = true;\n\t\t\t\tchanged.trimAutoWhitespace = true;\n\t\t\t\tthis._options.trimAutoWhitespace = newOpts.trimAutoWhitespace;\n\t\t\t}\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis.emit(editorCommon.EventType.ModelOptionsChanged, changed);\n\t\t}\n\t}\n\n\tpublic detectIndentation(defaultInsertSpaces:boolean, defaultTabSize:number): void {\n\t\tlet lines = this._lines.map(line => line.text);\n\t\tlet guessedIndentation = guessIndentation(lines, defaultTabSize, defaultInsertSpaces);\n\t\tthis.updateOptions({\n\t\t\tinsertSpaces: guessedIndentation.insertSpaces,\n\t\t\ttabSize: guessedIndentation.tabSize\n\t\t});\n\t}\n\n\tprivate _normalizeIndentationFromWhitespace(str:string): string {\n\t\tlet tabSize = this._options.tabSize;\n\t\tlet insertSpaces = this._options.insertSpaces;\n\n\t\tlet spacesCnt = 0;\n\t\tfor (let i = 0; i < str.length; i++) {\n\t\t\tif (str.charAt(i) === '\\t') {\n\t\t\t\tspacesCnt += tabSize;\n\t\t\t} else {\n\t\t\t\tspacesCnt++;\n\t\t\t}\n\t\t}\n\n\t\tlet result = '';\n\t\tif (!insertSpaces) {\n\t\t\tlet tabsCnt = Math.floor(spacesCnt / tabSize);\n\t\t\tspacesCnt = spacesCnt % tabSize;\n\t\t\tfor (let i = 0; i < tabsCnt; i++) {\n\t\t\t\tresult += '\\t';\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < spacesCnt; i++) {\n\t\t\tresult += ' ';\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic normalizeIndentation(str:string): string {\n\t\tlet firstNonWhitespaceIndex = strings.firstNonWhitespaceIndex(str);\n\t\tif (firstNonWhitespaceIndex === -1) {\n\t\t\tfirstNonWhitespaceIndex = str.length;\n\t\t}\n\t\treturn this._normalizeIndentationFromWhitespace(str.substring(0, firstNonWhitespaceIndex)) + str.substring(firstNonWhitespaceIndex);\n\t}\n\n\tpublic getOneIndent(): string {\n\t\tlet tabSize = this._options.tabSize;\n\t\tlet insertSpaces = this._options.insertSpaces;\n\n\t\tif (insertSpaces) {\n\t\t\tlet result = '';\n\t\t\tfor (let i = 0; i < tabSize; i++) {\n\t\t\t\tresult += ' ';\n\t\t\t}\n\t\t\treturn result;\n\t\t} else {\n\t\t\treturn '\\t';\n\t\t}\n\t}\n\n\tpublic getVersionId(): number {\n\t\treturn this._versionId;\n\t}\n\n\tpublic getAlternativeVersionId(): number {\n\t\treturn this._alternativeVersionId;\n\t}\n\n\tprivate _ensureLineStarts(): void {\n\t\tif (!this._lineStarts) {\n\t\t\tconst lineStartValues:number[] = [];\n\t\t\tconst eolLength = this._EOL.length;\n\t\t\tfor (let i = 0, len = this._lines.length; i < len; i++) {\n\t\t\t\tlineStartValues.push(this._lines[i].text.length + eolLength);\n\t\t\t}\n\t\t\tthis._lineStarts = new PrefixSumComputer(lineStartValues);\n\t\t}\n\t}\n\n\tpublic getOffsetAt(rawPosition: editorCommon.IPosition): number {\n\t\tlet position = this.validatePosition(rawPosition);\n\t\tthis._ensureLineStarts();\n\t\treturn this._lineStarts.getAccumulatedValue(position.lineNumber - 2) + position.column - 1;\n\t}\n\n\tpublic getPositionAt(offset: number): Position {\n\t\toffset = Math.floor(offset);\n\t\toffset = Math.max(0, offset);\n\n\t\tthis._ensureLineStarts();\n\t\tlet out = this._lineStarts.getIndexOf(offset);\n\n\t\tlet lineLength = this._lines[out.index].text.length;\n\n\t\t// Ensure we return a valid position\n\t\treturn new Position(out.index + 1, Math.min(out.remainder + 1, lineLength + 1));\n\t}\n\n\t_increaseVersionId(): void {\n\t\tthis._setVersionId(this._versionId + 1);\n\t}\n\n\t_setVersionId(newVersionId:number): void {\n\t\tthis._versionId = newVersionId;\n\t\tthis._alternativeVersionId = this._versionId;\n\t}\n\n\t_overwriteAlternativeVersionId(newAlternativeVersionId:number): void {\n\t\tthis._alternativeVersionId = newAlternativeVersionId;\n\t}\n\n\tpublic isDisposed(): boolean {\n\t\treturn this._isDisposed;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._isDisposed = true;\n\t\t// Null out members, such that any use of a disposed model will throw exceptions sooner rather than later\n\t\tthis._lines = null;\n\t\tthis._EOL = null;\n\t\tthis._BOM = null;\n\n\t\tsuper.dispose();\n\t}\n\n\t_createContentChangedFlushEvent(): editorCommon.IModelContentChangedFlushEvent {\n\t\treturn {\n\t\t\tchangeType: editorCommon.EventType.ModelRawContentChangedFlush,\n\t\t\tdetail: null,\n\t\t\t// TODO@Alex -> remove these fields from here\n\t\t\tversionId: -1,\n\t\t\tisUndoing: false,\n\t\t\tisRedoing: false\n\t\t};\n\t}\n\n\tprotected _emitContentChanged2(startLineNumber:number, startColumn:number, endLineNumber:number, endColumn:number, rangeLength:number, text:string, isUndoing:boolean, isRedoing:boolean): void {\n\t\tvar e:editorCommon.IModelContentChangedEvent2 = {\n\t\t\trange: new Range(startLineNumber, startColumn, endLineNumber, endColumn),\n\t\t\trangeLength: rangeLength,\n\t\t\ttext: text,\n\t\t\teol: this._EOL,\n\t\t\tversionId: this.getVersionId(),\n\t\t\tisUndoing: isUndoing,\n\t\t\tisRedoing: isRedoing\n\t\t};\n\t\tif (!this._isDisposing) {\n\t\t\tthis.emit(editorCommon.EventType.ModelContentChanged2, e);\n\t\t}\n\t}\n\n\t_resetValue(e:editorCommon.IModelContentChangedFlushEvent, newValue:editorCommon.IRawText): void {\n\t\tthis._constructLines(newValue);\n\n\t\tthis._increaseVersionId();\n\n\t\te.detail = this.toRawText();\n\t\te.versionId = this._versionId;\n\t}\n\n\tpublic toRawText(): editorCommon.IRawText {\n\t\treturn {\n\t\t\tBOM: this._BOM,\n\t\t\tEOL: this._EOL,\n\t\t\tlines: this.getLinesContent(),\n\t\t\tlength: this.getValueLength(),\n\t\t\toptions: this._options\n\t\t};\n\t}\n\n\tpublic equals(other: editorCommon.IRawText): boolean {\n\t\tif (this._BOM !== other.BOM) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this._EOL !== other.EOL) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this._lines.length !== other.lines.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0, len = this._lines.length; i < len; i++) {\n\t\t\tif (this._lines[i].text !== other.lines[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic setValue(value:string): void {\n\t\tif (value === null) {\n\t\t\t// There's nothing to do\n\t\t\treturn;\n\t\t}\n\t\tlet rawText: editorCommon.IRawText = null;\n\t\trawText = TextModel.toRawText(value, {\n\t\t\ttabSize: this._options.tabSize,\n\t\t\tinsertSpaces: this._options.insertSpaces,\n\t\t\ttrimAutoWhitespace: this._options.trimAutoWhitespace,\n\t\t\tdetectIndentation: false,\n\t\t\tdefaultEOL: this._options.defaultEOL\n\t\t});\n\t\tthis.setValueFromRawText(rawText);\n\t}\n\n\tpublic setValueFromRawText(newValue:editorCommon.IRawText): void {\n\t\tif (newValue === null) {\n\t\t\t// There's nothing to do\n\t\t\treturn;\n\t\t}\n\t\tvar oldFullModelRange = this.getFullModelRange();\n\t\tvar oldModelValueLength = this.getValueLengthInRange(oldFullModelRange);\n\t\tvar endLineNumber = this.getLineCount();\n\t\tvar endColumn = this.getLineMaxColumn(endLineNumber);\n\t\tvar e = this._createContentChangedFlushEvent();\n\n\t\tthis._resetValue(e, newValue);\n\t\tthis._emitModelContentChangedFlushEvent(e);\n\t\tthis._emitContentChanged2(1, 1, endLineNumber, endColumn, oldModelValueLength, this.getValue(), false, false);\n\t}\n\n\tpublic getValue(eol?:editorCommon.EndOfLinePreference, preserveBOM:boolean=false): string {\n\t\tvar fullModelRange = this.getFullModelRange();\n\t\tvar fullModelValue = this.getValueInRange(fullModelRange, eol);\n\n\t\tif (preserveBOM) {\n\t\t\treturn this._BOM + fullModelValue;\n\t\t}\n\n\t\treturn fullModelValue;\n\t}\n\n\tpublic getValueLength(eol?: editorCommon.EndOfLinePreference, preserveBOM: boolean = false): number {\n\t\tvar fullModelRange = this.getFullModelRange();\n\t\tvar fullModelValue = this.getValueLengthInRange(fullModelRange, eol);\n\n\t\tif (preserveBOM) {\n\t\t\treturn this._BOM.length + fullModelValue;\n\t\t}\n\n\t\treturn fullModelValue;\n\t}\n\n\tpublic getEmptiedValueInRange(rawRange:editorCommon.IRange, fillCharacter: string = '', eol:editorCommon.EndOfLinePreference=editorCommon.EndOfLinePreference.TextDefined): string {\n\t\tvar range = this.validateRange(rawRange);\n\n\t\tif (range.isEmpty()) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (range.startLineNumber === range.endLineNumber) {\n\t\t\treturn this._repeatCharacter(fillCharacter, range.endColumn - range.startColumn);\n\t\t}\n\n\t\tvar lineEnding = this._getEndOfLine(eol),\n\t\t\tstartLineIndex = range.startLineNumber - 1,\n\t\t\tendLineIndex = range.endLineNumber - 1,\n\t\t\tresultLines:string[] = [];\n\n\t\tresultLines.push(this._repeatCharacter(fillCharacter, this._lines[startLineIndex].text.length - range.startColumn + 1));\n\t\tfor (var i = startLineIndex + 1; i < endLineIndex; i++) {\n\t\t\tresultLines.push(this._repeatCharacter(fillCharacter, this._lines[i].text.length));\n\t\t}\n\t\tresultLines.push(this._repeatCharacter(fillCharacter, range.endColumn - 1));\n\n\t\treturn resultLines.join(lineEnding);\n\t}\n\n\tprivate _repeatCharacter(fillCharacter:string, count:number): string {\n\t\tvar r = '';\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tr += fillCharacter;\n\t\t}\n\t\treturn r;\n\t}\n\n\tpublic getValueInRange(rawRange:editorCommon.IRange, eol:editorCommon.EndOfLinePreference=editorCommon.EndOfLinePreference.TextDefined): string {\n\t\tvar range = this.validateRange(rawRange);\n\n\t\tif (range.isEmpty()) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (range.startLineNumber === range.endLineNumber) {\n\t\t\treturn this._lines[range.startLineNumber - 1].text.substring(range.startColumn - 1, range.endColumn - 1);\n\t\t}\n\n\t\tvar lineEnding = this._getEndOfLine(eol),\n\t\t\tstartLineIndex = range.startLineNumber - 1,\n\t\t\tendLineIndex = range.endLineNumber - 1,\n\t\t\tresultLines:string[] = [];\n\n\t\tresultLines.push(this._lines[startLineIndex].text.substring(range.startColumn - 1));\n\t\tfor (var i = startLineIndex + 1; i < endLineIndex; i++) {\n\t\t\tresultLines.push(this._lines[i].text);\n\t\t}\n\t\tresultLines.push(this._lines[endLineIndex].text.substring(0, range.endColumn - 1));\n\n\t\treturn resultLines.join(lineEnding);\n\t}\n\n\tpublic getValueLengthInRange(rawRange:editorCommon.IRange, eol:editorCommon.EndOfLinePreference=editorCommon.EndOfLinePreference.TextDefined): number {\n\t\tvar range = this.validateRange(rawRange);\n\n\t\tif (range.isEmpty()) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (range.startLineNumber === range.endLineNumber) {\n\t\t\treturn (range.endColumn - range.startColumn);\n\t\t}\n\n\t\tlet startOffset = this.getOffsetAt(new Position(range.startLineNumber, range.startColumn));\n\t\tlet endOffset = this.getOffsetAt(new Position(range.endLineNumber, range.endColumn));\n\t\treturn endOffset - startOffset;\n\t}\n\n\tpublic isDominatedByLongLines(): boolean {\n\t\tvar smallLineCharCount = 0,\n\t\t\tlongLineCharCount = 0,\n\t\t\ti: number,\n\t\t\tlen: number,\n\t\t\tlines = this._lines,\n\t\t\tlineLength: number;\n\n\t\tfor (i = 0, len = this._lines.length; i < len; i++) {\n\t\t\tlineLength = lines[i].text.length;\n\t\t\tif (lineLength >= LONG_LINE_BOUNDARY) {\n\t\t\t\tlongLineCharCount += lineLength;\n\t\t\t} else {\n\t\t\t\tsmallLineCharCount += lineLength;\n\t\t\t}\n\t\t}\n\n\t\treturn (longLineCharCount > smallLineCharCount);\n\t}\n\n\tpublic getLineCount(): number {\n\t\treturn this._lines.length;\n\t}\n\n\tpublic getLineContent(lineNumber:number): string {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\n\t\treturn this._lines[lineNumber - 1].text;\n\t}\n\n\tpublic getLinesContent(): string[] {\n\t\tvar r: string[] = [];\n\t\tfor (var i = 0, len = this._lines.length; i < len; i++) {\n\t\t\tr[i] = this._lines[i].text;\n\t\t}\n\t\treturn r;\n\t}\n\n\tpublic getEOL(): string {\n\t\treturn this._EOL;\n\t}\n\n\tpublic setEOL(eol: editorCommon.EndOfLineSequence): void {\n\t\tvar newEOL = (eol === editorCommon.EndOfLineSequence.CRLF ? '\\r\\n' : '\\n');\n\t\tif (this._EOL === newEOL) {\n\t\t\t// Nothing to do\n\t\t\treturn;\n\t\t}\n\n\t\tvar oldFullModelRange = this.getFullModelRange();\n\t\tvar oldModelValueLength = this.getValueLengthInRange(oldFullModelRange);\n\t\tvar endLineNumber = this.getLineCount();\n\t\tvar endColumn = this.getLineMaxColumn(endLineNumber);\n\n\t\tthis._EOL = newEOL;\n\t\tthis._lineStarts = null;\n\t\tthis._increaseVersionId();\n\n\t\tvar e = this._createContentChangedFlushEvent();\n\t\te.detail = this.toRawText();\n\t\te.versionId = this._versionId;\n\n\t\tthis._emitModelContentChangedFlushEvent(e);\n\t\tthis._emitContentChanged2(1, 1, endLineNumber, endColumn, oldModelValueLength, this.getValue(), false, false);\n\t}\n\n\tpublic getLineMinColumn(lineNumber:number): number {\n\t\treturn 1;\n\t}\n\n\tpublic getLineMaxColumn(lineNumber:number): number {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\n\t\treturn this._lines[lineNumber - 1].text.length + 1;\n\t}\n\n\tpublic getLineFirstNonWhitespaceColumn(lineNumber: number): number {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\n\t\tvar result = strings.firstNonWhitespaceIndex(this._lines[lineNumber - 1].text);\n\t\tif (result === -1) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn result + 1;\n\t}\n\n\tpublic getLineLastNonWhitespaceColumn(lineNumber: number): number {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\n\t\tvar result = strings.lastNonWhitespaceIndex(this._lines[lineNumber - 1].text);\n\t\tif (result === -1) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn result + 2;\n\t}\n\n\tpublic validateLineNumber(lineNumber:number): number {\n\t\tif (lineNumber < 1) {\n\t\t\tlineNumber = 1;\n\t\t}\n\t\tif (lineNumber > this._lines.length) {\n\t\t\tlineNumber = this._lines.length;\n\t\t}\n\t\treturn lineNumber;\n\t}\n\n\tpublic validatePosition(position:editorCommon.IPosition): Position {\n\t\tvar lineNumber = position.lineNumber ? position.lineNumber : 1;\n\t\tvar column = position.column ? position.column : 1;\n\n\t\tif (lineNumber < 1) {\n\t\t\tlineNumber = 1;\n\t\t\tcolumn = 1;\n\t\t}\n\t\telse if (lineNumber > this._lines.length) {\n\t\t\tlineNumber = this._lines.length;\n\t\t\tcolumn = this.getLineMaxColumn(lineNumber);\n\t\t}\n\t\telse {\n\t\t\tvar maxColumn = this.getLineMaxColumn(lineNumber);\n\t\t\tif (column < 1) {\n\t\t\t\tcolumn = 1;\n\t\t\t}\n\t\t\telse if (column > maxColumn) {\n\t\t\t\tcolumn = maxColumn;\n\t\t\t}\n\t\t}\n\n\t\treturn new Position(lineNumber, column);\n\t}\n\n\tpublic validateRange(range:editorCommon.IRange): Range {\n\t\tvar start = this.validatePosition(new Position(range.startLineNumber, range.startColumn));\n\t\tvar end = this.validatePosition(new Position(range.endLineNumber, range.endColumn));\n\t\treturn new Range(start.lineNumber, start.column, end.lineNumber, end.column);\n\t}\n\n\tpublic modifyPosition(rawPosition: editorCommon.IPosition, offset: number) : Position {\n\t\treturn this.getPositionAt(this.getOffsetAt(rawPosition) + offset);\n\t}\n\n\tpublic getFullModelRange(): Range {\n\t\tvar lineCount = this.getLineCount();\n\t\treturn new Range(1, 1, lineCount, this.getLineMaxColumn(lineCount));\n\t}\n\n\t_emitModelContentChangedFlushEvent(e:editorCommon.IModelContentChangedFlushEvent): void {\n\t\tif (!this._isDisposing) {\n\t\t\tthis.emit(editorCommon.EventType.ModelRawContentChanged, e);\n\t\t}\n\t}\n\n\tpublic static toRawText(rawText:string, opts:editorCommon.ITextModelCreationOptions): editorCommon.IRawText {\n\t\t// Count the number of lines that end with \\r\\n\n\t\tvar carriageReturnCnt = 0,\n\t\t\tlastCarriageReturnIndex = -1;\n\t\twhile ((lastCarriageReturnIndex = rawText.indexOf('\\r', lastCarriageReturnIndex + 1)) !== -1) {\n\t\t\tcarriageReturnCnt++;\n\t\t}\n\n\t\t// Split the text into lines\n\t\tvar lines = rawText.split(/\\r\\n|\\r|\\n/);\n\n\t\t// Remove the BOM (if present)\n\t\tvar BOM = '';\n\t\tif (strings.startsWithUTF8BOM(lines[0])) {\n\t\t\tBOM = strings.UTF8_BOM_CHARACTER;\n\t\t\tlines[0] = lines[0].substr(1);\n\t\t}\n\n\t\tvar lineFeedCnt = lines.length - 1;\n\t\tvar EOL = '';\n\t\tif (lineFeedCnt === 0) {\n\t\t\t// This is an empty file or a file with precisely one line\n\t\t\tEOL = (opts.defaultEOL === editorCommon.DefaultEndOfLine.LF ? '\\n' : '\\r\\n');\n\t\t} else if (carriageReturnCnt > lineFeedCnt / 2) {\n\t\t\t// More than half of the file contains \\r\\n ending lines\n\t\t\tEOL = '\\r\\n';\n\t\t} else {\n\t\t\t// At least one line more ends in \\n\n\t\t\tEOL = '\\n';\n\t\t}\n\n\t\tlet resolvedOpts: editorCommon.ITextModelResolvedOptions;\n\t\tif (opts.detectIndentation) {\n\t\t\tlet guessedIndentation = guessIndentation(lines, opts.tabSize, opts.insertSpaces);\n\t\t\tresolvedOpts = {\n\t\t\t\ttabSize: guessedIndentation.tabSize,\n\t\t\t\tinsertSpaces: guessedIndentation.insertSpaces,\n\t\t\t\ttrimAutoWhitespace: opts.trimAutoWhitespace,\n\t\t\t\tdefaultEOL: opts.defaultEOL\n\t\t\t};\n\t\t} else {\n\t\t\tresolvedOpts = {\n\t\t\t\ttabSize: opts.tabSize,\n\t\t\t\tinsertSpaces: opts.insertSpaces,\n\t\t\t\ttrimAutoWhitespace: opts.trimAutoWhitespace,\n\t\t\t\tdefaultEOL: opts.defaultEOL\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tBOM: BOM,\n\t\t\tEOL: EOL,\n\t\t\tlines: lines,\n\t\t\tlength: rawText.length,\n\t\t\toptions: resolvedOpts\n\t\t};\n\t}\n\n\t_constructLines(rawText:editorCommon.IRawText): void {\n\t\tvar rawLines = rawText.lines,\n\t\t\tmodelLines: ModelLine[] = [],\n\t\t\ti: number,\n\t\t\tlen: number;\n\n\t\tfor (i = 0, len = rawLines.length; i < len; i++) {\n\t\t\tmodelLines.push(new ModelLine(i + 1, rawLines[i]));\n\t\t}\n\t\tthis._BOM = rawText.BOM;\n\t\tthis._EOL = rawText.EOL;\n\t\tthis._lines = modelLines;\n\t\tthis._lineStarts = null;\n\t}\n\n\tprivate _getEndOfLine(eol:editorCommon.EndOfLinePreference): string {\n\t\tswitch (eol) {\n\t\t\tcase editorCommon.EndOfLinePreference.LF:\n\t\t\t\treturn '\\n';\n\t\t\tcase editorCommon.EndOfLinePreference.CRLF:\n\t\t\t\treturn '\\r\\n';\n\t\t\tcase editorCommon.EndOfLinePreference.TextDefined:\n\t\t\t\treturn this.getEOL();\n\t\t}\n\t\tthrow new Error('Unknown EOL preference');\n\t}\n\n\tpublic findMatches(searchString:string, rawSearchScope:any, isRegex:boolean, matchCase:boolean, wholeWord:boolean, limitResultCount:number = LIMIT_FIND_COUNT): Range[] {\n\t\tvar regex = strings.createSafeRegExp(searchString, isRegex, matchCase, wholeWord);\n\t\tif (!regex) {\n\t\t\treturn [];\n\t\t}\n\n\t\tvar searchRange:Range;\n\t\tif (Range.isIRange(rawSearchScope)) {\n\t\t\tsearchRange = rawSearchScope;\n\t\t} else {\n\t\t\tsearchRange = this.getFullModelRange();\n\t\t}\n\n\t\treturn this._doFindMatches(searchRange, regex, limitResultCount);\n\t}\n\n\tpublic findNextMatch(searchString:string, rawSearchStart:editorCommon.IPosition, isRegex:boolean, matchCase:boolean, wholeWord:boolean): Range {\n\t\tvar regex = strings.createSafeRegExp(searchString, isRegex, matchCase, wholeWord);\n\t\tif (!regex) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar searchStart = this.validatePosition(rawSearchStart),\n\t\t\tlineCount = this.getLineCount(),\n\t\t\tstartLineNumber = searchStart.lineNumber,\n\t\t\ttext: string,\n\t\t\tr: Range;\n\n\t\t// Look in first line\n\t\ttext = this._lines[startLineNumber - 1].text.substring(searchStart.column - 1);\n\t\tr = this._findMatchInLine(regex, text, startLineNumber, searchStart.column - 1);\n\t\tif (r) {\n\t\t\treturn r;\n\t\t}\n\n\t\tfor (var i = 1; i <= lineCount; i++) {\n\t\t\tvar lineIndex = (startLineNumber + i - 1) % lineCount;\n\t\t\ttext = this._lines[lineIndex].text;\n\t\t\tr = this._findMatchInLine(regex, text, lineIndex + 1, 0);\n\t\t\tif (r) {\n\t\t\t\treturn r;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic findPreviousMatch(searchString:string, rawSearchStart:editorCommon.IPosition, isRegex:boolean, matchCase:boolean, wholeWord:boolean): Range {\n\t\tvar regex = strings.createSafeRegExp(searchString, isRegex, matchCase, wholeWord);\n\t\tif (!regex) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar searchStart = this.validatePosition(rawSearchStart),\n\t\t\tlineCount = this.getLineCount(),\n\t\t\tstartLineNumber = searchStart.lineNumber,\n\t\t\ttext: string,\n\t\t\tr: Range;\n\n\t\t// Look in first line\n\t\ttext = this._lines[startLineNumber - 1].text.substring(0, searchStart.column - 1);\n\t\tr = this._findLastMatchInLine(regex, text, startLineNumber);\n\t\tif (r) {\n\t\t\treturn r;\n\t\t}\n\n\t\tfor (var i = 1; i <= lineCount; i++) {\n\t\t\tvar lineIndex = (lineCount + startLineNumber - i - 1) % lineCount;\n\t\t\ttext = this._lines[lineIndex].text;\n\t\t\tr = this._findLastMatchInLine(regex, text, lineIndex + 1);\n\t\t\tif (r) {\n\t\t\t\treturn r;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _doFindMatches(searchRange:Range, searchRegex:RegExp, limitResultCount:number): Range[] {\n\t\tvar result:Range[] = [],\n\t\t\ttext: string,\n\t\t\tcounter = 0;\n\n\t\t// Early case for a search range that starts & stops on the same line number\n\t\tif (searchRange.startLineNumber === searchRange.endLineNumber) {\n\t\t\ttext = this._lines[searchRange.startLineNumber - 1].text.substring(searchRange.startColumn - 1, searchRange.endColumn - 1);\n\t\t\tcounter = this._findMatchesInLine(searchRegex, text, searchRange.startLineNumber, searchRange.startColumn - 1, counter, result, limitResultCount);\n\t\t\treturn result;\n\t\t}\n\n\t\t// Collect results from first line\n\t\ttext = this._lines[searchRange.startLineNumber - 1].text.substring(searchRange.startColumn - 1);\n\t\tcounter = this._findMatchesInLine(searchRegex, text, searchRange.startLineNumber, searchRange.startColumn - 1, counter, result, limitResultCount);\n\n\t\t// Collect results from middle lines\n\t\tfor (var lineNumber = searchRange.startLineNumber + 1; lineNumber < searchRange.endLineNumber && counter < limitResultCount; lineNumber++) {\n\t\t\tcounter = this._findMatchesInLine(searchRegex, this._lines[lineNumber - 1].text, lineNumber, 0, counter, result, limitResultCount);\n\t\t}\n\n\t\t// Collect results from last line\n\t\tif (counter < limitResultCount) {\n\t\t\ttext = this._lines[searchRange.endLineNumber - 1].text.substring(0, searchRange.endColumn - 1);\n\t\t\tcounter = this._findMatchesInLine(searchRegex, text, searchRange.endLineNumber, 0, counter, result, limitResultCount);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _findMatchInLine(searchRegex:RegExp, text:string, lineNumber:number, deltaOffset:number): Range {\n\t\tvar m = searchRegex.exec(text);\n\t\tif (!m) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new Range(lineNumber, m.index + 1 + deltaOffset, lineNumber, m.index + 1 + m[0].length + deltaOffset);\n\t}\n\n\tprivate _findLastMatchInLine(searchRegex:RegExp, text:string, lineNumber:number): Range {\n\t\tlet bestResult: Range = null;\n\t\tlet m:RegExpExecArray;\n\t\twhile ((m = searchRegex.exec(text))) {\n\t\t\tlet result = new Range(lineNumber, m.index + 1, lineNumber, m.index + 1 + m[0].length);\n\t\t\tif (result.equalsRange(bestResult)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbestResult = result;\n\t\t}\n\t\treturn bestResult;\n\t}\n\n\tprivate _findMatchesInLine(searchRegex:RegExp, text:string, lineNumber:number, deltaOffset:number, counter:number, result:Range[], limitResultCount:number): number {\n\t\tvar m:RegExpExecArray;\n\t\t// Reset regex to search from the beginning\n\t\tsearchRegex.lastIndex = 0;\n\t\tdo {\n\t\t\tm = searchRegex.exec(text);\n\t\t\tif (m) {\n\t\t\t\tvar range = new Range(lineNumber, m.index + 1 + deltaOffset, lineNumber, m.index + 1 + m[0].length + deltaOffset);\n\t\t\t\t// Exit early if the regex matches the same range\n\t\t\t\tif (range.equalsRange(result[result.length - 1])) {\n\t\t\t\t\treturn counter;\n\t\t\t\t}\n\t\t\t\tresult.push(range);\n\t\t\t\tcounter++;\n\t\t\t\tif (counter >= limitResultCount) {\n\t\t\t\t\treturn counter;\n\t\t\t\t}\n\t\t\t}\n\t\t} while(m);\n\t\treturn counter;\n\t}\n}\n\nexport class RawText {\n\n\tpublic static fromString(rawText:string, opts:editorCommon.ITextModelCreationOptions): editorCommon.IRawText {\n\t\treturn TextModel.toRawText(rawText, opts);\n\t}\n\n\tpublic static fromStringWithModelOptions(rawText:string, model:editorCommon.IModel): editorCommon.IRawText {\n\t\tlet opts = model.getOptions();\n\t\treturn TextModel.toRawText(rawText, {\n\t\t\ttabSize: opts.tabSize,\n\t\t\tinsertSpaces: opts.insertSpaces,\n\t\t\ttrimAutoWhitespace: opts.trimAutoWhitespace,\n\t\t\tdetectIndentation: false,\n\t\t\tdefaultEOL: opts.defaultEOL\n\t\t});\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {RunOnceScheduler} from 'vs/base/common/async';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport {IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport {StopWatch} from 'vs/base/common/stopwatch';\nimport * as timer from 'vs/base/common/timer';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {Range} from 'vs/editor/common/core/range';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport {ModelLine} from 'vs/editor/common/model/modelLine';\nimport {TextModel} from 'vs/editor/common/model/textModel';\nimport {WordHelper} from 'vs/editor/common/model/textModelWithTokensHelpers';\nimport {TokenIterator} from 'vs/editor/common/model/tokenIterator';\nimport {ILineContext, ILineTokens, IToken, IModeTransition, IMode, IState} from 'vs/editor/common/modes';\nimport {NullMode, NullState, nullTokenize} from 'vs/editor/common/modes/nullMode';\nimport {ignoreBracketsInToken} from 'vs/editor/common/modes/supports';\nimport {BracketsUtils} from 'vs/editor/common/modes/supports/richEditBrackets';\nimport {ModeTransition} from 'vs/editor/common/core/modeTransition';\nimport {LineToken} from 'vs/editor/common/model/lineToken';\nimport {TokensInflatorMap} from 'vs/editor/common/model/tokensBinaryEncoding';\nimport {Position} from 'vs/editor/common/core/position';\nimport {LanguageConfigurationRegistry} from 'vs/editor/common/modes/languageConfigurationRegistry';\n\nclass ModeToModelBinder implements IDisposable {\n\n\tprivate _modePromise:TPromise<IMode>;\n\tprivate _externalModePromise:TPromise<boolean>;\n\tprivate _externalModePromise_c:(value:boolean)=>void;\n\tprivate _externalModePromise_e:(err:any)=>void;\n\tprivate _model:TextModelWithTokens;\n\tprivate _isDisposed:boolean;\n\n\tconstructor(modePromise:TPromise<IMode>, model:TextModelWithTokens) {\n\t\tthis._modePromise = modePromise;\n\t\t// Create an external mode promise that fires after the mode is set to the model\n\t\tthis._externalModePromise = new TPromise<boolean>((c, e, p) => {\n\t\t\tthis._externalModePromise_c = c;\n\t\t\tthis._externalModePromise_e = e;\n\t\t}, () => {\n\t\t\t// this promise cannot be canceled\n\t\t});\n\t\tthis._model = model;\n\t\tthis._isDisposed = false;\n\n\t\t// Ensure asynchronicity\n\t\tTPromise.timeout(0).then(() => {\n\t\t\treturn this._modePromise;\n\t\t}).then((mode:IMode) => {\n\t\t\tif (this._isDisposed) {\n\t\t\t\tthis._externalModePromise_c(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar model = this._model;\n\t\t\tthis.dispose();\n\t\t\tmodel.setMode(mode);\n\t\t\tmodel._warmUpTokens();\n\t\t\tthis._externalModePromise_c(true);\n\t\t}).done(null, (err) => {\n\t\t\tthis._externalModePromise_e(err);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n\n\tpublic getModePromise(): TPromise<boolean> {\n\t\treturn this._externalModePromise;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._modePromise = null;\n\t\tthis._model = null;\n\t\tthis._isDisposed = true;\n\t}\n}\n\nexport interface IRetokenizeRequest extends IDisposable {\n\n\tisFulfilled: boolean;\n\n\t/**\n\t * If null, the entire model will be retokenzied, use null with caution\n\t */\n\tgetRange(): editorCommon.IRange;\n}\n\nexport class FullModelRetokenizer implements IRetokenizeRequest {\n\n\tpublic isFulfilled: boolean;\n\n\t_model:TextModelWithTokens;\n\tprivate _retokenizePromise:TPromise<void>;\n\tprivate _isDisposed: boolean;\n\n\tconstructor(retokenizePromise:TPromise<void>, model:TextModelWithTokens) {\n\t\tthis._retokenizePromise = retokenizePromise;\n\t\tthis._model = model;\n\t\tthis._isDisposed = false;\n\t\tthis.isFulfilled = false;\n\n\t\t// Ensure asynchronicity\n\t\tTPromise.timeout(0).then(() => {\n\t\t\treturn this._retokenizePromise;\n\t\t}).then(() => {\n\t\t\tif (this._isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isFulfilled = true;\n\t\t\tthis._model.onRetokenizerFulfilled();\n\t\t}).done(null, onUnexpectedError);\n\t}\n\n\tpublic getRange(): editorCommon.IRange {\n\t\treturn null;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._retokenizePromise = null;\n\t\tthis._model = null;\n\t\tthis._isDisposed = true;\n\t}\n}\n\nclass LineContext implements ILineContext {\n\n\tpublic modeTransitions:ModeTransition[];\n\tprivate _text:string;\n\tprivate _lineTokens:editorCommon.ILineTokens;\n\n\tconstructor (topLevelMode:IMode, line:ModelLine) {\n\t\tthis.modeTransitions = line.getModeTransitions(topLevelMode);\n\t\tthis._text = line.text;\n\t\tthis._lineTokens = line.getTokens();\n\t}\n\n\tpublic getLineContent(): string {\n\t\treturn this._text;\n\t}\n\n\tpublic getTokenCount(): number {\n\t\treturn this._lineTokens.getTokenCount();\n\t}\n\n\tpublic getTokenStartIndex(tokenIndex:number): number {\n\t\treturn this._lineTokens.getTokenStartIndex(tokenIndex);\n\t}\n\n\tpublic getTokenEndIndex(tokenIndex:number): number {\n\t\treturn this._lineTokens.getTokenEndIndex(tokenIndex, this._text.length);\n\t}\n\n\tpublic getTokenType(tokenIndex:number): string {\n\t\treturn this._lineTokens.getTokenType(tokenIndex);\n\t}\n\n\tpublic getTokenText(tokenIndex:number): string {\n\t\tvar startIndex = this._lineTokens.getTokenStartIndex(tokenIndex);\n\t\tvar endIndex = this._lineTokens.getTokenEndIndex(tokenIndex, this._text.length);\n\t\treturn this._text.substring(startIndex, endIndex);\n\t}\n\n\tpublic findIndexOfOffset(offset:number): number {\n\t\treturn this._lineTokens.findIndexOfOffset(offset);\n\t}\n}\n\nexport class TextModelWithTokens extends TextModel implements editorCommon.ITokenizedModel {\n\n\tprivate static MODE_TOKENIZATION_FAILED_MSG = nls.localize('mode.tokenizationSupportFailed', \"The mode has failed while tokenizing the input.\");\n\n\tprivate _shouldAutoTokenize:boolean;\n\tprivate _mode: IMode;\n\tprivate _modeListener: IDisposable;\n\tprivate _modeToModelBinder:ModeToModelBinder;\n\tprivate _tokensInflatorMap:TokensInflatorMap;\n\n\tprivate _invalidLineStartIndex:number;\n\tprivate _lastState:IState;\n\n\tprivate _revalidateTokensTimeout:number;\n\tprivate _scheduleRetokenizeNow: RunOnceScheduler;\n\tprivate _retokenizers:IRetokenizeRequest[];\n\n\tconstructor(allowedEventTypes:string[], rawText:editorCommon.IRawText, shouldAutoTokenize:boolean, modeOrPromise:IMode|TPromise<IMode>) {\n\t\tallowedEventTypes.push(editorCommon.EventType.ModelTokensChanged);\n\t\tallowedEventTypes.push(editorCommon.EventType.ModelModeChanged);\n\t\tallowedEventTypes.push(editorCommon.EventType.ModelModeSupportChanged);\n\t\tsuper(allowedEventTypes, rawText);\n\n\t\tthis._shouldAutoTokenize = shouldAutoTokenize;\n\t\tthis._mode = null;\n\t\tthis._modeListener = null;\n\t\tthis._modeToModelBinder = null;\n\t\tthis._tokensInflatorMap = null;\n\n\t\tthis._invalidLineStartIndex = 0;\n\t\tthis._lastState = null;\n\n\t\tthis._revalidateTokensTimeout = -1;\n\t\tthis._scheduleRetokenizeNow = null;\n\t\tthis._retokenizers = null;\n\n\t\tif (!modeOrPromise) {\n\t\t\tthis._mode = new NullMode();\n\t\t} else if (TPromise.is(modeOrPromise)) {\n\t\t\t// TODO@Alex: To avoid mode id changes, we check if this promise is resolved\n\t\t\tlet promiseValue = <IMode>(<any>modeOrPromise)._value;\n\n\t\t\tif (promiseValue && typeof promiseValue.getId === 'function') {\n\t\t\t\t// The promise is already resolved\n\t\t\t\tthis._mode = this._massageMode(promiseValue);\n\t\t\t\tthis._resetModeListener(this._mode);\n\t\t\t} else {\n\t\t\t\tvar modePromise = <TPromise<IMode>>modeOrPromise;\n\t\t\t\tthis._modeToModelBinder = new ModeToModelBinder(modePromise, this);\n\t\t\t\tthis._mode = new NullMode();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._mode = this._massageMode(<IMode>modeOrPromise);\n\t\t\tthis._resetModeListener(this._mode);\n\t\t}\n\n\t\tthis._revalidateTokensTimeout = -1;\n\t\tthis._scheduleRetokenizeNow = new RunOnceScheduler(() => this._retokenizeNow(), 200);\n\t\tthis._retokenizers = [];\n\n\t\tthis._resetTokenizationState();\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._modeToModelBinder) {\n\t\t\tthis._modeToModelBinder.dispose();\n\t\t\tthis._modeToModelBinder = null;\n\t\t}\n\t\tthis._resetModeListener(null);\n\t\tthis._clearTimers();\n\t\tthis._mode = null;\n\t\tthis._lastState = null;\n\t\tthis._tokensInflatorMap = null;\n\t\tthis._retokenizers = dispose(this._retokenizers);\n\t\tthis._scheduleRetokenizeNow.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\tprivate _massageMode(mode: IMode): IMode {\n\t\tif (this.isTooLargeForHavingAMode()) {\n\t\t\treturn new NullMode();\n\t\t}\n\t\tif (this.isTooLargeForHavingARichMode()) {\n\t\t\treturn mode.toSimplifiedMode();\n\t\t}\n\t\treturn mode;\n\t}\n\n\tpublic whenModeIsReady(): TPromise<IMode> {\n\t\tif (this._modeToModelBinder) {\n\t\t\t// Still waiting for some mode to load\n\t\t\treturn this._modeToModelBinder.getModePromise().then(() => this._mode);\n\t\t}\n\t\treturn TPromise.as(this._mode);\n\t}\n\n\tpublic onRetokenizerFulfilled(): void {\n\t\tthis._scheduleRetokenizeNow.schedule();\n\t}\n\n\tprivate _retokenizeNow(): void {\n\t\tvar fulfilled = this._retokenizers.filter(r => r.isFulfilled);\n\t\tthis._retokenizers = this._retokenizers.filter(r => !r.isFulfilled);\n\n\t\tvar hasFullModel = false;\n\t\tfor (var i = 0; i < fulfilled.length; i++) {\n\t\t\tif (!fulfilled[i].getRange()) {\n\t\t\t\thasFullModel = true;\n\t\t\t}\n\t\t}\n\n\t\tif (hasFullModel) {\n\t\t\t// Just invalidate all the lines\n\t\t\tfor (var i = 0, len = this._lines.length; i < len; i++) {\n\t\t\t\tthis._lines[i].isInvalid = true;\n\t\t\t}\n\t\t\tthis._invalidLineStartIndex = 0;\n\t\t} else {\n\t\t\tvar minLineNumber = Number.MAX_VALUE;\n\t\t\tfor (var i = 0; i < fulfilled.length; i++) {\n\t\t\t\tvar range = fulfilled[i].getRange();\n\t\t\t\tminLineNumber = Math.min(minLineNumber, range.startLineNumber);\n\t\t\t\tfor (var lineNumber = range.startLineNumber; lineNumber <= range.endLineNumber; lineNumber++) {\n\t\t\t\t\tthis._lines[lineNumber - 1].isInvalid = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (minLineNumber - 1 < this._invalidLineStartIndex) {\n\t\t\t\tif (this._invalidLineStartIndex < this._lines.length) {\n\t\t\t\t\tthis._lines[this._invalidLineStartIndex].isInvalid = true;\n\t\t\t\t}\n\t\t\t\tthis._invalidLineStartIndex = minLineNumber - 1;\n\t\t\t}\n\t\t}\n\n\t\tthis._beginBackgroundTokenization();\n\n\t\tfor (var i = 0; i < fulfilled.length; i++) {\n\t\t\tfulfilled[i].dispose();\n\t\t}\n\t}\n\n\t_createRetokenizer(retokenizePromise:TPromise<void>, lineNumber:number): IRetokenizeRequest {\n\t\treturn new FullModelRetokenizer(retokenizePromise, this);\n\t}\n\n\t_resetValue(e:editorCommon.IModelContentChangedFlushEvent, newValue:editorCommon.IRawText): void {\n\t\tsuper._resetValue(e, newValue);\n\t\t// Cancel tokenization, clear all tokens and begin tokenizing\n\t\tthis._resetTokenizationState();\n\t}\n\n\t_resetMode(e:editorCommon.IModelModeChangedEvent, newMode:IMode): void {\n\t\t// Cancel tokenization, clear all tokens and begin tokenizing\n\t\tthis._mode = newMode;\n\t\tthis._resetModeListener(newMode);\n\t\tthis._resetTokenizationState();\n\n\t\tthis.emitModelTokensChangedEvent(1, this.getLineCount());\n\t}\n\n\tprivate _resetModeListener(newMode: IMode): void {\n\t\tif (this._modeListener) {\n\t\t\tthis._modeListener.dispose();\n\t\t\tthis._modeListener = null;\n\t\t}\n\t\tif (newMode && typeof newMode.addSupportChangedListener === 'function') {\n\t\t\tthis._modeListener = newMode.addSupportChangedListener( (e) => this._onModeSupportChanged(e) );\n\t\t}\n\t}\n\n\tprivate _onModeSupportChanged(e: editorCommon.IModeSupportChangedEvent): void {\n\t\tthis._emitModelModeSupportChangedEvent(e);\n\t\tif (e.tokenizationSupport) {\n\t\t\tthis._resetTokenizationState();\n\t\t\tthis.emitModelTokensChangedEvent(1, this.getLineCount());\n\t\t}\n\t}\n\n\t_resetTokenizationState(): void {\n\t\tthis._retokenizers = dispose(this._retokenizers);\n\t\tthis._scheduleRetokenizeNow.cancel();\n\t\tthis._clearTimers();\n\t\tfor (var i = 0; i < this._lines.length; i++) {\n\t\t\tthis._lines[i].setState(null);\n\t\t}\n\t\tthis._initializeTokenizationState();\n\t}\n\n\tprivate _clearTimers(): void {\n\t\tif (this._revalidateTokensTimeout !== -1) {\n\t\t\tclearTimeout(this._revalidateTokensTimeout);\n\t\t\tthis._revalidateTokensTimeout = -1;\n\t\t}\n\t}\n\n\tprivate _initializeTokenizationState(): void {\n\t\t// Initialize tokenization states\n\t\tvar initialState:IState = null;\n\t\tif (this._mode.tokenizationSupport) {\n\t\t\ttry {\n\t\t\t\tinitialState = this._mode.tokenizationSupport.getInitialState();\n\t\t\t} catch (e) {\n\t\t\t\te.friendlyMessage = TextModelWithTokens.MODE_TOKENIZATION_FAILED_MSG;\n\t\t\t\tonUnexpectedError(e);\n\t\t\t\tthis._mode = new NullMode();\n\t\t\t}\n\t\t}\n\t\tif (!initialState) {\n\t\t\tinitialState = new NullState(this._mode, null);\n\t\t}\n\n\t\tthis._lines[0].setState(initialState);\n\t\tthis._lastState = null;\n\t\tthis._tokensInflatorMap = new TokensInflatorMap();\n\t\tthis._invalidLineStartIndex = 0;\n\t\tthis._beginBackgroundTokenization();\n\t}\n\n\tpublic getLineTokens(lineNumber:number, inaccurateTokensAcceptable:boolean = false): editorCommon.ILineTokens {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\n\t\tif (!inaccurateTokensAcceptable) {\n\t\t\tthis._updateTokensUntilLine(lineNumber, true);\n\t\t}\n\t\treturn this._lines[lineNumber - 1].getTokens();\n\t}\n\n\tpublic getLineContext(lineNumber:number): ILineContext {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\n\t\tthis._updateTokensUntilLine(lineNumber, true);\n\n\t\treturn new LineContext(this._mode, this._lines[lineNumber - 1]);\n\t}\n\n\t_getInternalTokens(lineNumber:number): editorCommon.ILineTokens {\n\t\tthis._updateTokensUntilLine(lineNumber, true);\n\t\treturn this._lines[lineNumber - 1].getTokens();\n\t}\n\n\tpublic getMode(): IMode {\n\t\treturn this._mode;\n\t}\n\n\tpublic setMode(newModeOrPromise:IMode|TPromise<IMode>): void {\n\t\tif (!newModeOrPromise) {\n\t\t\t// There's nothing to do\n\t\t\treturn;\n\t\t}\n\t\tif (this._modeToModelBinder) {\n\t\t\tthis._modeToModelBinder.dispose();\n\t\t\tthis._modeToModelBinder = null;\n\t\t}\n\t\tif (TPromise.is(newModeOrPromise)) {\n\t\t\tthis._modeToModelBinder = new ModeToModelBinder(<TPromise<IMode>>newModeOrPromise, this);\n\t\t} else {\n\t\t\tvar actualNewMode = this._massageMode(<IMode>newModeOrPromise);\n\t\t\tif (this._mode !== actualNewMode) {\n\t\t\t\tvar e2:editorCommon.IModelModeChangedEvent = {\n\t\t\t\t\toldMode: this._mode,\n\t\t\t\t\tnewMode: actualNewMode\n\t\t\t\t};\n\t\t\t\tthis._resetMode(e2, actualNewMode);\n\t\t\t\tthis._emitModelModeChangedEvent(e2);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic getModeIdAtPosition(_lineNumber:number, _column:number): string {\n\t\tvar validPosition = this.validatePosition({\n\t\t\tlineNumber: _lineNumber,\n\t\t\tcolumn: _column\n\t\t});\n\n\t\tvar lineNumber = validPosition.lineNumber;\n\t\tvar column = validPosition.column;\n\n\t\tif (column === 1) {\n\t\t\treturn this.getStateBeforeLine(lineNumber).getMode().getId();\n\t\t} else if (column === this.getLineMaxColumn(lineNumber)) {\n\t\t\treturn this.getStateAfterLine(lineNumber).getMode().getId();\n\t\t} else {\n\t\t\tvar modeTransitions = this._getLineModeTransitions(lineNumber);\n\t\t\tvar modeTransitionIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, column - 1);\n\t\t\treturn modeTransitions[modeTransitionIndex].modeId;\n\t\t}\n\t}\n\n\t_invalidateLine(lineIndex:number): void {\n\t\tthis._lines[lineIndex].isInvalid = true;\n\t\tif (lineIndex < this._invalidLineStartIndex) {\n\t\t\tif (this._invalidLineStartIndex < this._lines.length) {\n\t\t\t\tthis._lines[this._invalidLineStartIndex].isInvalid = true;\n\t\t\t}\n\t\t\tthis._invalidLineStartIndex = lineIndex;\n\t\t\tthis._beginBackgroundTokenization();\n\t\t}\n\t}\n\n\tprivate static _toLineTokens(tokens:IToken[]): LineToken[] {\n\t\tif (!tokens || tokens.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tif (tokens[0] instanceof LineToken) {\n\t\t\treturn <LineToken[]>tokens;\n\t\t}\n\t\tlet result:LineToken[] = [];\n\t\tfor (let i = 0, len = tokens.length; i < len; i++) {\n\t\t\tresult[i] = new LineToken(tokens[i].startIndex, tokens[i].type);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate static _toModeTransitions(modeTransitions:IModeTransition[]): ModeTransition[] {\n\t\tif (!modeTransitions || modeTransitions.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tif (modeTransitions[0] instanceof ModeTransition) {\n\t\t\treturn <ModeTransition[]>modeTransitions;\n\t\t}\n\t\tlet result:ModeTransition[] = [];\n\t\tfor (let i = 0, len = modeTransitions.length; i < len; i++) {\n\t\t\tresult[i] = new ModeTransition(modeTransitions[i].startIndex, modeTransitions[i].mode);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _updateLineTokens(lineIndex:number, map:TokensInflatorMap, topLevelMode:IMode, r:ILineTokens): void {\n\t\tthis._lines[lineIndex].setTokens(map, TextModelWithTokens._toLineTokens(r.tokens), topLevelMode, TextModelWithTokens._toModeTransitions(r.modeTransitions));\n\t}\n\n\tprivate _beginBackgroundTokenization(): void {\n\t\tif (this._shouldAutoTokenize && this._revalidateTokensTimeout === -1) {\n\t\t\tthis._revalidateTokensTimeout = setTimeout(() => {\n\t\t\t\tthis._revalidateTokensTimeout = -1;\n\t\t\t\tthis._revalidateTokensNow();\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\t_warmUpTokens(): void {\n\t\t// Warm up first 100 lines (if it takes less than 50ms)\n\t\tvar maxLineNumber = Math.min(100, this.getLineCount());\n\t\tvar toLineNumber = maxLineNumber;\n\t\tfor (var lineNumber = 1; lineNumber <= maxLineNumber; lineNumber++) {\n\t\t\tvar text = this._lines[lineNumber - 1].text;\n\t\t\tif (text.length >= 200) {\n\t\t\t\t// This line is over 200 chars long, so warm up without it\n\t\t\t\ttoLineNumber = lineNumber - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis._revalidateTokensNow(toLineNumber);\n\t}\n\n\tprivate _revalidateTokensNow(toLineNumber:number = this._invalidLineStartIndex + 1000000): void {\n\n\t\tvar t1 = timer.start(timer.Topic.EDITOR, 'backgroundTokenization');\n\t\ttoLineNumber = Math.min(this._lines.length, toLineNumber);\n\n\t\tvar MAX_ALLOWED_TIME = 20,\n\t\t\tfromLineNumber = this._invalidLineStartIndex + 1,\n\t\t\ttokenizedChars = 0,\n\t\t\tcurrentCharsToTokenize = 0,\n\t\t\tcurrentEstimatedTimeToTokenize = 0,\n\t\t\tsw = StopWatch.create(false),\n\t\t\telapsedTime: number;\n\n\t\t// Tokenize at most 1000 lines. Estimate the tokenization speed per character and stop when:\n\t\t// - MAX_ALLOWED_TIME is reached\n\t\t// - tokenizing the next line would go above MAX_ALLOWED_TIME\n\n\t\tfor (var lineNumber = fromLineNumber; lineNumber <= toLineNumber; lineNumber++) {\n\t\t\telapsedTime = sw.elapsed();\n\t\t\tif (elapsedTime > MAX_ALLOWED_TIME) {\n\t\t\t\t// Stop if MAX_ALLOWED_TIME is reached\n\t\t\t\ttoLineNumber = lineNumber - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Compute how many characters will be tokenized for this line\n\t\t\tcurrentCharsToTokenize = this._lines[lineNumber - 1].text.length;\n\n\t\t\tif (tokenizedChars > 0) {\n\t\t\t\t// If we have enough history, estimate how long tokenizing this line would take\n\t\t\t\tcurrentEstimatedTimeToTokenize = (elapsedTime / tokenizedChars) * currentCharsToTokenize;\n\t\t\t\tif (elapsedTime + currentEstimatedTimeToTokenize > MAX_ALLOWED_TIME) {\n\t\t\t\t\t// Tokenizing this line will go above MAX_ALLOWED_TIME\n\t\t\t\t\ttoLineNumber = lineNumber - 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._updateTokensUntilLine(lineNumber, false);\n\t\t\ttokenizedChars += currentCharsToTokenize;\n\t\t}\n\n\t\telapsedTime = sw.elapsed();\n\n\t\tif (fromLineNumber <= toLineNumber) {\n\t\t\tthis.emitModelTokensChangedEvent(fromLineNumber, toLineNumber);\n\t\t}\n\n\t\tif (this._invalidLineStartIndex < this._lines.length) {\n\t\t\tthis._beginBackgroundTokenization();\n\t\t}\n\n\t\tt1.stop();\n\t}\n\n\tprivate getStateBeforeLine(lineNumber:number): IState {\n\t\tthis._updateTokensUntilLine(lineNumber - 1, true);\n\t\treturn this._lines[lineNumber - 1].getState();\n\t}\n\n\tprivate getStateAfterLine(lineNumber:number): IState {\n\t\tthis._updateTokensUntilLine(lineNumber, true);\n\t\treturn lineNumber < this._lines.length ? this._lines[lineNumber].getState() : this._lastState;\n\t}\n\n\t_getLineModeTransitions(lineNumber:number): ModeTransition[] {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new Error('Illegal value ' + lineNumber + ' for `lineNumber`');\n\t\t}\n\t\tthis._updateTokensUntilLine(lineNumber, true);\n\t\treturn this._lines[lineNumber - 1].getModeTransitions(this._mode);\n\t}\n\n\tprivate _updateTokensUntilLine(lineNumber:number, emitEvents:boolean): void {\n\t\tvar linesLength = this._lines.length;\n\t\tvar endLineIndex = lineNumber - 1;\n\t\tvar stopLineTokenizationAfter = 1000000000; // 1 billion, if a line is so long, you have other trouble :).\n\n\t\tvar fromLineNumber = this._invalidLineStartIndex + 1, toLineNumber = lineNumber;\n\n\t\t// Validate all states up to and including endLineIndex\n\t\tfor (var lineIndex = this._invalidLineStartIndex; lineIndex <= endLineIndex; lineIndex++) {\n\t\t\tvar endStateIndex = lineIndex + 1;\n\t\t\tvar r:ILineTokens = null;\n\t\t\tvar text = this._lines[lineIndex].text;\n\t\t\tif (this._mode.tokenizationSupport) {\n\n\t\t\t\ttry {\n\t\t\t\t\t// Tokenize only the first X characters\n\t\t\t\t\tr = this._mode.tokenizationSupport.tokenize(this._lines[lineIndex].text, this._lines[lineIndex].getState(), 0, stopLineTokenizationAfter);\n\t\t\t\t} catch (e) {\n\t\t\t\t\te.friendlyMessage = TextModelWithTokens.MODE_TOKENIZATION_FAILED_MSG;\n\t\t\t\t\tonUnexpectedError(e);\n\t\t\t\t}\n\n\t\t\t\tif (r && r.retokenize) {\n\t\t\t\t\tthis._retokenizers.push(this._createRetokenizer(r.retokenize, lineIndex + 1));\n\t\t\t\t}\n\n\t\t\t\tif (r && r.tokens && r.tokens.length > 0) {\n\t\t\t\t\t// Cannot have a stop offset before the last token\n\t\t\t\t\tr.actualStopOffset = Math.max(r.actualStopOffset, r.tokens[r.tokens.length - 1].startIndex + 1);\n\t\t\t\t}\n\n\t\t\t\tif (r && r.actualStopOffset < text.length) {\n\t\t\t\t\t// Treat the rest of the line (if above limit) as one default token\n\t\t\t\t\tr.tokens.push({\n\t\t\t\t\t\tstartIndex: r.actualStopOffset,\n\t\t\t\t\t\ttype: ''\n\t\t\t\t\t});\n\n\t\t\t\t\t// Use as end state the starting state\n\t\t\t\t\tr.endState = this._lines[lineIndex].getState();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!r) {\n\t\t\t\tr = nullTokenize(this._mode, text, this._lines[lineIndex].getState());\n\t\t\t}\n\t\t\tif (!r.modeTransitions) {\n\t\t\t\tr.modeTransitions = [];\n\t\t\t}\n\t\t\tif (r.modeTransitions.length === 0) {\n\t\t\t\t// Make sure there is at least the transition to the top-most mode\n\t\t\t\tr.modeTransitions.push({\n\t\t\t\t\tstartIndex: 0,\n\t\t\t\t\tmode: this._mode\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._updateLineTokens(lineIndex, this._tokensInflatorMap, this._mode, r);\n\n\t\t\tif (this._lines[lineIndex].isInvalid) {\n\t\t\t\tthis._lines[lineIndex].isInvalid = false;\n\t\t\t}\n\n\t\t\tif (endStateIndex < linesLength) {\n\t\t\t\tif (this._lines[endStateIndex].getState() !== null && r.endState.equals(this._lines[endStateIndex].getState())) {\n\t\t\t\t\t// The end state of this line remains the same\n\t\t\t\t\tvar nextInvalidLineIndex = lineIndex + 1;\n\t\t\t\t\twhile (nextInvalidLineIndex < linesLength) {\n\t\t\t\t\t\tif (this._lines[nextInvalidLineIndex].isInvalid) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nextInvalidLineIndex + 1 < linesLength) {\n\t\t\t\t\t\t\tif (this._lines[nextInvalidLineIndex + 1].getState() === null) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (this._lastState === null) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextInvalidLineIndex++;\n\t\t\t\t\t}\n\t\t\t\t\tthis._invalidLineStartIndex = Math.max(this._invalidLineStartIndex, nextInvalidLineIndex);\n\t\t\t\t\tlineIndex = nextInvalidLineIndex - 1; // -1 because the outer loop increments it\n\t\t\t\t} else {\n\t\t\t\t\tthis._lines[endStateIndex].setState(r.endState);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._lastState = r.endState;\n\t\t\t}\n\t\t}\n\t\tthis._invalidLineStartIndex = Math.max(this._invalidLineStartIndex, endLineIndex + 1);\n\n\t\tif (emitEvents && fromLineNumber <= toLineNumber) {\n\t\t\tthis.emitModelTokensChangedEvent(fromLineNumber, toLineNumber);\n\t\t}\n\t}\n\n\tprivate emitModelTokensChangedEvent(fromLineNumber:number, toLineNumber:number): void {\n\t\tvar e:editorCommon.IModelTokensChangedEvent = {\n\t\t\tfromLineNumber: fromLineNumber,\n\t\t\ttoLineNumber: toLineNumber\n\t\t};\n\t\tif (!this._isDisposing) {\n\t\t\tthis.emit(editorCommon.EventType.ModelTokensChanged, e);\n\t\t}\n\t}\n\n\tprivate _emitModelModeChangedEvent(e:editorCommon.IModelModeChangedEvent): void {\n\t\tif (!this._isDisposing) {\n\t\t\tthis.emit(editorCommon.EventType.ModelModeChanged, e);\n\t\t}\n\t}\n\n\tprivate _emitModelModeSupportChangedEvent(e:editorCommon.IModeSupportChangedEvent): void {\n\t\tif (!this._isDisposing) {\n\t\t\tthis.emit(editorCommon.EventType.ModelModeSupportChanged, e);\n\t\t}\n\t}\n\n\t// Having tokens allows implementing additional helper methods\n\n\t_lineIsTokenized(lineNumber:number): boolean {\n\t\treturn this._invalidLineStartIndex > lineNumber - 1;\n\t}\n\n\t_getWordDefinition(): RegExp {\n\t\treturn WordHelper.massageWordDefinitionOf(this._mode);\n\t}\n\n\tpublic getWordAtPosition(position:editorCommon.IPosition): editorCommon.IWordAtPosition {\n\t\treturn WordHelper.getWordAtPosition(this, this.validatePosition(position));\n\t}\n\n\tpublic getWordUntilPosition(position: editorCommon.IPosition): editorCommon.IWordAtPosition {\n\t\tvar wordAtPosition = this.getWordAtPosition(position);\n\t\tif (!wordAtPosition) {\n\t\t\treturn {\n\t\t\t\tword: '',\n\t\t\t\tstartColumn: position.column,\n\t\t\t\tendColumn: position.column\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tword: wordAtPosition.word.substr(0, position.column - wordAtPosition.startColumn),\n\t\t\tstartColumn: wordAtPosition.startColumn,\n\t\t\tendColumn: position.column\n\t\t};\n\t}\n\n\tpublic tokenIterator(position:editorCommon.IPosition, callback:(it:TokenIterator)=>any): any {\n\t\tvar iter = new TokenIterator(this, this.validatePosition(position));\n\t\tvar result = callback(iter);\n\t\titer._invalidate();\n\t\treturn result;\n\t}\n\n\tpublic findMatchingBracketUp(bracket:string, _position:editorCommon.IPosition): Range {\n\t\tlet position = this.validatePosition(_position);\n\t\tlet modeTransitions = this._lines[position.lineNumber - 1].getModeTransitions(this._mode);\n\t\tlet currentModeIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n\t\tlet currentMode = modeTransitions[currentModeIndex];\n\t\tlet currentModeBrackets = LanguageConfigurationRegistry.getBracketsSupport(currentMode.modeId);\n\n\t\tif (!currentModeBrackets) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet data = currentModeBrackets.textIsBracket[bracket];\n\n\t\tif (!data) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._findMatchingBracketUp(data, position);\n\t}\n\n\tpublic matchBracket(position:editorCommon.IPosition): [Range,Range] {\n\t\treturn this._matchBracket(this.validatePosition(position));\n\t}\n\n\tprivate _matchBracket(position:Position): [Range,Range] {\n\t\tlet lineNumber = position.lineNumber;\n\t\tlet lineText = this._lines[lineNumber - 1].text;\n\n\t\tlet lineTokens = this._lines[lineNumber - 1].getTokens();\n\t\tlet currentTokenIndex = lineTokens.findIndexOfOffset(position.column - 1);\n\t\tlet currentTokenStart = lineTokens.getTokenStartIndex(currentTokenIndex);\n\n\t\tlet modeTransitions = this._lines[lineNumber - 1].getModeTransitions(this._mode);\n\t\tlet currentModeIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n\t\tlet currentMode = modeTransitions[currentModeIndex];\n\t\tlet currentModeBrackets = LanguageConfigurationRegistry.getBracketsSupport(currentMode.modeId);\n\n\t\t// If position is in between two tokens, try first looking in the previous token\n\t\tif (currentTokenIndex > 0 && currentTokenStart === position.column - 1) {\n\t\t\tlet prevTokenIndex = currentTokenIndex - 1;\n\t\t\tlet prevTokenType = lineTokens.getTokenType(prevTokenIndex);\n\n\t\t\t// check that previous token is not to be ignored\n\t\t\tif (!ignoreBracketsInToken(prevTokenType)) {\n\t\t\t\tlet prevTokenStart = lineTokens.getTokenStartIndex(prevTokenIndex);\n\n\t\t\t\tlet prevMode = currentMode;\n\t\t\t\tlet prevModeBrackets = currentModeBrackets;\n\t\t\t\t// check if previous token is in a different mode\n\t\t\t\tif (currentModeIndex > 0 && currentMode.startIndex === position.column - 1) {\n\t\t\t\t\tprevMode = modeTransitions[currentModeIndex - 1];\n\t\t\t\t\tprevModeBrackets = LanguageConfigurationRegistry.getBracketsSupport(prevMode.modeId);\n\t\t\t\t}\n\n\t\t\t\tif (prevModeBrackets) {\n\t\t\t\t\t// limit search in case previous token is very large, there's no need to go beyond `maxBracketLength`\n\t\t\t\t\tprevTokenStart = Math.max(prevTokenStart, position.column - 1 - prevModeBrackets.maxBracketLength);\n\n\t\t\t\t\tlet foundBracket = BracketsUtils.findPrevBracketInToken(prevModeBrackets.reversedRegex, lineNumber, lineText, prevTokenStart, currentTokenStart);\n\n\t\t\t\t\t// check that we didn't hit a bracket too far away from position\n\t\t\t\t\tif (foundBracket && foundBracket.startColumn <= position.column && position.column <= foundBracket.endColumn) {\n\t\t\t\t\t\tlet foundBracketText = lineText.substring(foundBracket.startColumn - 1, foundBracket.endColumn - 1);\n\t\t\t\t\t\tlet r = this._matchFoundBracket(foundBracket, prevModeBrackets.textIsBracket[foundBracketText], prevModeBrackets.textIsOpenBracket[foundBracketText]);\n\n\t\t\t\t\t\t// check that we can actually match this bracket\n\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// check that the token is not to be ignored\n\t\tif (!ignoreBracketsInToken(lineTokens.getTokenType(currentTokenIndex))) {\n\n\t\t\tif (currentModeBrackets) {\n\t\t\t\t// limit search to not go before `maxBracketLength`\n\t\t\t\tcurrentTokenStart = Math.max(currentTokenStart, position.column - 1 - currentModeBrackets.maxBracketLength);\n\n\t\t\t\t// limit search to not go after `maxBracketLength`\n\t\t\t\tlet currentTokenEnd = lineTokens.getTokenEndIndex(currentTokenIndex, lineText.length);\n\t\t\t\tcurrentTokenEnd = Math.min(currentTokenEnd, position.column - 1 + currentModeBrackets.maxBracketLength);\n\n\t\t\t\t// it might still be the case that [currentTokenStart -> currentTokenEnd] contains multiple brackets\n\t\t\t\twhile(true) {\n\t\t\t\t\tlet foundBracket = BracketsUtils.findNextBracketInText(currentModeBrackets.forwardRegex, lineNumber, lineText.substring(currentTokenStart, currentTokenEnd), currentTokenStart);\n\t\t\t\t\tif (!foundBracket) {\n\t\t\t\t\t\t// there are no brackets in this text\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// check that we didn't hit a bracket too far away from position\n\t\t\t\t\tif (foundBracket.startColumn <= position.column && position.column <= foundBracket.endColumn) {\n\t\t\t\t\t\tlet foundBracketText = lineText.substring(foundBracket.startColumn - 1, foundBracket.endColumn - 1);\n\t\t\t\t\t\tlet r = this._matchFoundBracket(foundBracket, currentModeBrackets.textIsBracket[foundBracketText], currentModeBrackets.textIsOpenBracket[foundBracketText]);\n\n\t\t\t\t\t\t// check that we can actually match this bracket\n\t\t\t\t\t\tif (r) {\n\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentTokenStart = foundBracket.endColumn - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _matchFoundBracket(foundBracket:Range, data:editorCommon.IRichEditBracket, isOpen:boolean): [Range,Range] {\n\t\tif (isOpen) {\n\t\t\tlet matched = this._findMatchingBracketDown(data, foundBracket.getEndPosition());\n\t\t\tif (matched) {\n\t\t\t\treturn [foundBracket, matched];\n\t\t\t}\n\t\t} else {\n\t\t\tlet matched = this._findMatchingBracketUp(data, foundBracket.getStartPosition());\n\t\t\tif (matched) {\n\t\t\t\treturn [foundBracket, matched];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _findMatchingBracketUp(bracket:editorCommon.IRichEditBracket, position:Position): Range {\n\t\t// console.log('_findMatchingBracketUp: ', 'bracket: ', JSON.stringify(bracket), 'startPosition: ', String(position));\n\n\t\tlet modeId = bracket.modeId;\n\t\tlet reversedBracketRegex = bracket.reversedRegex;\n\t\tlet count = -1;\n\n\t\tfor (let lineNumber = position.lineNumber; lineNumber >= 1; lineNumber--) {\n\t\t\tlet lineTokens = this._lines[lineNumber - 1].getTokens();\n\t\t\tlet lineText = this._lines[lineNumber - 1].text;\n\t\t\tlet modeTransitions = this._lines[lineNumber - 1].getModeTransitions(this._mode);\n\t\t\tlet currentModeIndex = modeTransitions.length - 1;\n\t\t\tlet currentModeStart = modeTransitions[currentModeIndex].startIndex;\n\t\t\tlet currentModeId = modeTransitions[currentModeIndex].modeId;\n\n\t\t\tlet tokensLength = lineTokens.getTokenCount() - 1;\n\t\t\tlet currentTokenEnd = lineText.length;\n\t\t\tif (lineNumber === position.lineNumber) {\n\t\t\t\ttokensLength = lineTokens.findIndexOfOffset(position.column - 1);\n\t\t\t\tcurrentTokenEnd = position.column - 1;\n\n\t\t\t\tcurrentModeIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n\t\t\t\tcurrentModeStart = modeTransitions[currentModeIndex].startIndex;\n\t\t\t\tcurrentModeId = modeTransitions[currentModeIndex].modeId;\n\t\t\t}\n\n\t\t\tfor (let tokenIndex = tokensLength; tokenIndex >= 0; tokenIndex--) {\n\t\t\t\tlet currentTokenType = lineTokens.getTokenType(tokenIndex);\n\t\t\t\tlet currentTokenStart = lineTokens.getTokenStartIndex(tokenIndex);\n\n\t\t\t\tif (currentTokenStart < currentModeStart) {\n\t\t\t\t\tcurrentModeIndex--;\n\t\t\t\t\tcurrentModeStart = modeTransitions[currentModeIndex].startIndex;\n\t\t\t\t\tcurrentModeId = modeTransitions[currentModeIndex].modeId;\n\t\t\t\t}\n\n\t\t\t\tif (currentModeId === modeId && !ignoreBracketsInToken(currentTokenType)) {\n\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tlet r = BracketsUtils.findPrevBracketInToken(reversedBracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n\t\t\t\t\t\tif (!r) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1);\n\n\t\t\t\t\t\tif (hitText === bracket.open) {\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t} else if (hitText === bracket.close) {\n\t\t\t\t\t\t\tcount--;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (count === 0) {\n\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentTokenEnd = r.startColumn - 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcurrentTokenEnd = currentTokenStart;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _findMatchingBracketDown(bracket:editorCommon.IRichEditBracket, position:Position): Range {\n\t\t// console.log('_findMatchingBracketDown: ', 'bracket: ', JSON.stringify(bracket), 'startPosition: ', String(position));\n\n\t\tlet modeId = bracket.modeId;\n\t\tlet bracketRegex = bracket.forwardRegex;\n\t\tlet count = 1;\n\n\t\tfor (let lineNumber = position.lineNumber, lineCount = this.getLineCount(); lineNumber <= lineCount; lineNumber++) {\n\t\t\tlet lineTokens = this._lines[lineNumber - 1].getTokens();\n\t\t\tlet lineText = this._lines[lineNumber - 1].text;\n\t\t\tlet modeTransitions = this._lines[lineNumber - 1].getModeTransitions(this._mode);\n\t\t\tlet currentModeIndex = 0;\n\t\t\tlet nextModeStart = (currentModeIndex + 1 < modeTransitions.length ? modeTransitions[currentModeIndex + 1].startIndex : lineText.length + 1);\n\t\t\tlet currentModeId = modeTransitions[currentModeIndex].modeId;\n\n\t\t\tlet startTokenIndex = 0;\n\t\t\tlet currentTokenStart = lineTokens.getTokenStartIndex(startTokenIndex);\n\t\t\tif (lineNumber === position.lineNumber) {\n\t\t\t\tstartTokenIndex = lineTokens.findIndexOfOffset(position.column - 1);\n\t\t\t\tcurrentTokenStart = Math.max(currentTokenStart, position.column - 1);\n\n\t\t\t\tcurrentModeIndex = ModeTransition.findIndexInSegmentsArray(modeTransitions, position.column - 1);\n\t\t\t\tnextModeStart = (currentModeIndex + 1 < modeTransitions.length ? modeTransitions[currentModeIndex + 1].startIndex : lineText.length + 1);\n\t\t\t\tcurrentModeId = modeTransitions[currentModeIndex].modeId;\n\t\t\t}\n\n\t\t\tfor (let tokenIndex = startTokenIndex, tokensLength = lineTokens.getTokenCount(); tokenIndex < tokensLength; tokenIndex++) {\n\t\t\t\tlet currentTokenType = lineTokens.getTokenType(tokenIndex);\n\t\t\t\tlet currentTokenEnd = lineTokens.getTokenEndIndex(tokenIndex, lineText.length);\n\n\t\t\t\tif (currentTokenStart >= nextModeStart) {\n\t\t\t\t\tcurrentModeIndex++;\n\t\t\t\t\tnextModeStart = (currentModeIndex + 1 < modeTransitions.length ? modeTransitions[currentModeIndex + 1].startIndex : lineText.length + 1);\n\t\t\t\t\tcurrentModeId = modeTransitions[currentModeIndex].modeId;\n\t\t\t\t}\n\n\t\t\t\tif (currentModeId === modeId && !ignoreBracketsInToken(currentTokenType)) {\n\t\t\t\t\twhile (true) {\n\t\t\t\t\t\tlet r = BracketsUtils.findNextBracketInToken(bracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n\t\t\t\t\t\tif (!r) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1);\n\n\t\t\t\t\t\tif (hitText === bracket.open) {\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t} else if (hitText === bracket.close) {\n\t\t\t\t\t\t\tcount--;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (count === 0) {\n\t\t\t\t\t\t\treturn r;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentTokenStart = r.endColumn - 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcurrentTokenStart = currentTokenEnd;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic findPrevBracket(_position:editorCommon.IPosition): editorCommon.IFoundBracket {\n\t\tlet position = this.validatePosition(_position);\n\n\t\tlet reversedBracketRegex = /[\\(\\)\\[\\]\\{\\}]/; // TODO@Alex: use mode's brackets\n\n\t\tfor (let lineNumber = position.lineNumber; lineNumber >= 1; lineNumber--) {\n\t\t\tlet lineTokens = this._lines[lineNumber - 1].getTokens();\n\t\t\tlet lineText = this._lines[lineNumber - 1].text;\n\n\t\t\tlet tokensLength = lineTokens.getTokenCount() - 1;\n\t\t\tlet currentTokenEnd = lineText.length;\n\t\t\tif (lineNumber === position.lineNumber) {\n\t\t\t\ttokensLength = lineTokens.findIndexOfOffset(position.column - 1);\n\t\t\t\tcurrentTokenEnd = position.column - 1;\n\t\t\t}\n\n\t\t\tfor (let tokenIndex = tokensLength; tokenIndex >= 0; tokenIndex--) {\n\t\t\t\tlet currentTokenType = lineTokens.getTokenType(tokenIndex);\n\t\t\t\tlet currentTokenStart = lineTokens.getTokenStartIndex(tokenIndex);\n\n\t\t\t\tif (!ignoreBracketsInToken(currentTokenType)) {\n\t\t\t\t\tlet r = BracketsUtils.findPrevBracketInToken(reversedBracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n\t\t\t\t\tif (r) {\n\t\t\t\t\t\treturn this._toFoundBracket(r);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcurrentTokenEnd = currentTokenStart;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic findNextBracket(_position:editorCommon.IPosition): editorCommon.IFoundBracket {\n\t\tlet position = this.validatePosition(_position);\n\n\t\tlet bracketRegex = /[\\(\\)\\[\\]\\{\\}]/; // TODO@Alex: use mode's brackets\n\n\t\tfor (let lineNumber = position.lineNumber, lineCount = this.getLineCount(); lineNumber <= lineCount; lineNumber++) {\n\t\t\tlet lineTokens = this._lines[lineNumber - 1].getTokens();\n\t\t\tlet lineText = this._lines[lineNumber - 1].text;\n\n\t\t\tlet startTokenIndex = 0;\n\t\t\tlet currentTokenStart = lineTokens.getTokenStartIndex(startTokenIndex);\n\t\t\tif (lineNumber === position.lineNumber) {\n\t\t\t\tstartTokenIndex = lineTokens.findIndexOfOffset(position.column - 1);\n\t\t\t\tcurrentTokenStart = Math.max(currentTokenStart, position.column - 1);\n\t\t\t}\n\n\t\t\tfor (let tokenIndex = startTokenIndex, tokensLength = lineTokens.getTokenCount(); tokenIndex < tokensLength; tokenIndex++) {\n\t\t\t\tlet currentTokenType = lineTokens.getTokenType(tokenIndex);\n\t\t\t\tlet currentTokenEnd = lineTokens.getTokenEndIndex(tokenIndex, lineText.length);\n\n\t\t\t\tif (!ignoreBracketsInToken(currentTokenType)) {\n\t\t\t\t\tlet r = BracketsUtils.findNextBracketInToken(bracketRegex, lineNumber, lineText, currentTokenStart, currentTokenEnd);\n\t\t\t\t\tif (r) {\n\t\t\t\t\t\treturn this._toFoundBracket(r);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcurrentTokenStart = currentTokenEnd;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _toFoundBracket(r:Range): editorCommon.IFoundBracket {\n\t\tif (!r) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet text = this.getValueInRange(r);\n\n\t\t// TODO@Alex: use mode's brackets\n\t\tswitch (text) {\n\t\t\tcase '(': return { range: r, open: '(', close: ')', isOpen: true };\n\t\t\tcase ')': return { range: r, open: '(', close: ')', isOpen: false };\n\t\t\tcase '[': return { range: r, open: '[', close: ']', isOpen: true };\n\t\t\tcase ']': return { range: r, open: '[', close: ']', isOpen: false };\n\t\t\tcase '{': return { range: r, open: '{', close: '}', isOpen: true };\n\t\t\tcase '}': return { range: r, open: '{', close: '}', isOpen: false };\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport {ModelLine} from 'vs/editor/common/model/modelLine';\nimport {TextModel} from 'vs/editor/common/model/textModel';\nimport {TextModelWithTokens} from 'vs/editor/common/model/textModelWithTokens';\nimport {IMode} from 'vs/editor/common/modes';\nimport {Range} from 'vs/editor/common/core/range';\nimport {Position} from 'vs/editor/common/core/position';\n\nexport interface IMirrorModelEvents {\n\tcontentChanged: editorCommon.IModelContentChangedEvent[];\n}\n\nexport class AbstractMirrorModel extends TextModelWithTokens implements editorCommon.IMirrorModel {\n\n\t_associatedResource:URI;\n\n\tconstructor(allowedEventTypes:string[], versionId:number, value:editorCommon.IRawText, mode:IMode|TPromise<IMode>, associatedResource?:URI) {\n\t\tsuper(allowedEventTypes.concat([editorCommon.EventType.ModelDispose]), value, false, mode);\n\n\t\tthis._setVersionId(versionId);\n\t\tthis._associatedResource = associatedResource;\n\t}\n\n\tpublic getModeId(): string {\n\t\treturn this.getMode().getId();\n\t}\n\n\tpublic _constructLines(rawText:editorCommon.IRawText):void {\n\t\tsuper._constructLines(rawText);\n\t\t// Force EOL to be \\n\n\t\tthis._EOL = '\\n';\n\t}\n\n\tpublic destroy(): void {\n\t\tthis.dispose();\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.emit(editorCommon.EventType.ModelDispose);\n\t\tsuper.dispose();\n\t}\n\n\tpublic get uri(): URI {\n\t\treturn this._associatedResource;\n\t}\n\n\tpublic getRangeFromOffsetAndLength(offset:number, length:number): Range {\n\t\tlet startPosition = this.getPositionAt(offset);\n\t\tlet endPosition = this.getPositionAt(offset + length);\n\t\treturn new Range(\n\t\t\tstartPosition.lineNumber,\n\t\t\tstartPosition.column,\n\t\t\tendPosition.lineNumber,\n\t\t\tendPosition.column\n\t\t);\n\t}\n\n\tpublic getOffsetAndLengthFromRange(range:editorCommon.IRange):{offset:number; length:number;} {\n\t\tlet startOffset = this.getOffsetAt(new Position(range.startLineNumber, range.startColumn));\n\t\tlet endOffset = this.getOffsetAt(new Position(range.endLineNumber, range.endColumn));\n\t\treturn {\n\t\t\toffset: startOffset,\n\t\t\tlength: endOffset - startOffset\n\t\t};\n\t}\n\n\tpublic getPositionFromOffset(offset:number): Position {\n\t\treturn this.getPositionAt(offset);\n\t}\n\n\tpublic getOffsetFromPosition(position:editorCommon.IPosition): number {\n\t\treturn this.getOffsetAt(position);\n\t}\n\n\tpublic getLineStart(lineNumber:number): number {\n\t\tif (lineNumber < 1) {\n\t\t\tlineNumber = 1;\n\t\t}\n\t\tif (lineNumber > this.getLineCount()) {\n\t\t\tlineNumber = this.getLineCount();\n\t\t}\n\t\treturn this.getOffsetAt(new Position(lineNumber, 1));\n\t}\n\n\tpublic getAllWordsWithRange(): editorCommon.IRangeWithText[] {\n\t\tif (this._lines.length > 10000) {\n\t\t\t// This is a very heavy method, unavailable for very heavy models\n\t\t\treturn [];\n\t\t}\n\n\t\tvar result:editorCommon.IRangeWithText[] = [],\n\t\t\ti:number;\n\n\t\tvar toTextRange = function (info: editorCommon.IWordRange) {\n\t\t\tvar s = line.text.substring(info.start, info.end);\n\t\t\tvar r = { startLineNumber: i + 1, startColumn: info.start + 1, endLineNumber: i + 1, endColumn: info.end + 1 };\n\t\t\tresult.push({ text: s, range: r});\n\t\t};\n\n\t\tfor(i = 0; i < this._lines.length; i++) {\n\t\t\tvar line = this._lines[i];\n\t\t\tthis.wordenize(line.text).forEach(toTextRange);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic getAllWords(): string[] {\n\t\tvar result:string[] = [];\n\t\tthis._lines.forEach((line) => {\n\t\t\tthis.wordenize(line.text).forEach((info) => {\n\t\t\t\tresult.push(line.text.substring(info.start, info.end));\n\t\t\t});\n\t\t});\n\t\treturn result;\n\t}\n\n\tpublic getAllUniqueWords(skipWordOnce?:string) : string[] {\n\t\tvar foundSkipWord = false;\n\t\tvar uniqueWords = {};\n\t\treturn this.getAllWords().filter((word) => {\n\t\t\tif (skipWordOnce && !foundSkipWord && skipWordOnce === word) {\n\t\t\t\tfoundSkipWord = true;\n\t\t\t\treturn false;\n\t\t\t} else if (uniqueWords[word]) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tuniqueWords[word] = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n//\t// TODO@Joh, TODO@Alex - remove these and make sure the super-things work\n\tprivate wordenize(content:string): editorCommon.IWordRange[] {\n\t\tvar result:editorCommon.IWordRange[] = [];\n\t\tvar match:RegExpExecArray;\n\t\tvar wordsRegexp = this._getWordDefinition();\n\t\twhile (match = wordsRegexp.exec(content)) {\n\t\t\tresult.push({ start: match.index, end: match.index + match[0].length });\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport function createTestMirrorModelFromString(value:string, mode:IMode = null, associatedResource?:URI): MirrorModel {\n\treturn new MirrorModel(0, TextModel.toRawText(value, TextModel.DEFAULT_CREATION_OPTIONS), mode, associatedResource);\n}\n\nexport class MirrorModel extends AbstractMirrorModel implements editorCommon.IMirrorModel {\n\n\tconstructor(versionId:number, value:editorCommon.IRawText, mode:IMode|TPromise<IMode>, associatedResource?:URI) {\n\t\tsuper(['changed'], versionId, value, mode, associatedResource);\n\t}\n\n\tpublic onEvents(events:IMirrorModelEvents) : void {\n\t\tlet changed = false;\n\t\tfor (let i = 0, len = events.contentChanged.length; i < len; i++) {\n\t\t\tlet contentChangedEvent = events.contentChanged[i];\n\n\t\t\tthis._setVersionId(contentChangedEvent.versionId);\n\t\t\tswitch (contentChangedEvent.changeType) {\n\t\t\t\tcase editorCommon.EventType.ModelRawContentChangedFlush:\n\t\t\t\t\tthis._onLinesFlushed(<editorCommon.IModelContentChangedFlushEvent>contentChangedEvent);\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase editorCommon.EventType.ModelRawContentChangedLinesDeleted:\n\t\t\t\t\tthis._onLinesDeleted(<editorCommon.IModelContentChangedLinesDeletedEvent>contentChangedEvent);\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase editorCommon.EventType.ModelRawContentChangedLinesInserted:\n\t\t\t\t\tthis._onLinesInserted(<editorCommon.IModelContentChangedLinesInsertedEvent>contentChangedEvent);\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase editorCommon.EventType.ModelRawContentChangedLineChanged:\n\t\t\t\t\tthis._onLineChanged(<editorCommon.IModelContentChangedLineChangedEvent>contentChangedEvent);\n\t\t\t\t\tchanged = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (changed) {\n\t\t\tthis.emit('changed', {});\n\t\t}\n\t}\n\n\tprivate _onLinesFlushed(e:editorCommon.IModelContentChangedFlushEvent): void {\n\t\t// Flush my lines\n\t\tthis._constructLines(e.detail);\n\t\tthis._resetTokenizationState();\n\t}\n\n\tprivate _onLineChanged(e:editorCommon.IModelContentChangedLineChangedEvent) : void {\n\t\tthis._lines[e.lineNumber - 1].applyEdits({}, [{\n\t\t\tstartColumn: 1,\n\t\t\tendColumn: Number.MAX_VALUE,\n\t\t\ttext: e.detail,\n\t\t\tforceMoveMarkers: false\n\t\t}]);\n\t\tif (this._lineStarts) {\n\t\t\t// update prefix sum\n\t\t\tthis._lineStarts.changeValue(e.lineNumber - 1, this._lines[e.lineNumber - 1].text.length + this._EOL.length);\n\t\t}\n\n\t\tthis._invalidateLine(e.lineNumber - 1);\n\t}\n\n\tprivate _onLinesDeleted(e:editorCommon.IModelContentChangedLinesDeletedEvent) : void {\n\t\tvar fromLineIndex = e.fromLineNumber - 1,\n\t\t\ttoLineIndex = e.toLineNumber - 1;\n\n\t\t// Save first line's state\n\t\tvar firstLineState = this._lines[fromLineIndex].getState();\n\n\t\tthis._lines.splice(fromLineIndex, toLineIndex - fromLineIndex + 1);\n\t\tif (this._lineStarts) {\n\t\t\t// update prefix sum\n\t\t\tthis._lineStarts.removeValues(fromLineIndex, toLineIndex - fromLineIndex + 1);\n\t\t}\n\n\t\tif (fromLineIndex < this._lines.length) {\n\t\t\t// This check is always true in real world, but the tests forced this\n\n\t\t\t// Restore first line's state\n\t\t\tthis._lines[fromLineIndex].setState(firstLineState);\n\n\t\t\t// Invalidate line\n\t\t\tthis._invalidateLine(fromLineIndex);\n\t\t}\n\t}\n\n\tprivate _onLinesInserted(e:editorCommon.IModelContentChangedLinesInsertedEvent) : void {\n\t\tvar lineIndex:number,\n\t\t\ti:number,\n\t\t\tsplitLines = e.detail.split('\\n');\n\n\t\tlet newLengths:number[] = [];\n\t\tfor (lineIndex = e.fromLineNumber - 1, i = 0; lineIndex < e.toLineNumber; lineIndex++, i++) {\n\t\t\tthis._lines.splice(lineIndex, 0, new ModelLine(0, splitLines[i]));\n\t\t\tnewLengths.push(splitLines[i].length + this._EOL.length);\n\t\t}\n\t\tif (this._lineStarts) {\n\t\t\t// update prefix sum\n\t\t\tthis._lineStarts.insertValues(e.fromLineNumber - 1, newLengths);\n\t\t}\n\n\t\tif (e.fromLineNumber >= 2) {\n\t\t\t// This check is always true in real world, but the tests forced this\n\t\t\tthis._invalidateLine(e.fromLineNumber - 2);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {illegalArgument} from 'vs/base/common/errors';\nimport * as instantiation from './instantiation';\n\nexport class AbstractDescriptor<T> {\n\n\tconstructor(private _staticArguments: any[]) {\n\t\t// empty\n\t}\n\n\tpublic appendStaticArguments(more: any[]): void {\n\t\tthis._staticArguments.push.apply(this._staticArguments, more);\n\t}\n\n\tpublic staticArguments(): any[];\n\tpublic staticArguments(nth: number): any;\n\tpublic staticArguments(nth?: number): any[] {\n\t\tif (isNaN(nth)) {\n\t\t\treturn this._staticArguments.slice(0);\n\t\t} else {\n\t\t\treturn this._staticArguments[nth];\n\t\t}\n\t}\n\n\t_validate(type: T): void {\n\t\tif (!type) {\n\t\t\tthrow illegalArgument('can not be falsy');\n\t\t}\n\t}\n}\n\nexport class SyncDescriptor<T> extends AbstractDescriptor<T> {\n\n\tconstructor(private _ctor: any, ...staticArguments: any[]) {\n\t\tsuper(staticArguments);\n\t}\n\n\tpublic get ctor(): any {\n\t\treturn this._ctor;\n\t}\n\n\tprotected bind(...moreStaticArguments): SyncDescriptor<T> {\n\t\tlet allArgs = [];\n\t\tallArgs = allArgs.concat(this.staticArguments());\n\t\tallArgs = allArgs.concat(moreStaticArguments);\n\t\treturn new SyncDescriptor<T>(this._ctor, ...allArgs);\n\t}\n}\n\nexport interface CreateSyncFunc {\n\n\t<T>(ctor: instantiation.IConstructorSignature0<T>): SyncDescriptor0<T>;\n\n\t<A1, T>(ctor: instantiation.IConstructorSignature1<A1, T>): SyncDescriptor1<A1, T>;\n\t<A1, T>(ctor: instantiation.IConstructorSignature1<A1, T>, a1: A1): SyncDescriptor0<T>;\n\n\t<A1, A2, T>(ctor: instantiation.IConstructorSignature2<A1, A2, T>): SyncDescriptor2<A1, A2, T>;\n\t<A1, A2, T>(ctor: instantiation.IConstructorSignature2<A1, A2, T>, a1: A1): SyncDescriptor1<A2, T>;\n\t<A1, A2, T>(ctor: instantiation.IConstructorSignature2<A1, A2, T>, a1: A1, a2: A2): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>): SyncDescriptor3<A1, A2, A3, T>;\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>, a1: A1): SyncDescriptor2<A2, A3, T>;\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>, a1: A1, a2: A2): SyncDescriptor1<A3, T>;\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>): SyncDescriptor4<A1, A2, A3, A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1): SyncDescriptor3<A2, A3, A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1, a2: A2): SyncDescriptor2<A3, A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor1<A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>): SyncDescriptor5<A1, A2, A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1): SyncDescriptor4<A2, A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2): SyncDescriptor3<A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor2<A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor1<A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>): SyncDescriptor6<A1, A2, A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1): SyncDescriptor5<A2, A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2): SyncDescriptor4<A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor3<A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor2<A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor1<A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>): SyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1): SyncDescriptor6<A2, A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2): SyncDescriptor5<A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor4<A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor3<A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor2<A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor1<A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>): SyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1): SyncDescriptor7<A2, A3, A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2): SyncDescriptor6<A3, A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor5<A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor4<A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor3<A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor2<A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor1<A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): SyncDescriptor0<T>;\n}\nexport const createSyncDescriptor: CreateSyncFunc = <T>(ctor: any, ...staticArguments: any[]): any => {\n\treturn new SyncDescriptor<T>(ctor, ...staticArguments);\n};\n\nexport interface SyncDescriptor0<T> {\n\tctor: any;\n\tbind(): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor1<A1, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor2<A1, A2, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor1<A2, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor3<A1, A2, A3, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor2<A2, A3, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor1<A3, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor4<A1, A2, A3, A4, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor3<A2, A3, A4, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor2<A3, A4, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor1<A4, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor5<A1, A2, A3, A4, A5, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor4<A2, A3, A4, A5, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor3<A3, A4, A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor2<A4, A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor1<A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor6<A1, A2, A3, A4, A5, A6, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor5<A2, A3, A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor4<A3, A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor3<A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor2<A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor1<A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor6<A2, A3, A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor5<A3, A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor4<A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor3<A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor2<A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor1<A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor7<A2, A3, A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor6<A3, A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor5<A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor4<A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor3<A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor2<A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor1<A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): SyncDescriptor0<T>;\n}\n\nexport class AsyncDescriptor<T> extends AbstractDescriptor<T> implements AsyncDescriptor0<T> {\n\n\tpublic static create<T>(moduleName: string, ctorName: string): AsyncDescriptor<T> {\n\t\treturn new AsyncDescriptor<T>(moduleName, ctorName);\n\t}\n\n\tconstructor(private _moduleName: string, private _ctorName?: string, ...staticArguments: any[]) {\n\t\tsuper(staticArguments);\n\t\tif (typeof _moduleName !== 'string') {\n\t\t\tthrow new Error('Invalid AsyncDescriptor arguments, expected `moduleName` to be a string!');\n\t\t}\n\t}\n\n\tpublic get moduleName(): string {\n\t\treturn this._moduleName;\n\t}\n\n\tpublic get ctorName(): string {\n\t\treturn this._ctorName;\n\t}\n\n\tbind(...moreStaticArguments): AsyncDescriptor<T> {\n\t\tlet allArgs = [];\n\t\tallArgs = allArgs.concat(this.staticArguments());\n\t\tallArgs = allArgs.concat(moreStaticArguments);\n\t\treturn new AsyncDescriptor<T>(this.moduleName, this.ctorName, ...allArgs);\n\t}\n}\n\nexport interface CreateAsyncFunc0 {\n\t<T>(moduleName: string, ctorName: string): AsyncDescriptor0<T>;\n\t<A1, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor0<T>;\n\t<A1, A2, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor0<T>;\n\t<A1, A2, A3, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3): AsyncDescriptor0<T>;\n\t<A1, A2, A3, A4, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor0<T>;\n\t<A1, A2, A3, A4, A5, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor0<T>;\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): AsyncDescriptor0<T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): AsyncDescriptor0<T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): AsyncDescriptor0<T>;\n}\n\nexport interface CreateAsyncFunc1 {\n\t<A1, T>(moduleName: string, ctorName: string): AsyncDescriptor1<A1, T>;\n\t<A1, A2, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor1<A2, T>;\n\t<A1, A2, A3, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor1<A3, T>;\n\t<A1, A2, A3, A4, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3): AsyncDescriptor1<A4, T>;\n\t<A1, A2, A3, A4, A5, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor1<A5, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor1<A6, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): AsyncDescriptor1<A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): AsyncDescriptor1<A8, T>;\n}\n\nexport interface CreateAsyncFunc2 {\n\t<A1, A2, T>(moduleName: string, ctorName: string): AsyncDescriptor2<A1, A2, T>;\n\t<A1, A2, A3, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor2<A2, A3, T>;\n\t<A1, A2, A3, A4, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor2<A3, A4, T>;\n\t<A1, A2, A3, A4, A5, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3): AsyncDescriptor2<A4, A5, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor2<A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor2<A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): AsyncDescriptor2<A7, A8, T>;\n}\n\nexport interface CreateAsyncFunc3 {\n\t<A1, A2, A3, T>(moduleName: string, ctorName: string): AsyncDescriptor3<A1, A2, A3, T>;\n\t<A1, A2, A3, A4, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor3<A2, A3, A4, T>;\n\t<A1, A2, A3, A4, A5, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor3<A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3): AsyncDescriptor3<A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor3<A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor3<A6, A7, A8, T>;\n}\n\nexport interface CreateAsyncFunc4 {\n\t<A1, A2, A3, A4, T>(moduleName: string, ctorName: string): AsyncDescriptor4<A1, A2, A3, A4, T>;\n\t<A1, A2, A3, A4, A5, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor4<A2, A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor4<A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3): AsyncDescriptor4<A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor4<A5, A6, A7, A8, T>;\n}\n\nexport interface CreateAsyncFunc5 {\n\t<A1, A2, A3, A4, A5, T>(moduleName: string, ctorName: string): AsyncDescriptor5<A1, A2, A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor5<A2, A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor5<A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2, a3: A3): AsyncDescriptor5<A4, A5, A6, A7, A8, T>;\n}\n\nexport interface CreateAsyncFunc6 {\n\t<A1, A2, A3, A4, A5, A6, T>(moduleName: string, ctorName: string): AsyncDescriptor6<A1, A2, A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor6<A2, A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1, a2: A2): AsyncDescriptor6<A3, A4, A5, A6, A7, A8, T>;\n}\n\nexport interface CreateAsyncFunc7 {\n\t<A1, A2, A3, A4, A5, A6, A7, T>(moduleName: string, ctorName: string): AsyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string, a1: A1): AsyncDescriptor7<A2, A3, A4, A5, A6, A7, A8, T>;\n}\n\nexport interface CreateAsyncFunc8 {\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(moduleName: string, ctorName: string): AsyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T>;\n}\n\nlet _createAsyncDescriptor = <T>(moduleName: string, ctorName: string, ...staticArguments: any[]): any => {\n\treturn new AsyncDescriptor<T>(moduleName, ctorName, ...staticArguments);\n};\nexport const createAsyncDescriptor0: CreateAsyncFunc0 = _createAsyncDescriptor;\nexport const createAsyncDescriptor1: CreateAsyncFunc1 = _createAsyncDescriptor;\nexport const createAsyncDescriptor2: CreateAsyncFunc2 = _createAsyncDescriptor;\nexport const createAsyncDescriptor3: CreateAsyncFunc3 = _createAsyncDescriptor;\nexport const createAsyncDescriptor4: CreateAsyncFunc4 = _createAsyncDescriptor;\nexport const createAsyncDescriptor5: CreateAsyncFunc5 = _createAsyncDescriptor;\nexport const createAsyncDescriptor6: CreateAsyncFunc6 = _createAsyncDescriptor;\nexport const createAsyncDescriptor7: CreateAsyncFunc7 = _createAsyncDescriptor;\n\nexport interface AsyncDescriptor0<T> {\n\tmoduleName: string;\n\tbind(): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor1<A1, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor2<A1, A2, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor1<A2, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor3<A1, A2, A3, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor2<A2, A3, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor1<A3, T>;\n\tbind(a1: A1, a2: A2, a3: A3): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor4<A1, A2, A3, A4, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor3<A2, A3, A4, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor2<A3, A4, T>;\n\tbind(a1: A1, a2: A2, a3: A3): AsyncDescriptor1<A4, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor5<A1, A2, A3, A4, A5, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor4<A2, A3, A4, A5, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor3<A3, A4, A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3): AsyncDescriptor2<A4, A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor1<A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor6<A1, A2, A3, A4, A5, A6, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor5<A2, A3, A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor4<A3, A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3): AsyncDescriptor3<A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor2<A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor1<A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor6<A2, A3, A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor5<A3, A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3): AsyncDescriptor4<A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor3<A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor2<A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): AsyncDescriptor1<A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): AsyncDescriptor0<T>;\n}\nexport interface AsyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T> {\n\tmoduleName: string;\n\tbind(a1: A1): AsyncDescriptor7<A2, A3, A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2): AsyncDescriptor6<A3, A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3): AsyncDescriptor5<A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): AsyncDescriptor4<A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): AsyncDescriptor3<A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): AsyncDescriptor2<A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): AsyncDescriptor1<A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): AsyncDescriptor0<T>;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ServiceCollection} from './serviceCollection';\nimport * as descriptors from './descriptors';\n\n// ------ internal util\n\nexport namespace _util {\n\n\texport const DI_TARGET = '$di$target';\n\texport const DI_DEPENDENCIES = '$di$dependencies';\n\n\texport function getServiceDependencies(ctor: any): { id: ServiceIdentifier<any>, index: number, optional: boolean }[] {\n\t\treturn ctor[DI_DEPENDENCIES] || [];\n\t}\n}\n\n// --- interfaces ------\n\nexport interface IConstructorSignature0<T> {\n\tnew (...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature1<A1, T> {\n\tnew (first: A1, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature2<A1, A2, T> {\n\tnew (first: A1, second: A2, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature3<A1, A2, A3, T> {\n\tnew (first: A1, second: A2, third: A3, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature4<A1, A2, A3, A4, T> {\n\tnew (first: A1, second: A2, third: A3, forth: A4, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature5<A1, A2, A3, A4, A5, T> {\n\tnew (first: A1, second: A2, third: A3, forth: A4, fifth: A5, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature6<A1, A2, A3, A4, A5, A6, T> {\n\tnew (first: A1, second: A2, third: A3, forth: A4, fifth: A5, sixth: A6, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T> {\n\tnew (first: A1, second: A2, third: A3, forth: A4, fifth: A5, sixth: A6, seventh: A7, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T> {\n\tnew (first: A1, second: A2, third: A3, forth: A4, fifth: A5, sixth: A6, seventh: A7, eigth: A8, ...services: { serviceId: ServiceIdentifier<any>; }[]): T;\n}\n\nexport interface ServicesAccessor {\n\tget<T>(id: ServiceIdentifier<T>, isOptional?: typeof optional): T;\n}\n\nexport interface IFunctionSignature0<R> {\n\t(accessor: ServicesAccessor): R;\n}\n\nexport interface IFunctionSignature1<A1, R> {\n\t(accessor: ServicesAccessor, first: A1): R;\n}\n\nexport interface IFunctionSignature2<A1, A2, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2): R;\n}\n\nexport interface IFunctionSignature3<A1, A2, A3, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2, third: A3): R;\n}\n\nexport interface IFunctionSignature4<A1, A2, A3, A4, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2, third: A3, forth: A4): R;\n}\n\nexport interface IFunctionSignature5<A1, A2, A3, A4, A5, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2, third: A3, forth: A4, fifth: A5): R;\n}\n\nexport interface IFunctionSignature6<A1, A2, A3, A4, A5, A6, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2, third: A3, forth: A4, fifth: A5, sixth: A6): R;\n}\n\nexport interface IFunctionSignature7<A1, A2, A3, A4, A5, A6, A7, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2, third: A3, forth: A4, fifth: A5, sixth: A6, seventh: A7): R;\n}\n\nexport interface IFunctionSignature8<A1, A2, A3, A4, A5, A6, A7, A8, R> {\n\t(accessor: ServicesAccessor, first: A1, second: A2, third: A3, forth: A4, fifth: A5, sixth: A6, seventh: A7, eigth: A8): R;\n}\n\nexport var IInstantiationService = createDecorator<IInstantiationService>('instantiationService');\n\nexport interface IInstantiationService {\n\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Synchronously creates an instance that is denoted by\n\t * the descriptor\n\t */\n\tcreateInstance<T>(descriptor: descriptors.SyncDescriptor0<T>): T;\n\tcreateInstance<A1, T>(descriptor: descriptors.SyncDescriptor1<A1, T>, a1: A1): T;\n\tcreateInstance<A1, A2, T>(descriptor: descriptors.SyncDescriptor2<A1, A2, T>, a1: A1, a2: A2): T;\n\tcreateInstance<A1, A2, A3, T>(descriptor: descriptors.SyncDescriptor3<A1, A2, A3, T>, a1: A1, a2: A2, a3: A3): T;\n\tcreateInstance<A1, A2, A3, A4, T>(descriptor: descriptors.SyncDescriptor4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3, a4: A4): T;\n\tcreateInstance<A1, A2, A3, A4, A5, T>(descriptor: descriptors.SyncDescriptor5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, T>(descriptor: descriptors.SyncDescriptor6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, T>(descriptor: descriptors.SyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, A8, T>(descriptor: descriptors.SyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): T;\n\n\tcreateInstance<T>(ctor: IConstructorSignature0<T>): T;\n\tcreateInstance<A1, T>(ctor: IConstructorSignature1<A1, T>, first: A1): T;\n\tcreateInstance<A1, A2, T>(ctor: IConstructorSignature2<A1, A2, T>, first: A1, second: A2): T;\n\tcreateInstance<A1, A2, A3, T>(ctor: IConstructorSignature3<A1, A2, A3, T>, first: A1, second: A2, third: A3): T;\n\tcreateInstance<A1, A2, A3, A4, T>(ctor: IConstructorSignature4<A1, A2, A3, A4, T>, first: A1, second: A2, third: A3, fourth: A4): T;\n\tcreateInstance<A1, A2, A3, A4, A5, T>(ctor: IConstructorSignature5<A1, A2, A3, A4, A5, T>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, T>(ctor: IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, T>(ctor: IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, seventh: A7): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, seventh: A7, eigth: A8): T;\n\n\t/**\n\t * Asynchronously creates an instance that is denoted by\n\t * the descriptor\n\t */\n\tcreateInstance<T>(descriptor: descriptors.AsyncDescriptor0<T>): TPromise<T>;\n\tcreateInstance<A1, T>(descriptor: descriptors.AsyncDescriptor1<A1, T>, a1: A1): TPromise<T>;\n\tcreateInstance<A1, A2, T>(descriptor: descriptors.AsyncDescriptor2<A1, A2, T>, a1: A1, a2: A2): TPromise<T>;\n\tcreateInstance<A1, A2, A3, T>(descriptor: descriptors.AsyncDescriptor3<A1, A2, A3, T>, a1: A1, a2: A2, a3: A3): TPromise<T>;\n\tcreateInstance<A1, A2, A3, A4, T>(descriptor: descriptors.AsyncDescriptor4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3, a4: A4): TPromise<T>;\n\tcreateInstance<A1, A2, A3, A4, A5, T>(descriptor: descriptors.AsyncDescriptor5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): TPromise<T>;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, T>(descriptor: descriptors.AsyncDescriptor6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): TPromise<T>;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, T>(descriptor: descriptors.AsyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): TPromise<T>;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, A8, T>(descriptor: descriptors.AsyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): TPromise<T>;\n\n\t/**\n\t *\n\t */\n\tinvokeFunction<R>(ctor: IFunctionSignature0<R>): R;\n\tinvokeFunction<A1, R>(ctor: IFunctionSignature1<A1, R>, first: A1): R;\n\tinvokeFunction<A1, A2, R>(ctor: IFunctionSignature2<A1, A2, R>, first: A1, second: A2): R;\n\tinvokeFunction<A1, A2, A3, R>(ctor: IFunctionSignature3<A1, A2, A3, R>, first: A1, second: A2, third: A3): R;\n\tinvokeFunction<A1, A2, A3, A4, R>(ctor: IFunctionSignature4<A1, A2, A3, A4, R>, first: A1, second: A2, third: A3, fourth: A4): R;\n\tinvokeFunction<A1, A2, A3, A4, A5, R>(ctor: IFunctionSignature5<A1, A2, A3, A4, A5, R>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5): R;\n\tinvokeFunction<A1, A2, A3, A4, A5, A6, R>(ctor: IFunctionSignature6<A1, A2, A3, A4, A5, A6, R>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6): R;\n\tinvokeFunction<A1, A2, A3, A4, A5, A6, A7, R>(ctor: IFunctionSignature7<A1, A2, A3, A4, A5, A6, A7, R>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, seventh: A7): R;\n\tinvokeFunction<A1, A2, A3, A4, A5, A6, A7, A8, R>(ctor: IFunctionSignature8<A1, A2, A3, A4, A5, A6, A7, A8, R>, first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, seventh: A7, eigth: A8): R;\n\n\t/**\n\t * Creates a child of this service which inherts all current services\n\t * and adds/overwrites the given services\n\t */\n\tcreateChild(services: ServiceCollection): IInstantiationService;\n}\n\n\n/**\n * Identifies a service of type T\n */\nexport interface ServiceIdentifier<T> {\n\t(...args: any[]): void;\n\ttype: T;\n}\n\nfunction storeServiceDependency(id: Function, target: Function, index: number, optional: boolean): void {\n\tif (target[_util.DI_TARGET] === target) {\n\t\ttarget[_util.DI_DEPENDENCIES].push({ id, index, optional });\n\t} else {\n\t\ttarget[_util.DI_DEPENDENCIES] = [{ id, index, optional }];\n\t\ttarget[_util.DI_TARGET] = target;\n\t}\n}\n\n/**\n * A *only* valid way to create a {{ServiceIdentifier}}.\n */\nexport function createDecorator<T>(serviceId: string): { (...args: any[]): void; type: T; } {\n\n\tlet id = function(target: Function, key: string, index: number): any {\n\t\tif (arguments.length !== 3) {\n\t\t\tthrow new Error('@IServiceName-decorator can only be used to decorate a parameter');\n\t\t}\n\t\tstoreServiceDependency(id, target, index, false);\n\t};\n\n\tid.toString = () => serviceId;\n\n\treturn <any>id;\n}\n\n/**\n * Mark a service dependency as optional.\n */\nexport function optional<T>(serviceIdentifier: ServiceIdentifier<T>) {\n\n\treturn function (target: Function, key: string, index: number){\n\t\tif (arguments.length !== 3) {\n\t\t\tthrow new Error('@optional-decorator can only be used to decorate a parameter');\n\t\t}\n\t\tstoreServiceDependency(serviceIdentifier, target, index, true);\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ServiceIdentifier, createDecorator} from 'vs/platform/instantiation/common/instantiation';\nimport {IRawText} from 'vs/editor/common/editorCommon';\n\nexport var ICompatWorkerService = createDecorator<ICompatWorkerService>('compatWorkerService');\n\nexport interface IRawModelData {\n\turl: URI;\n\tversionId: number;\n\tvalue: IRawText;\n\tmodeId: string;\n}\n\nexport interface ICompatMode {\n\tgetId(): string;\n\tcompatWorkerService: ICompatWorkerService;\n}\n\nexport interface ICompatWorkerService {\n\tserviceId: ServiceIdentifier<any>;\n\tisInMainThread: boolean;\n\tregisterCompatMode(compatMode:ICompatMode): void;\n\tCompatWorker(obj: ICompatMode, methodName: string, target: Function, param: any[]): TPromise<any>;\n}\n\nfunction findMember(proto: any, target: any): string {\n\tfor (let i in proto) {\n\t\tif (proto[i] === target) {\n\t\t\treturn i;\n\t\t}\n\t}\n\tthrow new Error('Member not found in prototype');\n}\n\nexport function CompatWorkerAttr(type: Function, target: Function): void {\n\tlet methodName = findMember(type.prototype, target);\n\ttype.prototype[methodName] = function(...param: any[]) {\n\t\tlet obj = <ICompatMode>this;\n\t\treturn obj.compatWorkerService.CompatWorker(obj, methodName, target, param);\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ServiceIdentifier, createDecorator} from 'vs/platform/instantiation/common/instantiation';\nimport {IChange, ILineChange, IPosition, IRange} from 'vs/editor/common/editorCommon';\nimport {IInplaceReplaceSupportResult, ILink, ISuggestResult} from 'vs/editor/common/modes';\n\nexport var ID_EDITOR_WORKER_SERVICE = 'editorWorkerService';\nexport var IEditorWorkerService = createDecorator<IEditorWorkerService>(ID_EDITOR_WORKER_SERVICE);\n\nexport interface IEditorWorkerService {\n\tserviceId: ServiceIdentifier<any>;\n\n\tcomputeDiff(original:URI, modified:URI, ignoreTrimWhitespace:boolean):TPromise<ILineChange[]>;\n\tcomputeDirtyDiff(original:URI, modified:URI, ignoreTrimWhitespace:boolean):TPromise<IChange[]>;\n\tcomputeLinks(resource:URI):TPromise<ILink[]>;\n\ttextualSuggest(resource: URI, position: IPosition): TPromise<ISuggestResult[]>;\n\tnavigateValueSet(resource: URI, range:IRange, up:boolean): TPromise<IInplaceReplaceSupportResult>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Event from 'vs/base/common/event';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ServiceIdentifier, createDecorator} from 'vs/platform/instantiation/common/instantiation';\nimport * as modes from 'vs/editor/common/modes';\n\nexport var IModeService = createDecorator<IModeService>('modeService');\n\nexport interface IModeLookupResult {\n\tmodeId: string;\n\tisInstantiated: boolean;\n}\n\nexport interface ILanguageExtensionPoint {\n\tid: string;\n\textensions?: string[];\n\tfilenames?: string[];\n\tfilenamePatterns?: string[];\n\tfirstLine?: string;\n\taliases?: string[];\n\tmimetypes?: string[];\n\tconfiguration?: string;\n}\n\nexport interface IValidLanguageExtensionPoint {\n\tid: string;\n\textensions: string[];\n\tfilenames: string[];\n\tfilenamePatterns: string[];\n\tfirstLine: string;\n\taliases: string[];\n\tmimetypes: string[];\n\tconfiguration: string;\n}\n\nexport interface IModeService {\n\tserviceId: ServiceIdentifier<any>;\n\n\tonDidAddModes: Event<string[]>;\n\tonDidCreateMode: Event<modes.IMode>;\n\n\tconfigureMode(modeName: string, options: any): void;\n\tconfigureModeById(modeId: string, options: any): void;\n\tconfigureAllModes(config:any): void;\n\tgetConfigurationForMode(modeId:string): any;\n\n\t// --- reading\n\tisRegisteredMode(mimetypeOrModeId: string): boolean;\n\tisCompatMode(modeId: string): boolean;\n\tgetRegisteredModes(): string[];\n\tgetRegisteredLanguageNames(): string[];\n\tgetExtensions(alias: string): string[];\n\tgetMimeForMode(modeId: string): string;\n\tgetLanguageName(modeId:string): string;\n\tgetModeIdForLanguageName(alias: string): string;\n\tgetModeIdByFilenameOrFirstLine(filename: string, firstLine?: string): string;\n\tgetModeId(commaSeparatedMimetypesOrCommaSeparatedIds: string): string;\n\tgetConfigurationFiles(modeId: string): string[];\n\n\t// --- instantiation\n\tlookup(commaSeparatedMimetypesOrCommaSeparatedIds: string): IModeLookupResult[];\n\tgetMode(commaSeparatedMimetypesOrCommaSeparatedIds: string): modes.IMode;\n\tgetOrCreateMode(commaSeparatedMimetypesOrCommaSeparatedIds: string): TPromise<modes.IMode>;\n\tgetOrCreateModeByLanguageName(languageName: string): TPromise<modes.IMode>;\n\tgetOrCreateModeByFilenameOrFirstLine(filename: string, firstLine?:string): TPromise<modes.IMode>;\n\n\tregisterTokenizationSupport(modeId: string, callback: (mode: modes.IMode) => modes.ITokenizationSupport): IDisposable;\n\tregisterTokenizationSupport2(modeId: string, support: modes.TokensProvider): IDisposable;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Event from 'vs/base/common/event';\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ServiceIdentifier, createDecorator} from 'vs/platform/instantiation/common/instantiation';\nimport {IModel, IRawText, ITextModelCreationOptions} from 'vs/editor/common/editorCommon';\nimport {IMode} from 'vs/editor/common/modes';\n\nexport var IModelService = createDecorator<IModelService>('modelService');\n\nexport interface IModelService {\n\tserviceId: ServiceIdentifier<any>;\n\n\tcreateModel(value:string | IRawText, modeOrPromise:TPromise<IMode>|IMode, resource: URI): IModel;\n\n\tdestroyModel(resource: URI): void;\n\n\tgetModels(): IModel[];\n\n\tgetCreationOptions(): ITextModelCreationOptions;\n\n\tgetModel(resource: URI): IModel;\n\n\tonModelAdded: Event<IModel>;\n\n\tonModelRemoved: Event<IModel>;\n\n\tonModelModeChanged: Event<{ model: IModel; oldModeId: string; }>;\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {EmitterEvent, ListenerCallback} from 'vs/base/common/eventEmitter';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport URI from 'vs/base/common/uri';\nimport {ServiceIdentifier, createDecorator} from 'vs/platform/instantiation/common/instantiation';\nimport {IMirrorModel} from 'vs/editor/common/editorCommon';\n\n// Resource Service\n\nexport var ResourceEvents = {\n\tADDED: 'resource.added',\n\tREMOVED: 'resource.removed',\n\tCHANGED: 'resource.changed'\n};\n\nexport interface IResourceAddedEvent {\n\turl: URI;\n\taddedElement: IMirrorModel;\n}\n\nexport interface IResourceRemovedEvent {\n\turl: URI;\n\tremovedElement: IMirrorModel;\n}\n\nexport interface IResourceChangedEvent {\n\turl: URI;\n\toriginalEvents: EmitterEvent[];\n}\n\nexport var IResourceService = createDecorator<IResourceService>('resourceService');\n\nexport interface IResourceService {\n\tserviceId: ServiceIdentifier<any>;\n\tinsert(url: URI, element: IMirrorModel): void;\n\tget(url: URI): IMirrorModel;\n\tall(): IMirrorModel[];\n\tcontains(url: URI): boolean;\n\tremove(url: URI): void;\n\taddListener2_(eventType: 'resource.added', listener: (event: IResourceAddedEvent) => void): IDisposable;\n\taddListener2_(eventType: 'resource.removed', listener: (event: IResourceRemovedEvent) => void): IDisposable;\n\taddListener2_(eventType: 'resource.changed', listener: (event: IResourceChangedEvent) => void): IDisposable;\n\taddListener2_(eventType: string, listener: ListenerCallback): IDisposable;\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {EventEmitter, EmitterEvent, ListenerCallback} from 'vs/base/common/eventEmitter';\nimport {IDisposable, dispose} from 'vs/base/common/lifecycle';\nimport URI from 'vs/base/common/uri';\nimport {IMirrorModel} from 'vs/editor/common/editorCommon';\nimport {IResourceAddedEvent, IResourceChangedEvent, IResourceRemovedEvent, IResourceService, ResourceEvents} from 'vs/editor/common/services/resourceService';\n\nexport class ResourceService extends EventEmitter implements IResourceService {\n\tpublic serviceId = IResourceService;\n\tprivate data:{[url:string]:IMirrorModel;};\n\tprivate unbinds:{[url:string]:IDisposable[];};\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.data = {};\n\t\tthis.unbinds = {};\n\t}\n\n\tpublic addListener2_(eventType: string, listener: ListenerCallback): IDisposable {\n\t\treturn super.addListener2(eventType, listener);\n\t}\n\n\tprivate _anonymousModelId(input:string): string {\n\t\tvar r = '';\n\t\tfor (var i = 0; i < input.length; i++) {\n\t\t\tvar ch = input[i];\n\t\t\tif (ch >= '0' && ch <= '9') {\n\t\t\t\tr += '0';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ch >= 'a' && ch <= 'z') {\n\t\t\t\tr += 'a';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ch >= 'A' && ch <= 'Z') {\n\t\t\t\tr += 'A';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tr += ch;\n\t\t}\n\t\treturn r;\n\t}\n\n\tpublic insert(url:URI, element:IMirrorModel): void {\n\t\t// console.log('INSERT: ' + url.toString());\n\t\tif (this.contains(url)) {\n\t\t\t// There already exists a model with this id => this is a programmer error\n\t\t\tthrow new Error('ResourceService: Cannot add model ' + this._anonymousModelId(url.toString()) + ' because it already exists!');\n\t\t}\n\n\t\t// add resource\n\t\tvar key = url.toString();\n\t\tthis.data[key] = element;\n\t\tthis.unbinds[key] = [];\n\t\tthis.unbinds[key].push(element.addBulkListener2((value:EmitterEvent[]) => {\n\t\t\tthis.emit(ResourceEvents.CHANGED, <IResourceChangedEvent>{ url: url, originalEvents: value });\n\t\t}));\n\n\t\t// event\n\t\tthis.emit(ResourceEvents.ADDED, <IResourceAddedEvent>{ url: url, addedElement: element });\n\t}\n\n\tpublic get(url:URI):IMirrorModel {\n\t\tif(!this.data[url.toString()]) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.data[url.toString()];\n\t}\n\n\tpublic all():IMirrorModel[] {\n\t\treturn Object.keys(this.data).map((key) => {\n\t\t\treturn this.data[key];\n\t\t});\n\t}\n\n\tpublic contains(url:URI):boolean {\n\t\treturn !!this.data[url.toString()];\n\t}\n\n\tpublic remove(url:URI):void {\n\t\t// console.log('REMOVE: ' + url.toString());\n\t\tif(!this.contains(url)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar key = url.toString(),\n\t\t\telement = this.data[key];\n\n\t\t// stop listen\n\t\tthis.unbinds[key] = dispose(this.unbinds[key]);\n\n\t\t// removal\n\t\tdelete this.unbinds[key];\n\t\tdelete this.data[key];\n\n\t\t// event\n\t\tthis.emit(ResourceEvents.REMOVED, <IResourceRemovedEvent>{ url: url, removedElement: element });\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {createDecorator, ServiceIdentifier} from 'vs/platform/instantiation/common/instantiation';\nimport Event from 'vs/base/common/event';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {JSONPath} from 'vs/base/common/json';\n\nexport const IConfigurationService = createDecorator<IConfigurationService>('configurationService');\n\nexport interface IConfigurationService {\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Fetches the appropriate section of the configuration JSON file.\n\t * This will be an object keyed off the section name.\n\t */\n\tgetConfiguration<T>(section?: string): T;\n\n\t/**\n\t * Similar to #getConfiguration() but ensures that the latest configuration\n\t * from disk is fetched.\n\t */\n\tloadConfiguration<T>(section?: string): TPromise<T>;\n\n\t/**\n\t * Returns iff the workspace has configuration or not.\n\t */\n\thasWorkspaceConfiguration(): boolean;\n\n\t/**\n\t * Event that fires when the configuration changes.\n\t */\n\tonDidUpdateConfiguration: Event<IConfigurationServiceEvent>;\n\n\t/**\n\t * Sets a user configuration. An the setting does not yet exist in the settings, it will be\n\t * added.\n\t */\n\tsetUserConfiguration(key: string | JSONPath, value: any) : Thenable<void>;\n}\n\nexport interface IConfigurationServiceEvent {\n\tconfig: any;\n}\n\nexport function getConfigurationValue<T>(config: any, settingPath: string, defaultValue?: T): T {\n\tfunction accessSetting(config: any, path: string[]): any {\n\t\tlet current = config;\n\t\tfor (let i = 0; i < path.length; i++) {\n\t\t\tcurrent = current[path[i]];\n\t\t\tif (!current) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\t\treturn <T> current;\n\t}\n\n\tlet path = settingPath.split('.');\n\tlet result = accessSetting(config, path);\n\treturn typeof result === 'undefined'\n\t\t? defaultValue\n\t\t: result;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IEventEmitter} from 'vs/base/common/eventEmitter';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {createDecorator, ServiceIdentifier} from 'vs/platform/instantiation/common/instantiation';\n\nexport const IEventService = createDecorator<IEventService>('eventService');\n\nexport interface IEventService {\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Allows to add a listener to the platform event bus for all emitters that are known to the platform.\n\t */\n\taddListener2(eventType: string, listener: (event: any) => void): IDisposable;\n\n\t/**\n\t * Allows to add an event emitter to the platform bus such as Events from the emitter\n\t * can be received from all listeners on the bus.\n\t */\n\taddEmitter2(eventEmitter: IEventEmitter, emitterType?: string): IDisposable;\n\n\t/**\n\t * Emits an event of the given type into the platform event bus.\n\t * Note: Instead of emitting directly to the platform bus, it is also possible to register\n\t * as event emitter to the bus using addEmitter() with a emitterType specified. This\n\t * makes it possible to scope Events on the bus to a specific namespace, depending on the\n\t * emitter and avoids polluting the global namespace in the bus with Events.\n\t */\n\temit(eventType: string, e?: any): void;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {EventEmitter} from 'vs/base/common/eventEmitter';\nimport {IEventService} from './event';\n\n// --- implementation ------------------------------------------\n\nexport class EventService extends EventEmitter implements IEventService {\n\tpublic serviceId = IEventService;\n\tconstructor() {\n\t\tsuper();\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Severity from 'vs/base/common/severity';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ServiceIdentifier, createDecorator} from 'vs/platform/instantiation/common/instantiation';\n\nexport interface IExtensionDescription {\n\tid: string;\n\tname: string;\n\tversion: string;\n\tpublisher: string;\n\tisBuiltin: boolean;\n\textensionFolderPath: string;\n\textensionDependencies?: string[];\n\tactivationEvents?: string[];\n\tengines: {\n\t\tvscode: string;\n\t};\n\tmain?: string;\n\tcontributes?: { [point: string]: any; };\n}\n\nexport interface IActivationEventListener {\n\t(): void;\n}\n\nexport interface IPointListener {\n\t(desc: IExtensionDescription[]): void;\n}\n\nexport const IExtensionService = createDecorator<IExtensionService>('extensionService');\n\nexport interface IMessage {\n\ttype: Severity;\n\tmessage: string;\n\tsource: string;\n}\n\nexport interface IExtensionsStatus {\n\tmessages: IMessage[];\n}\n\nexport interface IExtensionService {\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Send an activation event and activate interested extensions.\n\t */\n\tactivateByEvent(activationEvent: string): TPromise<void>;\n\n\t/**\n\t * Block on this signal any interactions with extensions.\n\t */\n\tonReady(): TPromise<boolean>;\n\n\t/**\n\t * Get information about extensions status.\n\t */\n\tgetExtensionsStatus(): { [id: string]: IExtensionsStatus };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {binarySearch} from 'vs/base/common/arrays';\nimport {ServiceIdentifier} from 'vs/platform/instantiation/common/instantiation';\nimport {SyncDescriptor} from './descriptors';\n\ntype Entry = [ServiceIdentifier<any>, any];\n\nexport class ServiceCollection {\n\n\tprivate _entries: Entry[] = [];\n\n\tconstructor(...entries:[ServiceIdentifier<any>, any][]) {\n\t\tfor (let entry of entries) {\n\t\t\tthis.set(entry[0], entry[1]);\n\t\t}\n\t}\n\n\tset<T>(id: ServiceIdentifier<T>, instanceOrDescriptor: T | SyncDescriptor<T>): T | SyncDescriptor<T> {\n\t\tconst entry: Entry = [id, instanceOrDescriptor];\n\t\tconst idx = binarySearch(this._entries, entry, ServiceCollection._entryCompare);\n\t\tif (idx < 0) {\n\t\t\t// new element\n\t\t\tthis._entries.splice(~idx, 0, entry);\n\t\t} else {\n\t\t\tconst old = this._entries[idx];\n\t\t\tthis._entries[idx] = entry;\n\t\t\treturn old[1];\n\t\t}\n\t}\n\n\tforEach(callback: (id: ServiceIdentifier<any>, instanceOrDescriptor: any) => any): void {\n\t\tfor (let entry of this._entries) {\n\t\t\tlet [id, instanceOrDescriptor] = entry;\n\t\t\tcallback(id, instanceOrDescriptor);\n\t\t}\n\t}\n\n\thas(id: ServiceIdentifier<any>): boolean {\n\t\treturn binarySearch(this._entries, ServiceCollection._searchEntry(id), ServiceCollection._entryCompare) >= 0;\n\t}\n\n\tget<T>(id: ServiceIdentifier<T>): T | SyncDescriptor<T> {\n\t\tconst idx = binarySearch(this._entries, ServiceCollection._searchEntry(id), ServiceCollection._entryCompare);\n\t\tif (idx >= 0) {\n\t\t\treturn this._entries[idx][1];\n\t\t}\n\t}\n\n\tprivate static _dummy: Entry = [undefined, undefined];\n\n\tprivate static _searchEntry(id: ServiceIdentifier<any>): Entry {\n\t\tServiceCollection._dummy[0] = id;\n\t\treturn ServiceCollection._dummy;\n\t}\n\n\tprivate static _entryCompare(a: Entry, b: Entry): number {\n\t\tconst _a = a[0].toString();\n\t\tconst _b = b[0].toString();\n\t\tif (_a < _b) {\n\t\t\treturn -1;\n\t\t} else if (_a > _b) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {illegalArgument, illegalState, canceled} from 'vs/base/common/errors';\nimport {create} from 'vs/base/common/types';\nimport * as assert from 'vs/base/common/assert';\nimport {Graph} from 'vs/base/common/graph';\nimport {SyncDescriptor, AsyncDescriptor} from 'vs/platform/instantiation/common/descriptors';\nimport {ServiceIdentifier, IInstantiationService, ServicesAccessor, _util, optional} from 'vs/platform/instantiation/common/instantiation';\nimport {ServiceCollection} from 'vs/platform/instantiation/common/serviceCollection';\n\n\nexport class InstantiationService implements IInstantiationService {\n\n\tserviceId: any;\n\n\tprivate _services: ServiceCollection;\n\tprivate _strict: boolean;\n\n\tconstructor(services: ServiceCollection = new ServiceCollection(), strict: boolean = false) {\n\t\tthis._services = services;\n\t\tthis._strict = strict;\n\n\t\tthis._services.set(IInstantiationService, this);\n\t}\n\n\tcreateChild(services: ServiceCollection): IInstantiationService {\n\t\tthis._services.forEach((id, thing) => {\n\t\t\tif (services.has(id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// If we copy descriptors we might end up with\n\t\t\t// multiple instances of the same service\n\t\t\tif (thing instanceof SyncDescriptor) {\n\t\t\t\tthing = this._createAndCacheServiceInstance(id, thing);\n\t\t\t}\n\t\t\tservices.set(id, thing);\n\t\t});\n\t\treturn new InstantiationService(services, this._strict);\n\t}\n\n\tinvokeFunction<R>(signature: (accessor: ServicesAccessor, ...more: any[]) => R, ...args: any[]): R {\n\t\tlet accessor: ServicesAccessor;\n\t\ttry {\n\t\t\taccessor = {\n\t\t\t\tget: <T>(id: ServiceIdentifier<T>, isOptional?: typeof optional) => {\n\t\t\t\t\tconst result = this._getOrCreateServiceInstance(id);\n\t\t\t\t\tif (!result && isOptional !== optional) {\n\t\t\t\t\t\tthrow new Error(`[invokeFunction] unkown service '${id}'`);\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn signature.apply(undefined, [accessor].concat(args));\n\t\t} finally {\n\t\t\taccessor.get = function () {\n\t\t\t\tthrow illegalState('service accessor is only valid during the invocation of its target method');\n\t\t\t};\n\t\t}\n\t}\n\n\tcreateInstance<T>(param: any, ...rest:any[]): any {\n\n\t\tif (param instanceof AsyncDescriptor) {\n\t\t\t// async\n\t\t\treturn this._createInstanceAsync(param, rest);\n\n\t\t} else if (param instanceof SyncDescriptor) {\n\t\t\t// sync\n\t\t\treturn this._createInstance(param, rest);\n\n\t\t} else {\n\t\t\t// sync, just ctor\n\t\t\treturn this._createInstance(new SyncDescriptor(param), rest);\n\t\t}\n\t}\n\n\tprivate _createInstanceAsync<T>(descriptor: AsyncDescriptor<T>, args: any[]): TPromise<T> {\n\n\t\tlet canceledError: Error;\n\n\t\treturn new TPromise((c, e, p) => {\n\t\t\trequire([descriptor.moduleName], (_module?: any) => {\n\t\t\t\tif (canceledError) {\n\t\t\t\t\te(canceledError);\n\t\t\t\t}\n\n\t\t\t\tif (!_module) {\n\t\t\t\t\treturn e(illegalArgument('module not found: ' + descriptor.moduleName));\n\t\t\t\t}\n\n\t\t\t\tlet ctor: Function;\n\t\t\t\tif (!descriptor.ctorName) {\n\t\t\t\t\tctor = _module;\n\t\t\t\t} else {\n\t\t\t\t\tctor = _module[descriptor.ctorName];\n\t\t\t\t}\n\n\t\t\t\tif (typeof ctor !== 'function') {\n\t\t\t\t\treturn e(illegalArgument('not a function: ' + descriptor.ctorName || descriptor.moduleName));\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\targs.unshift.apply(args, descriptor.staticArguments()); // instead of spread in ctor call\n\t\t\t\t\tc(this._createInstance(new SyncDescriptor<T>(ctor), args));\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn e(error);\n\t\t\t\t}\n\t\t\t}, e);\n\t\t}, () => {\n\t\t\tcanceledError = canceled();\n\t\t});\n\t}\n\n\tprivate _createInstance<T>(desc: SyncDescriptor<T>, args: any[]): T {\n\n\t\t// arguments given by createInstance-call and/or the descriptor\n\t\tlet staticArgs = desc.staticArguments().concat(args);\n\n\t\t// arguments defined by service decorators\n\t\tlet serviceDependencies = _util.getServiceDependencies(desc.ctor).sort((a, b) => a.index - b.index);\n\t\tlet serviceArgs = serviceDependencies.map(dependency => {\n\t\t\tlet service = this._getOrCreateServiceInstance(dependency.id);\n\t\t\tif (!service && this._strict && !dependency.optional) {\n\t\t\t\tthrow new Error(`[createInstance] ${desc.ctor.name} depends on UNKNOWN service ${dependency.id}.`);\n\t\t\t}\n\t\t\treturn service;\n\t\t});\n\t\tlet firstServiceArgPos = serviceDependencies.length > 0 ? serviceDependencies[0].index : staticArgs.length;\n\n\t\t// check for argument mismatches, adjust static args if needed\n\t\tif (staticArgs.length !== firstServiceArgPos) {\n\t\t\tconsole.warn(`[createInstance] First service dependency of ${desc.ctor.name} at position ${\n\t\t\t\tfirstServiceArgPos + 1} conflicts with ${staticArgs.length} static arguments`);\n\n\t\t\tlet delta = firstServiceArgPos - staticArgs.length;\n\t\t\tif (delta > 0) {\n\t\t\t\tstaticArgs = staticArgs.concat(new Array(delta));\n\t\t\t} else {\n\t\t\t\tstaticArgs = staticArgs.slice(0, firstServiceArgPos);\n\t\t\t}\n\t\t}\n\n\t\t// // check for missing args\n\t\t// for (let i = 0; i < serviceArgs.length; i++) {\n\t\t// \tif (!serviceArgs[i]) {\n\t\t// \t\tconsole.warn(`${desc.ctor.name} MISSES service dependency ${serviceDependencies[i].id}`, new Error().stack);\n\t\t// \t}\n\t\t// }\n\n\t\t// now create the instance\n\t\tconst argArray = [desc.ctor];\n\t\targArray.push(...staticArgs);\n\t\targArray.push(...serviceArgs);\n\n\t\tconst instance = create.apply(null, argArray);\n\t\tdesc._validate(instance);\n\t\treturn <T>instance;\n\t}\n\n\tprivate _getOrCreateServiceInstance<T>(id: ServiceIdentifier<T>): T {\n\t\tlet thing = this._services.get(id);\n\t\tif (thing instanceof SyncDescriptor) {\n\t\t\treturn this._createAndCacheServiceInstance(id, thing);\n\t\t} else {\n\t\t\treturn thing;\n\t\t}\n\t}\n\n\tprivate _createAndCacheServiceInstance<T>(id: ServiceIdentifier<T>, desc: SyncDescriptor<T>): T {\n\t\tassert.ok(this._services.get(id) instanceof SyncDescriptor);\n\n\t\tconst graph = new Graph<{ id: ServiceIdentifier<any>, desc: SyncDescriptor<any> }>(data => data.id.toString());\n\n\t\tfunction throwCycleError() {\n\t\t\tconst err = new Error('[createInstance] cyclic dependency between services');\n\t\t\terr.message = graph.toString();\n\t\t\tthrow err;\n\t\t}\n\n\t\tlet count = 0;\n\t\tconst stack = [{ id, desc }];\n\t\twhile (stack.length) {\n\t\t\tconst item = stack.pop();\n\t\t\tgraph.lookupOrInsertNode(item);\n\n\t\t\t// TODO@joh use the graph to find a cycle\n\t\t\t// a weak heuristic for cycle checks\n\t\t\tif (count++ > 100) {\n\t\t\t\tthrowCycleError();\n\t\t\t}\n\n\t\t\t// check all dependencies for existence and if the need to be created first\n\t\t\tlet dependencies = _util.getServiceDependencies(item.desc.ctor);\n\t\t\tfor (let dependency of dependencies) {\n\n\t\t\t\tlet instanceOrDesc = this._services.get(dependency.id);\n\t\t\t\tif (!instanceOrDesc) {\n\t\t\t\t\tconsole.warn(`[createInstance] ${id} depends on ${dependency.id} which is NOT registered.`);\n\t\t\t\t}\n\n\t\t\t\tif (instanceOrDesc instanceof SyncDescriptor) {\n\t\t\t\t\tconst d = { id: dependency.id, desc: instanceOrDesc };\n\t\t\t\t\tgraph.insertEdge(item, d);\n\t\t\t\t\tstack.push(d);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twhile (true) {\n\t\t\tlet roots = graph.roots();\n\n\t\t\t// if there is no more roots but still\n\t\t\t// nodes in the graph we have a cycle\n\t\t\tif (roots.length === 0) {\n\t\t\t\tif (graph.length !== 0) {\n\t\t\t\t\tthrowCycleError();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfor (let root of roots) {\n\t\t\t\t// create instance and overwrite the service collections\n\t\t\t\tconst instance = this._createInstance(root.data.desc, []);\n\t\t\t\tthis._services.set(root.data.id, instance);\n\t\t\t\tgraph.removeNode(root.data);\n\t\t\t}\n\t\t}\n\n\t\treturn <T> this._services.get(id);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport Types = require('vs/base/common/types');\nimport Assert = require('vs/base/common/assert');\nimport {IInstantiationService, IConstructorSignature0} from 'vs/platform/instantiation/common/instantiation';\n\nexport interface IRegistry {\n\n\t/**\n\t * Adds the extension functions and properties defined by data to the\n\t * platform. The provided id must be unique.\n\t * @param id a unique identifier\n\t * @param data a contribution\n\t */\n\tadd(id: string, data: any): void;\n\n\t/**\n\t * Returns true iff there is an extension with the provided id.\n\t * @param id an extension idenifier\n\t */\n\tknows(id: string): boolean;\n\n\t/**\n\t * Returns the extension functions and properties defined by the specified key or null.\n\t * @param id an extension idenifier\n\t */\n\tas(id: string): any;\n\tas<T>(id: string): T;\n}\n\nclass RegistryImpl implements IRegistry {\n\n\tprivate data: { [id: string]: any; };\n\n\tconstructor() {\n\t\tthis.data = {};\n\t}\n\n\tpublic add(id: string, data: any): void {\n\t\tAssert.ok(Types.isString(id));\n\t\tAssert.ok(Types.isObject(data));\n\t\tAssert.ok(!this.data.hasOwnProperty(id), 'There is already an extension with this id');\n\n\t\tthis.data[id] = data;\n\t}\n\n\tpublic knows(id: string): boolean {\n\t\treturn this.data.hasOwnProperty(id);\n\t}\n\n\tpublic as(id: string): any {\n\t\treturn this.data[id] || null;\n\t}\n}\n\nexport var Registry = <IRegistry>new RegistryImpl();\n\n/**\n * A base class for registries that leverage the instantiation service to create instances.\n */\nexport class BaseRegistry<T> {\n\tprivate toBeInstantiated: IConstructorSignature0<T>[] = [];\n\tprivate instances: T[] = [];\n\tprivate instantiationService: IInstantiationService;\n\n\tpublic setInstantiationService(service: IInstantiationService): void {\n\t\tthis.instantiationService = service;\n\n\t\twhile (this.toBeInstantiated.length > 0) {\n\t\t\tlet entry = this.toBeInstantiated.shift();\n\t\t\tthis.instantiate(entry);\n\t\t}\n\t}\n\n\tprivate instantiate(ctor: IConstructorSignature0<T>): void {\n\t\tlet instance = this.instantiationService.createInstance(ctor);\n\t\tthis.instances.push(instance);\n\t}\n\n\t_register(ctor: IConstructorSignature0<T>): void {\n\t\tif (this.instantiationService) {\n\t\t\tthis.instantiate(ctor);\n\t\t} else {\n\t\t\tthis.toBeInstantiated.push(ctor);\n\t\t}\n\t}\n\n\t_getInstances(): T[] {\n\t\treturn this.instances.slice(0);\n\t}\n\n\t_setInstances(instances: T[]): void {\n\t\tthis.instances = instances;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport Event, {Emitter} from 'vs/base/common/event';\nimport {Registry} from 'vs/platform/platform';\nimport {ILanguageExtensionPoint} from 'vs/editor/common/services/modeService';\n\nexport interface ILegacyLanguageDefinition {\n\tid: string;\n\textensions: string[];\n\tfilenames?: string[];\n\tfirstLine?: string;\n\taliases: string[];\n\tmimetypes: string[];\n\tmoduleId: string;\n\tctorName: string;\n\tdeps?: string[];\n}\n\n// Define extension point ids\nexport var Extensions = {\n\tModesRegistry: 'editor.modesRegistry'\n};\n\nexport class EditorModesRegistry {\n\n\tprivate _compatModes: ILegacyLanguageDefinition[];\n\tprivate _languages: ILanguageExtensionPoint[];\n\n\tprivate _onDidAddCompatModes: Emitter<ILegacyLanguageDefinition[]> = new Emitter<ILegacyLanguageDefinition[]>();\n\tpublic onDidAddCompatModes: Event<ILegacyLanguageDefinition[]> = this._onDidAddCompatModes.event;\n\n\tprivate _onDidAddLanguages: Emitter<ILanguageExtensionPoint[]> = new Emitter<ILanguageExtensionPoint[]>();\n\tpublic onDidAddLanguages: Event<ILanguageExtensionPoint[]> = this._onDidAddLanguages.event;\n\n\tconstructor() {\n\t\tthis._compatModes = [];\n\t\tthis._languages = [];\n\t}\n\n\t// --- compat modes\n\n\n\tpublic registerCompatModes(def:ILegacyLanguageDefinition[]): void {\n\t\tthis._compatModes = this._compatModes.concat(def);\n\t\tthis._onDidAddCompatModes.fire(def);\n\t}\n\tpublic registerCompatMode(def:ILegacyLanguageDefinition): void {\n\t\tthis._compatModes.push(def);\n\t\tthis._onDidAddCompatModes.fire([def]);\n\t}\n\tpublic getCompatModes(): ILegacyLanguageDefinition[] {\n\t\treturn this._compatModes.slice(0);\n\t}\n\n\t// --- languages\n\n\tpublic registerLanguage(def:ILanguageExtensionPoint): void {\n\t\tthis._languages.push(def);\n\t\tthis._onDidAddLanguages.fire([def]);\n\t}\n\tpublic registerLanguages(def:ILanguageExtensionPoint[]): void {\n\t\tthis._languages = this._languages.concat(def);\n\t\tthis._onDidAddLanguages.fire(def);\n\t}\n\tpublic getLanguages(): ILanguageExtensionPoint[] {\n\t\treturn this._languages.slice(0);\n\t}\n}\n\nexport var ModesRegistry = new EditorModesRegistry();\nRegistry.add(Extensions.ModesRegistry, ModesRegistry);\n\nModesRegistry.registerLanguage({\n\tid: 'plaintext',\n\textensions: ['.txt', '.gitignore'],\n\taliases: [nls.localize('plainText.alias', \"Plain Text\"), 'text'],\n\tmimetypes: ['text/plain']\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ICompatWorkerService, ICompatMode, IRawModelData} from 'vs/editor/common/services/compatWorkerService';\nimport {IResourceService} from 'vs/editor/common/services/resourceService';\nimport {ILanguageExtensionPoint, IModeService} from 'vs/editor/common/services/modeService';\nimport {IMirrorModelEvents, MirrorModel} from 'vs/editor/common/model/mirrorModel';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport URI from 'vs/base/common/uri';\nimport {ILegacyLanguageDefinition, ModesRegistry} from 'vs/editor/common/modes/modesRegistry';\n\nexport class CompatWorkerServiceWorker implements ICompatWorkerService {\n\tpublic serviceId = ICompatWorkerService;\n\tpublic isInMainThread = false;\n\tprivate _compatModes: {[modeId:string]:ICompatMode;};\n\n\tconstructor(\n\t\t@IResourceService private resourceService: IResourceService,\n\t\t@IModeService private modeService: IModeService,\n\t\tmodesRegistryData: {\n\t\t\tcompatModes: ILegacyLanguageDefinition[];\n\t\t\tlanguages: ILanguageExtensionPoint[];\n\t\t}\n\t) {\n\t\tModesRegistry.registerCompatModes(modesRegistryData.compatModes);\n\t\tModesRegistry.registerLanguages(modesRegistryData.languages);\n\t\tthis._compatModes = Object.create(null);\n\t}\n\n\tregisterCompatMode(compatMode:ICompatMode): void {\n\t\tthis._compatModes[compatMode.getId()] = compatMode;\n\t}\n\n\tpublic handleMainRequest(rpcId: string, methodName: string, args: any[]): any {\n\t\tif (rpcId === '$') {\n\t\t\tswitch (methodName) {\n\t\t\t\tcase 'acceptNewModel':\n\t\t\t\t\treturn this._acceptNewModel(args[0]);\n\t\t\t\tcase 'acceptDidDisposeModel':\n\t\t\t\t\treturn this._acceptDidDisposeModel(args[0]);\n\t\t\t\tcase 'acceptModelEvents':\n\t\t\t\t\treturn this._acceptModelEvents(args[0], args[1]);\n\t\t\t\tcase 'acceptCompatModes':\n\t\t\t\t\treturn this._acceptCompatModes(args[0]);\n\t\t\t\tcase 'acceptLanguages':\n\t\t\t\t\treturn this._acceptLanguages(args[0]);\n\t\t\t\tcase 'instantiateCompatMode':\n\t\t\t\t\treturn this._instantiateCompatMode(args[0]);\n\t\t\t}\n\t\t}\n\n\t\tlet obj = this._compatModes[rpcId];\n\t\treturn TPromise.as(obj[methodName].apply(obj, args));\n\t}\n\n\tpublic CompatWorker(obj: ICompatMode, methodName: string, target: Function, param: any[]): TPromise<any> {\n\t\treturn target.apply(obj, param);\n\t}\n\n\tprivate _acceptNewModel(data: IRawModelData): TPromise<void> {\n\t\t// Create & insert the mirror model eagerly in the resource service\n\t\tlet mirrorModel = new MirrorModel(data.versionId, data.value, null, data.url);\n\t\tthis.resourceService.insert(mirrorModel.uri, mirrorModel);\n\n\t\t// Block worker execution until the mode is instantiated\n\t\treturn this.modeService.getOrCreateMode(data.modeId).then((mode) => {\n\t\t\t// Changing mode should trigger a remove & an add, therefore:\n\n\t\t\t// (1) Remove from resource service\n\t\t\tthis.resourceService.remove(mirrorModel.uri);\n\n\t\t\t// (2) Change mode\n\t\t\tmirrorModel.setMode(mode);\n\n\t\t\t// (3) Insert again to resource service (it will have the new mode)\n\t\t\tthis.resourceService.insert(mirrorModel.uri, mirrorModel);\n\t\t});\n\t}\n\n\tprivate _acceptDidDisposeModel(uri: URI): void {\n\t\tlet model = <MirrorModel>this.resourceService.get(uri);\n\t\tthis.resourceService.remove(uri);\n\t\tmodel.dispose();\n\t}\n\n\tprivate _acceptModelEvents(uri: URI, events: IMirrorModelEvents): void {\n\t\tlet model = <MirrorModel>this.resourceService.get(uri);\n\t\ttry {\n\t\t\tmodel.onEvents(events);\n\t\t} catch (err) {\n\t\t\tonUnexpectedError(err);\n\t\t}\n\t}\n\n\tprivate _acceptCompatModes(modes:ILegacyLanguageDefinition[]): void {\n\t\tModesRegistry.registerCompatModes(modes);\n\t}\n\n\tprivate _acceptLanguages(languages:ILanguageExtensionPoint[]): void {\n\t\tModesRegistry.registerLanguages(languages);\n\t}\n\n\tprivate _instantiateCompatMode(modeId:string): TPromise<void> {\n\t\treturn this.modeService.getOrCreateMode(modeId).then(_ => void 0);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport Event, {Emitter} from 'vs/base/common/event';\nimport * as mime from 'vs/base/common/mime';\nimport * as strings from 'vs/base/common/strings';\nimport {ILegacyLanguageDefinition, ModesRegistry} from 'vs/editor/common/modes/modesRegistry';\nimport {ILanguageExtensionPoint} from 'vs/editor/common/services/modeService';\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport interface ICompatModeDescriptor {\n\tmoduleId: string;\n\tctorName: string;\n\tdeps: string[];\n}\n\nexport class LanguagesRegistry {\n\n\tprivate knownModeIds: { [id: string]: boolean; };\n\tprivate mime2LanguageId: { [mimeType: string]: string; };\n\tprivate name2LanguageId: { [name: string]: string; };\n\tprivate id2Name: { [id: string]: string; };\n\tprivate id2Extensions: { [id: string]: string[]; };\n\tprivate compatModes: { [id: string]: ICompatModeDescriptor; };\n\tprivate lowerName2Id: { [name: string]: string; };\n\tprivate id2ConfigurationFiles: { [id:string]: string[]; };\n\n\tprivate _onDidAddModes: Emitter<string[]> = new Emitter<string[]>();\n\tpublic onDidAddModes: Event<string[]> = this._onDidAddModes.event;\n\n\tconstructor(useModesRegistry = true) {\n\t\tthis.knownModeIds = {};\n\t\tthis.mime2LanguageId = {};\n\t\tthis.name2LanguageId = {};\n\t\tthis.id2Name = {};\n\t\tthis.id2Extensions = {};\n\t\tthis.compatModes = {};\n\t\tthis.lowerName2Id = {};\n\t\tthis.id2ConfigurationFiles = {};\n\n\t\tif (useModesRegistry) {\n\t\t\tthis._registerCompatModes(ModesRegistry.getCompatModes());\n\t\t\tModesRegistry.onDidAddCompatModes((m) => this._registerCompatModes(m));\n\n\t\t\tthis._registerLanguages(ModesRegistry.getLanguages());\n\t\t\tModesRegistry.onDidAddLanguages((m) => this._registerLanguages(m));\n\t\t}\n\t}\n\n\t_registerCompatModes(defs:ILegacyLanguageDefinition[]): void {\n\t\tlet addedModes: string[] = [];\n\t\tfor (let i = 0; i < defs.length; i++) {\n\t\t\tlet def = defs[i];\n\n\t\t\tthis._registerLanguage({\n\t\t\t\tid: def.id,\n\t\t\t\textensions: def.extensions,\n\t\t\t\tfilenames: def.filenames,\n\t\t\t\tfirstLine: def.firstLine,\n\t\t\t\taliases: def.aliases,\n\t\t\t\tmimetypes: def.mimetypes\n\t\t\t});\n\n\t\t\tthis.compatModes[def.id] = {\n\t\t\t\tmoduleId: def.moduleId,\n\t\t\t\tctorName: def.ctorName,\n\t\t\t\tdeps: def.deps\n\t\t\t};\n\n\t\t\taddedModes.push(def.id);\n\t\t}\n\t\tthis._onDidAddModes.fire(addedModes);\n\t}\n\n\t_registerLanguages(desc:ILanguageExtensionPoint[]): void {\n\t\tlet addedModes: string[] = [];\n\t\tfor (let i = 0; i < desc.length; i++) {\n\t\t\tthis._registerLanguage(desc[i]);\n\t\t\taddedModes.push(desc[i].id);\n\t\t}\n\t\tthis._onDidAddModes.fire(addedModes);\n\t}\n\n\tprivate _setLanguageName(languageId:string, languageName:string, force:boolean): void {\n\t\tlet prevName = this.id2Name[languageId];\n\t\tif (prevName) {\n\t\t\tif (!force) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdelete this.name2LanguageId[prevName];\n\t\t}\n\n\t\tthis.name2LanguageId[languageName] = languageId;\n\t\tthis.id2Name[languageId] = languageName;\n\t}\n\n\tprivate _registerLanguage(lang: ILanguageExtensionPoint): void {\n\t\tthis.knownModeIds[lang.id] = true;\n\n\t\tvar primaryMime: string = null;\n\n\t\tif (typeof lang.mimetypes !== 'undefined' && Array.isArray(lang.mimetypes)) {\n\t\t\tfor (var i = 0; i < lang.mimetypes.length; i++) {\n\t\t\t\tif (!primaryMime) {\n\t\t\t\t\tprimaryMime = lang.mimetypes[i];\n\t\t\t\t}\n\t\t\t\tthis.mime2LanguageId[lang.mimetypes[i]] = lang.id;\n\t\t\t}\n\t\t}\n\n\t\tif (!primaryMime) {\n\t\t\tprimaryMime = 'text/x-' + lang.id;\n\t\t\tthis.mime2LanguageId[primaryMime] = lang.id;\n\t\t}\n\n\t\tif (Array.isArray(lang.extensions)) {\n\t\t\tthis.id2Extensions[lang.id] = this.id2Extensions[lang.id] || [];\n\t\t\tfor (let extension of lang.extensions) {\n\t\t\t\tmime.registerTextMime({ mime: primaryMime, extension: extension });\n\t\t\t\tthis.id2Extensions[lang.id].push(extension);\n\t\t\t}\n\t\t}\n\n\t\tif (Array.isArray(lang.filenames)) {\n\t\t\tfor (let filename of lang.filenames) {\n\t\t\t\tmime.registerTextMime({ mime: primaryMime, filename: filename });\n\t\t\t}\n\t\t}\n\n\t\tif (Array.isArray(lang.filenamePatterns)) {\n\t\t\tfor (let filenamePattern of lang.filenamePatterns) {\n\t\t\t\tmime.registerTextMime({ mime: primaryMime, filepattern: filenamePattern });\n\t\t\t}\n\t\t}\n\n\t\tif (typeof lang.firstLine === 'string' && lang.firstLine.length > 0) {\n\t\t\tvar firstLineRegexStr = lang.firstLine;\n\t\t\tif (firstLineRegexStr.charAt(0) !== '^') {\n\t\t\t\tfirstLineRegexStr = '^' + firstLineRegexStr;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tvar firstLineRegex = new RegExp(firstLineRegexStr);\n\t\t\t\tif (!strings.regExpLeadsToEndlessLoop(firstLineRegex)) {\n\t\t\t\t\tmime.registerTextMime({ mime: primaryMime, firstline: firstLineRegex });\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\t// Most likely, the regex was bad\n\t\t\t\tonUnexpectedError(err);\n\t\t\t}\n\t\t}\n\n\t\tthis.lowerName2Id[lang.id.toLowerCase()] = lang.id;\n\n\t\tif (typeof lang.aliases !== 'undefined' && Array.isArray(lang.aliases)) {\n\t\t\tfor (var i = 0; i < lang.aliases.length; i++) {\n\t\t\t\tif (!lang.aliases[i] || lang.aliases[i].length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.lowerName2Id[lang.aliases[i].toLowerCase()] = lang.id;\n\t\t\t}\n\t\t}\n\n\t\tlet containsAliases = (typeof lang.aliases !== 'undefined' && Array.isArray(lang.aliases) && lang.aliases.length > 0);\n\t\tif (containsAliases && lang.aliases[0] === null) {\n\t\t\t// signal that this language should not get a name\n\t\t} else {\n\t\t\tlet bestName = (containsAliases ? lang.aliases[0] : null) || lang.id;\n\t\t\tthis._setLanguageName(lang.id, bestName, containsAliases);\n\t\t}\n\n\t\tif (typeof lang.configuration === 'string') {\n\t\t\tthis.id2ConfigurationFiles[lang.id] = this.id2ConfigurationFiles[lang.id] || [];\n\t\t\tthis.id2ConfigurationFiles[lang.id].push(lang.configuration);\n\t\t}\n\t}\n\n\tpublic isRegisteredMode(mimetypeOrModeId: string): boolean {\n\t\t// Is this a known mime type ?\n\t\tif (hasOwnProperty.call(this.mime2LanguageId, mimetypeOrModeId)) {\n\t\t\treturn true;\n\t\t}\n\t\t// Is this a known mode id ?\n\t\treturn hasOwnProperty.call(this.knownModeIds, mimetypeOrModeId);\n\t}\n\n\tpublic getRegisteredModes(): string[] {\n\t\treturn Object.keys(this.knownModeIds);\n\t}\n\n\tpublic getRegisteredLanguageNames(): string[]{\n\t\treturn Object.keys(this.name2LanguageId);\n\t}\n\n\tpublic getLanguageName(modeId: string): string {\n\t\treturn this.id2Name[modeId] || null;\n\t}\n\n\tpublic getModeIdForLanguageNameLowercase(languageNameLower: string): string {\n\t\treturn this.lowerName2Id[languageNameLower] || null;\n\t}\n\n\tpublic getConfigurationFiles(modeId: string): string[] {\n\t\treturn this.id2ConfigurationFiles[modeId] || [];\n\t}\n\n\tpublic getMimeForMode(theModeId: string): string {\n\t\tlet keys = Object.keys(this.mime2LanguageId);\n\t\tfor (let i = 0, len = keys.length; i < len; i++) {\n\t\t\tlet _mime = keys[i];\n\t\t\tlet modeId = this.mime2LanguageId[_mime];\n\t\t\tif (modeId === theModeId) {\n\t\t\t\treturn _mime;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIdsOrName: string): string[] {\n\t\tif (!commaSeparatedMimetypesOrCommaSeparatedIdsOrName) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn (\n\t\t\tcommaSeparatedMimetypesOrCommaSeparatedIdsOrName.\n\t\t\t\tsplit(',').\n\t\t\t\tmap((mimeTypeOrIdOrName) => mimeTypeOrIdOrName.trim()).\n\t\t\t\tmap((mimeTypeOrIdOrName) => {\n\t\t\t\t\treturn this.mime2LanguageId[mimeTypeOrIdOrName] || mimeTypeOrIdOrName;\n\t\t\t\t}).\n\t\t\t\tfilter((modeId) => {\n\t\t\t\t\treturn this.knownModeIds[modeId];\n\t\t\t\t})\n\t\t);\n\t}\n\n\tpublic getModeIdsFromLanguageName(languageName: string): string[]{\n\t\tif (!languageName) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (hasOwnProperty.call(this.name2LanguageId, languageName)) {\n\t\t\treturn [this.name2LanguageId[languageName]];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tpublic getModeIdsFromFilenameOrFirstLine(filename: string, firstLine?:string): string[] {\n\t\tif (!filename && !firstLine) {\n\t\t\treturn [];\n\t\t}\n\t\tvar mimeTypes = mime.guessMimeTypes(filename, firstLine);\n\t\treturn this.extractModeIds(mimeTypes.join(','));\n\t}\n\n\tpublic getCompatMode(modeId: string): ICompatModeDescriptor {\n\t\treturn this.compatModes[modeId] || null;\n\t}\n\n\tpublic getExtensions(languageName: string): string[] {\n\t\tlet languageId = this.name2LanguageId[languageName];\n\t\tif (!languageId) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.id2Extensions[languageId];\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport nls = require('vs/nls');\nimport {IJSONSchema} from 'vs/base/common/jsonSchema';\nimport platform = require('vs/platform/platform');\nimport {EventEmitter} from 'vs/base/common/eventEmitter';\nimport {IDisposable} from 'vs/base/common/lifecycle';\n\nexport const Extensions = {\n\tJSONContribution: 'base.contributions.json'\n};\n\nexport interface ISchemaContributions {\n\tschemas?: { [id: string]: IJSONSchema };\n}\n\nexport interface IJSONContributionRegistry {\n\n\t/**\n\t * Register a schema to the registry.\n\t */\n\tregisterSchema(uri: string, unresolvedSchemaContent: IJSONSchema): void;\n\n\t/**\n\t * Get all schemas\n\t */\n\tgetSchemaContributions(): ISchemaContributions;\n\n\t/**\n\t * Adds a change listener\n\t */\n\taddRegistryChangedListener(callback: (e: IJSONContributionRegistryEvent) => void): IDisposable;\n\n}\n\nexport interface IJSONContributionRegistryEvent {\n\n}\n\nfunction normalizeId(id: string) {\n\tif (id.length > 0 && id.charAt(id.length - 1) === '#') {\n\t\treturn id.substring(0, id.length - 1);\n\t}\n\treturn id;\n}\n\n\n\nclass JSONContributionRegistry implements IJSONContributionRegistry {\n\tprivate schemasById: { [id: string]: IJSONSchema };\n\tprivate eventEmitter: EventEmitter;\n\n\tconstructor() {\n\t\tthis.schemasById = {};\n\t\tthis.eventEmitter = new EventEmitter();\n\t}\n\n\tpublic addRegistryChangedListener(callback: (e: IJSONContributionRegistryEvent) => void): IDisposable {\n\t\treturn this.eventEmitter.addListener2('registryChanged', callback);\n\t}\n\n\tpublic registerSchema(uri: string, unresolvedSchemaContent: IJSONSchema): void {\n\t\tthis.schemasById[normalizeId(uri)] = unresolvedSchemaContent;\n\t\tthis.eventEmitter.emit('registryChanged', {});\n\t}\n\n\tpublic getSchemaContributions(): ISchemaContributions {\n\t\treturn {\n\t\t\tschemas: this.schemasById,\n\t\t};\n\t}\n\n}\n\nconst jsonContributionRegistry = new JSONContributionRegistry();\nplatform.Registry.add(Extensions.JSONContribution, jsonContributionRegistry);\n\n// preload the schema-schema with a version that contains descriptions.\njsonContributionRegistry.registerSchema('http://json-schema.org/draft-04/schema#', {\n\t'id': 'http://json-schema.org/draft-04/schema#',\n\t'title': nls.localize('schema.json', 'Describes a JSON file using a schema. See json-schema.org for more info.'),\n\t'$schema': 'http://json-schema.org/draft-04/schema#',\n\t'definitions': {\n\t\t'schemaArray': {\n\t\t\t'type': 'array',\n\t\t\t'minItems': 1,\n\t\t\t'items': { '$ref': '#' }\n\t\t},\n\t\t'positiveInteger': {\n\t\t\t'type': 'integer',\n\t\t\t'minimum': 0\n\t\t},\n\t\t'positiveIntegerDefault0': {\n\t\t\t'allOf': [{ '$ref': '#/definitions/positiveInteger' }, { 'default': 0 }]\n\t\t},\n\t\t'simpleTypes': {\n\t\t\t'type': 'string',\n\t\t\t'enum': ['array', 'boolean', 'integer', 'null', 'number', 'object', 'string']\n\t\t},\n\t\t'stringArray': {\n\t\t\t'type': 'array',\n\t\t\t'items': { 'type': 'string' },\n\t\t\t'minItems': 1,\n\t\t\t'uniqueItems': true\n\t\t}\n\t},\n\t'type': 'object',\n\t'properties': {\n\t\t'id': {\n\t\t\t'type': 'string',\n\t\t\t'format': 'uri',\n\t\t\t'description': nls.localize('schema.json.id', 'A unique identifier for the schema.')\n\t\t},\n\t\t'$schema': {\n\t\t\t'type': 'string',\n\t\t\t'format': 'uri',\n\t\t\t'description': nls.localize('schema.json.$schema', 'The schema to verify this document against ')\n\t\t},\n\t\t'title': {\n\t\t\t'type': 'string',\n\t\t\t'description': nls.localize('schema.json.title', 'A descriptive title of the element')\n\t\t},\n\t\t'description': {\n\t\t\t'type': 'string',\n\t\t\t'description': nls.localize('schema.json.description', 'A long description of the element. Used in hover menus and suggestions.')\n\t\t},\n\t\t'default': {\n\t\t\t'description': nls.localize('schema.json.default', 'A default value. Used by suggestions.')\n\t\t},\n\t\t'multipleOf': {\n\t\t\t'type': 'number',\n\t\t\t'minimum': 0,\n\t\t\t'exclusiveMinimum': true,\n\t\t\t'description': nls.localize('schema.json.multipleOf', 'A number that should cleanly divide the current value (i.e. have no remainder)')\n\t\t},\n\t\t'maximum': {\n\t\t\t'type': 'number',\n\t\t\t'description': nls.localize('schema.json.maximum', 'The maximum numerical value, inclusive by default.')\n\t\t},\n\t\t'exclusiveMaximum': {\n\t\t\t'type': 'boolean',\n\t\t\t'default': false,\n\t\t\t'description': nls.localize('schema.json.exclusiveMaximum', 'Makes the maximum property exclusive.')\n\t\t},\n\t\t'minimum': {\n\t\t\t'type': 'number',\n\t\t\t'description': nls.localize('schema.json.minimum', 'The minimum numerical value, inclusive by default.')\n\t\t},\n\t\t'exclusiveMinimum': {\n\t\t\t'type': 'boolean',\n\t\t\t'default': false,\n\t\t\t'description': nls.localize('schema.json.exclusiveMininum', 'Makes the minimum property exclusive.')\n\t\t},\n\t\t'maxLength': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/positiveInteger' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.maxLength', 'The maximum length of a string.')\n\t\t},\n\t\t'minLength': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/positiveIntegerDefault0' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.minLength', 'The minimum length of a string.')\n\t\t},\n\t\t'pattern': {\n\t\t\t'type': 'string',\n\t\t\t'format': 'regex',\n\t\t\t'description': nls.localize('schema.json.pattern', 'A regular expression to match the string against. It is not implicitly anchored.')\n\t\t},\n\t\t'additionalItems': {\n\t\t\t'anyOf': [\n\t\t\t\t{ 'type': 'boolean' },\n\t\t\t\t{ '$ref': '#' }\n\t\t\t],\n\t\t\t'default': {},\n\t\t\t'description': nls.localize('schema.json.additionalItems', 'For arrays, only when items is set as an array. If it is a schema, then this schema validates items after the ones specified by the items array. If it is false, then additional items will cause validation to fail.')\n\t\t},\n\t\t'items': {\n\t\t\t'anyOf': [\n\t\t\t\t{ '$ref': '#' },\n\t\t\t\t{ '$ref': '#/definitions/schemaArray' }\n\t\t\t],\n\t\t\t'default': {},\n\t\t\t'description': nls.localize('schema.json.items', 'For arrays. Can either be a schema to validate every element against or an array of schemas to validate each item against in order (the first schema will validate the first element, the second schema will validate the second element, and so on.')\n\t\t},\n\t\t'maxItems': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/positiveInteger' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.maxItems', 'The maximum number of items that can be inside an array. Inclusive.')\n\t\t},\n\t\t'minItems': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/positiveIntegerDefault0' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.minItems', 'The minimum number of items that can be inside an array. Inclusive.')\n\t\t},\n\t\t'uniqueItems': {\n\t\t\t'type': 'boolean',\n\t\t\t'default': false,\n\t\t\t'description': nls.localize('schema.json.uniqueItems', 'If all of the items in the array must be unique. Defaults to false.')\n\t\t},\n\t\t'maxProperties': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/positiveInteger' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.maxProperties', 'The maximum number of properties an object can have. Inclusive.')\n\t\t},\n\t\t'minProperties': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/positiveIntegerDefault0' },\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.minProperties', 'The minimum number of properties an object can have. Inclusive.')\n\t\t},\n\t\t'required': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/stringArray' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.required', 'An array of strings that lists the names of all properties required on this object.')\n\t\t},\n\t\t'additionalProperties': {\n\t\t\t'anyOf': [\n\t\t\t\t{ 'type': 'boolean' },\n\t\t\t\t{ '$ref': '#' }\n\t\t\t],\n\t\t\t'default': {},\n\t\t\t'description': nls.localize('schema.json.additionalProperties', 'Either a schema or a boolean. If a schema, then used to validate all properties not matched by \\'properties\\' or \\'patternProperties\\'. If false, then any properties not matched by either will cause this schema to fail.')\n\t\t},\n\t\t'definitions': {\n\t\t\t'type': 'object',\n\t\t\t'additionalProperties': { '$ref': '#' },\n\t\t\t'default': {},\n\t\t\t'description': nls.localize('schema.json.definitions', 'Not used for validation. Place subschemas here that you wish to reference inline with $ref')\n\t\t},\n\t\t'properties': {\n\t\t\t'type': 'object',\n\t\t\t'additionalProperties': { '$ref': '#' },\n\t\t\t'default': {},\n\t\t\t'description': nls.localize('schema.json.properties', 'A map of property names to schemas for each property.')\n\t\t},\n\t\t'patternProperties': {\n\t\t\t'type': 'object',\n\t\t\t'additionalProperties': { '$ref': '#' },\n\t\t\t'default': {},\n\t\t\t'description': nls.localize('schema.json.patternProperties', 'A map of regular expressions on property names to schemas for matching properties.')\n\t\t},\n\t\t'dependencies': {\n\t\t\t'type': 'object',\n\t\t\t'additionalProperties': {\n\t\t\t\t'anyOf': [\n\t\t\t\t\t{ '$ref': '#' },\n\t\t\t\t\t{ '$ref': '#/definitions/stringArray' }\n\t\t\t\t]\n\t\t\t},\n\t\t\t'description': nls.localize('schema.json.dependencies', 'A map of property names to either an array of property names or a schema. An array of property names means the property named in the key depends on the properties in the array being present in the object in order to be valid. If the value is a schema, then the schema is only applied to the object if the property in the key exists on the object.')\n\t\t},\n\t\t'enum': {\n\t\t\t'type': 'array',\n\t\t\t'minItems': 1,\n\t\t\t'uniqueItems': true,\n\t\t\t'description': nls.localize('schema.json.enum', 'The set of literal values that are valid')\n\t\t},\n\t\t'type': {\n\t\t\t'anyOf': [\n\t\t\t\t{ '$ref': '#/definitions/simpleTypes' },\n\t\t\t\t{\n\t\t\t\t\t'type': 'array',\n\t\t\t\t\t'items': { '$ref': '#/definitions/simpleTypes' },\n\t\t\t\t\t'minItems': 1,\n\t\t\t\t\t'uniqueItems': true\n\t\t\t\t}\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.type', 'Either a string of one of the basic schema types (number, integer, null, array, object, boolean, string) or an array of strings specifying a subset of those types.')\n\t\t},\n\t\t'format': {\n\t\t\t'anyOf': [\n\t\t\t\t{\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'description': nls.localize('schema.json.format', 'Describes the format expected for the value.'),\n\t\t\t\t\t'enum': ['date-time', 'uri', 'email', 'hostname', 'ipv4', 'ipv6', 'regex']\n\t\t\t\t}, {\n\t\t\t\t\t'type': 'string'\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t'allOf': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/schemaArray' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.allOf', 'An array of schemas, all of which must match.')\n\t\t},\n\t\t'anyOf': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/schemaArray' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.anyOf', 'An array of schemas, where at least one must match.')\n\t\t},\n\t\t'oneOf': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#/definitions/schemaArray' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.oneOf', 'An array of schemas, exactly one of which must match.')\n\t\t},\n\t\t'not': {\n\t\t\t'allOf': [\n\t\t\t\t{ '$ref': '#' }\n\t\t\t],\n\t\t\t'description': nls.localize('schema.json.not', 'A schema which must not match.')\n\t\t}\n\t},\n\t'dependencies': {\n\t\t'exclusiveMaximum': ['maximum'],\n\t\t'exclusiveMinimum': ['minimum']\n\t},\n\t'default': {}\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport {IJSONSchema} from 'vs/base/common/jsonSchema';\nimport * as paths from 'vs/base/common/paths';\nimport Severity from 'vs/base/common/severity';\nimport {IActivationEventListener, IMessage, IExtensionDescription, IPointListener} from 'vs/platform/extensions/common/extensions';\nimport {Extensions, IJSONContributionRegistry} from 'vs/platform/jsonschemas/common/jsonContributionRegistry';\nimport {Registry} from 'vs/platform/platform';\n\nexport interface IExtensionMessageCollector {\n\terror(message: string): void;\n\twarn(message: string): void;\n\tinfo(message: string): void;\n}\n\nclass ExtensionMessageCollector implements IExtensionMessageCollector {\n\n\tprivate _messageHandler: (msg:IMessage)=>void;\n\tprivate _source: string;\n\n\tconstructor(messageHandler: (msg:IMessage)=>void, source:string) {\n\t\tthis._messageHandler = messageHandler;\n\t\tthis._source = source;\n\t}\n\n\tprivate _msg(type:Severity, message:string): void {\n\t\tthis._messageHandler({\n\t\t\ttype: type,\n\t\t\tmessage: message,\n\t\t\tsource: this._source\n\t\t});\n\t}\n\n\tpublic error(message: string): void {\n\t\tthis._msg(Severity.Error, message);\n\t}\n\n\tpublic warn(message: string): void {\n\t\tthis._msg(Severity.Warning, message);\n\t}\n\n\tpublic info(message: string): void {\n\t\tthis._msg(Severity.Info, message);\n\t}\n\n}\n\nexport function isValidExtensionDescription(extensionFolderPath: string, extensionDescription: IExtensionDescription, notices: string[]): boolean {\n\tif (!extensionDescription) {\n\t\tnotices.push(nls.localize('extensionDescription.empty', \"Got empty extension description\"));\n\t\treturn false;\n\t}\n\tif (typeof extensionDescription.publisher !== 'string') {\n\t\tnotices.push(nls.localize('extensionDescription.publisher', \"property `{0}` is mandatory and must be of type `string`\", 'publisher'));\n\t\treturn false;\n\t}\n\tif (typeof extensionDescription.name !== 'string') {\n\t\tnotices.push(nls.localize('extensionDescription.name', \"property `{0}` is mandatory and must be of type `string`\", 'name'));\n\t\treturn false;\n\t}\n\tif (typeof extensionDescription.version !== 'string') {\n\t\tnotices.push(nls.localize('extensionDescription.version', \"property `{0}` is mandatory and must be of type `string`\", 'version'));\n\t\treturn false;\n\t}\n\tif (!extensionDescription.engines) {\n\t\tnotices.push(nls.localize('extensionDescription.engines', \"property `{0}` is mandatory and must be of type `object`\", 'engines'));\n\t\treturn false;\n\t}\n\tif (typeof extensionDescription.engines.vscode !== 'string') {\n\t\tnotices.push(nls.localize('extensionDescription.engines.vscode', \"property `{0}` is mandatory and must be of type `string`\", 'engines.vscode'));\n\t\treturn false;\n\t}\n\tif (typeof extensionDescription.extensionDependencies !== 'undefined') {\n\t\tif (!_isStringArray(extensionDescription.extensionDependencies)) {\n\t\t\tnotices.push(nls.localize('extensionDescription.extensionDependencies', \"property `{0}` can be omitted or must be of type `string[]`\", 'extensionDependencies'));\n\t\t\treturn false;\n\t\t}\n\t}\n\tif (typeof extensionDescription.activationEvents !== 'undefined') {\n\t\tif (!_isStringArray(extensionDescription.activationEvents)) {\n\t\t\tnotices.push(nls.localize('extensionDescription.activationEvents1', \"property `{0}` can be omitted or must be of type `string[]`\", 'activationEvents'));\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof extensionDescription.main === 'undefined') {\n\t\t\tnotices.push(nls.localize('extensionDescription.activationEvents2', \"properties `{0}` and `{1}` must both be specified or must both be omitted\", 'activationEvents', 'main'));\n\t\t\treturn false;\n\t\t}\n\t}\n\tif (typeof extensionDescription.main !== 'undefined') {\n\t\tif (typeof extensionDescription.main !== 'string') {\n\t\t\tnotices.push(nls.localize('extensionDescription.main1', \"property `{0}` can be omitted or must be of type `string`\", 'main'));\n\t\t\treturn false;\n\t\t} else {\n\t\t\tlet normalizedAbsolutePath = paths.normalize(paths.join(extensionFolderPath, extensionDescription.main));\n\n\t\t\tif (normalizedAbsolutePath.indexOf(extensionFolderPath)) {\n\t\t\t\tnotices.push(nls.localize('extensionDescription.main2', \"Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.\", normalizedAbsolutePath, extensionFolderPath));\n\t\t\t\t// not a failure case\n\t\t\t}\n\t\t}\n\t\tif (typeof extensionDescription.activationEvents === 'undefined') {\n\t\t\tnotices.push(nls.localize('extensionDescription.main3', \"properties `{0}` and `{1}` must both be specified or must both be omitted\", 'activationEvents', 'main'));\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\ninterface IExtensionDescriptionMap {\n\t[extensionId: string]: IExtensionDescription;\n}\nconst hasOwnProperty = Object.hasOwnProperty;\nlet schemaRegistry = <IJSONContributionRegistry>Registry.as(Extensions.JSONContribution);\n\nexport interface IExtensionPointUser<T> {\n\tdescription: IExtensionDescription;\n\tvalue: T;\n\tcollector: IExtensionMessageCollector;\n}\n\nexport interface IExtensionPointHandler<T> {\n\t(extensions: IExtensionPointUser<T>[]): void;\n}\n\nexport interface IExtensionPoint<T> {\n\tname: string;\n\tsetHandler(handler: IExtensionPointHandler<T>): void;\n}\n\nexport interface IExtensionsRegistry {\n\tregisterExtensions(extensionDescriptions: IExtensionDescription[]): void;\n\n\tgetExtensionDescriptionsForActivationEvent(activationEvent: string): IExtensionDescription[];\n\tgetAllExtensionDescriptions(): IExtensionDescription[];\n\tgetExtensionDescription(extensionId: string): IExtensionDescription;\n\n\tregisterOneTimeActivationEventListener(activationEvent: string, listener: IActivationEventListener): void;\n\ttriggerActivationEventListeners(activationEvent: string): void;\n\n\tregisterExtensionPoint<T>(extensionPoint: string, jsonSchema: IJSONSchema): IExtensionPoint<T>;\n\thandleExtensionPoints(messageHandler: (msg:IMessage)=>void): void;\n}\n\nclass ExtensionPoint<T> implements IExtensionPoint<T> {\n\n\tpublic name: string;\n\tprivate _registry: ExtensionsRegistryImpl;\n\tprivate _handler: IExtensionPointHandler<T>;\n\tprivate _messageHandler: (msg:IMessage)=>void;\n\n\tconstructor(name: string, registry: ExtensionsRegistryImpl) {\n\t\tthis.name = name;\n\t\tthis._registry = registry;\n\t\tthis._handler = null;\n\t\tthis._messageHandler = null;\n\t}\n\n\tsetHandler(handler: IExtensionPointHandler<T>): void {\n\t\tif (this._handler) {\n\t\t\tthrow new Error('Handler already set!');\n\t\t}\n\t\tthis._handler = handler;\n\t\tthis._handle();\n\t}\n\n\thandle(messageHandler: (msg:IMessage)=>void): void {\n\t\tthis._messageHandler = messageHandler;\n\t\tthis._handle();\n\t}\n\n\tprivate _handle(): void {\n\t\tif (!this._handler || !this._messageHandler) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._registry.registerPointListener(this.name, (descriptions: IExtensionDescription[]) => {\n\t\t\tlet users = descriptions.map((desc) => {\n\t\t\t\treturn {\n\t\t\t\t\tdescription: desc,\n\t\t\t\t\tvalue: desc.contributes[this.name],\n\t\t\t\t\tcollector: new ExtensionMessageCollector(this._messageHandler, desc.extensionFolderPath)\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis._handler(users);\n\t\t});\n\t}\n}\n\n\n\nconst schemaId = 'vscode://schemas/vscode-extensions';\nconst schema: IJSONSchema = {\n\tdefault: {\n\t\t'name': '{{name}}',\n\t\t'description': '{{description}}',\n\t\t'author': '{{author}}',\n\t\t'version': '{{1.0.0}}',\n\t\t'main': '{{pathToMain}}',\n\t\t'dependencies': {}\n\t},\n\tproperties: {\n\t\t// engines: {\n\t\t// \trequired: [ 'vscode' ],\n\t\t// \tproperties: {\n\t\t// \t\t'vscode': {\n\t\t// \t\t\ttype: 'string',\n\t\t// \t\t\tdescription: nls.localize('vscode.extension.engines.vscode', 'Specifies that this package only runs inside VSCode of the given version.'),\n\t\t// \t\t}\n\t\t// \t}\n\t\t// },\n\t\tdisplayName: {\n\t\t\tdescription: nls.localize('vscode.extension.displayName', 'The display name for the extension used in the VS Code gallery.'),\n\t\t\ttype: 'string'\n\t\t},\n\t\tcategories: {\n\t\t\tdescription: nls.localize('vscode.extension.categories', 'The categories used by the VS Code gallery to categorize the extension.'),\n\t\t\ttype: 'array',\n\t\t\titems: {\n\t\t\t\ttype: 'string',\n\t\t\t\tenum: ['Languages', 'Snippets', 'Linters', 'Themes', 'Debuggers', 'Productivity', 'Other']\n\t\t\t}\n\t\t},\n\t\tgalleryBanner: {\n\t\t\ttype: 'object',\n\t\t\tdescription: nls.localize('vscode.extension.galleryBanner', 'Banner used in the VS Code marketplace.'),\n\t\t\tproperties: {\n\t\t\t\tcolor: {\n\t\t\t\t\tdescription: nls.localize('vscode.extension.galleryBanner.color', 'The banner color on the VS Code marketplace page header.'),\n\t\t\t\t\ttype: 'string'\n\t\t\t\t},\n\t\t\t\ttheme: {\n\t\t\t\t\tdescription: nls.localize('vscode.extension.galleryBanner.theme', 'The color theme for the font used in the banner.'),\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['dark', 'light']\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tpublisher: {\n\t\t\tdescription: nls.localize('vscode.extension.publisher', 'The publisher of the VS Code extension.'),\n\t\t\ttype: 'string'\n\t\t},\n\t\tactivationEvents: {\n\t\t\tdescription: nls.localize('vscode.extension.activationEvents', 'Activation events for the VS Code extension.'),\n\t\t\ttype: 'array',\n\t\t\titems: {\n\t\t\t\ttype: 'string'\n\t\t\t}\n\t\t},\n\t\textensionDependencies: {\n\t\t\tdescription: nls.localize('vscode.extension.extensionDependencies', 'Dependencies to other extensions. The identifier of an extension is always ${publisher}.${name}. For example: vscode.csharp.'),\n\t\t\ttype: 'array',\n\t\t\titems: {\n\t\t\t\ttype: 'string'\n\t\t\t}\n\t\t},\n\t\tscripts: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\t'vscode:prepublish': {\n\t\t\t\t\tdescription: nls.localize('vscode.extension.scripts.prepublish', 'Script executed before the package is published as a VS Code extension.'),\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcontributes: {\n\t\t\tdescription: nls.localize('vscode.extension.contributes', 'All contributions of the VS Code extension represented by this package.'),\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\t// extensions will fill in\n\t\t\t},\n\t\t\tdefault: {}\n\t\t}\n\t}\n};\n\ninterface IPointListenerEntry {\n\textensionPoint: string;\n\tlistener: IPointListener;\n}\n\nclass ExtensionsRegistryImpl implements IExtensionsRegistry {\n\n\tprivate _extensionsMap: IExtensionDescriptionMap;\n\tprivate _extensionsArr: IExtensionDescription[];\n\tprivate _activationMap: { [activationEvent: string]: IExtensionDescription[]; };\n\tprivate _pointListeners: IPointListenerEntry[];\n\tprivate _oneTimeActivationEventListeners: { [activationEvent: string]: IActivationEventListener[]; };\n\tprivate _extensionPoints: { [extPoint: string]: ExtensionPoint<any>; };\n\n\tconstructor() {\n\t\tthis._extensionsMap = {};\n\t\tthis._extensionsArr = [];\n\t\tthis._activationMap = {};\n\t\tthis._pointListeners = [];\n\t\tthis._extensionPoints = {};\n\t\tthis._oneTimeActivationEventListeners = {};\n\t}\n\n\tpublic registerPointListener(point: string, handler: IPointListener): void {\n\t\tlet entry = {\n\t\t\textensionPoint: point,\n\t\t\tlistener: handler\n\t\t};\n\t\tthis._pointListeners.push(entry);\n\t\tthis._triggerPointListener(entry, ExtensionsRegistryImpl._filterWithExtPoint(this.getAllExtensionDescriptions(), point));\n\t}\n\n\tpublic registerExtensionPoint<T>(extensionPoint: string, jsonSchema: IJSONSchema): IExtensionPoint<T> {\n\t\tif (hasOwnProperty.call(this._extensionPoints, extensionPoint)) {\n\t\t\tthrow new Error('Duplicate extension point: ' + extensionPoint);\n\t\t}\n\t\tlet result = new ExtensionPoint<T>(extensionPoint, this);\n\t\tthis._extensionPoints[extensionPoint] = result;\n\n\t\tschema.properties['contributes'].properties[extensionPoint] = jsonSchema;\n\t\tschemaRegistry.registerSchema(schemaId, schema);\n\n\t\treturn result;\n\t}\n\n\tpublic handleExtensionPoints(messageHandler: (msg:IMessage)=>void): void {\n\t\tObject.keys(this._extensionPoints).forEach((extensionPointName) => {\n\t\t\tthis._extensionPoints[extensionPointName].handle(messageHandler);\n\t\t});\n\t}\n\n\tprivate _triggerPointListener(handler: IPointListenerEntry, desc: IExtensionDescription[]): void {\n\t\t// console.log('_triggerPointListeners: ' + desc.length + ' OF ' + handler.extensionPoint);\n\t\tif (!desc || desc.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\thandler.listener(desc);\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t}\n\n\tpublic registerExtensions(extensionDescriptions: IExtensionDescription[]): void {\n\t\tfor (let i = 0, len = extensionDescriptions.length; i < len; i++) {\n\t\t\tlet extensionDescription = extensionDescriptions[i];\n\n\t\t\tif (hasOwnProperty.call(this._extensionsMap, extensionDescription.id)) {\n\t\t\t\t// No overwriting allowed!\n\t\t\t\tconsole.error('Extension `' + extensionDescription.id + '` is already registered');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._extensionsMap[extensionDescription.id] = extensionDescription;\n\t\t\tthis._extensionsArr.push(extensionDescription);\n\n\t\t\tif (Array.isArray(extensionDescription.activationEvents)) {\n\t\t\t\tfor (let j = 0, lenJ = extensionDescription.activationEvents.length; j < lenJ; j++) {\n\t\t\t\t\tlet activationEvent = extensionDescription.activationEvents[j];\n\t\t\t\t\tthis._activationMap[activationEvent] = this._activationMap[activationEvent] || [];\n\t\t\t\t\tthis._activationMap[activationEvent].push(extensionDescription);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0, len = this._pointListeners.length; i < len; i++) {\n\t\t\tlet listenerEntry = this._pointListeners[i];\n\t\t\tlet descriptions = ExtensionsRegistryImpl._filterWithExtPoint(extensionDescriptions, listenerEntry.extensionPoint);\n\t\t\tthis._triggerPointListener(listenerEntry, descriptions);\n\t\t}\n\t}\n\n\tprivate static _filterWithExtPoint(input: IExtensionDescription[], point: string): IExtensionDescription[] {\n\t\treturn input.filter((desc) => {\n\t\t\treturn (desc.contributes && hasOwnProperty.call(desc.contributes, point));\n\t\t});\n\t}\n\n\tpublic getExtensionDescriptionsForActivationEvent(activationEvent: string): IExtensionDescription[] {\n\t\tif (!hasOwnProperty.call(this._activationMap, activationEvent)) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this._activationMap[activationEvent].slice(0);\n\t}\n\n\tpublic getAllExtensionDescriptions(): IExtensionDescription[] {\n\t\treturn this._extensionsArr.slice(0);\n\t}\n\n\tpublic getExtensionDescription(extensionId: string): IExtensionDescription {\n\t\tif (!hasOwnProperty.call(this._extensionsMap, extensionId)) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._extensionsMap[extensionId];\n\t}\n\n\tpublic registerOneTimeActivationEventListener(activationEvent: string, listener: IActivationEventListener): void {\n\t\tif (!hasOwnProperty.call(this._oneTimeActivationEventListeners, activationEvent)) {\n\t\t\tthis._oneTimeActivationEventListeners[activationEvent] = [];\n\t\t}\n\t\tthis._oneTimeActivationEventListeners[activationEvent].push(listener);\n\t}\n\n\tpublic triggerActivationEventListeners(activationEvent: string): void {\n\t\tif (hasOwnProperty.call(this._oneTimeActivationEventListeners, activationEvent)) {\n\t\t\tlet listeners = this._oneTimeActivationEventListeners[activationEvent];\n\t\t\tdelete this._oneTimeActivationEventListeners[activationEvent];\n\n\t\t\tfor (let i = 0, len = listeners.length; i < len; i++) {\n\t\t\t\tlet listener = listeners[i];\n\t\t\t\ttry {\n\t\t\t\t\tlistener();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tonUnexpectedError(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nfunction _isStringArray(arr: string[]): boolean {\n\tif (!Array.isArray(arr)) {\n\t\treturn false;\n\t}\n\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\tif (typeof arr[i] !== 'string') {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nconst PRExtensions = {\n\tExtensionsRegistry: 'ExtensionsRegistry'\n};\nRegistry.add(PRExtensions.ExtensionsRegistry, new ExtensionsRegistryImpl());\nexport const ExtensionsRegistry: IExtensionsRegistry = Registry.as(PRExtensions.ExtensionsRegistry);\n\nschemaRegistry.registerSchema(schemaId, schema);","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport nls = require('vs/nls');\nimport Event, {Emitter} from 'vs/base/common/event';\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\nimport platform = require('vs/platform/platform');\nimport objects = require('vs/base/common/objects');\nimport {ExtensionsRegistry} from 'vs/platform/extensions/common/extensionsRegistry';\nimport JSONContributionRegistry = require('vs/platform/jsonschemas/common/jsonContributionRegistry');\n\n\nexport const Extensions = {\n\tConfiguration: 'base.contributions.configuration'\n};\n\nexport interface IConfigurationRegistry {\n\n\t/**\n\t * Register a configuration to the registry.\n\t */\n\tregisterConfiguration(configuration: IConfigurationNode): void;\n\n\t/**\n\t * Event that fires whenver a configuratio has been\n\t * registered.\n\t */\n\tonDidRegisterConfiguration: Event<IConfigurationRegistry>;\n\n\t/**\n\t * Returns all configurations contributed to this registry.\n\t */\n\tgetConfigurations(): IConfigurationNode[];\n}\n\nexport interface IConfigurationNode {\n\tid?: string;\n\torder?: number;\n\ttype?: string | string[];\n\ttitle?: string;\n\tdescription?: string;\n\tdefault?: any;\n\tproperties?: { [path: string]: IJSONSchema; };\n\tallOf?: IJSONSchema[];\n\tdefinitions?: { [path: string]: IJSONSchema; };\n}\n\nconst schemaId = 'vscode://schemas/settings';\nconst contributionRegistry = <JSONContributionRegistry.IJSONContributionRegistry>platform.Registry.as(JSONContributionRegistry.Extensions.JSONContribution);\n\nclass ConfigurationRegistry implements IConfigurationRegistry {\n\tprivate configurationContributors: IConfigurationNode[];\n\tprivate configurationSchema: IJSONSchema;\n\tprivate _onDidRegisterConfiguration: Emitter<IConfigurationRegistry>;\n\n\tconstructor() {\n\t\tthis.configurationContributors = [];\n\t\tthis.configurationSchema = { allOf: [] };\n\t\tthis._onDidRegisterConfiguration = new Emitter<IConfigurationRegistry>();\n\n\t\tcontributionRegistry.registerSchema(schemaId, this.configurationSchema);\n\t}\n\n\tpublic get onDidRegisterConfiguration() {\n\t\treturn this._onDidRegisterConfiguration.event;\n\t}\n\n\tpublic registerConfiguration(configuration: IConfigurationNode): void {\n\t\tthis.configurationContributors.push(configuration);\n\n\t\tthis.registerJSONConfiguration(configuration);\n\t\tthis._onDidRegisterConfiguration.fire(this);\n\t}\n\n\tpublic getConfigurations(): IConfigurationNode[] {\n\t\treturn this.configurationContributors.slice(0);\n\t}\n\n\tprivate registerJSONConfiguration(configuration: IConfigurationNode) {\n\t\tlet schema = <IJSONSchema>objects.clone(configuration);\n\t\tthis.configurationSchema.allOf.push(schema);\n\t\tcontributionRegistry.registerSchema(schemaId, this.configurationSchema);\n\t}\n}\n\nconst configurationRegistry = new ConfigurationRegistry();\nplatform.Registry.add(Extensions.Configuration, configurationRegistry);\n\nlet configurationExtPoint = ExtensionsRegistry.registerExtensionPoint<IConfigurationNode>('configuration', {\n\tdescription: nls.localize('vscode.extension.contributes.configuration', 'Contributes configuration settings.'),\n\ttype: 'object',\n\tdefaultSnippets: [{ body: { title: '', properties: {} } }],\n\tproperties: {\n\t\ttitle: {\n\t\t\tdescription: nls.localize('vscode.extension.contributes.configuration.title', 'A summary of the settings. This label will be used in the settings file as separating comment.'),\n\t\t\ttype: 'string'\n\t\t},\n\t\tproperties: {\n\t\t\tdescription: nls.localize('vscode.extension.contributes.configuration.properties', 'Description of the configuration properties.'),\n\t\t\ttype: 'object',\n\t\t\tadditionalProperties: {\n\t\t\t\t$ref: 'http://json-schema.org/draft-04/schema#'\n\t\t\t}\n\t\t}\n\t}\n});\n\nconfigurationExtPoint.setHandler((extensions) => {\n\tfor (let i = 0; i < extensions.length; i++) {\n\t\tlet configuration = <IConfigurationNode>extensions[i].value;\n\t\tlet collector = extensions[i].collector;\n\n\t\tif (configuration.type && configuration.type !== 'object') {\n\t\t\tcollector.warn(nls.localize('invalid.type', \"if set, 'configuration.type' must be set to 'object\"));\n\t\t} else {\n\t\t\tconfiguration.type = 'object';\n\t\t}\n\n\t\tif (configuration.title && (typeof configuration.title !== 'string')) {\n\t\t\tcollector.error(nls.localize('invalid.title', \"'configuration.title' must be a string\"));\n\t\t}\n\n\t\tif (configuration.properties && (typeof configuration.properties !== 'object')) {\n\t\t\tcollector.error(nls.localize('invalid.properties', \"'configuration.properties' must be an object\"));\n\t\t\treturn;\n\t\t}\n\t\tlet clonedConfiguration = objects.clone(configuration);\n\t\tclonedConfiguration.id = extensions[i].description.id;\n\t\tconfigurationRegistry.registerConfiguration(clonedConfiguration);\n\t}\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {IReadOnlyModel} from 'vs/editor/common/editorCommon';\nimport {ISuggestResult, ISuggestSupport} from 'vs/editor/common/modes';\nimport {IFilter, matchesStrictPrefix, fuzzyContiguousFilter} from 'vs/base/common/filters';\nimport {IEditorWorkerService} from 'vs/editor/common/services/editorWorkerService';\nimport {IConfigurationService} from 'vs/platform/configuration/common/configuration';\nimport {IConfigurationRegistry, Extensions} from 'vs/platform/configuration/common/configurationRegistry';\nimport {Registry} from 'vs/platform/platform';\nimport {localize} from 'vs/nls';\nimport {CancellationToken} from 'vs/base/common/cancellation';\nimport {wireCancellationToken} from 'vs/base/common/async';\nimport {Position} from 'vs/editor/common/core/position';\n\nexport class TextualSuggestSupport implements ISuggestSupport {\n\n\t/* tslint:disable */\n\tprivate static _c = Registry.as<IConfigurationRegistry>(Extensions.Configuration).registerConfiguration({\n\t\ttype: 'object',\n\t\torder: 5.1,\n\t\tproperties: {\n\t\t\t'editor.wordBasedSuggestions': {\n\t\t\t\t'type': 'boolean',\n\t\t\t\t'description': localize('editor.wordBasedSuggestions', \"Enable word based suggestions.\"),\n\t\t\t\t'default': true\n\t\t\t}\n\t\t}\n\t});\n\t/* tslint:enable */\n\n\tpublic get triggerCharacters(): string[] {\n\t\treturn [];\n\t}\n\n\tpublic get shouldAutotriggerSuggest(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic get filter(): IFilter {\n\t\treturn matchesStrictPrefix;\n\t}\n\n\tprivate _editorWorkerService: IEditorWorkerService;\n\tprivate _configurationService: IConfigurationService;\n\n\tconstructor(editorWorkerService: IEditorWorkerService, configurationService: IConfigurationService) {\n\t\tthis._editorWorkerService = editorWorkerService;\n\t\tthis._configurationService = configurationService;\n\t}\n\n\tpublic provideCompletionItems(model:IReadOnlyModel, position:Position, token:CancellationToken): ISuggestResult[] | Thenable<ISuggestResult[]> {\n\t\tlet config = this._configurationService.getConfiguration<{ wordBasedSuggestions: boolean }>('editor');\n\t\tif (!config || config.wordBasedSuggestions) {\n\t\t\treturn wireCancellationToken(token, this._editorWorkerService.textualSuggest(model.uri, position));\n\t\t}\n\t\treturn <ISuggestResult[]>[];\n\t}\n}\n\nexport function filterSuggestions(value: ISuggestResult): ISuggestResult[] {\n\tif (!value) {\n\t\treturn;\n\t}\n\t// filter suggestions\n\tvar accept = fuzzyContiguousFilter,\n\t\tresult: ISuggestResult[] = [];\n\n\tresult.push({\n\t\tcurrentWord: value.currentWord,\n\t\tsuggestions: value.suggestions.filter((element) => !!accept(value.currentWord, element.label)),\n\t\tincomplete: value.incomplete\n\t});\n\n\treturn result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {EventEmitter} from 'vs/base/common/eventEmitter';\nimport {IDisposable} from 'vs/base/common/lifecycle';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {AsyncDescriptor1, createAsyncDescriptor1} from 'vs/platform/instantiation/common/descriptors';\nimport {IInstantiationService, optional} from 'vs/platform/instantiation/common/instantiation';\nimport {IConfigurationService} from 'vs/platform/configuration/common/configuration';\nimport {IModeSupportChangedEvent} from 'vs/editor/common/editorCommon';\nimport * as modes from 'vs/editor/common/modes';\nimport {TextualSuggestSupport} from 'vs/editor/common/modes/supports/suggestSupport';\nimport {IEditorWorkerService} from 'vs/editor/common/services/editorWorkerService';\nimport * as wordHelper from 'vs/editor/common/model/wordHelper';\nimport {ICompatWorkerService, ICompatMode} from 'vs/editor/common/services/compatWorkerService';\n\nexport function createWordRegExp(allowInWords:string = ''): RegExp {\n\treturn wordHelper.createWordRegExp(allowInWords);\n}\n\nexport class ModeWorkerManager<W> {\n\n\tprivate _descriptor: modes.IModeDescriptor;\n\tprivate _workerDescriptor: AsyncDescriptor1<string, W>;\n\tprivate _superWorkerModuleId: string;\n\tprivate _instantiationService: IInstantiationService;\n\tprivate _workerPiecePromise:TPromise<W>;\n\n\tconstructor(\n\t\tdescriptor:modes.IModeDescriptor,\n\t\tworkerModuleId:string,\n\t\tworkerClassName:string,\n\t\tsuperWorkerModuleId:string,\n\t\tinstantiationService: IInstantiationService\n\t) {\n\t\tthis._descriptor = descriptor;\n\t\tthis._workerDescriptor = createAsyncDescriptor1(workerModuleId, workerClassName);\n\t\tthis._superWorkerModuleId = superWorkerModuleId;\n\t\tthis._instantiationService = instantiationService;\n\t\tthis._workerPiecePromise = null;\n\t}\n\n\tpublic worker<T>(runner:(worker:W)=>TPromise<T>): TPromise<T>\n\tpublic worker<T>(runner:(worker:W)=>T): TPromise<T> {\n\t\treturn this._getOrCreateWorker().then(runner);\n\t}\n\n\tprivate _getOrCreateWorker(): TPromise<W> {\n\t\tif (!this._workerPiecePromise) {\n\t\t\t// TODO@Alex: workaround for missing `bundles` config\n\n\t\t\t// First, load the code of the worker super class\n\t\t\tlet superWorkerCodePromise = (this._superWorkerModuleId ? ModeWorkerManager._loadModule(this._superWorkerModuleId) : TPromise.as(null));\n\n\t\t\tthis._workerPiecePromise = superWorkerCodePromise.then(() => {\n\t\t\t\t// Second, load the code of the worker (without instantiating it)\n\t\t\t\treturn ModeWorkerManager._loadModule(this._workerDescriptor.moduleName);\n\t\t\t}).then(() => {\n\t\t\t\t// Finally, create the mode worker instance\n\t\t\t\treturn this._instantiationService.createInstance<string, W>(this._workerDescriptor, this._descriptor.id);\n\t\t\t});\n\t\t}\n\n\t\treturn this._workerPiecePromise;\n\t}\n\n\tprivate static _loadModule(moduleName:string): TPromise<any> {\n\t\treturn new TPromise((c, e, p) => {\n\t\t\t// Use the global require to be sure to get the global config\n\t\t\t(<any>self).require([moduleName], c, e);\n\t\t}, () => {\n\t\t\t// Cannot cancel loading code\n\t\t});\n\t}\n}\n\nexport abstract class AbstractMode implements modes.IMode {\n\n\tprivate _modeId: string;\n\tprivate _eventEmitter: EventEmitter;\n\tprivate _simplifiedMode: modes.IMode;\n\n\tconstructor(modeId:string) {\n\t\tthis._modeId = modeId;\n\t\tthis._eventEmitter = new EventEmitter();\n\t\tthis._simplifiedMode = null;\n\t}\n\n\tpublic getId(): string {\n\t\treturn this._modeId;\n\t}\n\n\tpublic toSimplifiedMode(): modes.IMode {\n\t\tif (!this._simplifiedMode) {\n\t\t\tthis._simplifiedMode = new SimplifiedMode(this);\n\t\t}\n\t\treturn this._simplifiedMode;\n\t}\n\n\tpublic addSupportChangedListener(callback: (e: IModeSupportChangedEvent) => void) : IDisposable {\n\t\treturn this._eventEmitter.addListener2('modeSupportChanged', callback);\n\t}\n\n\tpublic setTokenizationSupport<T>(callback:(mode:modes.IMode) => T) : IDisposable {\n\t\tvar supportImpl = callback(this);\n\t\tthis['tokenizationSupport'] = supportImpl;\n\t\tthis._eventEmitter.emit('modeSupportChanged', _createModeSupportChangedEvent());\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tif (this['tokenizationSupport'] === supportImpl) {\n\t\t\t\t\tdelete this['tokenizationSupport'];\n\t\t\t\t\tthis._eventEmitter.emit('modeSupportChanged', _createModeSupportChangedEvent());\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport abstract class CompatMode extends AbstractMode implements ICompatMode {\n\n\tpublic compatWorkerService:ICompatWorkerService;\n\n\tconstructor(modeId:string, compatWorkerService:ICompatWorkerService) {\n\t\tsuper(modeId);\n\t\tthis.compatWorkerService = compatWorkerService;\n\n\t\tif (this.compatWorkerService) {\n\t\t\tthis.compatWorkerService.registerCompatMode(this);\n\t\t}\n\t}\n\n}\n\nclass SimplifiedMode implements modes.IMode {\n\n\ttokenizationSupport: modes.ITokenizationSupport;\n\n\tprivate _sourceMode: modes.IMode;\n\tprivate _eventEmitter: EventEmitter;\n\tprivate _id: string;\n\n\tconstructor(sourceMode: modes.IMode) {\n\t\tthis._sourceMode = sourceMode;\n\t\tthis._eventEmitter = new EventEmitter();\n\t\tthis._id = 'vs.editor.modes.simplifiedMode:' + sourceMode.getId();\n\t\tthis._assignSupports();\n\n\t\tif (this._sourceMode.addSupportChangedListener) {\n\t\t\tthis._sourceMode.addSupportChangedListener((e) => {\n\t\t\t\tthis._assignSupports();\n\t\t\t\tthis._eventEmitter.emit('modeSupportChanged', e);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic getId(): string {\n\t\treturn this._id;\n\t}\n\n\tpublic toSimplifiedMode(): modes.IMode {\n\t\treturn this;\n\t}\n\n\tprivate _assignSupports(): void {\n\t\tthis.tokenizationSupport = this._sourceMode.tokenizationSupport;\n\t}\n}\n\nexport var isDigit:(character:string, base:number)=>boolean = (function () {\n\n\tvar _0 = '0'.charCodeAt(0),\n\t\t_1 = '1'.charCodeAt(0),\n\t\t_2 = '2'.charCodeAt(0),\n\t\t_3 = '3'.charCodeAt(0),\n\t\t_4 = '4'.charCodeAt(0),\n\t\t_5 = '5'.charCodeAt(0),\n\t\t_6 = '6'.charCodeAt(0),\n\t\t_7 = '7'.charCodeAt(0),\n\t\t_8 = '8'.charCodeAt(0),\n\t\t_9 = '9'.charCodeAt(0),\n\t\t_a = 'a'.charCodeAt(0),\n\t\t_b = 'b'.charCodeAt(0),\n\t\t_c = 'c'.charCodeAt(0),\n\t\t_d = 'd'.charCodeAt(0),\n\t\t_e = 'e'.charCodeAt(0),\n\t\t_f = 'f'.charCodeAt(0),\n\t\t_A = 'A'.charCodeAt(0),\n\t\t_B = 'B'.charCodeAt(0),\n\t\t_C = 'C'.charCodeAt(0),\n\t\t_D = 'D'.charCodeAt(0),\n\t\t_E = 'E'.charCodeAt(0),\n\t\t_F = 'F'.charCodeAt(0);\n\n\treturn function isDigit(character:string, base:number):boolean {\n\t\tvar c = character.charCodeAt(0);\n\t\tswitch (base) {\n\t\t\tcase 1:\n\t\t\t\treturn c === _0;\n\t\t\tcase 2:\n\t\t\t\treturn c >= _0 && c <= _1;\n\t\t\tcase 3:\n\t\t\t\treturn c >= _0 && c <= _2;\n\t\t\tcase 4:\n\t\t\t\treturn c >= _0 && c <= _3;\n\t\t\tcase 5:\n\t\t\t\treturn c >= _0 && c <= _4;\n\t\t\tcase 6:\n\t\t\t\treturn c >= _0 && c <= _5;\n\t\t\tcase 7:\n\t\t\t\treturn c >= _0 && c <= _6;\n\t\t\tcase 8:\n\t\t\t\treturn c >= _0 && c <= _7;\n\t\t\tcase 9:\n\t\t\t\treturn c >= _0 && c <= _8;\n\t\t\tcase 10:\n\t\t\t\treturn c >= _0 && c <= _9;\n\t\t\tcase 11:\n\t\t\t\treturn (c >= _0 && c <= _9) || (c === _a) || (c === _A);\n\t\t\tcase 12:\n\t\t\t\treturn (c >= _0 && c <= _9) || (c >= _a && c <= _b) || (c >= _A && c <= _B);\n\t\t\tcase 13:\n\t\t\t\treturn (c >= _0 && c <= _9) || (c >= _a && c <= _c) || (c >= _A && c <= _C);\n\t\t\tcase 14:\n\t\t\t\treturn (c >= _0 && c <= _9) || (c >= _a && c <= _d) || (c >= _A && c <= _D);\n\t\t\tcase 15:\n\t\t\t\treturn (c >= _0 && c <= _9) || (c >= _a && c <= _e) || (c >= _A && c <= _E);\n\t\t\tdefault:\n\t\t\t\treturn (c >= _0 && c <= _9) || (c >= _a && c <= _f) || (c >= _A && c <= _F);\n\t\t}\n\t};\n})();\n\nexport class FrankensteinMode extends AbstractMode {\n\n\tconstructor(\n\t\tdescriptor: modes.IModeDescriptor,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@optional(IEditorWorkerService) editorWorkerService: IEditorWorkerService\n\t) {\n\t\tsuper(descriptor.id);\n\n\t\tif (editorWorkerService) {\n\t\t\tmodes.SuggestRegistry.register(this.getId(), new TextualSuggestSupport(editorWorkerService, configurationService), true);\n\t\t}\n\t}\n}\n\nfunction _createModeSupportChangedEvent(): IModeSupportChangedEvent {\n\treturn {\n\t\ttokenizationSupport: true\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport {onUnexpectedError} from 'vs/base/common/errors';\nimport Event, {Emitter} from 'vs/base/common/event';\nimport {IDisposable, empty as EmptyDisposable} from 'vs/base/common/lifecycle'; // TODO@Alex\nimport * as objects from 'vs/base/common/objects';\nimport * as paths from 'vs/base/common/paths';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport mime = require('vs/base/common/mime');\nimport {IFilesConfiguration} from 'vs/platform/files/common/files';\nimport {createAsyncDescriptor1} from 'vs/platform/instantiation/common/descriptors';\nimport {IExtensionService} from 'vs/platform/extensions/common/extensions';\nimport {IExtensionPointUser, IExtensionMessageCollector, ExtensionsRegistry} from 'vs/platform/extensions/common/extensionsRegistry';\nimport {IInstantiationService} from 'vs/platform/instantiation/common/instantiation';\nimport * as modes from 'vs/editor/common/modes';\nimport {FrankensteinMode} from 'vs/editor/common/modes/abstractMode';\nimport {ModesRegistry} from 'vs/editor/common/modes/modesRegistry';\nimport {LanguagesRegistry} from 'vs/editor/common/services/languagesRegistry';\nimport {ILanguageExtensionPoint, IValidLanguageExtensionPoint, IModeLookupResult, IModeService} from 'vs/editor/common/services/modeService';\nimport {IConfigurationService} from 'vs/platform/configuration/common/configuration';\nimport {AbstractState} from 'vs/editor/common/modes/abstractState';\nimport {Token} from 'vs/editor/common/modes/supports';\n\ninterface IModeConfigurationMap { [modeId: string]: any; }\n\nlet languagesExtPoint = ExtensionsRegistry.registerExtensionPoint<ILanguageExtensionPoint[]>('languages', {\n\tdescription: nls.localize('vscode.extension.contributes.languages', 'Contributes language declarations.'),\n\ttype: 'array',\n\tdefaultSnippets: [{ body: [{ id: '', aliases: [], extensions: [] }] }],\n\titems: {\n\t\ttype: 'object',\n\t\tdefaultSnippets: [{ body: { id: '', extensions: [] } }],\n\t\tproperties: {\n\t\t\tid: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.id', 'ID of the language.'),\n\t\t\t\ttype: 'string'\n\t\t\t},\n\t\t\taliases: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.aliases', 'Name aliases for the language.'),\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t},\n\t\t\textensions: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.extensions', 'File extensions associated to the language.'),\n\t\t\t\tdefault: ['.foo'],\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t},\n\t\t\tfilenames: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.filenames', 'File names associated to the language.'),\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t},\n\t\t\tfilenamePatterns: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.filenamePatterns', 'File name glob patterns associated to the language.'),\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t},\n\t\t\tmimetypes: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.mimetypes', 'Mime types associated to the language.'),\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t},\n\t\t\tfirstLine: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.firstLine', 'A regular expression matching the first line of a file of the language.'),\n\t\t\t\ttype: 'string'\n\t\t\t},\n\t\t\tconfiguration: {\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.languages.configuration', 'A relative path to a file containing configuration options for the language.'),\n\t\t\t\ttype: 'string'\n\t\t\t}\n\t\t}\n\t}\n});\n\nfunction isUndefinedOrStringArray(value: string[]): boolean {\n\tif (typeof value === 'undefined') {\n\t\treturn true;\n\t}\n\tif (!Array.isArray(value)) {\n\t\treturn false;\n\t}\n\treturn value.every(item => typeof item === 'string');\n}\n\nfunction isValidLanguageExtensionPoint(value:ILanguageExtensionPoint, collector:IExtensionMessageCollector): boolean {\n\tif (!value) {\n\t\tcollector.error(nls.localize('invalid.empty', \"Empty value for `contributes.{0}`\", languagesExtPoint.name));\n\t\treturn false;\n\t}\n\tif (typeof value.id !== 'string') {\n\t\tcollector.error(nls.localize('require.id', \"property `{0}` is mandatory and must be of type `string`\", 'id'));\n\t\treturn false;\n\t}\n\tif (!isUndefinedOrStringArray(value.extensions)) {\n\t\tcollector.error(nls.localize('opt.extensions', \"property `{0}` can be omitted and must be of type `string[]`\", 'extensions'));\n\t\treturn false;\n\t}\n\tif (!isUndefinedOrStringArray(value.filenames)) {\n\t\tcollector.error(nls.localize('opt.filenames', \"property `{0}` can be omitted and must be of type `string[]`\", 'filenames'));\n\t\treturn false;\n\t}\n\tif (typeof value.firstLine !== 'undefined' && typeof value.firstLine !== 'string') {\n\t\tcollector.error(nls.localize('opt.firstLine', \"property `{0}` can be omitted and must be of type `string`\", 'firstLine'));\n\t\treturn false;\n\t}\n\tif (typeof value.configuration !== 'undefined' && typeof value.configuration !== 'string') {\n\t\tcollector.error(nls.localize('opt.configuration', \"property `{0}` can be omitted and must be of type `string`\", 'configuration'));\n\t\treturn false;\n\t}\n\tif (!isUndefinedOrStringArray(value.aliases)) {\n\t\tcollector.error(nls.localize('opt.aliases', \"property `{0}` can be omitted and must be of type `string[]`\", 'aliases'));\n\t\treturn false;\n\t}\n\tif (!isUndefinedOrStringArray(value.mimetypes)) {\n\t\tcollector.error(nls.localize('opt.mimetypes', \"property `{0}` can be omitted and must be of type `string[]`\", 'mimetypes'));\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nexport class ModeServiceImpl implements IModeService {\n\tpublic serviceId = IModeService;\n\n\tprivate _instantiationService: IInstantiationService;\n\tprotected _extensionService: IExtensionService;\n\n\tprivate _activationPromises: { [modeId: string]: TPromise<modes.IMode>; };\n\tprivate _instantiatedModes: { [modeId: string]: modes.IMode; };\n\tprivate _config: IModeConfigurationMap;\n\n\tprivate _registry: LanguagesRegistry;\n\n\tprivate _onDidAddModes: Emitter<string[]> = new Emitter<string[]>();\n\tpublic onDidAddModes: Event<string[]> = this._onDidAddModes.event;\n\n\tprivate _onDidCreateMode: Emitter<modes.IMode> = new Emitter<modes.IMode>();\n\tpublic onDidCreateMode: Event<modes.IMode> = this._onDidCreateMode.event;\n\n\tconstructor(instantiationService:IInstantiationService, extensionService:IExtensionService) {\n\t\tthis._instantiationService = instantiationService;\n\t\tthis._extensionService = extensionService;\n\n\t\tthis._activationPromises = {};\n\t\tthis._instantiatedModes = {};\n\t\tthis._config = {};\n\n\t\tthis._registry = new LanguagesRegistry();\n\t\tthis._registry.onDidAddModes((modes) => this._onDidAddModes.fire(modes));\n\t}\n\n\tpublic getConfigurationForMode(modeId:string): any {\n\t\treturn this._config[modeId] || {};\n\t}\n\n\tpublic configureMode(mimetype: string, options: any): void {\n\t\tvar modeId = this.getModeId(mimetype);\n\t\tif (modeId) {\n\t\t\tthis.configureModeById(modeId, options);\n\t\t}\n\t}\n\n\tpublic configureModeById(modeId:string, options:any):void {\n\t\tvar previousOptions = this._config[modeId] || {};\n\t\tvar newOptions = objects.mixin(objects.clone(previousOptions), options);\n\n\t\tif (objects.equals(previousOptions, newOptions)) {\n\t\t\t// This configure call is a no-op\n\t\t\treturn;\n\t\t}\n\n\t\tthis._config[modeId] = newOptions;\n\n\t\tvar mode = this.getMode(modeId);\n\t\tif (mode && mode.configSupport) {\n\t\t\tmode.configSupport.configure(this.getConfigurationForMode(modeId));\n\t\t}\n\t}\n\n\tpublic configureAllModes(config:any): void {\n\t\tif (!config) {\n\t\t\treturn;\n\t\t}\n\t\tvar modes = this._registry.getRegisteredModes();\n\t\tmodes.forEach((modeIdentifier) => {\n\t\t\tvar configuration = config[modeIdentifier];\n\t\t\tthis.configureModeById(modeIdentifier, configuration);\n\t\t});\n\t}\n\n\tpublic isRegisteredMode(mimetypeOrModeId: string): boolean {\n\t\treturn this._registry.isRegisteredMode(mimetypeOrModeId);\n\t}\n\n\tpublic isCompatMode(modeId:string): boolean {\n\t\tlet compatModeData = this._registry.getCompatMode(modeId);\n\t\treturn (compatModeData ? true : false);\n\t}\n\n\tpublic getRegisteredModes(): string[] {\n\t\treturn this._registry.getRegisteredModes();\n\t}\n\n\tpublic getRegisteredLanguageNames(): string[] {\n\t\treturn this._registry.getRegisteredLanguageNames();\n\t}\n\n\tpublic getExtensions(alias: string): string[] {\n\t\treturn this._registry.getExtensions(alias);\n\t}\n\n\tpublic getMimeForMode(modeId: string): string {\n\t\treturn this._registry.getMimeForMode(modeId);\n\t}\n\n\tpublic getLanguageName(modeId: string): string {\n\t\treturn this._registry.getLanguageName(modeId);\n\t}\n\n\tpublic getModeIdForLanguageName(alias:string): string {\n\t\treturn this._registry.getModeIdForLanguageNameLowercase(alias);\n\t}\n\n\tpublic getModeId(commaSeparatedMimetypesOrCommaSeparatedIds: string): string {\n\t\tvar modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\n\n\t\tif (modeIds.length > 0) {\n\t\t\treturn modeIds[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic getConfigurationFiles(modeId: string): string[] {\n\t\treturn this._registry.getConfigurationFiles(modeId);\n\t}\n\n\t// --- instantiation\n\n\tpublic lookup(commaSeparatedMimetypesOrCommaSeparatedIds: string): IModeLookupResult[]{\n\t\tvar r: IModeLookupResult[] = [];\n\t\tvar modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\n\n\t\tfor (var i = 0; i < modeIds.length; i++) {\n\t\t\tvar modeId = modeIds[i];\n\n\t\t\tr.push({\n\t\t\t\tmodeId: modeId,\n\t\t\t\tisInstantiated: this._instantiatedModes.hasOwnProperty(modeId)\n\t\t\t});\n\t\t}\n\n\t\treturn r;\n\t}\n\n\tpublic getMode(commaSeparatedMimetypesOrCommaSeparatedIds: string): modes.IMode {\n\t\tvar modeIds = this._registry.extractModeIds(commaSeparatedMimetypesOrCommaSeparatedIds);\n\n\t\tvar isPlainText = false;\n\t\tfor (var i = 0; i < modeIds.length; i++) {\n\t\t\tif (this._instantiatedModes.hasOwnProperty(modeIds[i])) {\n\t\t\t\treturn this._instantiatedModes[modeIds[i]];\n\t\t\t}\n\t\t\tisPlainText = isPlainText || (modeIds[i] === 'plaintext');\n\t\t}\n\n\t\tif (isPlainText) {\n\t\t\t// Try to do it synchronously\n\t\t\tvar r: modes.IMode = null;\n\t\t\tthis.getOrCreateMode(commaSeparatedMimetypesOrCommaSeparatedIds).then((mode) => {\n\t\t\t\tr = mode;\n\t\t\t}).done(null, onUnexpectedError);\n\t\t\treturn r;\n\t\t}\n\t}\n\n\tpublic getModeIdByLanguageName(languageName: string): string {\n\t\tvar modeIds = this._registry.getModeIdsFromLanguageName(languageName);\n\n\t\tif (modeIds.length > 0) {\n\t\t\treturn modeIds[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic getModeIdByFilenameOrFirstLine(filename: string, firstLine?:string): string {\n\t\tvar modeIds = this._registry.getModeIdsFromFilenameOrFirstLine(filename, firstLine);\n\n\t\tif (modeIds.length > 0) {\n\t\t\treturn modeIds[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic onReady(): TPromise<boolean> {\n\t\treturn this._extensionService.onReady();\n\t}\n\n\tpublic getOrCreateMode(commaSeparatedMimetypesOrCommaSeparatedIds: string): TPromise<modes.IMode> {\n\t\treturn this.onReady().then(() => {\n\t\t\tvar modeId = this.getModeId(commaSeparatedMimetypesOrCommaSeparatedIds);\n\t\t\t// Fall back to plain text if no mode was found\n\t\t\treturn this._getOrCreateMode(modeId || 'plaintext');\n\t\t});\n\t}\n\n\tpublic getOrCreateModeByLanguageName(languageName: string): TPromise<modes.IMode> {\n\t\treturn this.onReady().then(() => {\n\t\t\tvar modeId = this.getModeIdByLanguageName(languageName);\n\t\t\t// Fall back to plain text if no mode was found\n\t\t\treturn this._getOrCreateMode(modeId || 'plaintext');\n\t\t});\n\t}\n\n\tpublic getOrCreateModeByFilenameOrFirstLine(filename: string, firstLine?:string): TPromise<modes.IMode> {\n\t\treturn this.onReady().then(() => {\n\t\t\tvar modeId = this.getModeIdByFilenameOrFirstLine(filename, firstLine);\n\t\t\t// Fall back to plain text if no mode was found\n\t\t\treturn this._getOrCreateMode(modeId || 'plaintext');\n\t\t});\n\t}\n\n\tprivate _getOrCreateMode(modeId: string): TPromise<modes.IMode> {\n\t\tif (this._instantiatedModes.hasOwnProperty(modeId)) {\n\t\t\treturn TPromise.as(this._instantiatedModes[modeId]);\n\t\t}\n\n\t\tif (this._activationPromises.hasOwnProperty(modeId)) {\n\t\t\treturn this._activationPromises[modeId];\n\t\t}\n\t\tvar c, e;\n\t\tvar promise = new TPromise((cc,ee,pp) => { c = cc; e = ee; });\n\t\tthis._activationPromises[modeId] = promise;\n\n\t\tthis._createMode(modeId).then((mode) => {\n\t\t\tthis._instantiatedModes[modeId] = mode;\n\t\t\tdelete this._activationPromises[modeId];\n\n\t\t\tthis._onDidCreateMode.fire(mode);\n\n\t\t\tthis._extensionService.activateByEvent(`onLanguage:${modeId}`).done(null, onUnexpectedError);\n\n\t\t\treturn this._instantiatedModes[modeId];\n\t\t}).then(c, e);\n\n\t\treturn promise;\n\t}\n\n\tprivate _createMode(modeId:string): TPromise<modes.IMode> {\n\t\tlet modeDescriptor = this._createModeDescriptor(modeId);\n\n\t\tlet compatModeData = this._registry.getCompatMode(modeId);\n\t\tif (compatModeData) {\n\t\t\t// This is a compatibility mode\n\n\t\t\tlet resolvedDeps: TPromise<modes.IMode[]> = null;\n\t\t\tif (Array.isArray(compatModeData.deps)) {\n\t\t\t\tresolvedDeps = TPromise.join(compatModeData.deps.map(dep => this.getOrCreateMode(dep)));\n\t\t\t} else {\n\t\t\t\tresolvedDeps = TPromise.as<modes.IMode[]>(null);\n\t\t\t}\n\n\t\t\treturn resolvedDeps.then(_ => {\n\t\t\t\tlet compatModeAsyncDescriptor = createAsyncDescriptor1<modes.IModeDescriptor, modes.IMode>(compatModeData.moduleId, compatModeData.ctorName);\n\t\t\t\treturn this._instantiationService.createInstance(compatModeAsyncDescriptor, modeDescriptor).then((compatMode) => {\n\t\t\t\t\tif (compatMode.configSupport) {\n\t\t\t\t\t\tcompatMode.configSupport.configure(this.getConfigurationForMode(modeId));\n\t\t\t\t\t}\n\t\t\t\t\treturn compatMode;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn TPromise.as<modes.IMode>(this._instantiationService.createInstance(FrankensteinMode, modeDescriptor));\n\t}\n\n\tprivate _createModeDescriptor(modeId:string): modes.IModeDescriptor {\n\t\treturn {\n\t\t\tid: modeId\n\t\t};\n\t}\n\n\tprivate _registerTokenizationSupport<T>(mode:modes.IMode, callback: (mode: modes.IMode) => T): IDisposable {\n\t\tif (mode.setTokenizationSupport) {\n\t\t\treturn mode.setTokenizationSupport(callback);\n\t\t} else {\n\t\t\tconsole.warn('Cannot register tokenizationSupport on mode ' + mode.getId() + ' because it does not support it.');\n\t\t\treturn EmptyDisposable;\n\t\t}\n\t}\n\n\tprivate registerModeSupport<T>(modeId: string, callback: (mode: modes.IMode) => T): IDisposable {\n\t\tif (this._instantiatedModes.hasOwnProperty(modeId)) {\n\t\t\treturn this._registerTokenizationSupport(this._instantiatedModes[modeId], callback);\n\t\t}\n\n\t\tlet cc: (disposable:IDisposable)=>void;\n\t\tlet promise = new TPromise<IDisposable>((c, e) => { cc = c; });\n\n\t\tlet disposable = this.onDidCreateMode((mode) => {\n\t\t\tif (mode.getId() !== modeId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcc(this._registerTokenizationSupport(mode, callback));\n\t\t\tdisposable.dispose();\n\t\t});\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tpromise.done(disposable => disposable.dispose(), null);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic registerTokenizationSupport(modeId: string, callback: (mode: modes.IMode) => modes.ITokenizationSupport): IDisposable {\n\t\treturn this.registerModeSupport(modeId, callback);\n\t}\n\n\tpublic registerTokenizationSupport2(modeId: string, support: modes.TokensProvider): IDisposable {\n\t\treturn this.registerModeSupport(modeId, (mode) => {\n\t\t\treturn new TokenizationSupport2Adapter(mode, support);\n\t\t});\n\t}\n}\n\nexport class TokenizationState2Adapter implements modes.IState {\n\n\tprivate _mode: modes.IMode;\n\tprivate _actual: modes.IState2;\n\tprivate _stateData: modes.IState;\n\n\tconstructor(mode: modes.IMode, actual: modes.IState2, stateData: modes.IState) {\n\t\tthis._mode = mode;\n\t\tthis._actual = actual;\n\t\tthis._stateData = stateData;\n\t}\n\n\tpublic get actual(): modes.IState2 { return this._actual; }\n\n\tpublic clone(): TokenizationState2Adapter {\n\t\treturn new TokenizationState2Adapter(this._mode, this._actual.clone(), AbstractState.safeClone(this._stateData));\n\t}\n\n\tpublic equals(other:modes.IState): boolean {\n\t\tif (other instanceof TokenizationState2Adapter) {\n\t\t\tif (!this._actual.equals(other._actual)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn AbstractState.safeEquals(this._stateData, other._stateData);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic getMode(): modes.IMode {\n\t\treturn this._mode;\n\t}\n\n\tpublic tokenize(stream:any): any {\n\t\tthrow new Error('Unexpected tokenize call!');\n\t}\n\n\tpublic getStateData(): modes.IState {\n\t\treturn this._stateData;\n\t}\n\n\tpublic setStateData(stateData:modes.IState): void {\n\t\tthis._stateData = stateData;\n\t}\n}\n\nexport class TokenizationSupport2Adapter implements modes.ITokenizationSupport {\n\n\tprivate _mode: modes.IMode;\n\tprivate _actual: modes.TokensProvider;\n\n\tconstructor(mode: modes.IMode, actual: modes.TokensProvider) {\n\t\tthis._mode = mode;\n\t\tthis._actual = actual;\n\t}\n\n\tpublic getInitialState(): modes.IState {\n\t\treturn new TokenizationState2Adapter(this._mode, this._actual.getInitialState(), null);\n\t}\n\n\tpublic tokenize(line:string, state:modes.IState, offsetDelta: number = 0, stopAtOffset?: number): modes.ILineTokens {\n\t\tif (state instanceof TokenizationState2Adapter) {\n\t\t\tlet actualResult = this._actual.tokenize(line, state.actual);\n\t\t\tlet tokens: modes.IToken[] = [];\n\t\t\tactualResult.tokens.forEach((t) => {\n\t\t\t\tif (typeof t.scopes === 'string') {\n\t\t\t\t\ttokens.push(new Token(t.startIndex + offsetDelta, <string>t.scopes));\n\t\t\t\t} else if (Array.isArray(t.scopes) && t.scopes.length === 1) {\n\t\t\t\t\ttokens.push(new Token(t.startIndex + offsetDelta, t.scopes[0]));\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Only token scopes as strings or of precisely 1 length are supported at this time!');\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn {\n\t\t\t\ttokens: tokens,\n\t\t\t\tactualStopOffset: offsetDelta + line.length,\n\t\t\t\tendState: new TokenizationState2Adapter(state.getMode(), actualResult.endState, state.getStateData()),\n\t\t\t\tmodeTransitions: [{ startIndex: offsetDelta, mode: state.getMode() }],\n\t\t\t};\n\t\t}\n\t\tthrow new Error('Unexpected state to tokenize with!');\n\t}\n\n}\n\nexport class MainThreadModeServiceImpl extends ModeServiceImpl {\n\tprivate _configurationService: IConfigurationService;\n\tprivate _onReadyPromise: TPromise<boolean>;\n\n\tconstructor(\n\t\t@IInstantiationService instantiationService:IInstantiationService,\n\t\t@IExtensionService extensionService:IExtensionService,\n\t\t@IConfigurationService configurationService:IConfigurationService\n\t) {\n\t\tsuper(instantiationService, extensionService);\n\t\tthis._configurationService = configurationService;\n\n\t\tlanguagesExtPoint.setHandler((extensions:IExtensionPointUser<ILanguageExtensionPoint[]>[]) => {\n\t\t\tlet allValidLanguages: IValidLanguageExtensionPoint[] = [];\n\n\t\t\tfor (let i = 0, len = extensions.length; i < len; i++) {\n\t\t\t\tlet extension = extensions[i];\n\n\t\t\t\tif (!Array.isArray(extension.value)) {\n\t\t\t\t\textension.collector.error(nls.localize('invalid', \"Invalid `contributes.{0}`. Expected an array.\", languagesExtPoint.name));\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (let j = 0, lenJ = extension.value.length; j < lenJ; j++) {\n\t\t\t\t\tlet ext = extension.value[j];\n\t\t\t\t\tif (isValidLanguageExtensionPoint(ext, extension.collector)) {\n\t\t\t\t\t\tlet configuration = (ext.configuration ? paths.join(extension.description.extensionFolderPath, ext.configuration) : ext.configuration);\n\t\t\t\t\t\tallValidLanguages.push({\n\t\t\t\t\t\t\tid: ext.id,\n\t\t\t\t\t\t\textensions: ext.extensions,\n\t\t\t\t\t\t\tfilenames: ext.filenames,\n\t\t\t\t\t\t\tfilenamePatterns: ext.filenamePatterns,\n\t\t\t\t\t\t\tfirstLine: ext.firstLine,\n\t\t\t\t\t\t\taliases: ext.aliases,\n\t\t\t\t\t\t\tmimetypes: ext.mimetypes,\n\t\t\t\t\t\t\tconfiguration: configuration\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tModesRegistry.registerLanguages(allValidLanguages);\n\n\t\t});\n\n\t\tthis._configurationService.onDidUpdateConfiguration(e => this.onConfigurationChange(e.config));\n\t}\n\n\tpublic onReady(): TPromise<boolean> {\n\t\tif (!this._onReadyPromise) {\n\t\t\tconst configuration = this._configurationService.getConfiguration<IFilesConfiguration>();\n\t\t\tthis._onReadyPromise = this._extensionService.onReady().then(() => {\n\t\t\t\tthis.onConfigurationChange(configuration);\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\treturn this._onReadyPromise;\n\t}\n\n\tprivate onConfigurationChange(configuration: IFilesConfiguration): void {\n\n\t\t// Clear user configured mime associations\n\t\tmime.clearTextMimes(true /* user configured */);\n\n\t\t// Register based on settings\n\t\tif (configuration.files && configuration.files.associations) {\n\t\t\tObject.keys(configuration.files.associations).forEach(pattern => {\n\t\t\t\tmime.registerTextMime({ mime: this.getMimeForMode(configuration.files.associations[pattern]), filepattern: pattern, userConfigured: true });\n\t\t\t});\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nls from 'vs/nls';\nimport Severity from 'vs/base/common/severity';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {IExtensionDescription, IExtensionService, IExtensionsStatus} from 'vs/platform/extensions/common/extensions';\nimport {ExtensionsRegistry} from 'vs/platform/extensions/common/extensionsRegistry';\n\nconst hasOwnProperty = Object.hasOwnProperty;\n\nexport abstract class ActivatedExtension {\n\tactivationFailed: boolean;\n\n\tconstructor(activationFailed: boolean) {\n\t\tthis.activationFailed = activationFailed;\n\t}\n}\n\nexport interface IActivatedExtensionMap<T extends ActivatedExtension> {\n\t[extensionId: string]: T;\n}\n\ninterface IActivatingExtensionMap {\n\t[extensionId: string]: TPromise<void>;\n}\n\nexport abstract class AbstractExtensionService<T extends ActivatedExtension> implements IExtensionService {\n\tpublic serviceId = IExtensionService;\n\n\tprivate _activatingExtensions: IActivatingExtensionMap;\n\tprotected _activatedExtensions: IActivatedExtensionMap<T>;\n\tprivate _onReady: TPromise<boolean>;\n\tprivate _onReadyC: (v: boolean) => void;\n\n\tconstructor(isReadyByDefault: boolean) {\n\t\tif (isReadyByDefault) {\n\t\t\tthis._onReady = TPromise.as(true);\n\t\t\tthis._onReadyC = (v: boolean) => { /*no-op*/ };\n\t\t} else {\n\t\t\tthis._onReady = new TPromise<boolean>((c, e, p) => {\n\t\t\t\tthis._onReadyC = c;\n\t\t\t}, () => {\n\t\t\t\tconsole.warn('You should really not try to cancel this ready promise!');\n\t\t\t});\n\t\t}\n\t\tthis._activatingExtensions = {};\n\t\tthis._activatedExtensions = {};\n\t}\n\n\tprotected _triggerOnReady(): void {\n\t\tthis._onReadyC(true);\n\t}\n\n\tpublic onReady(): TPromise<boolean> {\n\t\treturn this._onReady;\n\t}\n\n\tpublic getExtensionsStatus(): { [id: string]: IExtensionsStatus } {\n\t\treturn null;\n\t}\n\n\tpublic isActivated(extensionId: string): boolean {\n\t\treturn hasOwnProperty.call(this._activatedExtensions, extensionId);\n\t}\n\n\tpublic activateByEvent(activationEvent: string): TPromise<void> {\n\t\treturn this._onReady.then(() => {\n\t\t\tExtensionsRegistry.triggerActivationEventListeners(activationEvent);\n\t\t\tlet activateExtensions = ExtensionsRegistry.getExtensionDescriptionsForActivationEvent(activationEvent);\n\t\t\treturn this._activateExtensions(activateExtensions, 0);\n\t\t});\n\t}\n\n\tpublic activateById(extensionId: string): TPromise<void> {\n\t\treturn this._onReady.then(() => {\n\t\t\tlet desc = ExtensionsRegistry.getExtensionDescription(extensionId);\n\t\t\tif (!desc) {\n\t\t\t\tthrow new Error('Extension `' + extensionId + '` is not known');\n\t\t\t}\n\n\t\t\treturn this._activateExtensions([desc], 0);\n\t\t});\n\t}\n\n\t/**\n\t * Handle semantics related to dependencies for `currentExtension`.\n\t * semantics: `redExtensions` must wait for `greenExtensions`.\n\t */\n\tprivate _handleActivateRequest(currentExtension: IExtensionDescription, greenExtensions: { [id: string]: IExtensionDescription; }, redExtensions: IExtensionDescription[]): void {\n\t\tlet depIds = (typeof currentExtension.extensionDependencies === 'undefined' ? [] : currentExtension.extensionDependencies);\n\t\tlet currentExtensionGetsGreenLight = true;\n\n\t\tfor (let j = 0, lenJ = depIds.length; j < lenJ; j++) {\n\t\t\tlet depId = depIds[j];\n\t\t\tlet depDesc = ExtensionsRegistry.getExtensionDescription(depId);\n\n\t\t\tif (!depDesc) {\n\t\t\t\t// Error condition 1: unknown dependency\n\t\t\t\tthis._showMessage(Severity.Error, nls.localize('unknownDep', \"Extension `{1}` failed to activate. Reason: unknown dependency `{0}`.\", depId, currentExtension.id));\n\t\t\t\tthis._activatedExtensions[currentExtension.id] = this._createFailedExtension();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (hasOwnProperty.call(this._activatedExtensions, depId)) {\n\t\t\t\tlet dep = this._activatedExtensions[depId];\n\t\t\t\tif (dep.activationFailed) {\n\t\t\t\t\t// Error condition 2: a dependency has already failed activation\n\t\t\t\t\tthis._showMessage(Severity.Error, nls.localize('failedDep1', \"Extension `{1}` failed to activate. Reason: dependency `{0}` failed to activate.\", depId, currentExtension.id));\n\t\t\t\t\tthis._activatedExtensions[currentExtension.id] = this._createFailedExtension();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// must first wait for the dependency to activate\n\t\t\t\tcurrentExtensionGetsGreenLight = false;\n\t\t\t\tgreenExtensions[depId] = depDesc;\n\t\t\t}\n\t\t}\n\n\t\tif (currentExtensionGetsGreenLight) {\n\t\t\tgreenExtensions[currentExtension.id] = currentExtension;\n\t\t} else {\n\t\t\tredExtensions.push(currentExtension);\n\t\t}\n\t}\n\n\tprivate _activateExtensions(extensionDescriptions: IExtensionDescription[], recursionLevel: number): TPromise<void> {\n\t\t// console.log(recursionLevel, '_activateExtensions: ', extensionDescriptions.map(p => p.id));\n\t\tif (extensionDescriptions.length === 0) {\n\t\t\treturn TPromise.as(void 0);\n\t\t}\n\n\t\textensionDescriptions = extensionDescriptions.filter((p) => !hasOwnProperty.call(this._activatedExtensions, p.id));\n\t\tif (extensionDescriptions.length === 0) {\n\t\t\treturn TPromise.as(void 0);\n\t\t}\n\n\t\tif (recursionLevel > 10) {\n\t\t\t// More than 10 dependencies deep => most likely a dependency loop\n\t\t\tfor (let i = 0, len = extensionDescriptions.length; i < len; i++) {\n\t\t\t\t// Error condition 3: dependency loop\n\t\t\t\tthis._showMessage(Severity.Error, nls.localize('failedDep2', \"Extension `{0}` failed to activate. Reason: more than 10 levels of dependencies (most likely a dependency loop).\", extensionDescriptions[i].id));\n\t\t\t\tthis._activatedExtensions[extensionDescriptions[i].id] = this._createFailedExtension();\n\t\t\t}\n\t\t\treturn TPromise.as(void 0);\n\t\t}\n\n\t\tlet greenMap: { [id: string]: IExtensionDescription; } = Object.create(null),\n\t\t\tred: IExtensionDescription[] = [];\n\n\t\tfor (let i = 0, len = extensionDescriptions.length; i < len; i++) {\n\t\t\tthis._handleActivateRequest(extensionDescriptions[i], greenMap, red);\n\t\t}\n\n\t\t// Make sure no red is also green\n\t\tfor (let i = 0, len = red.length; i < len; i++) {\n\t\t\tif (greenMap[red[i].id]) {\n\t\t\t\tdelete greenMap[red[i].id];\n\t\t\t}\n\t\t}\n\n\t\tlet green = Object.keys(greenMap).map(id => greenMap[id]);\n\n\t\t// console.log('greenExtensions: ', green.map(p => p.id));\n\t\t// console.log('redExtensions: ', red.map(p => p.id));\n\n\t\tif (red.length === 0) {\n\t\t\t// Finally reached only leafs!\n\t\t\treturn TPromise.join(green.map((p) => this._activateExtension(p))).then(_ => void 0);\n\t\t}\n\n\t\treturn this._activateExtensions(green, recursionLevel + 1).then(_ => {\n\t\t\treturn this._activateExtensions(red, recursionLevel + 1);\n\t\t});\n\t}\n\n\tprotected _activateExtension(extensionDescription: IExtensionDescription): TPromise<void> {\n\t\tif (hasOwnProperty.call(this._activatedExtensions, extensionDescription.id)) {\n\t\t\treturn TPromise.as(void 0);\n\t\t}\n\n\t\tif (hasOwnProperty.call(this._activatingExtensions, extensionDescription.id)) {\n\t\t\treturn this._activatingExtensions[extensionDescription.id];\n\t\t}\n\n\t\tthis._activatingExtensions[extensionDescription.id] = this._actualActivateExtension(extensionDescription).then(null, (err) => {\n\t\t\tthis._showMessage(Severity.Error, nls.localize('activationError', \"Activating extension `{0}` failed: {1}.\", extensionDescription.id, err.message));\n\t\t\tconsole.error('Activating extension `' + extensionDescription.id + '` failed: ', err.message);\n\t\t\tconsole.log('Here is the error stack: ', err.stack);\n\t\t\t// Treat the extension as being empty\n\t\t\treturn this._createFailedExtension();\n\t\t}).then((x: T) => {\n\t\t\tthis._activatedExtensions[extensionDescription.id] = x;\n\t\t\tdelete this._activatingExtensions[extensionDescription.id];\n\t\t});\n\n\t\treturn this._activatingExtensions[extensionDescription.id];\n\t}\n\n\tprotected abstract _showMessage(severity: Severity, message: string): void;\n\n\tprotected abstract _createFailedExtension(): T;\n\n\tprotected abstract _actualActivateExtension(extensionDescription: IExtensionDescription): TPromise<T>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport http = require('vs/base/common/http');\nimport { TPromise } from 'vs/base/common/winjs.base';\nimport { createDecorator, ServiceIdentifier } from 'vs/platform/instantiation/common/instantiation';\n\nexport const IRequestService = createDecorator<IRequestService>('requestService');\n\nexport interface IRequestService {\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Wraps the call into WinJS.XHR to allow for mocking and telemetry. Use this instead\n\t * of calling WinJS.XHR directly.\n\t */\n\tmakeRequest(options: http.IXHROptions): TPromise<http.IXHRResponse>;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {ITimerEvent, nullEvent} from 'vs/base/common/timer';\nimport {createDecorator, ServiceIdentifier} from 'vs/platform/instantiation/common/instantiation';\n\nexport const ITelemetryService = createDecorator<ITelemetryService>('telemetryService');\n\nexport interface ITelemetryInfo {\n\tsessionId: string;\n\tmachineId: string;\n\tinstanceId: string;\n}\n\nexport interface ITelemetryService {\n\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Sends a telemetry event that has been privacy approved.\n\t * Do not call this unless you have been given approval.\n\t */\n\tpublicLog(eventName: string, data?: any): TPromise<void>;\n\n\t/**\n\t * Starts a telemetry timer. Call stop() to send the event.\n\t */\n\ttimedPublicLog(name: string, data?: any): ITimerEvent;\n\n\tgetTelemetryInfo(): TPromise<ITelemetryInfo>;\n\n\tisOptedIn: boolean;\n}\n\nexport const NullTelemetryService: ITelemetryService = {\n\tserviceId: undefined,\n\ttimedPublicLog(name: string, data?: any) { return nullEvent; },\n\tpublicLog(eventName: string, data?: any) { return TPromise.as<void>(null); },\n\tisOptedIn: true,\n\tgetTelemetryInfo(): TPromise<ITelemetryInfo> {\n\t\treturn TPromise.as({\n\t\t\tinstanceId: 'someValue.instanceId',\n\t\t\tsessionId: 'someValue.sessionId',\n\t\t\tmachineId: 'someValue.machineId'\n\t\t});\n\t}\n};\n\nexport interface ITelemetryAppender {\n\tlog(eventName: string, data: any): void;\n}\n\nexport function combinedAppender(...appenders: ITelemetryAppender[]): ITelemetryAppender {\n\treturn { log: (e, d) => appenders.forEach(a => a.log(e,d)) };\n}\n\nexport const NullAppender: ITelemetryAppender = { log: () => null };\n\n// --- util\n\nexport function anonymize(input: string): string {\n\tif (!input) {\n\t\treturn input;\n\t}\n\n\tlet r = '';\n\tfor (let i = 0; i < input.length; i++) {\n\t\tlet ch = input[i];\n\t\tif (ch >= '0' && ch <= '9') {\n\t\t\tr += '0';\n\t\t\tcontinue;\n\t\t}\n\t\tif (ch >= 'a' && ch <= 'z') {\n\t\t\tr += 'a';\n\t\t\tcontinue;\n\t\t}\n\t\tif (ch >= 'A' && ch <= 'Z') {\n\t\t\tr += 'A';\n\t\t\tcontinue;\n\t\t}\n\t\tr += ch;\n\t}\n\treturn r;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {xhr, IXHROptions} from 'vs/base/common/network';\nimport strings = require('vs/base/common/strings');\nimport Timer = require('vs/base/common/timer');\nimport Async = require('vs/base/common/async');\nimport http = require('vs/base/common/http');\nimport objects = require('vs/base/common/objects');\nimport {IRequestService} from 'vs/platform/request/common/request';\nimport {ITelemetryService, NullTelemetryService} from 'vs/platform/telemetry/common/telemetry';\nimport {IWorkspaceContextService} from 'vs/platform/workspace/common/workspace';\n\n/**\n * Simple IRequestService implementation to allow sharing of this service implementation\n * between different layers of the platform.\n */\nexport class BaseRequestService implements IRequestService {\n\tpublic serviceId = IRequestService;\n\tprivate _serviceMap: { [service: string]: string; };\n\tprivate _origin: string;\n\n\tprotected _telemetryService: ITelemetryService;\n\n\tconstructor(contextService: IWorkspaceContextService, telemetryService: ITelemetryService = NullTelemetryService) {\n\t\tlet workspaceUri: string = null;\n\n\t\tlet workspace = contextService.getWorkspace();\n\t\tthis._serviceMap = (<any>workspace) || Object.create(null);\n\t\tthis._telemetryService = telemetryService;\n\n\t\tif (workspace) {\n\t\t\tworkspaceUri = strings.rtrim(workspace.resource.toString(), '/') + '/';\n\t\t}\n\n\t\tthis.computeOrigin(workspaceUri);\n\t}\n\n\tprivate computeOrigin(workspaceUri: string): void {\n\t\tif (workspaceUri) {\n\n\t\t\t// Find root server URL from configuration\n\t\t\tthis._origin = workspaceUri;\n\t\t\tlet urlPath = URI.parse(this._origin).path;\n\t\t\tif (urlPath && urlPath.length > 0) {\n\t\t\t\tthis._origin = this._origin.substring(0, this._origin.length - urlPath.length + 1);\n\t\t\t}\n\n\t\t\tif (!strings.endsWith(this._origin, '/')) {\n\t\t\t\tthis._origin += '/';\n\t\t\t}\n\t\t} else {\n\t\t\tthis._origin = '/'; // Configuration not provided, fallback to default\n\t\t}\n\t}\n\n\tprotected makeCrossOriginRequest(options: http.IXHROptions): TPromise<http.IXHRResponse> {\n\t\treturn null;\n\t}\n\n\tpublic makeRequest(options: http.IXHROptions): TPromise<http.IXHRResponse> {\n\t\tlet timer: Timer.ITimerEvent = Timer.nullEvent;\n\n\t\tlet isXhrRequestCORS = false;\n\n\t\tlet url = options.url;\n\t\tif (!url) {\n\t\t\tthrow new Error('IRequestService.makeRequest: Url is required');\n\t\t}\n\n\t\tif ((strings.startsWith(url, 'http://') || strings.startsWith(url, 'https://')) && this._origin && !strings.startsWith(url, this._origin)) {\n\t\t\tlet coPromise = this.makeCrossOriginRequest(options);\n\t\t\tif (coPromise) {\n\t\t\t\treturn coPromise;\n\t\t\t}\n\t\t\tisXhrRequestCORS = true;\n\t\t}\n\n\t\tlet xhrOptions = <IXHROptions>options;\n\n\t\tlet xhrOptionsPromise = TPromise.as(undefined);\n\t\tif (!isXhrRequestCORS) {\n\t\t\txhrOptions = this._telemetryService.getTelemetryInfo().then(info => {\n\t\t\t\tlet additionalHeaders = {};\n\t\t\t\tadditionalHeaders['X-TelemetrySession'] = info.sessionId;\n\t\t\t\tadditionalHeaders['X-Requested-With'] = 'XMLHttpRequest';\n\t\t\t\txhrOptions.headers = objects.mixin(xhrOptions.headers, additionalHeaders);\n\t\t\t});\n\t\t}\n\n\t\tif (options.timeout) {\n\t\t\txhrOptions.customRequestInitializer = function(xhrRequest: XMLHttpRequest) {\n\t\t\t\txhrRequest.timeout = options.timeout;\n\t\t\t};\n\t\t}\n\n\t\treturn xhrOptionsPromise.then(() => {\n\t\t\treturn Async.always(xhr(xhrOptions), ((xhr: XMLHttpRequest) => {\n\t\t\t\tif (timer.data) {\n\t\t\t\t\ttimer.data.status = xhr.status;\n\t\t\t\t}\n\t\t\t\ttimer.stop();\n\t\t\t}));\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport {createDecorator, ServiceIdentifier} from 'vs/platform/instantiation/common/instantiation';\n\nexport const IWorkspaceContextService = createDecorator<IWorkspaceContextService>('contextService');\n\nexport interface IWorkspaceContextService {\n\tserviceId: ServiceIdentifier<any>;\n\n\t/**\n\t * Provides access to the workspace object the platform is running with. This may be null if the workbench was opened\n\t * without workspace (empty);\n\t */\n\tgetWorkspace(): IWorkspace;\n\n\t/**\n\t * Provides access to the configuration object the platform is running with.\n\t */\n\tgetConfiguration(): IConfiguration;\n\n\t/**\n\t * Provides access to the options object the platform is running with.\n\t */\n\tgetOptions(): any;\n\n\t/**\n\t * Returns iff the provided resource is inside the workspace or not.\n\t */\n\tisInsideWorkspace(resource: URI): boolean;\n\n\t/**\n\t * Given a resource inside the workspace, returns its relative path from the workspace root\n\t * without leading or trailing slashes. Returns null if the file is not inside an opened\n\t * workspace.\n\t */\n\ttoWorkspaceRelativePath: (resource: URI) => string;\n\n\t/**\n\t * Given a workspace relative path, returns the resource with the absolute path.\n\t */\n\ttoResource: (workspaceRelativePath: string) => URI;\n}\n\nexport interface IWorkspace {\n\n\t/**\n\t * the full uri of the workspace. this is a file:// URL to the location\n\t * of the workspace on disk.\n\t */\n\tresource: URI;\n\n\t/**\n\t * the identifier that uniquely identifies this workspace among others.\n\t */\n\tid: string;\n\n\t/**\n\t * the name of the workspace\n\t */\n\tname: string;\n\n\t/**\n\t * the last modified date of the workspace if known\n\t */\n\tmtime?: number;\n\n\t/**\n\t * the unique identifier of the workspace. if the workspace is deleted and recreated\n\t * the identifier also changes. this makes the uid more unique compared to the id which\n\t * is just derived from the workspace name.\n\t */\n\tuid?: number;\n}\n\nexport interface IConfiguration {\n\t/**\n\t * Some environmental flags\n\t */\n\tenv?: IEnvironment;\n}\n\nexport interface IEnvironment {\n\tappName: string;\n\tappRoot: string;\n\tisBuilt: boolean;\n\texecPath: string;\n\n\tapplicationName: string;\n\tdarwinBundleIdentifier: string;\n\n\tversion: string;\n\tcommitHash: string;\n\n\tupdateFeedUrl: string;\n\tupdateChannel: string;\n\n\textensionsGallery: {\n\t\tserviceUrl: string;\n\t\titemUrl: string;\n\t};\n\n\textensionTips: { [id: string]: string; };\n\n\treleaseNotesUrl: string;\n\tlicenseUrl: string;\n\tproductDownloadUrl: string;\n\n\twelcomePage: string;\n\n\tcrashReporter: any;\n\n\tappSettingsHome: string;\n\tappSettingsPath: string;\n\tappKeybindingsPath: string;\n\n\tdebugExtensionHostPort: number;\n\tdebugBrkExtensionHost: boolean;\n\tdisableExtensions: boolean;\n\n\tlogExtensionHostCommunication: boolean;\n\tdebugBrkFileWatcherPort: number;\n\tverboseLogging: boolean;\n\tenablePerformance: boolean;\n\n\tuserExtensionsHome: string;\n\tsharedIPCHandle: string;\n\textensionDevelopmentPath: string;\n\textensionTestsPath: string;\n\n\trecentFiles: string[];\n\trecentFolders: string[];\n\n\tenableTelemetry: boolean;\n\n\taiConfig: {\n\t\tkey: string;\n\t\tasimovKey: string;\n\t};\n\n\tsendASmile: {\n\t\treportIssueUrl: string,\n\t\trequestFeatureUrl: string\n\t};\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\n// base common\nimport 'vs/base/common/assert';\nimport 'vs/base/common/async';\nimport 'vs/base/common/callbackList';\nimport 'vs/base/common/cancellation';\nimport 'vs/base/common/collections';\nimport 'vs/base/common/event';\nimport 'vs/base/common/events';\nimport 'vs/base/common/lifecycle';\nimport 'vs/base/common/paths';\nimport 'vs/base/common/uri';\n\n// platform common\nimport 'vs/platform/platform';\nimport 'vs/platform/jsonschemas/common/jsonContributionRegistry';\nimport 'vs/platform/request/common/request';\nimport 'vs/platform/workspace/common/workspace';\nimport 'vs/platform/telemetry/common/telemetry';\n\n// editor common\nimport 'vs/editor/common/editorCommon';\nimport 'vs/editor/common/modes';\nimport 'vs/editor/common/modes/abstractMode';\nimport 'vs/editor/common/modes/abstractState';\nimport 'vs/editor/common/modes/monarch/monarchCommon';\nimport 'vs/editor/common/modes/monarch/monarchLexer';\nimport 'vs/editor/common/modes/monarch/monarchCompile';\nimport 'vs/editor/common/modes/languageConfigurationRegistry';\nimport 'vs/editor/common/modes/supports/suggestSupport';\nimport 'vs/editor/common/modes/supports/tokenizationSupport';\nimport 'vs/editor/common/services/modelService';\nimport 'vs/editor/common/services/modeService';\nimport 'vs/editor/common/services/compatWorkerService';\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport URI from 'vs/base/common/uri';\nimport paths = require('vs/base/common/paths');\nimport {IWorkspaceContextService, IWorkspace, IConfiguration} from './workspace';\n\n/**\n * Simple IWorkspaceContextService implementation to allow sharing of this service implementation\n * between different layers of the platform.\n */\nexport class BaseWorkspaceContextService implements IWorkspaceContextService {\n\tpublic serviceId = IWorkspaceContextService;\n\tprotected options: any;\n\n\tprivate workspace: IWorkspace;\n\tprivate configuration: IConfiguration;\n\n\tconstructor(workspace: IWorkspace, configuration?: IConfiguration, options: any = {}) {\n\t\tthis.workspace = workspace;\n\t\tthis.configuration = configuration;\n\t\tthis.options = options;\n\t}\n\n\tpublic getWorkspace(): IWorkspace {\n\t\treturn this.workspace;\n\t}\n\n\tpublic getConfiguration(): IConfiguration {\n\t\treturn this.configuration;\n\t}\n\n\tpublic getOptions(): any {\n\t\treturn this.options;\n\t}\n\n\tpublic isInsideWorkspace(resource: URI): boolean {\n\t\tif (resource && this.workspace) {\n\t\t\treturn paths.isEqualOrParent(resource.fsPath, this.workspace.resource.fsPath);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic toWorkspaceRelativePath(resource: URI): string {\n\t\tif (this.isInsideWorkspace(resource)) {\n\t\t\treturn paths.normalize(paths.relative(this.workspace.resource.fsPath, resource.fsPath));\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tpublic toResource(workspaceRelativePath: string): URI {\n\t\tif (typeof workspaceRelativePath === 'string' && this.workspace) {\n\t\t\treturn URI.file(paths.join(this.workspace.resource.fsPath, workspaceRelativePath));\n\t\t}\n\n\t\treturn null;\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\n// include these in the editor bundle because they are widely used by many languages\nimport 'vs/editor/common/languages.common';\nimport Severity from 'vs/base/common/severity';\nimport {TPromise} from 'vs/base/common/winjs.base';\nimport {WorkerServer} from 'vs/base/common/worker/workerServer';\nimport {EventService} from 'vs/platform/event/common/eventService';\nimport {IEventService} from 'vs/platform/event/common/event';\nimport {AbstractExtensionService, ActivatedExtension} from 'vs/platform/extensions/common/abstractExtensionService';\nimport {IExtensionDescription, IExtensionService} from 'vs/platform/extensions/common/extensions';\nimport {ServiceCollection} from 'vs/platform/instantiation/common/serviceCollection';\nimport {InstantiationService} from 'vs/platform/instantiation/common/instantiationService';\nimport {BaseRequestService} from 'vs/platform/request/common/baseRequestService';\nimport {IRequestService} from 'vs/platform/request/common/request';\nimport {NullTelemetryService} from 'vs/platform/telemetry/common/telemetry';\nimport {BaseWorkspaceContextService} from 'vs/platform/workspace/common/baseWorkspaceContextService';\nimport {IWorkspaceContextService} from 'vs/platform/workspace/common/workspace';\nimport {ModeServiceImpl} from 'vs/editor/common/services/modeServiceImpl';\nimport {IModeService, ILanguageExtensionPoint} from 'vs/editor/common/services/modeService';\nimport {ResourceService} from 'vs/editor/common/services/resourceServiceImpl';\nimport {IResourceService} from 'vs/editor/common/services/resourceService';\nimport {CompatWorkerServiceWorker} from 'vs/editor/common/services/compatWorkerServiceWorker';\nimport {ICompatWorkerService} from 'vs/editor/common/services/compatWorkerService';\nimport {ILegacyLanguageDefinition} from 'vs/editor/common/modes/modesRegistry';\n\nexport interface IInitData {\n\tcontextService: {\n\t\tworkspace:any;\n\t\tconfiguration:any;\n\t\toptions:any;\n\t};\n\tmodesRegistryData?: {\n\t\tcompatModes: ILegacyLanguageDefinition[];\n\t\tlanguages: ILanguageExtensionPoint[];\n\t};\n}\n\nexport interface ICallback {\n\t(something:any):void;\n}\n\nclass WorkerExtensionService extends AbstractExtensionService<ActivatedExtension> {\n\n\tconstructor() {\n\t\tsuper(true);\n\t}\n\n\tprotected _showMessage(severity:Severity, msg:string): void {\n\t\tswitch (severity) {\n\t\t\tcase Severity.Error:\n\t\t\t\tconsole.error(msg);\n\t\t\t\tbreak;\n\t\t\tcase Severity.Warning:\n\t\t\t\tconsole.warn(msg);\n\t\t\t\tbreak;\n\t\t\tcase Severity.Info:\n\t\t\t\tconsole.info(msg);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.log(msg);\n\t\t}\n\t}\n\n\tprotected _createFailedExtension(): ActivatedExtension {\n\t\tthrow new Error('unexpected');\n\t}\n\n\tprotected _actualActivateExtension(extensionDescription: IExtensionDescription): TPromise<ActivatedExtension> {\n\t\tthrow new Error('unexpected');\n\t}\n}\n\nexport class EditorWorkerServer {\n\n\tprivate compatWorkerService:CompatWorkerServiceWorker;\n\n\tconstructor() {\n\t}\n\n\tpublic initialize(mainThread:WorkerServer, complete:ICallback, error:ICallback, progress:ICallback, initData:IInitData):void {\n\n\t\tconst services = new ServiceCollection();\n\t\tconst instantiationService = new InstantiationService(services);\n\n\t\tconst extensionService = new WorkerExtensionService();\n\t\tservices.set(IExtensionService, extensionService);\n\n\t\tconst contextService = new BaseWorkspaceContextService(initData.contextService.workspace, initData.contextService.configuration, initData.contextService.options);\n\t\tservices.set(IWorkspaceContextService, contextService);\n\n\t\tconst resourceService = new ResourceService();\n\t\tservices.set(IResourceService, resourceService);\n\n\t\tconst requestService = new BaseRequestService(contextService, NullTelemetryService);\n\t\tservices.set(IRequestService, requestService);\n\n\t\tservices.set(IEventService, new EventService());\n\n\t\tconst modeService = new ModeServiceImpl(instantiationService, extensionService);\n\t\tservices.set(IModeService, modeService);\n\n\t\tthis.compatWorkerService = new CompatWorkerServiceWorker(resourceService, modeService, initData.modesRegistryData);\n\t\tservices.set(ICompatWorkerService, this.compatWorkerService);\n\n\t\tcomplete(undefined);\n\t}\n\n\tpublic request(mainThread:WorkerServer, complete:ICallback, error:ICallback, progress:ICallback, data:any):void {\n\t\ttry {\n\t\t\tTPromise.as(\n\t\t\t\tthis.compatWorkerService.handleMainRequest(data.target, data.methodName, data.args)\n\t\t\t).then(complete, error);\n\t\t} catch (err) {\n\t\t\terror(err);\n\t\t}\n\t}\n}\n\nexport var value = new EditorWorkerServer();\n"]}